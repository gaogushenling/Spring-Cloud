<!DOCTYPE html>
<!-- saved from url=(0074)https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Spring Cloud</title>
<link rel="stylesheet" href="./Spring Cloud_files/spring.css">
<link rel="stylesheet" href="./Spring Cloud_files/font-awesome.min.css">
<style>.hidden{display:none}.switch{border-width:1px 1px 0 1px;border-style:solid;border-color:#7a2518;display:inline-block}.switch--item{padding:10px;background-color:#fff;color:#7a2518;display:inline-block;cursor:pointer}.switch--item:not(:first-child) {border-width:0 0 0 1px;border-style:solid;border-color:#7a2518}.switch--item.selected{background-color:#7a2519;color:#fff}</style>
<script async="" src="./Spring Cloud_files/analytics.js.下载"></script><script src="./Spring Cloud_files/zepto.min.js.下载"></script>
<script type="text/javascript">function addBlockSwitches(){$('.primary').each(function(){primary=$(this);createSwitchItem(primary,createBlockSwitch(primary)).item.addClass("selected");primary.children('.title').remove();});$('.secondary').each(function(idx,node){secondary=$(node);primary=findPrimary(secondary);switchItem=createSwitchItem(secondary,primary.children('.switch'));switchItem.content.addClass('hidden');findPrimary(secondary).append(switchItem.content);secondary.remove();});}function createBlockSwitch(primary){blockSwitch=$('<div class="switch"></div>');primary.prepend(blockSwitch);return blockSwitch;}function findPrimary(secondary){candidate=secondary.prev();while(!candidate.is('.primary')){candidate=candidate.prev();}return candidate;}function createSwitchItem(block,blockSwitch){blockName=block.children('.title').text();content=block.children('.content').first().append(block.next('.colist'));item=$('<div class="switch--item">'+blockName+'</div>');item.on('click','',content,function(e){$(this).addClass('selected');$(this).siblings().removeClass('selected');e.data.siblings('.content').addClass('hidden');e.data.removeClass('hidden');});blockSwitch.append(item);return{'item':item,'content':content};}function globalSwitch(){$('.switch--item').each(function(){$(this).off('click');$(this).on('click',function(){selectedText=$(this).text()
selectedIndex=$(this).index()
$(".switch--item").filter(function(){return($(this).text()===selectedText)}).each(function(){$(this).addClass('selected');$(this).siblings().removeClass('selected');selectedContent=$(this).parent().siblings(".content").eq(selectedIndex)
selectedContent.removeClass('hidden');selectedContent.siblings().addClass('hidden');});});});}$(addBlockSwitches);$(globalSwitch);</script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Spring Cloud</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features">1. Features</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-documentation-versions">2. Release Train Versions</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-aws">Spring Cloud AWS</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-amazon-web-services">3. Using Amazon Web Services</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#basic-setup">4. Basic setup</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-aws-maven-dependency-management">4.1. Spring Cloud AWS maven dependency management</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#amazon-sdk-dependency-version-management">4.2. Amazon SDK dependency version management</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#amazon-sdk-configuration">4.3. Amazon SDK configuration</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-environment">5. Cloud environment</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#retrieving-instance-metadata">5.1. Retrieving instance metadata</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#integrating-your-spring-cloud-application-with-the-aws-parameter-store">5.2. Integrating your Spring Cloud application with the AWS Parameter Store</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#integrating-your-spring-cloud-application-with-the-aws-secrets-manager">5.3. Integrating your Spring Cloud application with the AWS Secrets Manager</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#managing-cloud-environments">6. Managing cloud environments</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#automatic-cloudformation-configuration">6.1. Automatic CloudFormation configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#manual-cloudformation-configuration">6.2. Manual CloudFormation configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloudformation-configuration-with-java-config-classes">6.3. CloudFormation configuration with Java config classes</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloudformation-configuration-in-spring-boot">6.4. CloudFormation configuration in Spring Boot</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#manual-name-resolution">6.5. Manual name resolution</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stack-tags">6.6. Stack Tags</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-custom-cloudformation-client">6.7. Using custom CloudFormation client</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#messaging">7. Messaging</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-messaging">7.1. Configuring messaging</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sqs-support">7.2. SQS support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sns-support">7.3. SNS support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-cloudformation">7.4. Using CloudFormation</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#caching">8. Caching</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-dependencies-for-redis-caches">8.1. Configuring dependencies for Redis caches</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-caching-with-xml">8.2. Configuring caching with XML</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-caching-using-java-configuration">8.3. Configuring caching using Java configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-caching-in-spring-boot">8.4. Configuring caching in Spring Boot</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-caching">8.5. Using caching</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#memcached-client-implementation">8.6. Memcached client implementation</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-cloudformation-2">8.7. Using CloudFormation</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#data-access-with-jdbc">9. Data Access with JDBC</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-data-source">9.1. Configuring data source</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-data-source-with-java-config">9.2. Configuring data source with Java config</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-data-source-in-spring-boot">9.3. Configuring data source in Spring Boot</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#read-replica-configuration">9.4. Read-replica configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#failover-support">9.5. Failover support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloudformation-support">9.6. CloudFormation support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#database-tags">9.7. Database tags</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-mails">10. Sending mails</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-the-mail-sender">10.1. Configuring the mail sender</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-simple-mails">10.2. Sending simple mails</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-attachments">10.3. Sending attachments</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-regions">10.4. Configuring regions</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#authenticating-e-mails">10.5. Authenticating e-mails</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#resource-handling">11. Resource handling</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-the-resource-loader">11.1. Configuring the resource loader</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#downloading-files">11.2. Downloading files</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#uploading-files">11.3. Uploading files</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#searching-resources">11.4. Searching resources</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-cloudformation-3">11.5. Using CloudFormation</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloudwatch-metrics">12. CloudWatch Metrics</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties">13. Configuration properties</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-build">Spring Cloud Build</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#building-and-deploying">14. Building and Deploying</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#contributing">15. Contributing</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sign-the-contributor-license-agreement">15.1. Sign the Contributor License Agreement</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-of-conduct">15.2. Code of Conduct</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-conventions-and-housekeeping">15.3. Code Conventions and Housekeeping</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#checkstyle">15.4. Checkstyle</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ide-setup">15.5. IDE setup</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#flattening-the-poms">16. Flattening the POMs</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reusing-the-documentation">17. Reusing the documentation</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#updating-the-guides">18. Updating the guides</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-bus">Spring Cloud Bus</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quick-start">19. Quick Start</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bus-endpoints">20. Bus Endpoints</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bus-refresh-endpoint">20.1. Bus Refresh Endpoint</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bus-env-endpoint">20.2. Bus Env Endpoint</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#addressing-an-instance">21. Addressing an Instance</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#addressing-all-instances-of-a-service">22. Addressing All Instances of a Service</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-id-must-be-unique">23. Service ID Must Be Unique</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-the-message-broker">24. Customizing the Message Broker</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tracing-bus-events">25. Tracing Bus Events</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#broadcasting-your-own-events">26. Broadcasting Your Own Events</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-events-in-custom-packages">26.1. Registering events in custom packages</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-2">27. Configuration properties</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-circuit-breaker">Spring Cloud Circuit Breaker</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-resilience4j-circuit-breakers">.1. Configuring Resilience4J Circuit Breakers</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-spring-retry-circuit-breakers">.2. Configuring Spring Retry Circuit Breakers</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#building">28. Building</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#basic-compile-and-test">28.1. Basic Compile and Test</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#documentation">28.2. Documentation</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#working-with-the-code">28.3. Working with the code</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#contributing-2">29. Contributing</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sign-the-contributor-license-agreement-2">29.1. Sign the Contributor License Agreement</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-of-conduct-2">29.2. Code of Conduct</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-conventions-and-housekeeping-2">29.3. Code Conventions and Housekeeping</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#checkstyle-2">29.4. Checkstyle</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ide-setup-2">29.5. IDE setup</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-cloud-cli">Spring Boot Cloud CLI</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#installation">30. Installation</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#running-spring-cloud-services-in-development">31. Running Spring Cloud Services in Development</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#adding-additional-applications">31.1. Adding Additional Applications</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#writing-groovy-scripts-and-running-applications">32. Writing Groovy Scripts and Running Applications</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#encryption-and-decryption">33. Encryption and Decryption</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-for-cloud-foundry">Spring Cloud for Cloud Foundry</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discovery">34. Discovery</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#single-sign-on">35. Single Sign On</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration">36. Configuration</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-native-applications">Cloud Native Applications</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-context-application-context-services">37. Spring Cloud Context: Application Context Services</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-bootstrap-application-context">37.1. The Bootstrap Application Context</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#application-context-hierarchies">37.2. Application Context Hierarchies</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-bootstrap-properties">37.3. Changing the Location of Bootstrap Properties</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#overriding-bootstrap-properties">37.4. Overriding the Values of Remote Properties</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-the-bootstrap-configuration">37.5. Customizing the Bootstrap Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-bootstrap-property-sources">37.6. Customizing the Bootstrap Property Sources</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#logging-configuration">37.7. Logging Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#environment-changes">37.8. Environment Changes</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#refresh-scope">37.9. Refresh Scope</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#encryption-and-decryption-2">37.10. Encryption and Decryption</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#endpoints">37.11. Endpoints</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-commons-common-abstractions">38. Spring Cloud Commons: Common Abstractions</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discovery-client">38.1. The <code>@EnableDiscoveryClient</code> Annotation</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serviceregistry">38.2. ServiceRegistry</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rest-template-loadbalancer-client">38.3. Spring RestTemplate as a Load Balancer Client</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#webclinet-loadbalancer-client">38.4. Spring WebClient as a Load Balancer Client</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#multiple-resttemplate-objects">38.5. Multiple <code>RestTemplate</code> Objects</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#multiple-webclient-objects">38.6. Multiple WebClient Objects</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#loadbalanced-webclient">38.7. Spring WebFlux <code>WebClient</code> as a Load Balancer Client</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ignore-network-interfaces">38.8. Ignore Network Interfaces</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-clients">38.9. HTTP Client Factories</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enabled-features">38.10. Enabled Features</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-compatibility-verification">38.11. Spring Cloud Compatibility Verification</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-loadbalancer">39. Spring Cloud LoadBalancer</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#switching-between-the-load-balancing-algorithms">39.1. Switching between the load-balancing algorithms</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-loadbalancer-integrations">39.2. Spring Cloud LoadBalancer integrations</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#loadbalancer-caching">39.3. Spring Cloud LoadBalancer Caching</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zone-based-load-balancing">39.4. Zone-Based Load-Balancing</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#instance-health-check-for-loadbalancer">39.5. Instance Health-Check for LoadBalancer</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#same-instance-preference-for-loadbalancer">39.6. Same instance preference for LoadBalancer</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-loadbalancer-starter">39.7. Spring Cloud LoadBalancer Starter</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-loadbalancer-configuration">39.8. Passing Your Own Spring Cloud LoadBalancer Configuration</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-circuit-breaker-2">40. Spring Cloud Circuit Breaker</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#introduction">40.1. Introduction</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#core-concepts">40.2. Core Concepts</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-2">40.3. Configuration</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cachedrandompropertysource">41. CachedRandomPropertySource</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-3">42. Configuration Properties</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config">Spring Cloud Config</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quick-start-2">43. Quick Start</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#client-side-usage">43.1. Client Side Usage</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-server">44. Spring Cloud Config Server</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#environment-repository">44.1. Environment Repository</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#health-indicator-2">44.2. Health Indicator</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#security">44.3. Security</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#encryption-and-decryption-3">44.4. Encryption and Decryption</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#key-management">44.5. Key Management</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-a-key-store-for-testing">44.6. Creating a Key Store for Testing</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-multiple-keys-and-key-rotation">44.7. Using Multiple Keys and Key Rotation</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serving-encrypted-properties">44.8. Serving Encrypted Properties</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serving-alternative-formats">45. Serving Alternative Formats</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serving-plain-text">46. Serving Plain Text</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-serving-plain-text-git-svn-native-backends">46.1. Git, SVN, and Native Backends</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-serving-plain-text-aws-s3">46.2. AWS S3</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#decrypting-plain-text">46.3. Decrypting Plain Text</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#embedding-the-config-server">47. Embedding the Config Server</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#push-notifications-and-spring-cloud-bus">48. Push Notifications and Spring Cloud Bus</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-client">49. Spring Cloud Config Client</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#config-first-bootstrap">49.1. Config First Bootstrap</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discovery-first-bootstrap">49.2. Discovery First Bootstrap</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#config-client-fail-fast">49.3. Config Client Fail Fast</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#config-client-retry">49.4. Config Client Retry</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#locating-remote-configuration-resources">49.5. Locating Remote Configuration Resources</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#specifying-multiple-urls-for-the-config-server">49.6. Specifying Multiple Urls for the Config Server</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-timeouts">49.7. Configuring Timeouts</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#security-2">49.8. Security</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#nested-keys-in-vault">49.9. Nested Keys In Vault</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul">Spring Cloud Consul</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-install">50. Install Consul</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-agent">51. Consul Agent</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-discovery">52. Service Discovery with Consul</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-activate">52.1. How to activate</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-with-consul">52.2. Registering with Consul</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#looking-up-services">52.3. Looking up services</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#consul-catalog-watch">52.4. Consul Catalog Watch</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-config">53. Distributed Configuration with Consul</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-activate-2">53.1. How to activate</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing">53.2. Customizing</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-config-watch">53.3. Config Watch</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-config-format">53.4. YAML or Properties with Config</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-config-git2consul">53.5. git2consul with Config</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-failfast">53.6. Fail Fast</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-retry">54. Consul Retry</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-bus">55. Spring Cloud Bus with Consul</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-activate-3">55.1. How to activate</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-hystrix">56. Circuit Breaker with Hystrix</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-turbine">57. Hystrix metrics aggregation with Turbine and Consul</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-4">58. Configuration Properties</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-function">Spring Cloud Function</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#introduction-2">59. Introduction</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started">60. Getting Started</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#programming-model">61. Programming model</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-catalog-and-flexible-function-signatures">61.1. Function Catalog and Flexible Function Signatures</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#java-8-function-support">61.2. Java 8 function support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-composition">61.3. Function Composition</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-routing-and-filtering">61.4. Function Routing and Filtering</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-arity">61.5. Function Arity</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#type-conversion-content-type-negotiation">61.6. Type conversion (Content-Type negotiation)</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kotlin-lambda-support">61.7. Kotlin Lambda support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-component-scan">61.8. Function Component Scan</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#standalone-web-applications">62. Standalone Web Applications</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-mapping-rules">62.1. Function Mapping rules</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-filtering-rules">62.2. Function Filtering rules</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#standalone-streaming-applications">63. Standalone Streaming Applications</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#deploying-a-packaged-function">64. Deploying a Packaged Function</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#supported-packaging-scenarios">64.1. Supported Packaging Scenarios</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#functional-bean-definitions">65. Functional Bean Definitions</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#comparing-functional-with-traditional-bean-definitions">65.1. Comparing Functional with Traditional Bean Definitions</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#limitations-of-functional-bean-declaration">65.2. Limitations of Functional Bean Declaration</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#testing-functional-applications">66. Testing Functional Applications</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dynamic-compilation">67. Dynamic Compilation</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serverless-platform-adapters">68. Serverless Platform Adapters</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#aws-lambda">68.1. AWS Lambda</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#microsoft-azure">68.2. Microsoft Azure</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#google-cloud-functions-alpha">68.3. Google Cloud Functions (Alpha)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gateway">Spring Cloud Gateway</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-starter">69. How to Include Spring Cloud Gateway</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#glossary">70. Glossary</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-how-it-works">71. How It Works</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-route-predicate-factories-and-gateway-filter-factories">72. Configuring Route Predicate Factories and Gateway Filter Factories</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#shortcut-configuration">72.1. Shortcut Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#fully-expanded-arguments">72.2. Fully Expanded Arguments</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-request-predicates-factories">73. Route Predicate Factories</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-after-route-predicate-factory">73.1. The After Route Predicate Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-before-route-predicate-factory">73.2. The Before Route Predicate Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-between-route-predicate-factory">73.3. The Between Route Predicate Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-cookie-route-predicate-factory">73.4. The Cookie Route Predicate Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-header-route-predicate-factory">73.5. The Header Route Predicate Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-host-route-predicate-factory">73.6. The Host Route Predicate Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-method-route-predicate-factory">73.7. The Method Route Predicate Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-path-route-predicate-factory">73.8. The Path Route Predicate Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-query-route-predicate-factory">73.9. The Query Route Predicate Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-remoteaddr-route-predicate-factory">73.10. The RemoteAddr Route Predicate Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-weight-route-predicate-factory">73.11. The Weight Route Predicate Factory</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gatewayfilter-factories">74. <code>GatewayFilter</code> Factories</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-addrequestheader-gatewayfilter-factory">74.1. The <code>AddRequestHeader</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-addrequestparameter-gatewayfilter-factory">74.2. The <code>AddRequestParameter</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-addresponseheader-gatewayfilter-factory">74.3. The <code>AddResponseHeader</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-deduperesponseheader-gatewayfilter-factory">74.4. The <code>DedupeResponseHeader</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix">74.5. The Hystrix <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-circuitbreaker-filter-factory">74.6. Spring Cloud CircuitBreaker GatewayFilter Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#fallback-headers">74.7. The <code>FallbackHeaders</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-maprequestheader-gatewayfilter-factory">74.8. The <code>MapRequestHeader</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-prefixpath-gatewayfilter-factory">74.9. The <code>PrefixPath</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-preservehostheader-gatewayfilter-factory">74.10. The <code>PreserveHostHeader</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-requestratelimiter-gatewayfilter-factory">74.11. The <code>RequestRateLimiter</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-redirectto-gatewayfilter-factory">74.12. The <code>RedirectTo</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-removerequestheader-gatewayfilter-factory">74.13. The <code>RemoveRequestHeader</code> GatewayFilter Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#removeresponseheader-gatewayfilter-factory">74.14. <code>RemoveResponseHeader</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-removerequestparameter-gatewayfilter-factory">74.15. The <code>RemoveRequestParameter</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-rewritepath-gatewayfilter-factory">74.16. The <code>RewritePath</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rewritelocationresponseheader-gatewayfilter-factory">74.17. <code>RewriteLocationResponseHeader</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-rewriteresponseheader-gatewayfilter-factory">74.18. The <code>RewriteResponseHeader</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-savesession-gatewayfilter-factory">74.19. The <code>SaveSession</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-secureheaders-gatewayfilter-factory">74.20. The <code>SecureHeaders</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-setpath-gatewayfilter-factory">74.21. The <code>SetPath</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-setrequestheader-gatewayfilter-factory">74.22. The <code>SetRequestHeader</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-setresponseheader-gatewayfilter-factory">74.23. The <code>SetResponseHeader</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-setstatus-gatewayfilter-factory">74.24. The <code>SetStatus</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-stripprefix-gatewayfilter-factory">74.25. The <code>StripPrefix</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-retry-gatewayfilter-factory">74.26. The Retry <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-requestsize-gatewayfilter-factory">74.27. The <code>RequestSize</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-setrequesthostheader-gatewayfilter-factory">74.28. The <code>SetRequestHostHeader</code> <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#modify-a-request-body-gatewayfilter-factory">74.29. Modify a Request Body <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#modify-a-response-body-gatewayfilter-factory">74.30. Modify a Response Body <code>GatewayFilter</code> Factory</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#default-filters">74.31. Default Filters</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#global-filters">75. Global Filters</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-combined-global-filter-and-gatewayfilter-ordering">75.1. Combined Global Filter and <code>GatewayFilter</code> Ordering</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#forward-routing-filter">75.2. Forward Routing Filter</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-loadbalancerclient-filter">75.3. The <code>LoadBalancerClient</code> Filter</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-loadbalancer-client-filter">75.4. The <code>ReactiveLoadBalancerClientFilter</code></a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-netty-routing-filter">75.5. The Netty Routing Filter</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-netty-write-response-filter">75.6. The Netty Write Response Filter</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-routetorequesturl-filter">75.7. The <code>RouteToRequestUrl</code> Filter</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-websocket-routing-filter">75.8. The Websocket Routing Filter</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-gateway-metrics-filter">75.9. The Gateway Metrics Filter</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#marking-an-exchange-as-routed">75.10. Marking An Exchange As Routed</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#httpheadersfilters">76. HttpHeadersFilters</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#forwarded-headers-filter">76.1. Forwarded Headers Filter</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#removehopbyhop-headers-filter">76.2. RemoveHopByHop Headers Filter</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#xforwarded-headers-filter">76.3. XForwarded Headers Filter</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tls-and-ssl">77. TLS and SSL</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tls-handshake">77.1. TLS Handshake</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-3">78. Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#route-metadata-configuration">79. Route Metadata Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-timeouts-configuration">80. Http timeouts configuration</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#global-timeouts">80.1. Global timeouts</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#per-route-timeouts">80.2. Per-route timeouts</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#fluent-java-routes-api">80.3. Fluent Java Routes API</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-discoveryclient-route-definition-locator">80.4. The <code>DiscoveryClient</code> Route Definition Locator</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactor-netty-access-logs">81. Reactor Netty Access Logs</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cors-configuration">82. CORS Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#actuator-api">83. Actuator API</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#verbose-actuator-format">83.1. Verbose Actuator Format</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#retrieving-route-filters">83.2. Retrieving Route Filters</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#refreshing-the-route-cache">83.3. Refreshing the Route Cache</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#retrieving-the-routes-defined-in-the-gateway">83.4. Retrieving the Routes Defined in the Gateway</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-retrieving-information-about-a-particular-route">83.5. Retrieving Information about a Particular Route</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-and-deleting-a-particular-route">83.6. Creating and Deleting a Particular Route</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#recap-the-list-of-all-endpoints">83.7. Recap: The List of All endpoints</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#troubleshooting">84. Troubleshooting</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#log-levels">84.1. Log Levels</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#wiretap">84.2. Wiretap</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#developer-guide">85. Developer Guide</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#writing-custom-route-predicate-factories">85.1. Writing Custom Route Predicate Factories</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#writing-custom-gatewayfilter-factories">85.2. Writing Custom GatewayFilter Factories</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#writing-custom-global-filters">85.3. Writing Custom Global Filters</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#building-a-simple-gateway-by-using-spring-mvc-or-webflux">86. Building a Simple Gateway by Using Spring MVC or Webflux</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-5">87. Configuration properties</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-reference">Spring Cloud GCP</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#introduction-3">88. Introduction</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-5">89. Getting Started</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#setting-up-dependencies">89.1. Setting up Dependencies</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#learning-spring-cloud-gcp">89.2. Learning Spring Cloud GCP</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">90. Spring Cloud GCP Core</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-4">90.1. Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#project-id">90.2. Project ID</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#credentials">90.3. Credentials</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#environment">90.4. Environment</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-bean-scope">90.5. Customizing bean scope</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-initializr-2">90.6. Spring Initializr</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-storage">91. Cloud Storage</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-cloud-storage">91.1. Using Cloud Storage</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-storage-objects-as-spring-resources">91.2. Cloud Storage Objects As Spring Resources</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-5">91.3. Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample">91.4. Sample</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-sql">92. Cloud SQL</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#prerequisites">92.1. Prerequisites</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-starter-for-google-cloud-sql">92.2. Spring Boot Starter for Google Cloud SQL</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#samples">92.3. Samples</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-pubsub">93. Cloud Pub/Sub</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pubsub-configuration">93.1. Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-actuator-support">93.2. Spring Boot Actuator Support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pubsub-operations-template">93.3. Pub/Sub Operations &amp; Template</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-stream-subscription">93.4. Reactive Stream Subscription</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pubsub-management">93.5. Pub/Sub management</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-2">93.6. Sample</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-integration">94. Spring Integration</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#channel-adapters-for-cloud-pubsub">94.1. Channel Adapters for Cloud Pub/Sub</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#channel-adapters-for-google-cloud-storage">94.2. Channel Adapters for Google Cloud Storage</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-stream">95. Spring Cloud Stream</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#overview">95.1. Overview</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-6">95.2. Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#binding-with-functions">95.3. Binding with Functions</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#binding-with-annotations">95.4. Binding with Annotations</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#streaming-vs-polled-input">95.5. Streaming vs. Polled Input</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-4">95.6. Sample</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-bus-2">96. Spring Cloud Bus</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-management-with-spring-cloud-config-and-spring-cloud-bus">96.1. Configuration Management with Spring Cloud Config and Spring Cloud Bus</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stackdriver-trace">97. Stackdriver Trace</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tracing">97.1. Tracing</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-starter-for-stackdriver-trace">97.2. Spring Boot Starter for Stackdriver Trace</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#overriding-the-auto-configuration">97.3. Overriding the auto-configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-spans">97.4. Customizing spans</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#integration-with-logging">97.5. Integration with Logging</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-5">97.6. Sample</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stackdriver-logging">98. Stackdriver Logging</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#web-mvc-interceptor">98.1. Web MVC Interceptor</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#logback-support">98.2. Logback Support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-6">98.3. Sample</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stackdriver-monitoring">99. Stackdriver Monitoring</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-7">99.1. Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-7">99.2. Sample</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-data-cloud-spanner">100. Spring Data Cloud Spanner</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-8">100.1. Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#object-mapping">100.2. Object Mapping</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spanner-operations-template">100.3. Spanner Operations &amp; Template</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#repositories">100.4. Repositories</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods">100.5. Query Methods</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#database-and-schema-admin">100.6. Database and Schema Admin</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#events">100.7. Events</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#auditing">100.8. Auditing</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#multi-instance-usage">100.9. Multi-Instance Usage</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-spanner-emulator">100.10. Cloud Spanner Emulator</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-8">100.11. Sample</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-data-cloud-datastore">101. Spring Data Cloud Datastore</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-9">101.1. Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#object-mapping-2">101.2. Object Mapping</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#relationships-2">101.3. Relationships</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#datastore-operations-template">101.4. Datastore Operations &amp; Template</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#repositories-2">101.5. Repositories</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#events-2">101.6. Events</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#auditing-2">101.7. Auditing</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#partitioning-data-by-namespace">101.8. Partitioning Data by Namespace</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-actuator-support-2">101.9. Spring Boot Actuator Support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-9">101.10. Sample</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-data-cloud-firestore">102. Spring Data Cloud Firestore</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-10">102.1. Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#object-mapping-3">102.2. Object Mapping</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-repositories">102.3. Reactive Repositories</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#firestore-operations-template">102.4. Firestore Operations &amp; Template</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods-by-convention-3">102.5. Query methods by convention</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#transactions-4">102.6. Transactions</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-firestore-spring-boot-starter">102.7. Cloud Firestore Spring Boot Starter</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#emulator-usage">102.8. Emulator Usage</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#samples-3">102.9. Samples</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-memorystore-for-redis">103. Cloud Memorystore for Redis</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-caching">103.1. Spring Caching</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bigquery">104. BigQuery</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-11">104.1. Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-integration-2">104.2. Spring Integration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-10">104.3. Sample</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-iap">105. Cloud IAP</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-12">105.1. Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-11">105.2. Sample</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-vision">106. Cloud Vision</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dependency-setup">106.1. Dependency Setup</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-13">106.2. Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#image-analysis">106.3. Image Analysis</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#document-ocr-template">106.4. Document OCR Template</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-12">106.5. Sample</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#secret-manager">107. Secret Manager</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dependency-setup-2">107.1. Dependency Setup</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#secret-manager-property-source">107.2. Secret Manager Property Source</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#secret-manager-template">107.3. Secret Manager Template</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-13">107.4. Sample</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-runtime-configuration-api">108. Cloud Runtime Configuration API</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-15">108.1. Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quick-start-3">108.2. Quick start</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#refreshing-the-configuration-at-runtime">108.3. Refreshing the configuration at runtime</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-14">108.4. Sample</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-foundry">109. Cloud Foundry</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#user-provided-services">109.1. User-Provided Services</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kotlin-support">110. Kotlin Support</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#prerequisites-2">110.1. Prerequisites</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-15">110.2. Sample</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-6">111. Configuration properties</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-kubernetes">Spring Cloud Kubernetes</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#why-do-you-need-spring-cloud-kubernetes">112. Why do you need Spring Cloud Kubernetes?</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#starters-2">113. Starters</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discoveryclient-for-kubernetes">114. DiscoveryClient for Kubernetes</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kubernetes-native-service-discovery">115. Kubernetes native service discovery</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kubernetes-propertysource-implementations">116. Kubernetes PropertySource implementations</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configmap-propertysource">116.1. Using a <code>ConfigMap</code> <code>PropertySource</code></a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#secrets-propertysource">116.2. Secrets PropertySource</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#propertysource-reload">116.3. <code>PropertySource</code> Reload</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ribbon-discovery-in-kubernetes">117. Ribbon Discovery in Kubernetes</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kubernetes-ecosystem-awareness">118. Kubernetes Ecosystem Awareness</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kubernetes-profile-autoconfiguration">118.1. Kubernetes Profile Autoconfiguration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#istio-awareness">118.2. Istio Awareness</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pod-health-indicator">119. Pod Health Indicator</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#info-contributor">120. Info Contributor</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#leader-election">121. Leader Election</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#loadbalancer-for-kubernetes">122. LoadBalancer for Kubernetes</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#security-configurations-inside-kubernetes">123. Security Configurations Inside Kubernetes</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#namespace">123.1. Namespace</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-account">123.2. Service Account</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-registry-implementation">124. Service Registry Implementation</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#examples">125. Examples</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#other-resources">126. Other Resources</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-7">127. Configuration properties</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#building-2">128. Building</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#basic-compile-and-test-2">128.1. Basic Compile and Test</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#documentation-2">128.2. Documentation</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#working-with-the-code-2">128.3. Working with the code</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#contributing-3">129. Contributing</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sign-the-contributor-license-agreement-3">129.1. Sign the Contributor License Agreement</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-of-conduct-3">129.2. Code of Conduct</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-conventions-and-housekeeping-3">129.3. Code Conventions and Housekeeping</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#checkstyle-3">129.4. Checkstyle</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ide-setup-3">129.5. IDE setup</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-netflix">Spring Cloud Netflix</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-discovery-eureka-clients">130. Service Discovery: Eureka Clients</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-eureka-client-starter">130.1. How to Include Eureka Client</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-with-eureka">130.2. Registering with Eureka</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#authenticating-with-the-eureka-server">130.3. Authenticating with the Eureka Server</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#status-page-and-health-indicator">130.4. Status Page and Health Indicator</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-a-secure-application">130.5. Registering a Secure Application</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#eurekas-health-checks">130.6. Eureka’s Health Checks</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#eureka-metadata-for-instances-and-clients">130.7. Eureka Metadata for Instances and Clients</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-the-eurekaclient">130.8. Using the EurekaClient</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#alternatives-to-the-native-netflix-eurekaclient">130.9. Alternatives to the Native Netflix EurekaClient</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#why-is-it-so-slow-to-register-a-service">130.10. Why Is It so Slow to Register a Service?</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zones">130.11. Zones</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#refreshing-eureka-clients">130.12. Refreshing Eureka Clients</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-eureka-with-spring-cloud-loadbalancer">130.13. Using Eureka with Spring Cloud LoadBalancer</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server">131. Service Discovery: Eureka Server</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-eureka-server-starter">131.1. How to Include Eureka Server</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-running-eureka-server">131.2. How to Run a Eureka Server</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server-zones-and-regions">131.3. High Availability, Zones and Regions</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server-standalone-mode">131.4. Standalone Mode</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server-peer-awareness">131.5. Peer Awareness</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server-prefer-ip-address">131.6. When to Prefer IP Address</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#securing-the-eureka-server">131.7. Securing The Eureka Server</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#disabling-ribbon-with-eureka-server-and-client-starters">131.8. Disabling Ribbon with Eureka Server and Client starters</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#jdk-11-support">131.9. JDK 11 Support</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#circuit-breaker-spring-cloud-circuit-breaker-with-hystrix">132. Circuit Breaker: Spring Cloud Circuit Breaker With Hystrix</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#disabling-spring-cloud-circuit-breaker-hystrix">132.1. Disabling Spring Cloud Circuit Breaker Hystrix</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-hystrix-circuit-breakers">132.2. Configuring Hystrix Circuit Breakers</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#circuit-breaker-hystrix-clients">133. Circuit Breaker: Hystrix Clients</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-include-hystrix">133.1. How to Include Hystrix</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-hystrix-starter">133.2. Propagating the Security Context or Using Spring Scopes</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#health-indicator-4">133.3. Health Indicator</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix-metrics-stream">133.4. Hystrix Metrics Stream</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#circuit-breaker-hystrix-dashboard">134. Circuit Breaker: Hystrix Dashboard</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix-timeouts-and-ribbon-clients">135. Hystrix Timeouts And Ribbon Clients</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-hystrix-dashboard-starter">135.1. How to Include the Hystrix Dashboard</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#turbine">135.2. Turbine</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#turbine-stream">135.3. Turbine Stream</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-ribbon">136. Client Side Load Balancer: Ribbon</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-ribbon-starter">136.1. How to Include Ribbon</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-the-ribbon-client">136.2. Customizing the Ribbon Client</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-the-default-for-all-ribbon-clients">136.3. Customizing the Default for All Ribbon Clients</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-the-ribbon-client-by-setting-properties">136.4. Customizing the Ribbon Client by Setting Properties</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-ribbon-with-eureka">136.5. Using Ribbon with Eureka</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-ribbon-without-eureka">136.6. Example: How to Use Ribbon Without Eureka</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#example-disable-eureka-use-in-ribbon">136.7. Example: Disable Eureka Use in Ribbon</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-the-ribbon-api-directly">136.8. Using the Ribbon API Directly</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ribbon-child-context-eager-load">136.9. Caching of Ribbon Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-configure-hystrix-thread-pools">136.10. How to Configure Hystrix Thread Pools</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-provdie-a-key-to-ribbon">136.11. How to Provide a Key to Ribbon’s <code>IRule</code></a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#external-configuration-archaius">137. External Configuration: Archaius</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#router-and-filter-zuul">138. Router and Filter: Zuul</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-zuul-starter">138.1. How to Include Zuul</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-zuul-reverse-proxy">138.2. Embedded Zuul Reverse Proxy</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-http-client">138.3. Zuul Http Client</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cookies-and-sensitive-headers">138.4. Cookies and Sensitive Headers</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ignored-headers">138.5. Ignored Headers</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#management-endpoints">138.6. Management Endpoints</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#strangulation-patterns-and-local-forwards">138.7. Strangulation Patterns and Local Forwards</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#uploading-files-through-zuul">138.8. Uploading Files through Zuul</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-string-encoding">138.9. Query String Encoding</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#request-uri-encoding">138.10. Request URI Encoding</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#plain-embedded-zuul">138.11. Plain Embedded Zuul</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#disable-zuul-filters">138.12. Disable Zuul Filters</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix-fallbacks-for-routes">138.13. Providing Hystrix Fallbacks For Routes</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-timeouts">138.14. Zuul Timeouts</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-redirect-location-rewrite">138.15. Rewriting the <code>Location</code> header</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enabling-cross-origin-requests">138.16. Enabling Cross Origin Requests</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#metrics">138.17. Metrics</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-developer-guide">138.18. Zuul Developer Guide</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#polyglot-support-with-sidecar">139. Polyglot support with Sidecar</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#retrying-failed-requests">140. Retrying Failed Requests</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#backoff-policies">140.1. BackOff Policies</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-16">140.2. Configuration</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-clients-2">141. HTTP Clients</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#modules-in-maintenance-mode">142. Modules In Maintenance Mode</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-8">143. Configuration properties</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-openfeign">Spring Cloud OpenFeign</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign">144. Declarative REST Client: Feign</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-feign-starter">144.1. How to Include Feign</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-overriding-defaults">144.2. Overriding Feign Defaults</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#timeout-handling">144.3. Timeout Handling</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-feign-clients-manually">144.4. Creating Feign Clients Manually</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-hystrix">144.5. Feign Hystrix Support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-hystrix-fallback">144.6. Feign Hystrix Fallbacks</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-circuitbreaker">144.7. Feign Spring Cloud CircuitBreaker Support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-circuitbreaker-fallback">144.8. Feign Spring Cloud CircuitBreaker Fallbacks</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign-and-primary">144.9. Feign and <code>@Primary</code></a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-inheritance">144.10. Feign Inheritance Support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign-requestresponse-compression">144.11. Feign request/response compression</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign-logging">144.12. Feign logging</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign-querymap-support">144.13. Feign @QueryMap support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hateoas-support">144.14. HATEOAS support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-matrixvariable-support">144.15. Spring @MatrixVariable Support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign-collectionformat-support">144.16. Feign <code>CollectionFormat</code> support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-support">144.17. Reactive Support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-data-support">144.18. Spring Data Support</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-9">145. Configuration properties</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-security">Spring Cloud Security</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quickstart">146. Quickstart</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#oauth2-single-sign-on">146.1. OAuth2 Single Sign On</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#oauth2-protected-resource">146.2. OAuth2 Protected Resource</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#more-detail">147. More Detail</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#single-sign-on-2">147.1. Single Sign On</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#token-relay">147.2. Token Relay</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-authentication-downstream-of-a-zuul-proxy">148. Configuring Authentication Downstream of a Zuul Proxy</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-sleuth">Spring Cloud Sleuth</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#introduction-4">149. Introduction</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#terminology">149.1. Terminology</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#purpose">149.2. Purpose</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sleuth-adding-project">149.3. Adding Sleuth to the Project</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#overriding-the-auto-configuration-of-zipkin">149.4. Overriding the auto-configuration of Zipkin</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#additional-resources">150. Additional Resources</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-2">151. Features</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#introduction-to-brave">151.1. Introduction to Brave</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sampling">152. Sampling</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#declarative-sampling">152.1. Declarative sampling</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-sampling">152.2. Custom sampling</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sampling-in-spring-cloud-sleuth">152.3. Sampling in Spring Cloud Sleuth</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#propagation">153. Propagation</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#propagating-extra-fields">153.1. Propagating extra fields</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#current-tracing-component">154. Current Tracing Component</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#current-span">155. Current Span</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#setting-a-span-in-scope-manually">155.1. Setting a span in scope manually</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#instrumentation">156. Instrumentation</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#span-lifecycle">157. Span lifecycle</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-and-finishing-spans">157.1. Creating and finishing spans</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#continuing-spans">157.2. Continuing Spans</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-spans-with-explicit-parent">157.3. Creating a Span with an explicit Parent</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#naming-spans">158. Naming spans</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spanname-annotation">158.1. <code>@SpanName</code> Annotation</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tostring-method">158.2. <code>toString()</code> method</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#managing-spans-with-annotations">159. Managing Spans with Annotations</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rationale">159.1. Rationale</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-new-spans">159.2. Creating New Spans</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#continuing-spans-2">159.3. Continuing Spans</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#advanced-tag-setting">159.4. Advanced Tag Setting</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizations">160. Customizations</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizers">160.1. Customizers</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http">160.2. HTTP</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tracingfilter">160.3. <code>TracingFilter</code></a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#messaging-2">160.4. Messaging</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rpc">160.5. RPC</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-service-name">160.6. Custom service name</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customization-of-reported-spans">160.7. Customization of Reported Spans</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#host-locator">160.8. Host Locator</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-spans-to-zipkin">161. Sending Spans to Zipkin</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zipkin-stream-span-consumer">162. Zipkin Stream Span Consumer</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#integrations">163. Integrations</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#opentracing">163.1. OpenTracing</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#runnable-and-callable">163.2. Runnable and Callable</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-circuitbreaker">163.3. Spring Cloud CircuitBreaker</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix-2">163.4. Hystrix</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rxjava">163.5. RxJava</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-integration">163.6. HTTP integration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-client-integration">163.7. HTTP Client Integration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign">163.8. Feign</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#grpc">163.9. gRPC</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#asynchronous-communication">163.10. Asynchronous Communication</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#messaging-3">163.11. Messaging</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-2">163.12. Zuul</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#redis">163.13. Redis</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quartz">163.14. Quartz</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#project-reactor">163.15. Project Reactor</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-10">164. Configuration properties</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#running-examples">165. Running examples</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-task-reference-guide">Spring Cloud Task Reference Guide</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#preface">Preface</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#about-the-documentation">166. About the documentation</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#task-documentation-getting-help">167. Getting help</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#task-documentation-first-steps">168. First Steps</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started">Getting started</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-introducing-spring-cloud-task">169. Introducing Spring Cloud Task</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-system-requirements">170. System Requirements</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#database-requirements">170.1. Database Requirements</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-developing-first-task">171. Developing Your First Spring Cloud Task Application</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-creating-project">171.1. Creating the Spring Task Project using Spring Initializr</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-writing-the-code">171.2. Writing the Code</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-running-the-example">171.3. Running the Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features">Features</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-lifecycle">172. The lifecycle of a Spring Cloud Task</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-execution-details">172.1. The TaskExecution</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-lifecycle-exit-codes">172.2. Mapping Exit Codes</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-configuration">173. Configuration</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-data-source">173.1. DataSource</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-table-prefix">173.2. Table Prefix</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-table-initialization">173.3. Enable/Disable table initialization</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-generated_task_id">173.4. Externally Generated Task ID</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-external_task_id">173.5. External Task Id</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-parent_task_id">173.6. Parent Task Id</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-configurer">173.7. TaskConfigurer</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-name">173.8. Task Name</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-execution-listener">173.9. Task Execution Listener</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-single-instance-enabled">173.10. Restricting Spring Cloud Task Instances</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#disabling-spring-cloud-task-auto-configuration">173.11. Disabling Spring Cloud Task Auto Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#closing-the-context">173.12. Closing the Context</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch">Batch</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch-association">174. Associating a Job Execution to the Task in which It Was Executed</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch-association-override">174.1. Overriding the TaskBatchExecutionListener</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch-partitioning">175. Remote Partitioning</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#notes-on-developing-a-batch-partitioned-application-for-the-kubernetes-platform">175.1. Notes on Developing a Batch-partitioned application for the Kubernetes Platform</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#notes-on-developing-a-batch-partitioned-application-for-the-cloud-foundry-platform">175.2. Notes on Developing a Batch-partitioned Application for the Cloud Foundry Platform</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch-informational-messages">176. Batch Informational Messages</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch-failures-and-tasks">177. Batch Job Exit Codes</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration">Spring Cloud Stream Integration</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration-launching-sink">178. Launching a Task from a Spring Cloud Stream</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration-launching-sink-dataflow">178.1. Spring Cloud Data Flow</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration-events">179. Spring Cloud Task Events</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration-disable-task-events">179.1. Disabling Specific Task Events</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration-batch-events">180. Spring Batch Events</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-batch-events-to-different-channels">180.1. Sending Batch Events to Different Channels</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#disabling-batch-events">180.2. Disabling Batch Events</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#emit-order-for-batch-events">180.3. Emit Order for Batch Events</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#appendix">Appendices</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#appendix-task-repository-schema">181. Task Repository Schema</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#table-information">181.1. Table Information</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#appendix-building-the-documentation">182. Building This Documentation</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#appendix-cloud-foundry">183. Running a Task App on Cloud Foundry</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-vault">Spring Cloud Vault</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quick-start-4">184. Quick Start</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#client-side-usage-2">185. Client Side Usage</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#authentication-2">185.1. Authentication</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication">186. Authentication methods</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.token">186.1. Token authentication</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.vault-agent">186.2. Vault Agent authentication</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.appid">186.3. AppId authentication</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#approle-authentication">186.4. AppRole authentication</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.awsec2">186.5. AWS-EC2 authentication</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.awsiam">186.6. AWS-IAM authentication</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.azuremsi">186.7. Azure MSI authentication</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.clientcert">186.8. TLS certificate authentication</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.cubbyhole">186.9. Cubbyhole authentication</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.gcpgce">186.10. GCP-GCE authentication</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.gcpiam">186.11. GCP-IAM authentication</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.kubernetes">186.12. Kubernetes authentication</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.pcf">186.13. Pivotal CloudFoundry authentication</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends">187. Secret Backends</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.generic">187.1. Generic Backend</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.kv.versioned">187.2. Key-Value Backend</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.consul">187.3. Consul</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.rabbitmq">187.4. RabbitMQ</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.aws">187.5. AWS</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.database-backends">188. Database backends</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.database">188.1. Database</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.cassandra">188.2. Apache Cassandra</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.mongodb">188.3. MongoDB</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.mysql">188.4. MySQL</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.postgresql">188.5. PostgreSQL</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.configurer">189. Configure <code>PropertySourceLocator</code> behavior</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-registry-configuration">190. Service Registry Configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.fail-fast">191. Vault Client Fail Fast</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.namespaces">192. Vault Enterprise Namespace Support</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.ssl">193. Vault Client SSL configuration</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault-lease-renewal">194. Lease lifecycle management (renewal and revocation)</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper">Spring Cloud Zookeeper</a>
<ul class="sectlevel1">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-install">195. Install Zookeeper</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-discovery">196. Service Discovery with Zookeeper</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#activating">196.1. Activating</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-with-zookeeper">196.2. Registering with Zookeeper</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-the-discoveryclient-2">196.3. Using the DiscoveryClient</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-netflix">197. Using Spring Cloud Zookeeper with Spring Cloud Netflix Components</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ribbon-with-zookeeper">197.1. Ribbon with Zookeeper</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-service-registry">198. Spring Cloud Zookeeper and Service Registry</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#instance-status">198.1. Instance Status</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies">199. Zookeeper Dependencies</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-using">199.1. Using the Zookeeper Dependencies</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-activating">199.2. Activating Zookeeper Dependencies</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-setting-up">199.3. Setting up Zookeeper Dependencies</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-configuring">199.4. Configuring Spring Cloud Zookeeper Dependencies</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependency-watcher">200. Spring Cloud Zookeeper Dependency Watcher</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#activating-2">200.1. Activating</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-a-listener">200.2. Registering a Listener</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependency-watcher-presence-checker">200.3. Using the Presence Checker</a></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-config">201. Distributed Configuration with Zookeeper</a>
<ul class="sectlevel2">
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#activating-3">201.1. Activating</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-2">201.2. Customizing</a></li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#access-control-lists-acls">201.3. Access Control Lists (ACLs)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#appendix-compendium-of-configuration-properties">Appendix: Compendium of Configuration Properties</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud provides tools for developers to quickly build some of
the common patterns in distributed systems (e.g. configuration
management, service discovery, circuit breakers, intelligent routing,
micro-proxy, control bus). Coordination of
distributed systems leads to boiler plate patterns, and using Spring
Cloud developers can quickly stand up services and applications that
implement those patterns. They will work well in any distributed
environment, including the developer’s own laptop, bare metal data
centres, and managed platforms such as Cloud Foundry.</p>
</div>
<div class="paragraph">
<p>Release Train Version: <strong>Hoxton.SR10</strong></p>
</div>
<div class="paragraph">
<p>Supported Boot Version: <strong>2.3.8.RELEASE</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="features"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features">1. Features</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud focuses on providing good out of box experience for typical use cases
and extensibility mechanism to cover others.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Distributed/versioned configuration</p>
</li>
<li>
<p>Service registration and discovery</p>
</li>
<li>
<p>Routing</p>
</li>
<li>
<p>Service-to-service calls</p>
</li>
<li>
<p>Load balancing</p>
</li>
<li>
<p>Circuit Breakers</p>
</li>
<li>
<p>Distributed messaging</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cloud-documentation-versions"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-documentation-versions"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-documentation-versions">2. Release Train Versions</a></h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Release Train Project Versions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Project Name</th>
<th class="tableblock halign-left valign-top">Project Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-boot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.3.8.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-aws</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.6.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-build</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.3.2.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-bus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.3.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-circuitbreaker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0.4.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-cli</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.4.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-cloudfoundry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.3.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-commons</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.7.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.7.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-consul</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.6.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-contract</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.6.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0.13.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-gateway</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.7.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-gcp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2.7.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-kubernetes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1.8.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-netflix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.7.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-openfeign</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.7.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-security</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.4.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-sleuth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.7.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.5.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-vault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.7.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-zookeeper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.4.RELEASE</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<h1 id="spring-cloud-aws" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-aws"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-aws">Spring Cloud AWS</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Spring Cloud for Amazon Web Services, part of the Spring Cloud umbrella project, eases the integration with hosted Amazon Web Services. It offers a convenient way to interact with AWS provided services using well-known Spring idioms and APIs, such as the messaging or caching API. Developers can build their application around the hosted services without having to care about infrastructure or maintenance.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Cloud is released under the non-restrictive Apache 2.0 license. If you would like to contribute to this section of the documentation or if you find an error, please find the source code and issue trackers in the project at <a href="https://github.com/spring-cloud/spring-cloud">github</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-amazon-web-services"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-amazon-web-services"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-amazon-web-services">3. Using Amazon Web Services</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Amazon provides a <a href="https://aws.amazon.com/sdk-for-java/">Java SDK</a> to issue requests for the all services provided by the
<a href="https://aws.amazon.com/">Amazon Web Service</a> platform. Using the SDK, application developers still have to integrate the
SDK into their application with a considerable amount of infrastructure related code. Spring Cloud AWS provides application
developers already integrated Spring-based modules to consume services and avoid infrastructure related code as much as possible.
The Spring Cloud AWS module provides a module set so that application developers can arrange the dependencies based on
their needs for the particular services. The graphic below provides a general overview of all Spring Cloud AWS modules along
with the service support for the respective Spring Cloud AWS services.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/overview.png" alt="Overview">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Spring Cloud AWS Core</strong> is the core module of Spring Cloud AWS providing basic services for security and configuration
setup. Developers will not use this module directly but rather through other modules. The core module provides support for
cloud based environment configurations providing direct access to the instance based <a href="https://aws.amazon.com/ec2/">EC2</a>
metadata and the overall application stack specific <a href="https://aws.amazon.com/cloudformation/">CloudFormation</a> metadata.</p>
</li>
<li>
<p><strong>Spring Cloud AWS Context</strong> delivers access to the <a href="https://aws.amazon.com/s3/">Simple Storage Service</a> via the Spring
resource loader abstraction. Moreover developers can send e-mails using the <a href="https://aws.amazon.com/ses/">Simple E-Mail Service</a>
and the Spring mail abstraction. Further the developers can introduce declarative caching using the Spring caching support
and the <a href="https://aws.amazon.com/elasticache/">ElastiCache</a> caching service.</p>
</li>
<li>
<p><strong>Spring Cloud AWS JDBC</strong> provides automatic datasource lookup and configuration for the <a href="https://aws.amazon.com/rds/">Relational Database Service</a>
which can be used with JDBC or any other support data access technology by Spring.</p>
</li>
<li>
<p><strong>Spring Cloud AWS Messaging</strong> enables developers to receive and send messages with the <a href="https://aws.amazon.com/sqs/">Simple Queueing Service</a> for
point-to-point communication. Publish-subscribe messaging is supported with the integration of the <a href="https://aws.amazon.com/sns/">Simple Notification Service</a>.</p>
</li>
<li>
<p><strong>Spring Cloud AWS Parameter Store Configuration</strong> enables Spring Cloud applications to use the <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-paramstore.html">AWS Parameter Store</a>
as a Bootstrap Property Source, comparable to the support provided for the Spring Cloud Config Server or Consul’s key-value store.</p>
</li>
<li>
<p><strong>Spring Cloud AWS Secrets Manager Configuration</strong> enables Spring Cloud applications to use the <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html">AWS Secrets Manager</a>
as a Bootstrap Property Source, comparable to the support provided for the Spring Cloud Config Server or Consul’s key-value store.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="basic-setup"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#basic-setup"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#basic-setup">4. Basic setup</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before using the Spring Cloud AWS module developers have to pick the dependencies and configure the Spring Cloud AWS module.
The next chapters describe the dependency management and also the basic configuration for the Spring AWS Cloud project.</p>
</div>
<div class="sect2">
<h3 id="spring-cloud-aws-maven-dependency-management"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-aws-maven-dependency-management"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-aws-maven-dependency-management">4.1. Spring Cloud AWS maven dependency management</a></h3>
<div class="paragraph">
<p>Spring Cloud AWS module dependencies can be used directly in <a href="https://maven.apache.org/">Maven</a> with a direct configuration
of the particular module. The Spring Cloud AWS module includes all transitive dependencies for the Spring modules and
also the Amazon SDK that are needed to operate the modules. The general dependency configuration will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-aws-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>{spring-cloud-version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Different modules can be included by replacing the module name with the respective one (e.g. <code>spring-cloud-aws-messaging</code>
instead of <code>spring-cloud-aws-context</code>)</p>
</div>
<div class="paragraph">
<p>The example above works with the Maven Central repository. To use the Spring Maven repository (e.g. for milestones or
developer snapshots), you need to specify the repository location in your Maven configuration. For full releases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>io.spring.repo.maven.release<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://repo.spring.io/release/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">snapshots</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">snapshots</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For milestones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>io.spring.repo.maven.milestone<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://repo.spring.io/milestone/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">snapshots</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">snapshots</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="amazon-sdk-dependency-version-management"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#amazon-sdk-dependency-version-management"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#amazon-sdk-dependency-version-management">4.2. Amazon SDK dependency version management</a></h3>
<div class="paragraph">
<p>Amazon SDK is released more frequently than Spring Cloud AWS. If you need to use newer version of AWS SDK than one configured by Spring Cloud AWS
add AWS SDK BOM to dependency management section making sure it is declared before any other BOM dependency that configures AWS SDK dependencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.amazonaws<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aws-java-sdk-bom<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${aws-java-sdk.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="amazon-sdk-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#amazon-sdk-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#amazon-sdk-configuration">4.3. Amazon SDK configuration</a></h3>
<div class="paragraph">
<p>The Spring Cloud AWS configuration is currently done using custom elements provided by Spring Cloud AWS namespaces.
JavaConfig will be supported soon. The configuration setup is done directly in Spring XML configuration files
so that the elements can be directly used. Each module of Spring Cloud AWS provides custom namespaces to allow the modular
use of the modules. A typical XML configuration to use Spring Cloud AWS is outlined below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hljs-attr">xmlns:aws-context</span>=<span class="hljs-string">"http://www.springframework.org/schema/cloud/aws/context"</span>
       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/cloud/aws/context
        http://www.springframework.org/schema/cloud/aws/context/spring-cloud-aws-context.xsd"</span>&gt;</span>

           <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-region</span> <span class="hljs-attr">region</span>=<span class="hljs-string">"..."</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On application startup, for its internal purposes Spring Cloud AWS performs a check if application runs in AWS cloud environment
by using <code>EC2MetadataUtils</code> class provided by AWS SDK. Starting from version 1.11.678, AWS SDK logs a warning message with exception when this check is made outside of AWS environment.
This warning message can be hidden by setting <code>ERROR</code> logging level on <code>com.amazonaws.util.EC2MetadataUtils</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs aspectj">logging.level.com.amazonaws.util.EC2MetadataUtils=<span class="hljs-keyword">error</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="sdk-credentials-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sdk-credentials-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sdk-credentials-configuration">4.3.1. SDK credentials configuration</a></h4>
<div class="paragraph">
<p>In order to make calls to the Amazon Web Service the credentials must be configured for the the Amazon SDK. Spring Cloud AWS
provides support to configure an application context specific credentials that are used for <em>each</em> service call for requests done
by Spring Cloud AWS components, with the exception of the Parameter Store and Secrets Manager Configuration.
Therefore there must be <strong>exactly one</strong> configuration of the credentials for an entire application context.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>com.amazonaws.auth.DefaultAWSCredentialsProviderChain</code> is used by all the clients if there is no dedicated credentials
provider defined. This will essentially use the following authentication information</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use the environment variables <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code></p>
</li>
<li>
<p>use the system properties <code>aws.accessKeyId</code> and <code>aws.secretKey</code></p>
</li>
<li>
<p>use the user specific profile credentials file</p>
</li>
<li>
<p>use ECS credentials if the <code>AWS_CONTAINER_CREDENTIALS_RELATIVE_URI</code> environment variable is set</p>
</li>
<li>
<p>use the instance profile credentials (see below)</p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Based on the overall credentials policy there are different options to configure the credentials. The possible ones are described in
the following sub-chapters.</p>
</div>
<div class="sect4">
<h5 id="simple-credentials-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#simple-credentials-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#simple-credentials-configuration">Simple credentials configuration</a></h5>
<div class="paragraph">
<p>Credentials for the Amazon SDK consist of an access key (which might be shared) and a secret key (which must <strong>not</strong> be shared). Both
security attributes can be configured using the XML namespaces for each Amazon SDK service created by the Spring Cloud AWS
module. The overall configuration looks like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">...</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:simple-credentials</span> <span class="hljs-attr">access-key</span>=<span class="hljs-string">"AKIAIO"</span> <span class="hljs-attr">secret-key</span>=<span class="hljs-string">"wJalrXUtnFEMI/K7M"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The access-key and secret-key should be externalized into property files (e.g. Spring Boot application configuration)
and not be checked in into the source management system.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="instance-profile-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#instance-profile-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#instance-profile-configuration">Instance profile configuration</a></h5>
<div class="paragraph">
<p>An <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/instance-profiles.html">instance profile configuration</a> allows to assign
a profile that is authorized by a role while starting an EC2 instance. All calls made from the EC2 instance are then authenticated
with the instance profile specific user role. Therefore there is no dedicated access-key and secret-key needed in the configuration.
The configuration for the instance profile in Spring Cloud AWS looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">...</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:instance-profile-credentials</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mixing-both-security-configurations"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#mixing-both-security-configurations"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#mixing-both-security-configurations">Mixing both security configurations</a></h5>
<div class="paragraph">
<p>In some cases it is useful to combine both authentication strategies to allow the application to use the instance profile
with a fallback for an explicit access-key and secret-key configuration. This is useful if the application is tested inside
EC2 (e.g. on a test server) and locally for testing. The next snippet shows a combination of both security configurations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">...</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:instance-profile-credentials</span>/&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:simple-credentials</span> <span class="hljs-attr">access-key</span>=<span class="hljs-string">"${accessKey:}"</span> <span class="hljs-attr">secret-key</span>=<span class="hljs-string">"${secretKey:}"</span>/&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The access-key and secret-key are defined using a placeholder expressions along with a default value to avoid bootstrap
errors if the properties are not configured at all.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="parameter-store-and-secrets-manager-configuration-credentials-and-region-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#parameter-store-and-secrets-manager-configuration-credentials-and-region-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#parameter-store-and-secrets-manager-configuration-credentials-and-region-configuration">Parameter Store and Secrets Manager Configuration credentials and region configuration</a></h5>
<div class="paragraph">
<p>The Parameter Store and Secrets Manager Configuration support uses a bootstrap context to configure a default <code>AWSSimpleSystemsManagement</code>
client, which uses a <code>com.amazonaws.auth.DefaultAWSCredentialsProviderChain</code> and <code>com.amazonaws.regions.DefaultAwsRegionProviderChain</code>.
If you want to override this, then you need to
<a href="https://cloud.spring.io/spring-cloud-static/Edgware.SR2/multi/multi__spring_cloud_context_application_context_services.html#_customizing_the_bootstrap_configuration">define your own Spring Cloud bootstrap configuration class</a>
with a bean of type <code>AWSSimpleSystemsManagement</code> that’s configured to use your chosen credentials and/or region provider.
Because this context is created when your Spring Cloud Bootstrap context is created, you can’t simply override the bean
in a regular <code>@Configuration</code> class.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="region-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#region-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#region-configuration">4.3.2. Region configuration</a></h4>
<div class="paragraph">
<p>Amazon Web services are available in different <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html">regions</a>. Based
on the custom requirements, the user can host the application on different Amazon regions. The <code>spring-cloud-aws-context</code>
module provides a way to define the region for the entire application context.</p>
</div>
<div class="sect4">
<h5 id="explicit-region-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#explicit-region-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#explicit-region-configuration">Explicit region configuration</a></h5>
<div class="paragraph">
<p>The region can be explicitly configured using an XML element. This is particularly useful if the region can not be automatically
derived because the application is not hosted on a EC2 instance (e.g. local testing) or the region must be manually overridden.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">...</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-region</span> <span class="hljs-attr">region</span>=<span class="hljs-string">"eu-west-1"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is also allowed to use expressions or placeholders to externalize the configuration and ensure that the region can
be reconfigured with property files or system properties.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="automatic-region-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#automatic-region-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#automatic-region-configuration">Automatic region configuration</a></h5>
<div class="paragraph">
<p>If the application context is started inside an EC2 instance, then the region can automatically be fetched from the
<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html">instance metadata</a> and therefore must
not be configured statically. The configuration will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">...</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-region</span> <span class="hljs-attr">auto-detect</span>=<span class="hljs-string">"true"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="service-specific-region-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-specific-region-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-specific-region-configuration">Service specific region configuration</a></h5>
<div class="paragraph">
<p>A region can also be overridden for particular services if one application context consumes services from different regions.
The configuration can be done globally like described above and configured for each service with a region attribute.
The configuration might look like this for a database service (described later)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">...</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-region</span> <span class="hljs-attr">region</span>=<span class="hljs-string">"eu-central-1"</span> /&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">jdbc:data-source</span> <span class="hljs-attr">...</span> <span class="hljs-attr">region</span>=<span class="hljs-string">"eu-west-1"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While it is theoretically possible to use multiple regions per application, we strongly recommend to write applications that
are hosted only inside one region and split the application if it is hosted in different regions at the same time.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="spring-boot-auto-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-auto-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-auto-configuration">4.3.3. Spring Boot auto-configuration</a></h4>
<div class="paragraph">
<p>Following the Spring Cloud umbrella project, Spring Cloud AWS also provides dedicated Spring Boot support. Spring Cloud
AWS can be configured using Spring Boot properties and will also automatically guess any sensible configuration based on
the general setup.</p>
</div>
<div class="sect4">
<h5 id="maven-dependencies"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#maven-dependencies"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#maven-dependencies">Maven dependencies</a></h5>
<div class="paragraph">
<p>Spring Cloud AWS provides a dedicated module to enable the Spring Boot support. That module must be added to the general
maven dependency inside the application. The typical configuration will look like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-aws-autoconfigure<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>{spring-cloud-version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Additional dependencies to enable particular features like messaging and JDBC have to be added. Spring Cloud AWS will
only configure classes that are available in the Spring Boot application’s classpath.</p>
</div>
</div>
<div class="sect4">
<h5 id="configuring-credentials"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-credentials"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-credentials">Configuring credentials</a></h5>
<div class="paragraph">
<p>Spring Boot provides a standard way to define properties with property file or YAML configuration files. Spring Cloud
AWS provides support to configure the credential information with the Spring Boot application configuration files.
Spring Cloud AWS provides the following properties to configure the credentials setup for the whole application.</p>
</div>
<div class="paragraph">
<p>Unless <code>cloud.aws.credentials.use-default-aws-credentials-chain</code> is set to <code>true</code>, Spring Cloud AWS configures following
credentials chain:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>AWSStaticCredentialsProvider</code> if <code>cloud.aws.credentials.access-key</code> is provided</p>
</li>
<li>
<p><code>EC2ContainerCredentialsProviderWrapper</code> unless <code>cloud.aws.credentials.instance-profile</code> is set to <code>false</code></p>
</li>
<li>
<p><code>ProfileCredentialsProvider</code></p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">property</th>
<th class="tableblock halign-left valign-top">example</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.credentials.access-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AKIAIOSFODNN7EXAMPLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The access key to be used with a static provider</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.credentials.secret-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The secret key to be used with a static provider</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.credentials.instance-profile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures an instance profile credentials provider with no further configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.credentials.profile-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of a configuration profile in the specified configuration file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.credentials.profile-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~/.aws/credentials</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The file path where the profile configuration file is located. Defaults to <code>~/.aws/credentials</code> if value is not provided</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.credentials.use-default-aws-credentials-chain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the DefaultAWSCredentials Chain instead of configuring a custom credentials chain</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="configuring-region"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-region"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-region">Configuring region</a></h5>
<div class="paragraph">
<p>Like for the credentials, the Spring Cloud AWS module also supports the configuration of the region inside the Spring
Boot configuration files. The region can be automatically detected or explicitly configured (e.g. in case of local tests
against the AWS cloud).</p>
</div>
<div class="paragraph">
<p>The properties to configure the region are shown below</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">property</th>
<th class="tableblock halign-left valign-top">example</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.region.auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables automatic region detection based on the EC2 meta data service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.region.use-default-aws-region-chain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the DefaultAWSRegion Chain instead of configuring a custom region chain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.region.static</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eu-west-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures a static region for the application. Possible regions are (currently) us-east-1, us-west-1, us-west-2,
eu-west-1, eu-central-1, ap-southeast-1, ap-southeast-1, ap-northeast-1, sa-east-1, cn-north-1 and any custom region
configured with own region meta data</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cloud-environment"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-environment"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-environment">5. Cloud environment</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Applications often need environment specific configuration information, especially in changing environments like in the
Amazon cloud environment. Spring Cloud AWS provides a support to retrieve and use environment specific data inside the
application context using common Spring mechanisms like property placeholder or the Spring expression language.</p>
</div>
<div class="sect2">
<h3 id="retrieving-instance-metadata"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#retrieving-instance-metadata"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#retrieving-instance-metadata">5.1. Retrieving instance metadata</a></h3>
<div class="paragraph">
<p><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html">Instance metadata</a> are available inside an
EC2 environment. The metadata can be queried using a special HTTP address that provides the instance metadata. Spring Cloud
AWS enables application to access this metadata directly in expression or property placeholder without the need to call
an external HTTP service.</p>
</div>
<div class="sect3">
<h4 id="enabling-instance-metadata-support-with-xml"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enabling-instance-metadata-support-with-xml"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enabling-instance-metadata-support-with-xml">5.1.1. Enabling instance metadata support with XML</a></h4>
<div class="paragraph">
<p>The instance metadata retrieval support is enabled through an XML element like the standard property placeholder in Spring.
The following code sample demonstrates the activation of the instance metadata support inside an application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">...</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-instance-data</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Instance metadata can be retrieved without an authorized service call, therefore the configuration above does not require
any region or security specific configuration.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="enabling-instance-metadata-support-with-java"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enabling-instance-metadata-support-with-java"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enabling-instance-metadata-support-with-java">5.1.2. Enabling instance metadata support with Java</a></h4>
<div class="paragraph">
<p>The instance metadata can also be configured within a Java configuration class without the need for an XML configuration.
The next example shows a typical Spring <code>@Configuration</code> class that enables the instance metadata with the
<code>org.springframework.cloud.aws.context.config.annotation.EnableInstanceData</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableContextInstanceData</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfiguration</span> </span>{
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enabling-instance-metadata-support-in-spring-boot"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enabling-instance-metadata-support-in-spring-boot"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enabling-instance-metadata-support-in-spring-boot">5.1.3. Enabling instance metadata support in Spring Boot</a></h4>
<div class="paragraph">
<p>The instance metadata is automatically available in a Spring Boot application as a property source if the application
is running on an EC2 instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-instance-metadata"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-instance-metadata"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-instance-metadata">5.1.4. Using instance metadata</a></h4>
<div class="paragraph">
<p>Instance metadata can be used in XML, Java placeholders and expressions. The example below demonstrates the usage of
instance metadata inside an XML file using placeholders and also the expression referring to the special variable <code>environment</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">...</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.cloud.aws....SimpleConfigurationBean"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"value1"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"#{environment.ami-id}"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"value2"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"#{environment.hostname}"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"value3"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${instance-type}"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"value4"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${instance-id}"</span> /&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Instance metadata can also be injected with the Spring <code>org.springframework.beans.factory.annotation.Value</code> annotation
directly into Java fields. The next example demonstrates the use of instance metadata inside a Spring bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationInfoBean</span> </span>{

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${ami-id:N/A}"</span>)
    <span class="hljs-keyword">private</span> String amiId;

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${hostname:N/A}"</span>)
    <span class="hljs-keyword">private</span> String hostname;

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${instance-type:N/A}"</span>)
    <span class="hljs-keyword">private</span> String instanceType;

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${services/domain:N/A}"</span>)
    <span class="hljs-keyword">private</span> String serviceDomain;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Every instance metadata can be accessed by the key available in the <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html">instance metadata service</a>
Nested properties can be accessed by separating the properties with a slash ('/').</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="using-instance-user-data"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-instance-user-data"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-instance-user-data">5.1.5. Using instance user data</a></h4>
<div class="paragraph">
<p>Besides the default instance metadata it is also possible to configure user data on each instance. This user data is retrieved and
parsed by Spring Cloud AWS. The user data can be defined while starting an EC2 instance with the application. Spring Cloud AWS
expects the format <code>&lt;key&gt;:&lt;value&gt;;&lt;key&gt;:&lt;value&gt;</code> inside the user data so that it can parse the string and extract the key value pairs.</p>
</div>
<div class="paragraph">
<p>The user data can be configured using either the management console shown below or a <a href="https://aws.amazon.com/cloudformation/aws-cloudformation-templates/">CloudFormation template</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/cloud-environment-user-data.png" alt="User data in the management console">
</div>
</div>
<div class="paragraph">
<p>A CloudFormation template snippet for the configuration of the user data is outlined below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">...
<span class="hljs-string">"Resources"</span>: {
 <span class="hljs-attr">"ApplicationServerInstance"</span>: {
  <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"AWS::EC2::Instance"</span>,
  <span class="hljs-attr">"Properties"</span>: {
   <span class="hljs-attr">"ImageId"</span>: <span class="hljs-string">"ami-6a56b81d"</span>,
   <span class="hljs-attr">"UserData"</span>: {
      <span class="hljs-attr">"Fn::Base64"</span>: <span class="hljs-string">"data1:value1;data2:value2"</span>
    },
   <span class="hljs-attr">"InstanceType"</span>: <span class="hljs-string">"t1.micro"</span>,
  }
}
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The user data can be accessed directly in the application context like the instance metadata through placeholders
or expressions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecondConfigurationBean</span> </span>{

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${data1}"</span>)
    <span class="hljs-keyword">private</span> String firstDataOption;

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${data2}"</span>)
    <span class="hljs-keyword">private</span> String secondDataOption;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-instance-tags"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-instance-tags"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-instance-tags">5.1.6. Using instance tags</a></h4>
<div class="paragraph">
<p>User configured properties can also be configured with tags instead of user data. Tags are a global concept in the context
of Amazon Web services and used in different services. Spring Cloud AWS supports instance tags also across different
services. Compared to user data, user tags can be updated during runtime, there is no need to stop and restart
the instance.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html">User data</a> can also be used to execute scripts
on instance startup. Therefore it is useful to leverage instance tags for user configuration and user data to execute scripts
on instance startup.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Instance specific tags can be configured on the instance level through the management console outlined below and
like user data also with a CloudFormation template shown afterwards.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/cloud-environment-instance-tags.png" alt="Instance data in the management console">
</div>
</div>
<div class="paragraph">
<p>A CloudFormation template snippet for the configuration of the instance tags is outlined below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">...
<span class="hljs-string">"Resources"</span>: {
    <span class="hljs-attr">"UserTagAndUserDataInstance"</span>: {
        <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"AWS::EC2::Instance"</span>,
        <span class="hljs-attr">"Properties"</span>: {
            <span class="hljs-attr">"ImageId"</span>: <span class="hljs-string">"ami-6a56b81d"</span>,
            <span class="hljs-attr">"InstanceType"</span>: <span class="hljs-string">"t1.micro"</span>,
            <span class="hljs-attr">"Tags"</span>: [
            {
                <span class="hljs-attr">"Key"</span>: <span class="hljs-string">"tag1"</span>,
                <span class="hljs-attr">"Value"</span>: <span class="hljs-string">"tagv1"</span>
            },
            {
                <span class="hljs-attr">"Key"</span>: <span class="hljs-string">"tag3"</span>,
                <span class="hljs-attr">"Value"</span>: <span class="hljs-string">"tagv3"</span>
            },
            {
                <span class="hljs-attr">"Key"</span>: <span class="hljs-string">"tag2"</span>,
                <span class="hljs-attr">"Value"</span>: <span class="hljs-string">"tagv2"</span>
            },
            {
                <span class="hljs-attr">"Key"</span>: <span class="hljs-string">"tag4"</span>,
                <span class="hljs-attr">"Value"</span>: <span class="hljs-string">"tagv4"</span>
            }
            ]
        }
    }
}
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve the instance tags, Spring Cloud AWS has to make authenticated requests and therefore it will need the region
and security configuration before actually resolving the placeholders. Also because the instance tags are not available while starting
the application context, they can only be referenced as expressions and not with placeholders. The <code>context-instance-data</code>
element defines an attribute <code>user-tags-map</code> that will create a map in the application context for the name. This map
can then be queried using expression for other bean definitions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">...</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-instance-data</span> <span class="hljs-attr">user-tags-map</span>=<span class="hljs-string">"instanceData"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A java bean might resolve expressions with the <code>@Value</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleConfigurationBean</span> </span>{

   <span class="hljs-meta">@Value</span>(<span class="hljs-string">"#{instanceData.tag1}"</span>)
   <span class="hljs-keyword">private</span> String value1;

   <span class="hljs-meta">@Value</span>(<span class="hljs-string">"#{instanceData.tag2}"</span>)
   <span class="hljs-keyword">private</span> String value2;

   <span class="hljs-meta">@Value</span>(<span class="hljs-string">"#{instanceData.tag3}"</span>)
   <span class="hljs-keyword">private</span> String value3;

   <span class="hljs-meta">@Value</span>(<span class="hljs-string">"#{instanceData.tag4}"</span>)
   <span class="hljs-keyword">private</span> String value4;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-custom-ec2-client"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-custom-ec2-client"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-custom-ec2-client">5.1.7. Configuring custom EC2 client</a></h4>
<div class="paragraph">
<p>In some circumstances it is necessary to have a custom EC2 client to retrieve the instance information. The
<code>context-instance-data</code> element supports a custom EC2 client with the <code>amazon-ec2</code> attribute. The next
example shows the use of a custom EC2 client that might have a special configuration in place.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">...</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>....<span class="hljs-tag">&lt;/<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-region</span> <span class="hljs-attr">...</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-instance-data</span>  <span class="hljs-attr">amazon-ec2</span>=<span class="hljs-string">"myCustomClient"</span>/&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"myCustomClient"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.amazonaws.services.ec2.AmazonEC2Client"</span>&gt;</span>
    ...
  <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="injecting-the-default-ec2-client"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#injecting-the-default-ec2-client"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#injecting-the-default-ec2-client">5.1.8. Injecting the default EC2 client</a></h4>
<div class="paragraph">
<p>If there are user tags configured for the instance data (see above) Spring Cloud AWS configures an EC2 client with
the specified region and security credentials. Application developers can inject the EC2 client directly into their code using the <code>@Autowired</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationService</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AmazonEC2 amazonEc2;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ApplicationService</span><span class="hljs-params">(AmazonEC2 amazonEc2)</span> </span>{
        <span class="hljs-keyword">this</span>.amazonEc2 = amazonEc2;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="integrating-your-spring-cloud-application-with-the-aws-parameter-store"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#integrating-your-spring-cloud-application-with-the-aws-parameter-store"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#integrating-your-spring-cloud-application-with-the-aws-parameter-store">5.2. Integrating your Spring Cloud application with the AWS Parameter Store</a></h3>
<div class="paragraph">
<p>Spring Cloud provides support for centralized configuration, which can be read and made available as a regular Spring
<code>PropertySource</code> when the application is started. The Parameter Store Configuration allows you to use this mechanism
with the <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-paramstore.html">AWS Parameter Store</a>.</p>
</div>
<div class="paragraph">
<p>Simply add a dependency on the <code>spring-cloud-starter-aws-parameter-store-config</code> starter module to activate the support.
The support is similar to the support provided for the Spring Cloud Config Server or Consul’s key-value store:
configuration parameters can be defined to be shared across all services or for a specific service and can be
profile-specific. Encrypted values will be decrypted when retrieved.</p>
</div>
<div class="paragraph">
<p>All configuration parameters are retrieved from a common path prefix, which defaults to <code>/config</code>. From there shared
parameters are retrieved from a path that defaults to <code>application</code> and service-specific parameters use a path that
defaults to the configured <code>spring.application.name</code>. You can use both dots and forward slashes to specify the names
of configuration keys. Names of activated profiles will be appended to the path using a separator that defaults to an
underscore.</p>
</div>
<div class="paragraph">
<p>That means that for a service called <code>my-service</code> the module by default would find and use these parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">parameter key</th>
<th class="tableblock halign-left valign-top">Spring property</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/application/cloud.aws.stack.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cloud.aws.stack.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shared by all services that have the Configuration support enabled. Can be overridden with a service- or profile-specific property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/application_production/cloud.aws.stack.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cloud.aws.stack.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shared by all services that have the Configuration support enabled and have a <code>production</code> Spring profile activated.
Can be overridden with a service-specific property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/my-service/cloud/aws/stack/auto</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cloud.aws.stack.auto</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specific to the <code>my-service</code> service. Note that slashes in the key path are replaced with dots.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/my-service_production/cloud/aws/stack/auto</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cloud.aws.stack.auto</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specific to the <code>my-service</code> service when a <code>production</code> Spring profile is activated.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that this module does not support full configuration files to be used as parameter values like e.g. Spring Cloud Consul does:
AWS parameter values are limited to 4096 characters, so we support individual Spring properties to be configured only.</p>
</div>
<div class="paragraph">
<p>You can configure the following settings in a Spring Cloud <code>bootstrap.properties</code> or <code>bootstrap.yml</code> file
(note that relaxed property binding is applied, so you don’t have to use this exact syntax):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">property</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws.paramstore.prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefix indicating first level for every property loaded from the Parameter Store.
Value must start with a forward slash followed by one or more valid path segments or be empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws.paramstore.defaultContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the context that defines properties shared across all services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws.paramstore.profileSeparator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String that separates an appended profile from the context name. Can only contain
dots, dashes, forward slashes, backward slashes and underscores next to alphanumeric characters.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws.paramstore.failFast</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates if an error while retrieving the parameters should fail starting the application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws.paramstore.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the configured value for <code>spring.application.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name to use when constructing the path for the properties to look up for this specific service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws.paramstore.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can be used to disable the Parameter Store Configuration support even though the auto-configuration is on the classpath.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to find out which properties are retrieved from AWS Parameter Store on application startup,
turn on <code>DEBUG</code> logging on <code>org.springframework.cloud.aws.paramstore.AwsParamStorePropertySource</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs">logging.level.org.springframework.cloud.aws.paramstore.AwsParamStorePropertySource=debug</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="integrating-your-spring-cloud-application-with-the-aws-secrets-manager"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#integrating-your-spring-cloud-application-with-the-aws-secrets-manager"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#integrating-your-spring-cloud-application-with-the-aws-secrets-manager">5.3. Integrating your Spring Cloud application with the AWS Secrets Manager</a></h3>
<div class="paragraph">
<p>Spring Cloud provides support for centralized configuration, which can be read and made available as a regular Spring
<code>PropertySource</code> when the application is started. The Secrets Manager Configuration allows you to use this mechanism
with the <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html">AWS Secrets Manager</a>.</p>
</div>
<div class="paragraph">
<p>Simply add a dependency on the <code>spring-cloud-starter-aws-secrets-manager-config</code> starter module to activate the support.
The support is similar to the support provided for the Spring Cloud Config Server or Consul’s key-value store:
configuration parameters can be defined to be shared across all services or for a specific service and can be
profile-specific.</p>
</div>
<div class="paragraph">
<p>All configuration parameters are retrieved from a common path prefix, which defaults to <code>/secret</code>. From there shared
parameters are retrieved from a path that defaults to <code>application</code> and service-specific parameters use a path that
defaults to the configured <code>spring.application.name</code>. You can use both dots and forward slashes to specify the names
of configuration keys. Names of activated profiles will be appended to the path using a separator that defaults to an
underscore.</p>
</div>
<div class="paragraph">
<p>That means that for a service called <code>my-service</code> the module by default would find and use these parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">parameter key</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/secret/application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shared by all services that have the Configuration support enabled. Can be overridden with a service- or profile-specific property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/secret/application_production</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shared by all services that have the Configuration support enabled and have a <code>production</code> Spring profile activated.
Can be overridden with a service-specific property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/secret/my-service</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specific to the <code>my-service</code> service..</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/secret/my-service_production</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specific to the <code>my-service</code> service when a <code>production</code> Spring profile is activated.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can configure the following settings in a Spring Cloud <code>bootstrap.properties</code> or <code>bootstrap.yml</code> file
(note that relaxed property binding is applied, so you don’t have to use this exact syntax):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">property</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws.secretsmanager.prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/secret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefix indicating first level for every property loaded from the Secrets Manager.
Value must start with a forward slash followed by one or more valid path segments or be empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws.secretsmanager.defaultContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the context that defines properties shared across all services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws.secretsmanager.profileSeparator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String that separates an appended profile from the context name. Can only contain
dots, dashes, forward slashes, backward slashes and underscores next to alphanumeric characters.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws.secretsmanager.failFast</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates if an error while retrieving the secrets should fail starting the application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws.secretsmanager.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the configured value for <code>spring.application.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name to use when constructing the path for the properties to look up for this specific service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws.secretsmanager.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can be used to disable the Secrets Manager Configuration support even though the auto-configuration is on the classpath.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="managing-cloud-environments"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#managing-cloud-environments"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#managing-cloud-environments">6. Managing cloud environments</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Managing environments manually with the management console does not scale and can become error-prone with the increasing
complexity of the infrastructure. Amazon Web services offers a <a href="https://aws.amazon.com/cloudformation/">CloudFormation</a>
service that allows to define stack configuration templates and bootstrap the whole infrastructure with the services.
In order to allow multiple stacks in parallel, each resource in the stack receives a unique physical name that contains
some arbitrary generated name. In order to interact with the stack resources in a unified way Spring Cloud AWS allows
developers to work with logical names instead of the random physical ones.</p>
</div>
<div class="paragraph">
<p>The next graphics shows a typical stack configuration.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/cloudformation-overview.png" alt="CloudFormation overview">
</div>
</div>
<div class="paragraph">
<p>The <strong>Template File</strong> describes all stack resources with their <em>logical name</em>. The <strong>CloudFormation</strong> service parses the stack
template file and creates all resources with their <em>physical name</em>. The application can use all the stack configured resources
with the <em>logical name</em> defined in the template. Spring Cloud AWS resolves all <em>logical names</em> into the respective
<em>physical name</em> for the application developer.</p>
</div>
<div class="sect2">
<h3 id="automatic-cloudformation-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#automatic-cloudformation-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#automatic-cloudformation-configuration">6.1. Automatic CloudFormation configuration</a></h3>
<div class="paragraph">
<p>If the application runs inside a stack (because the underlying EC2 instance has been bootstrapped within the stack), then
Spring Cloud AWS will automatically detect the stack and resolve all resources from the stack. Application developers
can use all the logical names from the stack template to interact with the services. In the example below, the database
resource is configured using a CloudFormation template, defining a logical name for the database instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">"applicationDatabase": {
  "Type": "AWS::RDS::DBInstance",
  "Properties": {
    "AllocatedStorage": "5",
    "DBInstanceClass": "db.t1.micro",
    "DBName": "test"
    ...
  ]
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The datasource is then created and will receive a physical name (e.g. ir142c39k6o5irj) as the database service name. Application
developers can still use the logical name (in this case <code>applicationDatabase</code>) to interact with the database. The example
below shows the stack configuration which is defined by the element <code>aws-context:stack-configuration</code> and resolves automatically
the particular stack. The <code>data-source</code> element uses the logical name for the <code>db-instance-identifier</code> attribute to work with
the database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hljs-attr">xmlns:aws-context</span>=<span class="hljs-string">"http://www.springframework.org/schema/cloud/aws/context"</span>
       <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/cloud/aws/context
       http://www.springframework.org/schema/cloud/aws/context/spring-cloud-aws-context.xsd"</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>
    ...
  <span class="hljs-tag">&lt;/<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-region</span> <span class="hljs-attr">..</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:stack-configuration</span>/&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">jdbc:data-source</span> <span class="hljs-attr">db-instance-identifier</span>=<span class="hljs-string">"applicationDatabase"</span> <span class="hljs-attr">...</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Further detailed information on the Amazon RDS configuration and setup can be found in the respective chapter in this
documentation.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="manual-cloudformation-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#manual-cloudformation-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#manual-cloudformation-configuration">6.2. Manual CloudFormation configuration</a></h3>
<div class="paragraph">
<p>If the application is not running inside a stack configured EC2 instance, then the stack configuration must be configured
manually. The configuration consists of an additional element attribute <code>stack-name</code> that will be used to resolve all the
respective stack configuration information at runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">....</span>&gt;</span>
    ...
  <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:stack-configuration</span> <span class="hljs-attr">stack-name</span>=<span class="hljs-string">"myStackName"</span> /&gt;</span>
    ...
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cloudformation-configuration-with-java-config-classes"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloudformation-configuration-with-java-config-classes"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloudformation-configuration-with-java-config-classes">6.3. CloudFormation configuration with Java config classes</a></h3>
<div class="paragraph">
<p>Spring Cloud AWS also supports the configuration of the CloudFormation support within Java classes avoiding the use of
XML inside the application configuration. Spring Cloud AWS provides the annotation
<code>og.springframework.cloud.aws.context.config.annotation.EnableStackConfiguration</code> that allows the automatic and manual
stack configuration. The next example shows a configuration class that configures the CloudFormation support with an
explicit stack name (here <code>manualStackName</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableStackConfiguration</span>(stackName = <span class="hljs-string">"manualStackName"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfiguration</span> </span>{
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not define the <code>stackName</code> attribute if an automatic stack name should be enabled.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="cloudformation-configuration-in-spring-boot"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloudformation-configuration-in-spring-boot"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloudformation-configuration-in-spring-boot">6.4. CloudFormation configuration in Spring Boot</a></h3>
<div class="paragraph">
<p>Spring Cloud AWS also supports the configuration of the CloudFormation support within the Spring Boot configuration. The
manual and automatic stack configuration can be defined with properties that are described in the table below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">property</th>
<th class="tableblock halign-left valign-top">example</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.stack.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myStackName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the manually configured stack name that will be used to retrieve the resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.stack.auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the automatic stack name detection for the application.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="manual-name-resolution"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#manual-name-resolution"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#manual-name-resolution">6.5. Manual name resolution</a></h3>
<div class="paragraph">
<p>Spring Cloud AWS uses the CloudFormation stack to resolve all resources internally using the logical names. In some circumstances
it might be needed to resolve the physical name inside the application code. Spring Cloud AWS provides a pre-configured
service to resolve the physical stack name based on the logical name. The sample shows a manual stack resource resolution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationService</span> </span>{

 <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ResourceIdResolver resourceIdResolver;

 <span class="hljs-meta">@Autowired</span>
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ApplicationService</span><span class="hljs-params">(ResourceIdResolver resourceIdResolver)</span> </span>{
    <span class="hljs-keyword">this</span>.resourceIdResolver = resourceIdResolver;
 }

 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleApplicationLogic</span><span class="hljs-params">()</span> </span>{
    String physicalBucketName =
        <span class="hljs-keyword">this</span>.resourceIdResolver.resolveToPhysicalResourceId(<span class="hljs-string">"someLogicalName"</span>);
 }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stack-tags"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stack-tags"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stack-tags">6.6. Stack Tags</a></h3>
<div class="paragraph">
<p>Like for the Amazon EC2 instances, CloudFormation also provides stack specific tags that can be used to
configure stack specific configuration information and receive them inside the application. This can for example be a
stage specific configuration property (like DEV, INT, PRD).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">....</span>&gt;</span>
    ...
    <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:stack-configuration</span> <span class="hljs-attr">user-tags-map</span>=<span class="hljs-string">"stackTags"</span>/&gt;</span>
    ...
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The application can then access the stack tags with an expression like <code>#{stackTags.key1}</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-custom-cloudformation-client"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-custom-cloudformation-client"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-custom-cloudformation-client">6.7. Using custom CloudFormation client</a></h3>
<div class="paragraph">
<p>Like for the EC2 configuration setup, the <code>aws-context:stack-configuration</code> element supports a custom CloudFormation client
with a special setup. The client itself can be configured using the <code>amazon-cloud-formation</code> attribute as shown in the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:stack-configuration</span> <span class="hljs-attr">amazon-cloud-formation</span>=<span class="hljs-string">""</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.amazonaws.services.cloudformation.AmazonCloudFormationClient"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="messaging"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#messaging"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#messaging">7. Messaging</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud AWS provides <a href="https://aws.amazon.com/sqs/">Amazon SQS</a> and <a href="https://aws.amazon.com/sqs/">Amazon SNS</a> integration
that simplifies the publication and consumption of messages over SQS or SNS. While SQS fully relies on the messaging API
introduced with Spring 4.0, SNS only partially implements it as the receiving part must be handled differently for
push notifications.</p>
</div>
<div class="sect2">
<h3 id="configuring-messaging"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-messaging"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-messaging">7.1. Configuring messaging</a></h3>
<div class="paragraph">
<p>Before using and configuring the messaging support, the application has to include the respective module dependency
into the Maven configuration. Spring Cloud AWS Messaging support comes as a separate module to allow the modularized use
of the modules.</p>
</div>
<div class="sect3">
<h4 id="maven-dependency-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#maven-dependency-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#maven-dependency-configuration">7.1.1. Maven dependency configuration</a></h4>
<div class="paragraph">
<p>The Spring Cloud AWS messaging module comes as a standalone module and can be imported with the following dependency declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-aws-messaging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>{spring-cloud-version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sqs-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sqs-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sqs-support">7.2. SQS support</a></h3>
<div class="paragraph">
<p>Amazon SQS is a hosted messaging service on the Amazon Web Service platform that provides point-to-point communication
with queues. Compared to JMS or other message services Amazon SQS has several features and limitations that should be
taken into consideration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Amazon SQS allows only <code>String</code> payloads, so any <code>Object</code> must be transformed into a String representation.
Spring Cloud AWS has dedicated support to transfer Java objects with Amazon SQS messages by converting them to JSON.</p>
</li>
<li>
<p>Amazon SQS has no transaction support, so messages might therefore be retrieved twice. Application have to be written in
an idempotent way so that they can receive a message twice.</p>
</li>
<li>
<p>Amazon SQS has a maximum message size of 256kb per message, so bigger messages will fail to be sent.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="sending-a-message"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-a-message"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-a-message">7.2.1. Sending a message</a></h4>
<div class="paragraph">
<p>The <code>QueueMessagingTemplate</code> contains many convenience methods to send a message. There are send methods that specify the
destination using a <code>QueueMessageChannel</code> object and those that specify the destination using a string which is going to
be resolved against the SQS API. The send method that takes no destination argument uses the default destination.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> com.amazonaws.services.sqs.AmazonSQSAsync;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.cloud.aws.messaging.core.QueueMessagingTemplate;
<span class="hljs-keyword">import</span> org.springframework.messaging.support.MessageBuilder;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SqsQueueSender</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> QueueMessagingTemplate queueMessagingTemplate;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SqsQueueSender</span><span class="hljs-params">(AmazonSQSAsync amazonSQSAsync)</span> </span>{
        <span class="hljs-keyword">this</span>.queueMessagingTemplate = <span class="hljs-keyword">new</span> QueueMessagingTemplate(amazonSQSAsync);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">send</span><span class="hljs-params">(String message)</span> </span>{
        <span class="hljs-keyword">this</span>.queueMessagingTemplate.send(<span class="hljs-string">"physicalQueueName"</span>, MessageBuilder.withPayload(message).build());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example uses the <code>MessageBuilder</code> class to create a message with a string payload. The <code>QueueMessagingTemplate</code> is
constructed by passing a reference to the <code>AmazonSQSAsync</code> client. The destination in the send method is a string value that
must match the queue name defined on AWS. This value will be resolved at runtime by the Amazon SQS client. Optionally
a <code>ResourceIdResolver</code> implementation can be passed to the <code>QueueMessagingTemplate</code> constructor to resolve resources by
logical name when running inside a CloudFormation stack (see <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#managing-cloud-environments">Managing cloud environments</a> for more information about
resource name resolution).</p>
</div>
<div class="paragraph">
<p>With the messaging namespace a <code>QueueMessagingTemplate</code> can be defined in an XML configuration file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xmlns:aws-context</span>=<span class="hljs-string">"http://www.springframework.org/schema/cloud/aws/context"</span>
    <span class="hljs-attr">xmlns:aws-messaging</span>=<span class="hljs-string">"http://www.springframework.org/schema/cloud/aws/messaging"</span>
    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/cloud/aws/context
        http://www.springframework.org/schema/cloud/aws/context/spring-cloud-aws-context.xsd
        http://www.springframework.org/schema/cloud/aws/messaging
        http://www.springframework.org/schema/cloud/aws/messaging/spring-cloud-aws-messaging"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:instance-profile-credentials</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">aws-messaging:queue-messaging-template</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"queueMessagingTemplate"</span> /&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example the messaging namespace handler constructs a new <code>QueueMessagingTemplate</code>. The <code>AmazonSQSAsync</code> client
is automatically created and passed to the template’s constructor based on the provided credentials. If the
application runs inside a configured CloudFormation stack a <code>ResourceIdResolver</code> is passed to the constructor (see
<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#managing-cloud-environments">Managing cloud environments</a> for more information about resource name resolution).</p>
</div>
<div class="sect4">
<h5 id="using-message-converters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-message-converters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-message-converters">Using message converters</a></h5>
<div class="paragraph">
<p>In order to facilitate the sending of domain model objects, the <code>QueueMessagingTemplate</code> has various send methods that
take a Java object as an argument for a message’s data content. The overloaded methods <code>convertAndSend()</code> and
<code>receiveAndConvert()</code> in <code>QueueMessagingTemplate</code> delegate the conversion process to an instance of the <code>MessageConverter</code>
interface. This interface defines a simple contract to convert between Java objects and SQS messages. The default
implementation <code>SimpleMessageConverter</code> simply unwraps the message payload as long as it matches the target type. By
using the converter, you and your application code can focus on the business object that is being sent or received via
SQS and not be concerned with the details of how it is represented as an SQS message.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As SQS is only able to send <code>String</code> payloads the default converter <code>SimpleMessageConverter</code> should only be used
to send <code>String</code> payloads. For more complex objects a custom converter should be used like the one created by the
messaging namespace handler.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is recommended to use the XML messaging namespace to create <code>QueueMessagingTemplate</code> as it will set a more
sophisticated <code>MessageConverter</code> that converts objects into JSON when Jackson is on the classpath.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">aws-messaging:queue-messaging-template</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"queueMessagingTemplate"</span> /&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">this</span>.queueMessagingTemplate.convertAndSend(<span class="hljs-string">"queueName"</span>, <span class="hljs-keyword">new</span> Person(<span class="hljs-string">"John, "</span>Doe<span class="hljs-string">"));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example a <code>QueueMessagingTemplate</code> is created using the messaging namespace. The <code>convertAndSend</code> method
converts the payload <code>Person</code> using the configured <code>MessageConverter</code> and sends the message.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="receiving-a-message"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#receiving-a-message"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#receiving-a-message">7.2.2. Receiving a message</a></h4>
<div class="paragraph">
<p>There are two ways for receiving SQS messages, either use the <code>receive</code> methods of the <code>QueueMessagingTemplate</code> or with
annotation-driven listener endpoints. The latter is by far the more convenient way to receive messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Person person = <span class="hljs-keyword">this</span>.queueMessagingTemplate.receiveAndConvert(<span class="hljs-string">"queueName"</span>, Person.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example the <code>QueueMessagingTemplate</code> will get one message from the SQS queue and convert it to the target class
passed as argument.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotation-driven-listener-endpoints"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#annotation-driven-listener-endpoints"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#annotation-driven-listener-endpoints">7.2.3. Annotation-driven listener endpoints</a></h4>
<div class="paragraph">
<p>Annotation-driven listener endpoints are the easiest way for listening on SQS messages. Simply annotate methods with
<code>MessageMapping</code> and the <code>QueueMessageHandler</code> will route the messages to the annotated methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">aws-messaging:annotation-driven-queue-listener</span> /&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SqsListener</span>(<span class="hljs-string">"queueName"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">queueListener</span><span class="hljs-params">(Person person)</span> </span>{
    <span class="hljs-comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example a queue listener container is started that polls the SQS <code>queueName</code> passed to the <code>MessageMapping</code>
annotation. The incoming messages are converted to the target type and then the annotated method <code>queueListener</code> is invoked.</p>
</div>
<div class="paragraph">
<p>In addition to the payload, headers can be injected in the listener methods with the <code>@Header</code> or <code>@Headers</code>
annotations. <code>@Header</code> is used to inject a specific header value while <code>@Headers</code> injects a <code>Map&lt;String, String&gt;</code>
containing all headers.</p>
</div>
<div class="paragraph">
<p>Only the <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/APIReference/API_Message.html">standard
message attributes</a> sent with an SQS message are supported. Custom attributes are currently not supported.</p>
</div>
<div class="paragraph">
<p>In addition to the provided argument resolvers, custom ones can be registered on the
<code>aws-messaging:annotation-driven-queue-listener</code> element using the <code>aws-messaging:argument-resolvers</code> attribute (see example below).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">aws-messaging:annotation-driven-queue-listener</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">aws-messaging:argument-resolvers</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.custom.CustomArgumentResolver"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">aws-messaging:argument-resolvers</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">aws-messaging:annotation-driven-queue-listener</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the <code>SimpleMessageListenerContainer</code> creates a <code>ThreadPoolTaskExecutor</code> with computed values for the core and
max pool sizes. The core pool size is set to twice the number of queues and the max pool size is obtained by multiplying
the number of queues by the value of the <code>maxNumberOfMessages</code> field. If these default values do not meet the need of
the application, a custom task executor can be set with the <code>task-executor</code> attribute (see example below).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">aws-messaging:annotation-driven-queue-listener</span> <span class="hljs-attr">task-executor</span>=<span class="hljs-string">"simpleTaskExecutor"</span> /&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="message-reply"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#message-reply"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#message-reply">Message reply</a></h5>
<div class="paragraph">
<p>Message listener methods can be annotated with <code>@SendTo</code> to send their return value to another channel. The
<code>SendToHandlerMethodReturnValueHandler</code> uses the defined messaging template set on the
<code>aws-messaging:annotation-driven-queue-listener</code> element to send the return value. The messaging template must implement
the <code>DestinationResolvingMessageSendingOperations</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">aws-messaging:annotation-driven-queue-listener</span> <span class="hljs-attr">send-to-message-template</span>=<span class="hljs-string">"queueMessagingTemplate"</span>/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SqsListener</span>(<span class="hljs-string">"treeQueue"</span>)
<span class="hljs-meta">@SendTo</span>(<span class="hljs-string">"leafsQueue"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Leaf&gt; <span class="hljs-title">extractLeafs</span><span class="hljs-params">(Tree tree)</span> </span>{
    <span class="hljs-comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example the <code>extractLeafs</code> method will receive messages coming from the <code>treeQueue</code> and then return a
<code>List</code> of <code>Leaf</code>s which is going to be sent to the <code>leafsQueue</code>. Note that on the
<code>aws-messaging:annotation-driven-queue-listener</code> XML element there is an attribute <code>send-to-message-template</code>
that specifies <code>QueueMessagingTemplate</code> as the messaging template to be used to send the return value of the message
listener method.</p>
</div>
</div>
<div class="sect4">
<h5 id="handling-exceptions"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#handling-exceptions"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#handling-exceptions">Handling Exceptions</a></h5>
<div class="paragraph">
<p>Exception thrown inside <code>@SqsListener</code> annotated methods can be handled by methods annotated with <code>@MessageExceptionHandler</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> org.springframework.cloud.aws.messaging.listener.annotation.SqsListener;
<span class="hljs-keyword">import</span> org.springframework.messaging.handler.annotation.MessageExceptionHandler;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyMessageHandler</span> </span>{

    <span class="hljs-meta">@SqsListener</span>(<span class="hljs-string">"queueName"</span>)
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">handle</span><span class="hljs-params">(String message)</span> </span>{
        ...
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> MyException(<span class="hljs-string">"something went wrong"</span>);
    }

    <span class="hljs-meta">@MessageExceptionHandler</span>(MyException.class)
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">handleException</span><span class="hljs-params">(MyException e)</span> </span>{
        ...
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-simplemessagelistenercontainerfactory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-simplemessagelistenercontainerfactory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-simplemessagelistenercontainerfactory">7.2.4. The SimpleMessageListenerContainerFactory</a></h4>
<div class="paragraph">
<p>The <code>SimpleMessageListenerContainer</code> can also be configured with Java by creating a bean of type <code>SimpleMessageListenerContainerFactory</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> SimpleMessageListenerContainerFactory <span class="hljs-title">simpleMessageListenerContainerFactory</span><span class="hljs-params">(AmazonSQSAsync amazonSqs)</span> </span>{
    SimpleMessageListenerContainerFactory factory = <span class="hljs-keyword">new</span> SimpleMessageListenerContainerFactory();
    factory.setAmazonSqs(amazonSqs);
    factory.setAutoStartup(<span class="hljs-keyword">false</span>);
    factory.setMaxNumberOfMessages(<span class="hljs-number">5</span>);
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">return</span> factory;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="consuming-aws-event-messages-with-amazon-sqs"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#consuming-aws-event-messages-with-amazon-sqs"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#consuming-aws-event-messages-with-amazon-sqs">7.2.5. Consuming AWS Event messages with Amazon SQS</a></h4>
<div class="paragraph">
<p>It is also possible to receive AWS generated event messages with the SQS message listeners. Because
AWS messages does not contain the mime-type header, the Jackson message converter has to be configured
with the <code>strictContentTypeMatch</code> property false to also parse message without the proper mime type.</p>
</div>
<div class="paragraph">
<p>The next code shows the configuration of the message converter using the <code>QueueMessageHandlerFactory</code>
and re-configuring the <code>MappingJackson2MessageConverter</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> QueueMessageHandlerFactory <span class="hljs-title">queueMessageHandlerFactory</span><span class="hljs-params">()</span> </span>{
    QueueMessageHandlerFactory factory = <span class="hljs-keyword">new</span> QueueMessageHandlerFactory();
    MappingJackson2MessageConverter messageConverter = <span class="hljs-keyword">new</span> MappingJackson2MessageConverter();

    <span class="hljs-comment">//set strict content type match to false</span>
    messageConverter.setStrictContentTypeMatch(<span class="hljs-keyword">false</span>);
    factory.setArgumentResolvers(Collections.&lt;HandlerMethodArgumentResolver&gt;singletonList(<span class="hljs-keyword">new</span> PayloadArgumentResolver(messageConverter)));
    <span class="hljs-keyword">return</span> factory;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the configuration above, it is possible to receive event notification for S3 buckets (and also other
event notifications like elastic transcoder messages) inside <code>@SqsListener</code> annotated methods s shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SqsListener</span>(<span class="hljs-string">"testQueue"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">receive</span><span class="hljs-params">(S3EventNotification s3EventNotificationRecord)</span> </span>{
    S3EventNotification.S3Entity s3Entity = s3EventNotificationRecord.getRecords().get(<span class="hljs-number">0</span>).getS3();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sns-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sns-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sns-support">7.3. SNS support</a></h3>
<div class="paragraph">
<p>Amazon SNS is a publish-subscribe messaging system that allows clients to publish notification to a particular topic. Other
interested clients may subscribe using different protocols like HTTP/HTTPS, e-mail or an Amazon SQS queue to receive the messages.</p>
</div>
<div class="paragraph">
<p>The next graphic shows a typical example of an Amazon SNS architecture.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/sns-overview.png" alt="SNS Overview">
</div>
</div>
<div class="paragraph">
<p>Spring Cloud AWS supports Amazon SNS by providing support to send notifications with a <code>NotificationMessagingTemplate</code> and
to receive notifications with the HTTP/HTTPS endpoint using the Spring Web MVC <code>@Controller</code> based programming model. Amazon
SQS based subscriptions can be used with the annotation-driven message support that is provided by the Spring Cloud AWS messaging module.</p>
</div>
<div class="sect3">
<h4 id="sending-a-message-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-a-message-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-a-message-2">7.3.1. Sending a message</a></h4>
<div class="paragraph">
<p>The <code>NotificationMessagingTemplate</code> contains two convenience methods to send a notification. The first one specifies the
destination using a <code>String</code> which is going to be resolved against the SNS API. The second one takes no destination
argument and uses the default destination. All the usual send methods that are available on the <code>MessageSendingOperations</code>
are implemented but are less convenient to send notifications because the subject must be passed as header.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Currently only <code>String</code> payloads can be sent using the <code>NotificationMessagingTemplate</code> as this is the expected
type by the SNS API.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> com.amazonaws.services.sns.AmazonSNS;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.cloud.aws.messaging.core.NotificationMessagingTemplate;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SnsNotificationSender</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> NotificationMessagingTemplate notificationMessagingTemplate;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SnsNotificationSender</span><span class="hljs-params">(AmazonSNS amazonSns)</span> </span>{
        <span class="hljs-keyword">this</span>.notificationMessagingTemplate = <span class="hljs-keyword">new</span> NotificationMessagingTemplate(amazonSns);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">send</span><span class="hljs-params">(String subject, String message)</span> </span>{
        <span class="hljs-keyword">this</span>.notificationMessagingTemplate.sendNotification(<span class="hljs-string">"physicalTopicName"</span>, message, subject);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example constructs a new <code>NotificationMessagingTemplate</code> by passing an <code>AmazonSNS</code> client as argument. In the <code>send</code>
method the convenience <code>sendNotification</code> method is used to send a <code>message</code> with <code>subject</code> to an SNS topic. The
destination in the <code>sendNotification</code> method is a string value that must match the topic name defined on AWS. This value
is resolved at runtime by the Amazon SNS client. Optionally a <code>ResourceIdResolver</code> implementation can be passed to the
<code>NotificationMessagingTemplate</code> constructor to resolve resources by logical name when running inside a CloudFormation stack.
(See <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#managing-cloud-environments">Managing cloud environments</a> for more information about resource name resolution.)</p>
</div>
<div class="paragraph">
<p>It is recommended to use the XML messaging namespace to create <code>NotificationMessagingTemplate</code> as it will automatically
configure the SNS client to setup the default converter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">aws-messaging:notification-messaging-template</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"notificationMessagingTemplate"</span> /&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="annotation-driven-http-notification-endpoint"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#annotation-driven-http-notification-endpoint"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#annotation-driven-http-notification-endpoint">7.3.2. Annotation-driven HTTP notification endpoint</a></h4>
<div class="paragraph">
<p>SNS supports multiple endpoint types (SQS, Email, HTTP, HTTPS), Spring Cloud AWS provides support for HTTP(S) endpoints.
SNS sends three type of requests to an HTTP topic listener endpoint, for each of them annotations are provided:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Subscription request → <code>@NotificationSubscriptionMapping</code></p>
</li>
<li>
<p>Notification request → <code>@NotificationMessageMapping</code></p>
</li>
<li>
<p>Unsubscription request → <code>@NotificationUnsubscribeMapping</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>HTTP endpoints are based on Spring MVC controllers. Spring Cloud AWS added some custom argument resolvers to extract
the message and subject out of the notification requests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/topicName"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NotificationTestController</span> </span>{

    <span class="hljs-meta">@NotificationSubscriptionMapping</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleSubscriptionMessage</span><span class="hljs-params">(NotificationStatus status)</span> <span class="hljs-keyword">throws</span> IOException </span>{
        <span class="hljs-comment">//We subscribe to start receive the message</span>
        status.confirmSubscription();
    }

    <span class="hljs-meta">@NotificationMessageMapping</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleNotificationMessage</span><span class="hljs-params">(@NotificationSubject String subject, @NotificationMessage String message)</span> </span>{
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@NotificationUnsubscribeConfirmationMapping</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleUnsubscribeMessage</span><span class="hljs-params">(NotificationStatus status)</span> </span>{
        <span class="hljs-comment">//e.g. the client has been unsubscribed and we want to "re-subscribe"</span>
        status.confirmSubscription();
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Currently it is not possible to define the mapping URL on the method level therefore the <code>RequestMapping</code> must
be done at type level and must contain the full path of the endpoint.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This example creates a new Spring MVC controller with three methods to handle the three requests listed above. In order
to resolve the arguments of the <code>handleNotificationMessage</code> methods a custom argument resolver must be registered. The
XML configuration is listed below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:argument-resolvers</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">"notificationResolver"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:argument-resolvers</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mvc:annotation-driven</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">aws-messaging:notification-argument-resolver</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"notificationResolver"</span> /&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>aws-messaging:notification-argument-resolver</code> element registers three argument resolvers:
<code>NotificationStatusHandlerMethodArgumentResolver</code>, <code>NotificationMessageHandlerMethodArgumentResolver</code>,
and <code>NotificationSubjectHandlerMethodArgumentResolver</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-cloudformation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-cloudformation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-cloudformation">7.4. Using CloudFormation</a></h3>
<div class="paragraph">
<p>Amazon SQS queues and SNS topics can be configured within a stack and then be used by applications. Spring Cloud AWS
also supports the lookup of stack-configured queues and topics by their logical name with the resolution to the physical
name. The example below shows an SNS topic and SQS queue configuration inside a CloudFormation template.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"><span class="hljs-string">"LogicalQueueName"</span>: {
    <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"AWS::SQS::Queue"</span>,
    <span class="hljs-attr">"Properties"</span>: {
    }
},
<span class="hljs-string">"LogicalTopicName"</span>: {
    <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"AWS::SNS::Topic"</span>,
    <span class="hljs-attr">"Properties"</span>: {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The logical names <code>LogicalQueueName</code> and <code>LogicalTopicName</code> can then be used in the configuration and in the application
as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">aws-messaging:queue-messaging-template</span> <span class="hljs-attr">default-destination</span>=<span class="hljs-string">"LogicalQueueName"</span> /&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">aws-messaging:notification-messaging-template</span> <span class="hljs-attr">default-destination</span>=<span class="hljs-string">"LogicalTopicName"</span> /&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SqsListener</span>(<span class="hljs-string">"LogicalQueueName"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">receiveQueueMessages</span><span class="hljs-params">(Person person)</span> </span>{
    <span class="hljs-comment">// Logical names can also be used with messaging templates</span>
    <span class="hljs-keyword">this</span>.notificationMessagingTemplate.sendNotification(<span class="hljs-string">"anotherLogicalTopicName"</span>, <span class="hljs-string">"Message"</span>, <span class="hljs-string">"Subject"</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the logical names like in the example above, the stack can be created on different environments without any
configuration or code changes inside the application.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="caching"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#caching"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#caching">8. Caching</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Caching in a cloud environment is useful for applications to reduce the latency and to save database round trips.
Reducing database round trips can significantly reduce the requirements for the database instance. The Spring Framework
provides, since version 3.1, a unified Cache abstraction to allow declarative caching in applications analogous to the
declarative transactions.</p>
</div>
<div class="paragraph">
<p>Spring Cloud AWS integrates the <a href="https://aws.amazon.com/elasticache/">Amazon ElastiCache</a> service into the Spring unified
caching abstraction providing a cache manager based on the memcached and Redis protocols. The caching support for Spring
Cloud AWS provides its own memcached implementation for ElastiCache and uses
<a href="https://projects.spring.io/spring-data-redis/">Spring Data Redis</a> for Redis caches.</p>
</div>
<div class="sect2">
<h3 id="configuring-dependencies-for-redis-caches"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-dependencies-for-redis-caches"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-dependencies-for-redis-caches">8.1. Configuring dependencies for Redis caches</a></h3>
<div class="paragraph">
<p>Spring Cloud AWS delivers its own implementation of a memcached cache, therefore no other dependencies are needed. For Redis
Spring Cloud AWS relies on Spring Data Redis to support caching and also to allow multiple Redis drivers to be used. Spring
Cloud AWS supports all Redis drivers that Spring Data Redis supports (currently Jedis, JRedis, SRP and Lettuce) with Jedis
being used internally for testing against ElastiCache. A dependency definition for Redis with Jedis is shown in the example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.data<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-data-redis.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Cloud AWS will automatically detect the Redis driver and will use one of them automatically.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-caching-with-xml"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-caching-with-xml"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-caching-with-xml">8.2. Configuring caching with XML</a></h3>
<div class="paragraph">
<p>The cache support for Spring Cloud AWS resides in the context module and can therefore be used if the context module
is already imported in the project. The cache integration provides its own namespace to configure cache clusters that are
hosted in the Amazon ElastiCache service. The next example contains a configuration for the cache cluster and the Spring
configuration to enable declarative, annotation-based caching.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns:aws-cache</span>=<span class="hljs-string">"http://www.springframework.org/schema/cloud/aws/cache"</span>
       <span class="hljs-attr">xmlns:cache</span>=<span class="hljs-string">"http://www.springframework.org/schema/cache"</span>
       <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/cloud/aws/cache
        http://www.springframework.org/schema/cloud/aws/cache/spring-cloud-aws-cache.xsd
        http://www.springframework.org/schema/cache
        https://www.springframework.org/schema/cache/spring-cache.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>
        ...
        <span class="hljs-tag">&lt;/<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">aws-cache:cache-manager</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">aws-cache:cache-cluster</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"CacheCluster"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">aws-cache:cache-manager</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">cache:annotation-driven</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration above configures a <code>cache-manager</code> with one cache with the name <code>CacheCluster</code> that represents an
<a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/UserGuide/ManagingCacheClusters.html">ElasticCache cluster</a>.</p>
</div>
<div class="sect3">
<h4 id="mixing-caches"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#mixing-caches"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#mixing-caches">8.2.1. Mixing caches</a></h4>
<div class="paragraph">
<p>Applications may have the need for multiple caches that are maintained by one central cache cluster. The Spring Cloud
AWS caching support allows to define multiple caches inside one cache manager and also to use externally defined caches
inside the cache manager.</p>
</div>
<div class="paragraph">
<p>The example below demonstrates a configuration example that contains a pre-configured cache with a <code>cache-ref</code> element
(which might be a local cache) and a <code>cache-cluster</code> configuration for ElastiCache cache clusters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">...</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">aws-cache:cache-manager</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"cacheManager"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">aws-cache:cache-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"memcached"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">aws-cache:cache-cluster</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"SimpleCache"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">aws-cache:cache-manager</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="defining-expiration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#defining-expiration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#defining-expiration">8.2.2. Defining expiration</a></h4>
<div class="paragraph">
<p>The Spring cache demarcation does not support expiry time configuration and leaves it up to the cache implementation
to support an expiry time. The Spring Cloud AWS cache configuration supports the expiry time setting per cache. The
expiry time will be passed to the memcached service.</p>
</div>
<div class="paragraph">
<p>The <code>cache-cluster</code> element accepts an expiration attribute that defines the expiration time in seconds.
No configured values implies that there is an infinite expiration time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">aws-cache:cache-manager</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">aws-cache:cache-cluster</span> <span class="hljs-attr">expiration</span>=<span class="hljs-string">"10000"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"CacheCluster"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">aws-cache:cache-manager</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-caching-using-java-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-caching-using-java-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-caching-using-java-configuration">8.3. Configuring caching using Java configuration</a></h3>
<div class="paragraph">
<p>Spring Cloud AWS also support the cache configuration with Java configuration classes. On any <code>Configuration</code> class,
the caching can be configured using the <code>org.springframework.cloud.aws.cache.config.annotation.EnableElastiCache</code>
annotation provided by Spring Cloud AWS. The next example shows a configuration of two cache clusters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@EnableElastiCache</span>({<span class="hljs-meta">@CacheClusterConfig</span>(name = <span class="hljs-string">"firstCache"</span>), <span class="hljs-meta">@CacheClusterConfig</span>(name = <span class="hljs-string">"secondCache"</span>)})
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfiguration</span> </span>{
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you leave the <code>value</code> attribute empty, then all the caches inside your CloudFormation stack (if available)
will be configured automatically.
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="configuring-expiry-time-for-caches"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-expiry-time-for-caches"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-expiry-time-for-caches">8.3.1. Configuring expiry time for caches</a></h4>
<div class="paragraph">
<p>The Java configuration also allows to configure the expiry time for the caches. This can be done for all
caches using the <code>defaultExpiration</code> attribute as shown in the example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@EnableElastiCache</span>(defaultExpiration = <span class="hljs-number">23</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfiguration</span> </span>{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The expiration can be defined on a cache level using the <code>@CacheClusterConfig</code> annotations expiration attribute as shown below (using seconds as
the value).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@EnableElastiCache</span>({<span class="hljs-meta">@CacheClusterConfig</span>(name = <span class="hljs-string">"firstCache"</span>, expiration = <span class="hljs-number">23</span>), <span class="hljs-meta">@CacheClusterConfig</span>(name = <span class="hljs-string">"secondCache"</span>, expiration = <span class="hljs-number">42</span>)})
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfiguration</span> </span>{
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-caching-in-spring-boot"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-caching-in-spring-boot"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-caching-in-spring-boot">8.4. Configuring caching in Spring Boot</a></h3>
<div class="paragraph">
<p>The caches will automatically be configured in Spring Boot without any explicit configuration property.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-caching"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-caching"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-caching">8.5. Using caching</a></h3>
<div class="paragraph">
<p>Based on the configuration of the cache, developers can annotate their methods to use the caching for method return values.
The next example contains a caching declaration for a service for which the return values should be cached</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExpensiveService</span> </span>{

    <span class="hljs-meta">@Cacheable</span>(<span class="hljs-string">"CacheCluster"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">calculateExpensiveValue</span><span class="hljs-params">(String key)</span> </span>{
        ...
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="memcached-client-implementation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#memcached-client-implementation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#memcached-client-implementation">8.6. Memcached client implementation</a></h3>
<div class="paragraph">
<p>There are different memcached client implementations available for Java, the most prominent ones are
<a href="https://github.com/couchbase/spymemcached">Spymemcached</a> and <a href="https://github.com/killme2008/xmemcached">XMemcached</a>.
Amazon AWS supports a dynamic configuration and delivers an enhanced memcached client based on Spymemcached to support the
<a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/UserGuide/AutoDiscovery.html">auto-discovery</a> of new nodes based on
a central configuration endpoint.</p>
</div>
<div class="paragraph">
<p>Spring Cloud AWS relies on the Amazon ElastiCache Client implementation and therefore has a dependency on that.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-cloudformation-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-cloudformation-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-cloudformation-2">8.7. Using CloudFormation</a></h3>
<div class="paragraph">
<p>Amazon ElastiCache clusters can also be configured within a stack and then be used by applications. Spring Cloud AWS
also supports the lookup of stack-configured cache clusters by their logical name with the resolution to the physical
name. The example below shows a cache cluster configuration inside a CloudFormation template.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"><span class="hljs-string">"CacheCluster"</span>: {
    <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"AWS::ElastiCache::CacheCluster"</span>,
    <span class="hljs-attr">"Properties"</span>: {
        <span class="hljs-attr">"AutoMinorVersionUpgrade"</span>: <span class="hljs-string">"true"</span>,
        <span class="hljs-attr">"Engine"</span>: <span class="hljs-string">"memcached"</span>,
        <span class="hljs-attr">"CacheNodeType"</span>: <span class="hljs-string">"cache.t2.micro"</span>,
        <span class="hljs-attr">"CacheSubnetGroupName"</span> : <span class="hljs-string">"sample"</span>,
        <span class="hljs-attr">"NumCacheNodes"</span>: <span class="hljs-string">"1"</span>,
        <span class="hljs-attr">"VpcSecurityGroupIds"</span>: [<span class="hljs-string">"sample1"</span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The cache cluster can then be used with the name <code>CacheCluster</code> inside the application configuration as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans...</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">aws-cache:cache-manager</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">aws-cache:cache-cluster</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"CacheCluster"</span> <span class="hljs-attr">expiration</span>=<span class="hljs-string">"15"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">aws-cache:cache-manager</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the configuration above the application can be deployed with multiple stacks on different environments
without any configuration change inside the application.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-access-with-jdbc"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#data-access-with-jdbc"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#data-access-with-jdbc">9. Data Access with JDBC</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring has a broad support of data access technologies built on top of JDBC like <code>JdbcTemplate</code> and dedicated ORM (JPA,
Hibernate support). Spring Cloud AWS enables application developers to re-use their JDBC technology of choice and access the
<a href="https://aws.amazon.com/rds/">Amazon Relational Database Service</a> with a declarative configuration. The main support provided by Spring
Cloud AWS for JDBC data access are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Automatic data source configuration and setup based on the Amazon RDS database instance.</p>
</li>
<li>
<p>Automatic read-replica detection and configuration for Amazon RDS database instances.</p>
</li>
<li>
<p>Retry-support to handle exception during Multi-AZ failover inside the data center.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="configuring-data-source"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-data-source"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-data-source">9.1. Configuring data source</a></h3>
<div class="paragraph">
<p>Before using and configuring the database support, the application has to include the respective module dependency
into its Maven configuration. Spring Cloud AWS JDBC support comes as a separate module to allow the modularized use of the
modules.</p>
</div>
<div class="sect3">
<h4 id="maven-dependency-configuration-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#maven-dependency-configuration-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#maven-dependency-configuration-2">9.1.1. Maven dependency configuration</a></h4>
<div class="paragraph">
<p>The Spring Cloud AWS JDBC module comes as a standalone module and can be imported with the following dependency declaration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-aws-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>{spring-cloud-version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-data-source-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#basic-data-source-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#basic-data-source-configuration">9.1.2. Basic data source configuration</a></h4>
<div class="paragraph">
<p>The data source configuration requires the security and region configuration as a minimum allowing Spring Cloud AWS to retrieve
the database metadata information with the Amazon RDS service. Spring Cloud AWS provides an additional <code>jdbc</code> specific namespace
to configure the data source with the minimum attributes as shown in the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hljs-attr">xmlns:jdbc</span>=<span class="hljs-string">"http://www.springframework.org/schema/cloud/aws/jdbc"</span>
       <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/cloud/aws/jdbc
       http://www.springframework.org/schema/cloud/aws/jdbc/spring-cloud-aws-jdbc.xsd"</span>&gt;</span>

 <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>
  ...
 <span class="hljs-tag">&lt;/<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>

 <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-region</span> <span class="hljs-attr">region</span>=<span class="hljs-string">"..."</span>/&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">jdbc:data-source</span>
         <span class="hljs-attr">db-instance-identifier</span>=<span class="hljs-string">"myRdsDatabase"</span>
         <span class="hljs-attr">password</span>=<span class="hljs-string">"${rdsPassword}"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">jdbc:data-source</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The minimum configuration parameters are a unique <code>id</code> for the data source, a valid <code>db-instance-identifier</code> attribute
that points to a valid Amazon RDS database instance. The master user password for the master user. If there is another
user to be used (which is recommended) then the <code>username</code> attribute can be set.</p>
</div>
<div class="paragraph">
<p>With this configuration Spring Cloud AWS fetches all the necessary metadata and creates a
<a href="https://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html">Tomcat JDBC pool</a> with the default properties. The data source
can be later injected into any Spring Bean as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleDatabaseService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">DatabaseService</span> </span>{

 <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> JdbcTemplate jdbcTemplate;

 <span class="hljs-meta">@Autowired</span>
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SimpleDatabaseService</span><span class="hljs-params">(DataSource dataSource)</span> </span>{
    <span class="hljs-keyword">this</span>.jdbcTemplate = <span class="hljs-keyword">new</span> JdbcTemplate(dataSource);
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to qualify the data source injection point with an <code>@Qualifier</code> annotation to allow multiple data source
configurations inside one application context and still use auto-wiring.</p>
</div>
</div>
<div class="sect3">
<h4 id="data-source-pool-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#data-source-pool-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#data-source-pool-configuration">9.1.3. Data source pool configuration</a></h4>
<div class="paragraph">
<p>Spring Cloud AWS creates a new Tomcat JDBC pool with the default properties. Often these default properties do not meet the
requirements of the application with regards to pool size and other settings. The data source configuration supports the configuration
of all valid pool properties with a nested XML element. The following example demonstrates the re-configuration of the data source
with custom pool properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">..</span>&gt;</span>

 <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>
  ...
 <span class="hljs-tag">&lt;/<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>

 <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-region</span> <span class="hljs-attr">region</span>=<span class="hljs-string">"..."</span>/&gt;</span>

 <span class="hljs-tag">&lt;<span class="hljs-name">jdbc:data-source</span>
         <span class="hljs-attr">db-instance-identifier</span>=<span class="hljs-string">"myRdsDatabase"</span>
         <span class="hljs-attr">password</span>=<span class="hljs-string">"${rdsPassword}"</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">jdbc:pool-attributes</span> <span class="hljs-attr">initialSize</span>=<span class="hljs-string">"1"</span> " <span class="hljs-attr">maxActive</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">minIdle</span>=<span class="hljs-string">"10"</span>
                <span class="hljs-attr">testOnBorrow</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">validationQuery</span>=<span class="hljs-string">"SELECT 1"</span> /&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">jdbc:data-source</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A full list of all configuration attributes with their value is available <a href="https://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html">here</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-data-source-with-java-config"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-data-source-with-java-config"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-data-source-with-java-config">9.2. Configuring data source with Java config</a></h3>
<div class="paragraph">
<p>Spring Cloud AWS also supports the configuration of the data source within an <code>@Configuration</code> class. The
<code>org.springframework.cloud.aws.jdbc.config.annotation.EnableRdsInstance</code> annotation can be used to configure one data
source. Multiple ones can be used to configure more then one data source. Each annotation will generate exactly one
data source bean.</p>
</div>
<div class="paragraph">
<p>The class below shows a data source configuration inside a configuration class</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableRdsInstance</span>(dbInstanceIdentifier = <span class="hljs-string">"test"</span>,password = <span class="hljs-string">"secret"</span>, readReplicaSupport = <span class="hljs-keyword">true</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfiguration</span> </span>{
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The configuration attributes are the same in the XML element. The required attributes are also the same
for the XML configuration (the <code>dbInstanceIdentifier</code> and <code>password</code> attribute)
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="java-based-data-source-pool-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#java-based-data-source-pool-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#java-based-data-source-pool-configuration">9.2.1. Java based data source pool configuration</a></h4>
<div class="paragraph">
<p>It is also possible to override the pool configuration with custom values. Spring Cloud AWS provides a
<code>org.springframework.cloud.aws.jdbc.config.annotation.RdsInstanceConfigurer</code> that creates a
<code>org.springframework.cloud.aws.jdbc.datasource.DataSourceFactory</code> which might contain custom pool attributes. The next
examples shows the implementation of one configurer that overrides the validation query and the initial size.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableRdsInstance</span>(dbInstanceIdentifier = <span class="hljs-string">"test"</span>,password = <span class="hljs-string">"secret"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfiguration</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RdsInstanceConfigurer <span class="hljs-title">instanceConfigurer</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RdsInstanceConfigurer() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> DataSourceFactory <span class="hljs-title">getDataSourceFactory</span><span class="hljs-params">()</span> </span>{
                TomcatJdbcDataSourceFactory dataSourceFactory = <span class="hljs-keyword">new</span> TomcatJdbcDataSourceFactory();
                dataSourceFactory.setInitialSize(<span class="hljs-number">10</span>);
                dataSourceFactory.setValidationQuery(<span class="hljs-string">"SELECT 1 FROM DUAL"</span>);
                <span class="hljs-keyword">return</span> dataSourceFactory;
            }
        };
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This class returns an anonymous class of type <code>org.springframework.cloud.aws.jdbc.config.annotation.RdsInstanceConfigurer</code>,
which might also of course be a standalone class.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-data-source-in-spring-boot"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-data-source-in-spring-boot"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-data-source-in-spring-boot">9.3. Configuring data source in Spring Boot</a></h3>
<div class="paragraph">
<p>The data sources can also be configured using the Spring Boot configuration files. Because of the dynamic number of
data sources inside one application, the Spring Boot properties must be configured for each data source.</p>
</div>
<div class="paragraph">
<p>A data source configuration consists of the general property name <code>cloud.aws.rds.&lt;instanceName&gt;</code> for the data source identifier
following the sub properties for the particular data source where <code>instanceName</code> is the name of the concrete instance. The table below
outlines all properties for a data source using <code>test</code> as the instance identifier.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">property</th>
<th class="tableblock halign-left valign-top">example</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.rds.test.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">verySecret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the db instance test</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.rds.test.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username for the db instance test (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.rds.test.readReplicaSupport</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If read-replicas should be used for the data source (see below)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.rds.test.databaseName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fooDb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom database name if the default one from rds should not be used</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="read-replica-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#read-replica-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#read-replica-configuration">9.4. Read-replica configuration</a></h3>
<div class="paragraph">
<p>Amazon RDS allows to use MySQL, MariaDB, Oracle, PostgreSQL and
Microsoft SQL Server <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_ReadRepl.html">read-replica</a>
instances to increase the overall throughput of the database by offloading read data access to one or more read-replica
slaves while maintaining the data in one master database.</p>
</div>
<div class="paragraph">
<p>Spring Cloud AWS supports the use of read-replicas in combination with Spring read-only transactions. If the read-replica
support is enabled, any read-only transaction will be routed to a read-replica instance while using the master database
for write operations.</p>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using read-replica instances does not guarantee strict <a href="https://en.wikipedia.org/wiki/ACID">ACID</a> semantics for the database
access and should be used with care. This is due to the fact that the read-replica might be behind and a write might not
be immediately visible to the read transaction. Therefore it is recommended to use read-replica instances only for transactions that read
data which is not changed very often and where outdated data can be handled by the application.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The read-replica support can be enabled with the <code>read-replica</code> attribute in the datasource configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">..</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">jdbc:data-source</span> <span class="hljs-attr">db-instance-identifier</span>=<span class="hljs-string">"RdsSingleMicroInstance"</span>
    <span class="hljs-attr">password</span>=<span class="hljs-string">"${rdsPassword}"</span> <span class="hljs-attr">read-replica-support</span>=<span class="hljs-string">"true"</span>&gt;</span>

 <span class="hljs-tag">&lt;/<span class="hljs-name">jdbc:data-source</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Cloud AWS will search for any read-replica that is created for the master database and route the read-only transactions
to one of the read-replicas that are available. A business service that uses read-replicas can be implemented like shown
in the example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleDatabaseService</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> JdbcTemplate jdbcTemplate;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SimpleDatabaseService</span><span class="hljs-params">(DataSource dataSource)</span> </span>{
        <span class="hljs-keyword">this</span>.jdbcTemplate = <span class="hljs-keyword">new</span> JdbcTemplate(dataSource);
    }

    <span class="hljs-meta">@Transactional</span>(readOnly = <span class="hljs-keyword">true</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> Person <span class="hljs-title">loadAll</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// read data on the read replica</span>
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updatePerson</span><span class="hljs-params">(Person person)</span> </span>{
        <span class="hljs-comment">// write data into database</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="failover-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#failover-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#failover-support">9.5. Failover support</a></h3>
<div class="paragraph">
<p>Amazon RDS supports a <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.MultiAZ.html">Multi-AZ</a> fail-over if
one availability zone is not available due to an outage or failure of the primary instance. The replication is synchronous
(compared to the read-replicas) and provides continuous service. Spring Cloud AWS supports a Multi-AZ failover with a retry
mechanism to recover transactions that fail during a Multi-AZ failover.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In most cases it is better to provide direct feedback to a user instead of trying potentially long and frequent retries within
a user interaction. Therefore the fail-over support is primarily useful for batch application or applications where the
responsiveness of a service call is not critical.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The Spring Cloud AWS JDBC module provides a retry interceptor that can be used to decorate services with an interceptor.
The interceptor will retry the database operation again if there is a temporary error due to a Multi-AZ failover. A Multi-AZ
failover typically lasts only a couple of seconds, therefore a retry of the business transaction will likely succeed.</p>
</div>
<div class="paragraph">
<p>The interceptor can be configured as a regular bean and then be used by a pointcut expression to decorate the respective
method calls with the interceptor. The interceptor must have a configured database to retrieve the current status (if it
is a temporary fail-over or a permanent error) from the Amazon RDS service.</p>
</div>
<div class="paragraph">
<p>The configuration for the interceptor can be done with a custom element from the Spring Cloud AWS jdbc namespace and
will be configured like shown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">..</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">jdbc:retry-interceptor</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"myInterceptor"</span>
        <span class="hljs-attr">db-instance-identifier</span>=<span class="hljs-string">"myRdsDatabase"</span>
        <span class="hljs-attr">max-number-of-retries</span>=<span class="hljs-string">"10"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The interceptor itself can be used with any Spring advice configuration to wrap the respective service. A pointcut
for the services shown in the chapter before can be defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">..</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">"myInterceptor"</span> <span class="hljs-attr">pointcut</span>=<span class="hljs-string">"bean(simpleDatabaseService)"</span> <span class="hljs-attr">order</span>=<span class="hljs-string">"1"</span> /&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is important that the interceptor is called outside the transaction interceptor to ensure that the whole transaction
will be re-executed. Configuring the interceptor inside the transaction interceptor will lead to a permanent error because
the broken connection will never be refreshed.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The configuration above in combination with a transaction configuration will produce the following proxy configuration
for the service.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/jdbc-retry-interceptor.png" alt="Retry interceptor">
</div>
</div>
</div>
<div class="sect2">
<h3 id="cloudformation-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloudformation-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloudformation-support">9.6. CloudFormation support</a></h3>
<div class="paragraph">
<p>Spring Cloud AWS supports database instances that are configured with CloudFormation. Spring Cloud AWS can use the logical
name inside the database configuration and lookup the concrete database with the generated physical resource name. A database
configuration can be easily configured in CloudFormation with a template definition that might look like the following
example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"><span class="hljs-string">"myRdsDatabase"</span>: {
    <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"AWS::RDS::DBInstance"</span>,
    <span class="hljs-attr">"Properties"</span>: {
     <span class="hljs-attr">"AllocatedStorage"</span>: <span class="hljs-string">"5"</span>,
     <span class="hljs-attr">"DBInstanceClass"</span>: <span class="hljs-string">"db.t1.micro"</span>,
     <span class="hljs-attr">"DBName"</span>: <span class="hljs-string">"test"</span>,
     <span class="hljs-attr">"Engine"</span>: <span class="hljs-string">"mysql"</span>,
     <span class="hljs-attr">"MasterUsername"</span>: <span class="hljs-string">"admin"</span>,
     <span class="hljs-attr">"MasterUserPassword"</span>: {<span class="hljs-attr">"Ref"</span>:<span class="hljs-string">"RdsPassword"</span>},
     ...
    }
 },
 <span class="hljs-string">"readReplicaDatabase"</span>: {
    <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"AWS::RDS::DBInstance"</span>,
    <span class="hljs-attr">"Properties"</span>: {
     <span class="hljs-attr">"AllocatedStorage"</span> : <span class="hljs-string">"5"</span>,
     <span class="hljs-attr">"SourceDBInstanceIdentifier"</span>: {
        <span class="hljs-attr">"Ref"</span>: <span class="hljs-string">"myRdsDatabase"</span>
     },
     <span class="hljs-attr">"DBInstanceClass"</span>: <span class="hljs-string">"db.t1.micro"</span>
    }
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The database can then be configured using the name set in the template. Also, the read-replica can
be enabled to use the configured read-replica database in the application. A configuration to use the configured
database is outlined below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:stack-configuration</span>/&gt;</span>

 <span class="hljs-tag">&lt;<span class="hljs-name">jdbc:data-source</span> <span class="hljs-attr">db-instance-identifier</span>=<span class="hljs-string">"myRdsDatabase"</span> <span class="hljs-attr">password</span>=<span class="hljs-string">"${rdsPassword}"</span> <span class="hljs-attr">read-replica-support</span>=<span class="hljs-string">"true"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="database-tags"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#database-tags"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#database-tags">9.7. Database tags</a></h3>
<div class="paragraph">
<p>Amazon RDS instances can also be configured using RDS database specific tags, allowing users to configure database specific
configuration metadata with the database. Database instance specific tags can be configured using the <code>user-tags-map</code> attribute
on the <code>data-source</code> element. Configure the tags support like in the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">jdbc:data-source</span>
    <span class="hljs-attr">db-instance-identifier</span>=<span class="hljs-string">"myRdsDatabase"</span>
    <span class="hljs-attr">password</span>=<span class="hljs-string">"${rdsPassword}"</span> <span class="hljs-attr">user-tags-map</span>=<span class="hljs-string">"dbTags"</span> /&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That allows the developer to access the properties in the code using expressions like shown in the class below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SampleService</span> </span>{

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"#{dbTags['aws:cloudformation:aws:cloudformation:stack-name']}"</span>)
    <span class="hljs-keyword">private</span> String stackName;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The database tag <code>aws:cloudformation:aws:cloudformation:stack-name</code> is a default tag that is created if the
database is configured using CloudFormation.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sending-mails"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-mails"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-mails">10. Sending mails</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring has a built-in support to send e-mails based on the <a href="https://www.oracle.com/technetwork/java/javamail/index.html">Java Mail API</a>
to avoid any static method calls while using the Java Mail API and thus supporting the testability of an application.
Spring Cloud AWS supports the <a href="https://aws.amazon.com/de/ses/">Amazon SES</a> as an implementation of the Spring Mail abstraction.</p>
</div>
<div class="paragraph">
<p>As a result Spring Cloud AWS users can decide to use the Spring Cloud AWS implementation of the Amazon SES service or
use the standard Java Mail API based implementation that sends e-mails via SMTP to Amazon SES.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is preferred to use the Spring Cloud AWS implementation instead of SMTP mainly for performance reasons.
Spring Cloud AWS uses one API call to send a mail message, while the SMTP protocol makes multiple requests (EHLO, MAIL FROM, RCPT TO, DATA, QUIT)
until it sends an e-mail.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="configuring-the-mail-sender"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-the-mail-sender"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-the-mail-sender">10.1. Configuring the mail sender</a></h3>
<div class="paragraph">
<p>Spring Cloud AWS provides an XML element to configure a Spring <code>org.springframework.mail.MailSender</code> implementation for the
client to be used. The default mail sender works without a Java Mail dependency and is capable of sending messages without
attachments as simple mail messages. A configuration with the necessary elements will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns:aws-mail</span>=<span class="hljs-string">"http://www.springframework.org/schema/cloud/aws/mail"</span>
   <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/cloud/aws/mail
      http://www.springframework.org/schema/cloud/aws/mail/spring-cloud-aws-mail.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>
      ..
    <span class="hljs-tag">&lt;/<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-region</span> <span class="hljs-attr">region</span>=<span class="hljs-string">"eu-west-1"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">aws-mail:mail-sender</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"testSender"</span> /&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sending-simple-mails"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-simple-mails"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-simple-mails">10.2. Sending simple mails</a></h3>
<div class="paragraph">
<p>Application developers can inject the <code>MailSender</code> into their application code and directly send simple text based e-mail
messages. The sample below demonstrates the creation of a simple mail message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailSendingService</span> </span>{

    <span class="hljs-keyword">private</span> MailSender mailSender;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MailSendingService</span><span class="hljs-params">(MailSender mailSender)</span> </span>{
        <span class="hljs-keyword">this</span>.mailSender = mailSender;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendMailMessage</span><span class="hljs-params">()</span> </span>{
        SimpleMailMessage simpleMailMessage = <span class="hljs-keyword">new</span> SimpleMailMessage();
        simpleMailMessage.setFrom(<span class="hljs-string">"foo@bar.com"</span>);
        simpleMailMessage.setTo(<span class="hljs-string">"bar@baz.com"</span>);
        simpleMailMessage.setSubject(<span class="hljs-string">"test subject"</span>);
        simpleMailMessage.setText(<span class="hljs-string">"test content"</span>);
        <span class="hljs-keyword">this</span>.mailSender.send(simpleMailMessage);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sending-attachments"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-attachments"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-attachments">10.3. Sending attachments</a></h3>
<div class="paragraph">
<p>Sending attachments with e-mail requires MIME messages to be created and sent. In order to create MIME messages,
the Java Mail dependency is required and has to be included in the classpath. Spring Cloud AWS will detect the
dependency and create a <code>org.springframework.mail.javamail.JavaMailSender</code> implementation that allows to create and
build MIME messages and send them. A dependency configuration for the Java Mail API is the only change in the configuration
which is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.mail<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mailapi<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- exclusion because we are running on Java 1.7 that includes the activation API by default--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>activation<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.activation<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Even though there is a dependency to the Java Mail API there is still the Amazon SES API used underneath to send mail
messages. There is no <a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/send-email-smtp.html">SMTP setup</a> required
on the Amazon AWS side.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Sending the mail requires the application developer to use the <code>JavaMailSender</code> to send an e-mail as shown in the example
below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailSendingService</span> </span>{

    <span class="hljs-keyword">private</span> JavaMailSender mailSender;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MailSendingService</span><span class="hljs-params">(JavaMailSender mailSender)</span> </span>{
        <span class="hljs-keyword">this</span>.mailSender = mailSender;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendMailMessage</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.mailSender.send(<span class="hljs-keyword">new</span> MimeMessagePreparator() {

            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">prepare</span><span class="hljs-params">(MimeMessage mimeMessage)</span> <span class="hljs-keyword">throws</span> Exception </span>{
                MimeMessageHelper helper =
                    <span class="hljs-keyword">new</span> MimeMessageHelper(mimeMessage, <span class="hljs-keyword">true</span>, <span class="hljs-string">"UTF-8"</span>);
                helper.addTo(<span class="hljs-string">"foo@bar.com"</span>);
                helper.setFrom(<span class="hljs-string">"bar@baz.com"</span>);
                helper.addAttachment(<span class="hljs-string">"test.txt"</span>, ...);
                helper.setSubject(<span class="hljs-string">"test subject with attachment"</span>);
                helper.setText(<span class="hljs-string">"mime body"</span>, <span class="hljs-keyword">false</span>);
            }
        });
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-regions"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-regions"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-regions">10.4. Configuring regions</a></h3>
<div class="paragraph">
<p>Amazon SES is not available in all <a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/regions.html">regions</a> of the
Amazon Web Services cloud. Therefore an application hosted and operated in a region that does not support the mail
service will produce an error while using the mail service. Therefore the region must be overridden for the mail
sender configuration. The example below shows a typical combination of a region (EU-CENTRAL-1) that does not provide
an SES service where the client is overridden to use a valid region (EU-WEST-1).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">...</span>&gt;</span>

 <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-region</span> <span class="hljs-attr">region</span>=<span class="hljs-string">"eu-central-1"</span> /&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">aws-mail:mail-sender</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"testSender"</span> <span class="hljs-attr">region</span>=<span class="hljs-string">"eu-west-1"</span>/&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="authenticating-e-mails"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#authenticating-e-mails"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#authenticating-e-mails">10.5. Authenticating e-mails</a></h3>
<div class="paragraph">
<p>To avoid any spam attacks on the Amazon SES mail service, applications without production access must
<a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/verify-email-addresses.html">verify</a> each
e-mail receiver otherwise the mail sender will throw a <code>com.amazonaws.services.simpleemail.model.MessageRejectedException</code>.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/request-production-access.html">Production access</a> can be requested
and will disable the need for mail address verification.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resource-handling"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#resource-handling"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#resource-handling">11. Resource handling</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Framework provides a <code>org.springframework.core.io.ResourceLoader</code> abstraction to load files from the filesystem,
servlet context and the classpath. Spring Cloud AWS adds support for the <a href="https://aws.amazon.com/s3/">Amazon S3</a> service
to load and write resources with the resource loader and the <code>s3</code> protocol.</p>
</div>
<div class="paragraph">
<p>The resource loader is part of the context module, therefore no additional dependencies are necessary to use the resource
handling support.</p>
</div>
<div class="sect2">
<h3 id="configuring-the-resource-loader"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-the-resource-loader"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-the-resource-loader">11.1. Configuring the resource loader</a></h3>
<div class="paragraph">
<p>Spring Cloud AWS does not modify the default resource loader unless it encounters an explicit configuration with an XML namespace element.
The configuration consists of one element for the whole application context that is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hljs-attr">xmlns:aws-context</span>=<span class="hljs-string">"http://www.springframework.org/schema/cloud/aws/context"</span>
       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/cloud/aws/context
       http://www.springframework.org/schema/cloud/aws/context/spring-cloud-aws-context.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>
            ...
        <span class="hljs-tag">&lt;/<span class="hljs-name">aws-context:context-credentials</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-resource-loader</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="downloading-files"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#downloading-files"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#downloading-files">11.2. Downloading files</a></h3>
<div class="paragraph">
<p>Downloading files can be done by using the <code>s3</code> protocol to reference Amazon S3 buckets and objects inside their bucket. The
typical pattern is <code>s3://&lt;bucket&gt;/&lt;object&gt;</code> where bucket is the global and unique bucket name and object is a valid object
name inside the bucket. The object name can be a file in the <em>root</em> folder of a bucket or a nested file within a directory
inside a bucket.</p>
</div>
<div class="paragraph">
<p>The next example demonstrates the use of the resource loader to load different resources.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleResourceLoadingBean</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ResourceLoader resourceLoader;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">resourceLoadingMethod</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{
        Resource resource = <span class="hljs-keyword">this</span>.resourceLoader.getResource(<span class="hljs-string">"s3://myBucket/rootFile.log"</span>);
        Resource secondResource = <span class="hljs-keyword">this</span>.resourceLoader.getResource(<span class="hljs-string">"s3://myBucket/rootFolder/subFile"</span>);

        InputStream inputStream = resource.getInputStream();
        <span class="hljs-comment">//read file</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="uploading-files"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#uploading-files"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#uploading-files">11.3. Uploading files</a></h3>
<div class="paragraph">
<p>Since Spring Framework 3.1 the resource loader can also be used to upload files with the <code>org.springframework.core.io.WritableResource</code>
interface which is a specialization of the <code>org.springframework.core.io.ResourceLoader</code> interface. Clients can upload files
using the <code>WritableResource</code> interface. The next example demonstrates an upload of a resource using the resource loader.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleResourceLoadingBean</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ResourceLoader resourceLoader;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeResource</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{
        Resource resource = <span class="hljs-keyword">this</span>.resourceLoader.getResource(<span class="hljs-string">"s3://myBucket/rootFile.log"</span>);
        WritableResource writableResource = (WritableResource) resource;
        <span class="hljs-keyword">try</span> (OutputStream outputStream = writableResource.getOutputStream()) {
            outputStream.write(<span class="hljs-string">"test"</span>.getBytes());
        }
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="uploading-multi-part-files"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#uploading-multi-part-files"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#uploading-multi-part-files">11.3.1. Uploading multi-part files</a></h4>
<div class="paragraph">
<p>Amazon S3 supports <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/uploadobjusingmpu.html">multi-part uploads</a> to
increase the general throughput while uploading. Spring Cloud AWS by default only uses one thread to upload the files and
therefore does not provide parallel upload support. Users can configure a custom <code>org.springframework.core.task.TaskExecutor</code>
for the resource loader. The resource loader will queue multiple threads at the same time to use parallel multi-part uploads.</p>
</div>
<div class="paragraph">
<p>The configuration for a resource loader that uploads with 10 Threads looks like the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">...</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">aws-context:context-resource-loader</span> <span class="hljs-attr">task-executor</span>=<span class="hljs-string">"executor"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">task:executor</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"executor"</span> <span class="hljs-attr">pool-size</span>=<span class="hljs-string">"10"</span> <span class="hljs-attr">queue-capacity</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">rejection-policy</span>=<span class="hljs-string">"CALLER_RUNS"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Spring Cloud AWS consumes up to 5 MB (at a minimum) of memory per thread. Therefore each parallel thread will incur
a memory footprint of 5 MB in the heap, and a thread size of 10 will consume therefore up to 50 mb of heap space. Spring Cloud
AWS releases the memory as soon as possible. Also, the example above shows that there is no <code>queue-capacity</code> configured,
because queued requests would also consume memory.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="uploading-with-the-transfermanager"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#uploading-with-the-transfermanager"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#uploading-with-the-transfermanager">11.3.2. Uploading with the TransferManager</a></h4>
<div class="paragraph">
<p>The Amazon SDK also provides a high-level abstraction that is useful to upload files, also with multiple threads using
the multi-part functionality. A <code>com.amazonaws.services.s3.transfer.TransferManager</code> can be easily created in the application
code and injected with the pre-configured <code>com.amazonaws.services.s3.AmazonS3</code> client that is already created
with the Spring Cloud AWS resource loader configuration.</p>
</div>
<div class="paragraph">
<p>This example shows the use of the <code>transferManager</code> within an application to upload files from the hard-drive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleResourceLoadingBean</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AmazonS3 amazonS3;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">withTransferManager</span><span class="hljs-params">()</span> </span>{
        TransferManager transferManager = <span class="hljs-keyword">new</span> TransferManager(<span class="hljs-keyword">this</span>.amazonS3);
        transferManager.upload(<span class="hljs-string">"myBucket"</span>,<span class="hljs-string">"filename"</span>,<span class="hljs-keyword">new</span> File(<span class="hljs-string">"someFile"</span>));
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="searching-resources"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#searching-resources"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#searching-resources">11.4. Searching resources</a></h3>
<div class="paragraph">
<p>The Spring resource loader also supports collecting resources based on an Ant-style path specification. Spring Cloud AWS
offers the same support to resolve resources within a bucket and even throughout buckets. The actual resource loader needs
to be wrapped with the Spring Cloud AWS one in order to search for s3 buckets, in case of non s3 bucket the resource loader
will fall back to the original one. The next example shows the resource resolution by using different patterns.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleResourceLoadingBean</span> </span>{

    <span class="hljs-keyword">private</span> ResourcePatternResolver resourcePatternResolver;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setupResolver</span><span class="hljs-params">(ApplicationContext applicationContext, AmazonS3 amazonS3)</span></span>{
        <span class="hljs-keyword">this</span>.resourcePatternResolver = <span class="hljs-keyword">new</span> PathMatchingSimpleStorageResourcePatternResolver(amazonS3, applicationContext);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">resolveAndLoad</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{
        Resource[] allTxtFilesInFolder =  <span class="hljs-keyword">this</span>.resourcePatternResolver.getResources(<span class="hljs-string">"s3://bucket/name/*.txt"</span>);
        Resource[] allTxtFilesInBucket =  <span class="hljs-keyword">this</span>.resourcePatternResolver.getResources(<span class="hljs-string">"s3://bucket/**/*.txt"</span>);
        Resource[] allTxtFilesGlobally =  <span class="hljs-keyword">this</span>.resourcePatternResolver.getResources(<span class="hljs-string">"s3://**/*.txt"</span>);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Resolving resources throughout all buckets can be very time consuming depending on the number of buckets a user owns.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="using-cloudformation-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-cloudformation-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-cloudformation-3">11.5. Using CloudFormation</a></h3>
<div class="paragraph">
<p>CloudFormation also allows to create buckets during stack creation. These buckets will typically have a generated name
that must be used as the bucket name. In order to allow application developers to define <em>static</em> names inside their
configuration, Spring Cloud AWS provides support to resolve the generated bucket names.
Application developers can use the <code>org.springframework.cloud.aws.core.env.ResourceIdResolver</code> interface to resolve the
physical names that are generated based on the logical names.</p>
</div>
<div class="paragraph">
<p>The next example shows a bucket definition inside a CloudFormation stack template. The bucket will be created with a name
like <em>integrationteststack-sampleBucket-23qysofs62tc2</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    <span class="hljs-attr">"Resources"</span>: {
        <span class="hljs-attr">"sampleBucket"</span>: {
            <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"AWS::S3::Bucket"</span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Application developers can resolve that name and use it to load resources as shown in the next example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleResourceLoadingBean</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ResourceLoader loader;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ResourceIdResolver idResolver;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SimpleResourceLoadingBean</span><span class="hljs-params">(ResourceLoader loader, ResourceIdResolver idResolver)</span> </span>{
        <span class="hljs-keyword">this</span>.loader = loader;
        <span class="hljs-keyword">this</span>.idResolver = idResolver;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">resolveAndLoad</span><span class="hljs-params">()</span> </span>{
        String sampleBucketName = <span class="hljs-keyword">this</span>.idResolver.
            resolveToPhysicalResourceId(<span class="hljs-string">"sampleBucket"</span>);
        Resource resource = <span class="hljs-keyword">this</span>.loader.
            getResource(<span class="hljs-string">"s3://"</span> + sampleBucketName + <span class="hljs-string">"/test"</span>);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cloudwatch-metrics"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloudwatch-metrics"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloudwatch-metrics">12. CloudWatch Metrics</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud AWS provides Spring Boot auto-configuration for Micrometer CloudWatch integration.
To send metrics to CloudWatch add a dependency to <code>spring-cloud-aws-actuator</code> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-aws-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally CloudWatch integration requires a value provided for <code>management.metrics.export.cloudwatch.namespace</code> configuration property.</p>
</div>
<div class="paragraph">
<p>Following configuration properties are available to configure CloudWatch integration:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">property</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">management.metrics.export.cloudwatch.namespace</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The namespace which will be used when sending metrics to CloudWatch. This property is needed and must not be null.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">management.metrics.export.cloudwatch.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If CloudWatch integration should be enabled. This property should be likely set to <code>false</code> for a local development profile.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">management.metrics.export.cloudwatch.step</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1m</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interval at which metrics are sent to CloudWatch. The default is 1 minute.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="configuration-properties"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties">13. Configuration properties</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To see the list of all Spring Cloud AWS related configuration properties please check <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/appendix.html">the Appendix page</a>.</p>
</div>
</div>
</div>
<h1 id="spring-cloud-build" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-build"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-build">Spring Cloud Build</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><span class="image"><a class="image" href="https://travis-ci.org/spring-cloud/spring-cloud-build"><img src="./Spring Cloud_files/spring-cloud-build.svg" alt="spring cloud build"></a></span></p>
</div>
<div class="paragraph">
<p>Spring Cloud Build is a common utility project for Spring Cloud
to use for plugin and dependency management.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-and-deploying"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#building-and-deploying"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#building-and-deploying">14. Building and Deploying</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To install locally:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mvn install -s .settings.xml</pre>
</div>
</div>
<div class="paragraph">
<p>and to deploy snapshots to repo.spring.io:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mvn deploy -DaltSnapshotDeploymentRepository=repo.spring.io::default::https://repo.spring.io/libs-snapshot-local</pre>
</div>
</div>
<div class="paragraph">
<p>for a RELEASE build use</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mvn deploy -DaltReleaseDeploymentRepository=repo.spring.io::default::https://repo.spring.io/libs-release-local</pre>
</div>
</div>
<div class="paragraph">
<p>and for jcenter use</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mvn deploy -DaltReleaseDeploymentRepository=bintray::default::https://api.bintray.com/maven/spring/jars/org.springframework.cloud:build</pre>
</div>
</div>
<div class="paragraph">
<p>and for Maven Central use</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mvn deploy -P central -DaltReleaseDeploymentRepository=sonatype-nexus-staging::default::https://oss.sonatype.org/service/local/staging/deploy/maven2</pre>
</div>
</div>
<div class="paragraph">
<p>(the "central" profile is available for all projects in Spring Cloud and it sets up the gpg jar signing, and the repository has to be specified separately for this project because it is a parent of the starter parent which users in turn have as their own parent).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="contributing"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#contributing"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#contributing">15. Contributing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud is released under the non-restrictive Apache 2.0 license,
and follows a very standard Github development process, using Github
tracker for issues and merging pull requests into master. If you want
to contribute even something trivial please do not hesitate, but
follow the guidelines below.</p>
</div>
<div class="sect2">
<h3 id="sign-the-contributor-license-agreement"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sign-the-contributor-license-agreement"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sign-the-contributor-license-agreement">15.1. Sign the Contributor License Agreement</a></h3>
<div class="paragraph">
<p>Before we accept a non-trivial patch or pull request we will need you to sign the
<a href="https://cla.pivotal.io/sign/spring">Contributor License Agreement</a>.
Signing the contributor’s agreement does not grant anyone commit rights to the main
repository, but it does mean that we can accept your contributions, and you will get an
author credit if we do. Active contributors might be asked to join the core team, and
given the ability to merge pull requests.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-of-conduct"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-of-conduct"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-of-conduct">15.2. Code of Conduct</a></h3>
<div class="paragraph">
<p>This project adheres to the Contributor Covenant <a href="https://github.com/spring-cloud/spring-cloud-build/blob/master/docs/src/main/asciidoc/code-of-conduct.adoc">code of
conduct</a>. By participating, you are expected to uphold this code. Please report
unacceptable behavior to <a href="mailto:spring-code-of-conduct@pivotal.io">spring-code-of-conduct@pivotal.io</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-conventions-and-housekeeping"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-conventions-and-housekeeping"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-conventions-and-housekeeping">15.3. Code Conventions and Housekeeping</a></h3>
<div class="paragraph">
<p>None of these is essential for a pull request, but they will all help. They can also be
added after the original pull request but before a merge.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the Spring Framework code format conventions. If you use Eclipse
you can import formatter settings using the
<code>eclipse-code-formatter.xml</code> file from the
<a href="https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-dependencies-parent/eclipse-code-formatter.xml">Spring
Cloud Build</a> project. If using IntelliJ, you can use the
<a href="https://plugins.jetbrains.com/plugin/6546">Eclipse Code Formatter
Plugin</a> to import the same file.</p>
</li>
<li>
<p>Make sure all new <code>.java</code> files to have a simple Javadoc class comment with at least an
<code>@author</code> tag identifying you, and preferably at least a paragraph on what the class is
for.</p>
</li>
<li>
<p>Add the ASF license header comment to all new <code>.java</code> files (copy from existing files
in the project)</p>
</li>
<li>
<p>Add yourself as an <code>@author</code> to the .java files that you modify substantially (more
than cosmetic changes).</p>
</li>
<li>
<p>Add some Javadocs and, if you change the namespace, some XSD doc elements.</p>
</li>
<li>
<p>A few unit tests would help a lot as well — someone has to do it.</p>
</li>
<li>
<p>If no-one else is using your branch, please rebase it against the current master (or
other target branch in the main project).</p>
</li>
<li>
<p>When writing a commit message please follow <a href="https://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html">these conventions</a>,
if you are fixing an existing issue please add <code>Fixes gh-XXXX</code> at the end of the commit
message (where XXXX is the issue number).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="checkstyle"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#checkstyle"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#checkstyle">15.4. Checkstyle</a></h3>
<div class="paragraph">
<p>Spring Cloud Build comes with a set of checkstyle rules. You can find them in the <code>spring-cloud-build-tools</code> module. The most notable files under the module are:</p>
</div>
<div class="listingblock">
<div class="title">spring-cloud-build-tools/</div>
<div class="content">
<pre>└── src
 &nbsp;&nbsp; ├── checkstyle
 &nbsp;&nbsp; │&nbsp;&nbsp; └── checkstyle-suppressions.xml <i class="conum" data-value="3"></i><b>(3)</b>
 &nbsp;&nbsp; └── main
 &nbsp;&nbsp;     └── resources
 &nbsp;&nbsp;         ├── checkstyle-header.txt <i class="conum" data-value="2"></i><b>(2)</b>
 &nbsp;&nbsp;         └── checkstyle.xml <i class="conum" data-value="1"></i><b>(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Default Checkstyle rules</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>File header setup</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Default suppression rules</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="checkstyle-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#checkstyle-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#checkstyle-configuration">15.4.1. Checkstyle configuration</a></h4>
<div class="paragraph">
<p>Checkstyle rules are <strong>disabled by default</strong>. To add checkstyle to your project just define the following properties and plugins.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre>&lt;properties&gt;
&lt;maven-checkstyle-plugin.failsOnError&gt;true&lt;/maven-checkstyle-plugin.failsOnError&gt; <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;maven-checkstyle-plugin.failsOnViolation&gt;true
        &lt;/maven-checkstyle-plugin.failsOnViolation&gt; <i class="conum" data-value="2"></i><b>(2)</b>
        &lt;maven-checkstyle-plugin.includeTestSourceDirectory&gt;true
        &lt;/maven-checkstyle-plugin.includeTestSourceDirectory&gt; <i class="conum" data-value="3"></i><b>(3)</b>
&lt;/properties&gt;

&lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt; <i class="conum" data-value="4"></i><b>(4)</b>
                &lt;groupId&gt;io.spring.javaformat&lt;/groupId&gt;
                &lt;artifactId&gt;spring-javaformat-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt; <i class="conum" data-value="5"></i><b>(5)</b>
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;

    &lt;reporting&gt;
        &lt;plugins&gt;
            &lt;plugin&gt; <i class="conum" data-value="5"></i><b>(5)</b>
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/reporting&gt;
&lt;/build&gt;</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Fails the build upon Checkstyle errors</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Fails the build upon Checkstyle violations</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Checkstyle analyzes also the test sources</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Add the Spring Java Format plugin that will reformat your code to pass most of the Checkstyle formatting rules</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Add checkstyle plugin to your build and reporting phases</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you need to suppress some rules (e.g. line length needs to be longer), then it’s enough for you to define a file under <code>${project.root}/src/checkstyle/checkstyle-suppressions.xml</code> with your suppressions. Example:</p>
</div>
<div class="listingblock">
<div class="title">projectRoot/src/checkstyle/checkstyle-suppresions.xml</div>
<div class="content">
<pre>&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE suppressions PUBLIC
        "-//Puppy Crawl//DTD Suppressions 1.1//EN"
        "https://www.puppycrawl.com/dtds/suppressions_1_1.dtd"&gt;
&lt;suppressions&gt;
    &lt;suppress files=".*ConfigServerApplication\.java" checks="HideUtilityClassConstructor"/&gt;
    &lt;suppress files=".*ConfigClientWatch\.java" checks="LineLengthCheck"/&gt;
&lt;/suppressions&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>It’s advisable to copy the <code>${spring-cloud-build.rootFolder}/.editorconfig</code> and <code>${spring-cloud-build.rootFolder}/.springformat</code> to your project. That way, some default formatting rules will be applied. You can do so by running this script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/.editorconfig -o .editorconfig
$ touch .springformat</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ide-setup"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ide-setup"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ide-setup">15.5. IDE setup</a></h3>
<div class="sect3">
<h4 id="intellij-idea"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#intellij-idea"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#intellij-idea">15.5.1. Intellij IDEA</a></h4>
<div class="paragraph">
<p>In order to setup Intellij you should import our coding conventions, inspection profiles and set up the checkstyle plugin.
The following files can be found in the <a href="https://github.com/spring-cloud/spring-cloud-build/tree/master/spring-cloud-build-tools">Spring Cloud Build</a> project.</p>
</div>
<div class="listingblock">
<div class="title">spring-cloud-build-tools/</div>
<div class="content">
<pre>└── src
 &nbsp;&nbsp; ├── checkstyle
 &nbsp;&nbsp; │&nbsp;&nbsp; └── checkstyle-suppressions.xml <i class="conum" data-value="3"></i><b>(3)</b>
 &nbsp;&nbsp; └── main
 &nbsp;&nbsp;     └── resources
 &nbsp;&nbsp;         ├── checkstyle-header.txt <i class="conum" data-value="2"></i><b>(2)</b>
 &nbsp;&nbsp;         ├── checkstyle.xml <i class="conum" data-value="1"></i><b>(1)</b>
 &nbsp;&nbsp;         └── intellij
 &nbsp;&nbsp;          &nbsp;&nbsp; ├── Intellij_Project_Defaults.xml <i class="conum" data-value="4"></i><b>(4)</b>
 &nbsp;&nbsp;          &nbsp;&nbsp; └── Intellij_Spring_Boot_Java_Conventions.xml <i class="conum" data-value="5"></i><b>(5)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Default Checkstyle rules</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>File header setup</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Default suppression rules</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Project defaults for Intellij that apply most of Checkstyle rules</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Project style conventions for Intellij that apply most of Checkstyle rules</td>
</tr>
</tbody></table>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/docs/src/main/asciidoc/images/intellij-code-style.png" alt="Code style">
</div>
<div class="title">Figure 1. Code style</div>
</div>
<div class="paragraph">
<p>Go to <code>File</code> → <code>Settings</code> → <code>Editor</code> → <code>Code style</code>. There click on the icon next to the <code>Scheme</code> section. There, click on the <code>Import Scheme</code> value and pick the <code>Intellij IDEA code style XML</code> option. Import the <code>spring-cloud-build-tools/src/main/resources/intellij/Intellij_Spring_Boot_Java_Conventions.xml</code> file.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/intellij-inspections.png" alt="Code style">
</div>
<div class="title">Figure 2. Inspection profiles</div>
</div>
<div class="paragraph">
<p>Go to <code>File</code> → <code>Settings</code> → <code>Editor</code> → <code>Inspections</code>. There click on the icon next to the <code>Profile</code> section. There, click on the <code>Import Profile</code> and import the <code>spring-cloud-build-tools/src/main/resources/intellij/Intellij_Project_Defaults.xml</code> file.</p>
</div>
<div class="paragraph">
<div class="title">Checkstyle</div>
<p>To have Intellij work with Checkstyle, you have to install the <code>Checkstyle</code> plugin. It’s advisable to also install the <code>Assertions2Assertj</code> to automatically convert the JUnit assertions</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/intellij-checkstyle.png" alt="Checkstyle">
</div>
</div>
<div class="paragraph">
<p>Go to <code>File</code> → <code>Settings</code> → <code>Other settings</code> → <code>Checkstyle</code>. There click on the <code>+</code> icon in the <code>Configuration file</code> section. There, you’ll have to define where the checkstyle rules should be picked from. In the image above, we’ve picked the rules from the cloned Spring Cloud Build repository. However, you can point to the Spring Cloud Build’s GitHub repository (e.g. for the <code>checkstyle.xml</code> : <code><a href="https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/main/resources/checkstyle.xml" class="bare">raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/main/resources/checkstyle.xml</a></code>). We need to provide the following variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>checkstyle.header.file</code> - please point it to the Spring Cloud Build’s, <code>spring-cloud-build-tools/src/main/resources/checkstyle-header.txt</code> file either in your cloned repo or via the <code><a href="https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/main/resources/checkstyle-header.txt" class="bare">raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/main/resources/checkstyle-header.txt</a></code> URL.</p>
</li>
<li>
<p><code>checkstyle.suppressions.file</code> - default suppressions. Please point it to the Spring Cloud Build’s, <code>spring-cloud-build-tools/src/checkstyle/checkstyle-suppressions.xml</code> file either in your cloned repo or via the <code><a href="https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/checkstyle/checkstyle-suppressions.xml" class="bare">raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/checkstyle/checkstyle-suppressions.xml</a></code> URL.</p>
</li>
<li>
<p><code>checkstyle.additional.suppressions.file</code> - this variable corresponds to suppressions in your local project. E.g. you’re working on <code>spring-cloud-contract</code>. Then point to the <code>project-root/src/checkstyle/checkstyle-suppressions.xml</code> folder. Example for <code>spring-cloud-contract</code> would be: <code>/home/username/spring-cloud-contract/src/checkstyle/checkstyle-suppressions.xml</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Remember to set the <code>Scan Scope</code> to <code>All sources</code> since we apply checkstyle rules for production and test sources.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="flattening-the-poms"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#flattening-the-poms"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#flattening-the-poms">16. Flattening the POMs</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To avoid propagating build setup that is required to build a Spring Cloud project, we’re using the maven flatten plugin. It has the advantage of letting you use whatever features you need while publishing "clean" pom to the repository.</p>
</div>
<div class="paragraph">
<p>In order to add it, add the <code>org.codehaus.mojo:flatten-maven-plugin</code> to your <code>pom.xml</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.codehaus.mojo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flatten-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reusing-the-documentation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reusing-the-documentation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reusing-the-documentation">17. Reusing the documentation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Build publishes its <code>spring-cloud-build-docs</code> module that contains
helpful scripts (e.g. README generation ruby script) and css, xslt and images
for the Spring Cloud documentation. If you want to follow the same convention
approach of generating documentation just add these plugins to your <code>docs</code> module</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>docs<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>pl.project13.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>git-commit-id-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-resources-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.codehaus.mojo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>exec-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.asciidoctor<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>asciidoctor-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <i class="conum" data-value="5"></i><b>(5)</b>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-antrun-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <i class="conum" data-value="6"></i><b>(6)</b>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This plugin downloads sets up all the git information of the project</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This plugin downloads the resources of the <code>spring-cloud-build-docs</code> module</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This plugin unpacks the resources of the <code>spring-cloud-build-docs</code> module</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>This plugin generates an <code>adoc</code> file with all the configuration properties from the classpath</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>This plugin is required to parse the Asciidoctor documentation</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>This plugin is required to copy resources into proper final destinations and to generate main README.adoc and to assert that no files use unresolved links</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The order of plugin declaration is important!
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In order for the build to generate the <code>adoc</code> file with all your configuration properties, your <code>docs</code> module should contain all the dependencies on the classpath, that you would want to scan for configuration properties. The file will be output to <code>${docsModule}/src/main/asciidoc/_configprops.adoc</code> file (configurable via the <code>configprops.path</code> property).</p>
</div>
<div class="paragraph">
<p>If you want to modify which of the configuration properties are put in the table, you can tweak the <code>configprops.inclusionPattern</code> pattern to include only a subset of the properties (e.g. <code>&lt;configprops.inclusionPattern&gt;spring.sleuth.*&lt;/configprops.inclusionPattern&gt;</code>).</p>
</div>
<div class="paragraph">
<p>Spring Cloud Build Docs comes with a set of attributes for asciidoctor that you can reuse.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">attributes</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">docinfo</span>&gt;</span>shared<span class="hljs-tag">&lt;/<span class="hljs-name">docinfo</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">allow-uri-read</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">allow-uri-read</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">nofooter</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">toc</span>&gt;</span>left<span class="hljs-tag">&lt;/<span class="hljs-name">toc</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">toc-levels</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">toc-levels</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">sectlinks</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">sectlinks</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">sources-root</span>&gt;</span>${project.basedir}/src@<span class="hljs-tag">&lt;/<span class="hljs-name">sources-root</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">asciidoc-sources-root</span>&gt;</span>${project.basedir}/src/main/asciidoc@<span class="hljs-tag">&lt;/<span class="hljs-name">asciidoc-sources-root</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">generated-resources-root</span>&gt;</span>${project.basedir}/target/generated-resources@
    <span class="hljs-tag">&lt;/<span class="hljs-name">generated-resources-root</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Use this attribute the reference code from another module --&gt;</span>
    <span class="hljs-comment">&lt;!-- Note the @ at the end, lowering the precedence of the attribute --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project-root</span>&gt;</span>${maven.multiModuleProjectDirectory}@<span class="hljs-tag">&lt;/<span class="hljs-name">project-root</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- It's mandatory for you to pass the docs.main property --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">github-repo</span>&gt;</span>${docs.main}@<span class="hljs-tag">&lt;/<span class="hljs-name">github-repo</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">github-project</span>&gt;</span>https://github.com/spring-cloud/${docs.main}@<span class="hljs-tag">&lt;/<span class="hljs-name">github-project</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">github-raw</span>&gt;</span>
        https://raw.githubusercontent.com/spring-cloud/${docs.main}/${github-tag}@
    <span class="hljs-tag">&lt;/<span class="hljs-name">github-raw</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">github-code</span>&gt;</span>https://github.com/spring-cloud/${docs.main}/tree/${github-tag}@
    <span class="hljs-tag">&lt;/<span class="hljs-name">github-code</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">github-issues</span>&gt;</span>https://github.com/spring-cloud/${docs.main}/issues/@<span class="hljs-tag">&lt;/<span class="hljs-name">github-issues</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">github-wiki</span>&gt;</span>https://github.com/spring-cloud/${docs.main}/wiki@<span class="hljs-tag">&lt;/<span class="hljs-name">github-wiki</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">github-master-code</span>&gt;</span>https://github.com/spring-cloud/${docs.main}/tree/master@
    <span class="hljs-tag">&lt;/<span class="hljs-name">github-master-code</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">index-link</span>&gt;</span>${index-link}@<span class="hljs-tag">&lt;/<span class="hljs-name">index-link</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Spring Cloud specific --&gt;</span>
    <span class="hljs-comment">&lt;!-- for backward compatibility --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">spring-cloud-version</span>&gt;</span>${project.version}@<span class="hljs-tag">&lt;/<span class="hljs-name">spring-cloud-version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project-version</span>&gt;</span>${project.version}@<span class="hljs-tag">&lt;/<span class="hljs-name">project-version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">github-tag</span>&gt;</span>${github-tag}@<span class="hljs-tag">&lt;/<span class="hljs-name">github-tag</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version-type</span>&gt;</span>${version-type}@<span class="hljs-tag">&lt;/<span class="hljs-name">version-type</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">docs-url</span>&gt;</span>https://docs.spring.io/${docs.main}/docs/${project.version}@<span class="hljs-tag">&lt;/<span class="hljs-name">docs-url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">raw-docs-url</span>&gt;</span>${github-raw}@<span class="hljs-tag">&lt;/<span class="hljs-name">raw-docs-url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project-version</span>&gt;</span>${project.version}@<span class="hljs-tag">&lt;/<span class="hljs-name">project-version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project-name</span>&gt;</span>${docs.main}@<span class="hljs-tag">&lt;/<span class="hljs-name">project-name</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">attributes</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="updating-the-guides"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#updating-the-guides"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#updating-the-guides">18. Updating the guides</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>We assume that your project contains guides under the <code>guides</code> folder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs asciidoc"><span class="hljs-bullet">.
</span>└── guides
<span class="hljs-code">    ├── gs-guide1</span>
<span class="hljs-code">    ├── gs-guide2</span>
<span class="hljs-code">    └── gs-guide3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This means that the project contains 3 guides that would
correspond to the following guides in Spring Guides org.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/spring-guides/gs-guide1" class="bare">github.com/spring-guides/gs-guide1</a></p>
</li>
<li>
<p><a href="https://github.com/spring-guides/gs-guide2" class="bare">github.com/spring-guides/gs-guide2</a></p>
</li>
<li>
<p><a href="https://github.com/spring-guides/gs-guide3" class="bare">github.com/spring-guides/gs-guide3</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you deploy your project with the <code>-Pguides</code> profile like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ./mvnw clean deploy -Pguides</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>what will happen is that for GA project versions, we will clone <code>gs-guide1</code>, <code>gs-guide2</code> and <code>gs-guide3</code> and update their contents with the ones being under your <code>guides</code> project.</p>
</div>
<div class="paragraph">
<p>You can skip this by either not adding the <code>guides</code> profile, or passing the <code>-DskipGuides</code> system property when the profile is turned on.</p>
</div>
<div class="paragraph">
<p>You can configure the project version passed to guides via the <code>guides-project.version</code> (defaults to <code>${project.version}</code>). The phase at which guides get updated can be configured by <code>guides-update.phase</code> (defaults to <code>deploy</code>).</p>
</div>
</div>
</div>
<h1 id="spring-cloud-bus" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-bus"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-bus">Spring Cloud Bus</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Spring Cloud Bus links the nodes of a distributed system with a lightweight message
broker. This broker can then be used to broadcast state changes (such as configuration
changes) or other management instructions. A key idea is that the bus is like a
distributed actuator for a Spring Boot application that is scaled out. However, it can
also be used as a communication channel between apps. This project provides starters for
either an AMQP broker or Kafka as the transport.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Cloud is released under the non-restrictive Apache 2.0 license. If you would like to contribute to this section of the documentation or if you find an error, please find the source code and issue trackers in the project at <a href="https://github.com/spring-cloud/spring-cloud">github</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quick-start"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quick-start"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quick-start">19. Quick Start</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Bus works by adding Spring Boot autconfiguration if it detects itself on the
classpath. To enable the bus, add <code>spring-cloud-starter-bus-amqp</code> or
<code>spring-cloud-starter-bus-kafka</code> to your dependency management. Spring Cloud takes care of
the rest. Make sure the broker (RabbitMQ or Kafka) is available and configured. When
running on localhost, you need not do anything. If you run remotely, use Spring Cloud
Connectors or Spring Boot conventions to define the broker credentials, as shown in the
following example for Rabbit:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>spring:
  rabbitmq:
    host: mybroker.com
    port: 5672
    username: user
    password: secret</pre>
</div>
</div>
<div class="paragraph">
<p>The bus currently supports sending messages to all nodes listening or all nodes for a
particular service (as defined by Eureka). The <code>/bus/*</code> actuator namespace has some HTTP
endpoints. Currently, two are implemented. The first, <code>/bus/env</code>, sends key/value pairs to
update each node’s Spring Environment. The second, <code>/bus/refresh</code>, reloads each
application’s configuration, as though they had all been pinged on their <code>/refresh</code>
endpoint.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Spring Cloud Bus starters cover Rabbit and Kafka, because those are the two most
common implementations. However, Spring Cloud Stream is quite flexible, and the binder
works with <code>spring-cloud-bus</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bus-endpoints"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bus-endpoints"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bus-endpoints">20. Bus Endpoints</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Bus provides two endpoints, <code>/actuator/bus-refresh</code> and <code>/actuator/bus-env</code>
that correspond to individual actuator endpoints in Spring Cloud Commons,
<code>/actuator/refresh</code> and <code>/actuator/env</code> respectively.</p>
</div>
<div class="sect2">
<h3 id="bus-refresh-endpoint"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bus-refresh-endpoint"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bus-refresh-endpoint">20.1. Bus Refresh Endpoint</a></h3>
<div class="paragraph">
<p>The <code>/actuator/bus-refresh</code> endpoint clears the <code>RefreshScope</code> cache and rebinds
<code>@ConfigurationProperties</code>. See the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#refresh-scope">Refresh Scope</a> documentation for
more information.</p>
</div>
<div class="paragraph">
<p>To expose the <code>/actuator/bus-refresh</code> endpoint, you need to add following configuration to your
application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"><span class="hljs-meta">management.endpoints.web.exposure.include</span>=<span class="hljs-string">bus-refresh</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bus-env-endpoint"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bus-env-endpoint"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bus-env-endpoint">20.2. Bus Env Endpoint</a></h3>
<div class="paragraph">
<p>The <code>/actuator/bus-env</code> endpoint updates each instances environment with the specified
key/value pair across multiple instances.</p>
</div>
<div class="paragraph">
<p>To expose the <code>/actuator/bus-env</code> endpoint, you need to add following configuration to your
application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"><span class="hljs-meta">management.endpoints.web.exposure.include</span>=<span class="hljs-string">bus-env</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>/actuator/bus-env</code> endpoint accepts <code>POST</code> requests with the following shape:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"key1"</span>,
    <span class="hljs-attr">"value"</span>: <span class="hljs-string">"value1"</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="addressing-an-instance"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#addressing-an-instance"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#addressing-an-instance">21. Addressing an Instance</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each instance of the application has a service ID, whose value can be set with
<code>spring.cloud.bus.id</code> and whose value is expected to be a colon-separated list of
identifiers, in order from least specific to most specific. The default value is
constructed from the environment as a combination of the <code>spring.application.name</code> and
<code>server.port</code> (or <code>spring.application.index</code>, if set). The default value of the ID is
constructed in the form of <code>app:index:id</code>, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>app</code> is the <code>vcap.application.name</code>, if it exists, or <code>spring.application.name</code></p>
</li>
<li>
<p><code>index</code> is the <code>vcap.application.instance_index</code>, if it exists,
<code>spring.application.index</code>, <code>local.server.port</code>, <code>server.port</code>, or <code>0</code> (in that order).</p>
</li>
<li>
<p><code>id</code> is the <code>vcap.application.instance_id</code>, if it exists, or a random value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The HTTP endpoints accept a “destination” path parameter, such as
<code>/bus-refresh/customers:9000</code>, where <code>destination</code> is a service ID. If the ID
is owned by an instance on the bus, it processes the message, and all other instances
ignore it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="addressing-all-instances-of-a-service"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#addressing-all-instances-of-a-service"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#addressing-all-instances-of-a-service">22. Addressing All Instances of a Service</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The “destination” parameter is used in a Spring <code>PathMatcher</code> (with the path separator
as a colon — <code>:</code>) to determine if an instance processes the message. Using the example
from earlier, <code>/bus-env/customers:**</code> targets all instances of the
“customers” service regardless of the rest of the service ID.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="service-id-must-be-unique"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-id-must-be-unique"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-id-must-be-unique">23. Service ID Must Be Unique</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The bus tries twice to eliminate processing an event — once from the original
<code>ApplicationEvent</code> and once from the queue. To do so, it checks the sending service ID
against the current service ID. If multiple instances of a service have the same ID,
events are not processed. When running on a local machine, each service is on a different
port, and that port is part of the ID. Cloud Foundry supplies an index to differentiate.
To ensure that the ID is unique outside Cloud Foundry, set <code>spring.application.index</code> to
something unique for each instance of a service.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="customizing-the-message-broker"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-the-message-broker"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-the-message-broker">24. Customizing the Message Broker</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Bus uses <a href="https://cloud.spring.io/spring-cloud-stream">Spring Cloud Stream</a> to
broadcast the messages. So, to get messages to flow, you need only include the binder
implementation of your choice in the classpath. There are convenient starters for the bus
with AMQP (RabbitMQ) and Kafka (<code>spring-cloud-starter-bus-[amqp|kafka]</code>). Generally
speaking, Spring Cloud Stream relies on Spring Boot autoconfiguration conventions for
configuring middleware. For instance, the AMQP broker address can be changed with
<code>spring.rabbitmq.*</code> configuration properties. Spring Cloud Bus has a handful of
native configuration properties in <code>spring.cloud.bus.*</code> (for example,
<code>spring.cloud.bus.destination</code> is the name of the topic to use as the external
middleware). Normally, the defaults suffice.</p>
</div>
<div class="paragraph">
<p>To learn more about how to customize the message broker settings, consult the Spring Cloud
Stream documentation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tracing-bus-events"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tracing-bus-events"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tracing-bus-events">25. Tracing Bus Events</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Bus events (subclasses of <code>RemoteApplicationEvent</code>) can be traced by setting
<code>spring.cloud.bus.trace.enabled=true</code>. If you do so, the Spring Boot <code>TraceRepository</code>
(if it is present) shows each event sent and all the acks from each service instance. The
following example comes from the <code>/trace</code> endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  <span class="hljs-attr">"timestamp"</span>: <span class="hljs-string">"2015-11-26T10:24:44.411+0000"</span>,
  <span class="hljs-attr">"info"</span>: {
    <span class="hljs-attr">"signal"</span>: <span class="hljs-string">"spring.cloud.bus.ack"</span>,
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"RefreshRemoteApplicationEvent"</span>,
    <span class="hljs-attr">"id"</span>: <span class="hljs-string">"c4d374b7-58ea-4928-a312-31984def293b"</span>,
    <span class="hljs-attr">"origin"</span>: <span class="hljs-string">"stores:8081"</span>,
    <span class="hljs-attr">"destination"</span>: <span class="hljs-string">"*:**"</span>
  }
  },
  {
  <span class="hljs-attr">"timestamp"</span>: <span class="hljs-string">"2015-11-26T10:24:41.864+0000"</span>,
  <span class="hljs-attr">"info"</span>: {
    <span class="hljs-attr">"signal"</span>: <span class="hljs-string">"spring.cloud.bus.sent"</span>,
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"RefreshRemoteApplicationEvent"</span>,
    <span class="hljs-attr">"id"</span>: <span class="hljs-string">"c4d374b7-58ea-4928-a312-31984def293b"</span>,
    <span class="hljs-attr">"origin"</span>: <span class="hljs-string">"customers:9000"</span>,
    <span class="hljs-attr">"destination"</span>: <span class="hljs-string">"*:**"</span>
  }
  },
  {
  <span class="hljs-attr">"timestamp"</span>: <span class="hljs-string">"2015-11-26T10:24:41.862+0000"</span>,
  <span class="hljs-attr">"info"</span>: {
    <span class="hljs-attr">"signal"</span>: <span class="hljs-string">"spring.cloud.bus.ack"</span>,
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"RefreshRemoteApplicationEvent"</span>,
    <span class="hljs-attr">"id"</span>: <span class="hljs-string">"c4d374b7-58ea-4928-a312-31984def293b"</span>,
    <span class="hljs-attr">"origin"</span>: <span class="hljs-string">"customers:9000"</span>,
    <span class="hljs-attr">"destination"</span>: <span class="hljs-string">"*:**"</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding trace shows that a <code>RefreshRemoteApplicationEvent</code> was sent from
<code>customers:9000</code>, broadcast to all services, and received (acked) by <code>customers:9000</code> and
<code>stores:8081</code>.</p>
</div>
<div class="paragraph">
<p>To handle the ack signals yourself, you could add an <code>@EventListener</code> for the
<code>AckRemoteApplicationEvent</code> and <code>SentApplicationEvent</code> types to your app (and enable
tracing). Alternatively, you could tap into the <code>TraceRepository</code> and mine the data from
there.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Any Bus application can trace acks. However, sometimes, it is
useful to do this in a central service that can do more complex
queries on the data or forward it to a specialized tracing service.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="broadcasting-your-own-events"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#broadcasting-your-own-events"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#broadcasting-your-own-events">26. Broadcasting Your Own Events</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Bus can carry any event of type <code>RemoteApplicationEvent</code>. The default transport is
JSON, and the deserializer needs to know which types are going to be used ahead of time.
To register a new type, you must put it in a subpackage of
<code>org.springframework.cloud.bus.event</code>.</p>
</div>
<div class="paragraph">
<p>To customise the event name, you can use <code>@JsonTypeName</code> on your custom class or rely on
the default strategy, which is to use the simple name of the class.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Both the producer and the consumer need access to the class definition.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="registering-events-in-custom-packages"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-events-in-custom-packages"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-events-in-custom-packages">26.1. Registering events in custom packages</a></h3>
<div class="paragraph">
<p>If you cannot or do not want to use a subpackage of <code>org.springframework.cloud.bus.event</code>
for your custom events, you must specify which packages to scan for events of type
<code>RemoteApplicationEvent</code> by using the <code>@RemoteApplicationEventScan</code> annotation. Packages
specified with <code>@RemoteApplicationEventScan</code> include subpackages.</p>
</div>
<div class="paragraph">
<p>For example, consider the following custom event, called <code>MyEvent</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">package</span> com.acme;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyEvent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RemoteApplicationEvent</span> </span>{
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can register that event with the deserializer in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">package</span> com.acme;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@RemoteApplicationEventScan</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BusConfiguration</span> </span>{
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Without specifying a value, the package of the class where <code>@RemoteApplicationEventScan</code>
is used is registered. In this example, <code>com.acme</code> is registered by using the package of
<code>BusConfiguration</code>.</p>
</div>
<div class="paragraph">
<p>You can also explicitly specify the packages to scan by using the <code>value</code>, <code>basePackages</code>
or <code>basePackageClasses</code> properties on <code>@RemoteApplicationEventScan</code>, as shown in the
following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">package</span> com.acme;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-comment">//@RemoteApplicationEventScan({"com.acme", "foo.bar"})</span>
<span class="hljs-comment">//@RemoteApplicationEventScan(basePackages = {"com.acme", "foo.bar", "fizz.buzz"})</span>
<span class="hljs-meta">@RemoteApplicationEventScan</span>(basePackageClasses = BusConfiguration.class)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BusConfiguration</span> </span>{
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All of the preceding examples of <code>@RemoteApplicationEventScan</code> are equivalent, in that the
<code>com.acme</code> package is registered by explicitly specifying the packages on
<code>@RemoteApplicationEventScan</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can specify multiple base packages to scan.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-properties-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-2">27. Configuration properties</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To see the list of all Bus related configuration properties please check <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/appendix.html">the Appendix page</a>.</p>
</div>
</div>
</div>
<h1 id="spring-cloud-circuit-breaker" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-circuit-breaker"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-circuit-breaker">Spring Cloud Circuit Breaker</a></h1>
<div class="openblock partintro">
<div class="content">
<strong>Hoxton.SR10</strong>
</div>
</div>
<div class="sect2">
<h3 id="configuring-resilience4j-circuit-breakers"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-resilience4j-circuit-breakers"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-resilience4j-circuit-breakers">.1. Configuring Resilience4J Circuit Breakers</a></h3>
<div class="sect3">
<h4 id="starters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#starters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#starters">.1.1. Starters</a></h4>
<div class="paragraph">
<p>There are two starters for the Resilience4J implementations, one for reactive applications and one for non-reactive applications.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.springframework.cloud:spring-cloud-starter-circuitbreaker-resilience4j</code> - non-reactive applications</p>
</li>
<li>
<p><code>org.springframework.cloud:spring-cloud-starter-circuitbreaker-reactor-resilience4j</code> - reactive applications</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="auto-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#auto-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#auto-configuration">.1.2. Auto-Configuration</a></h4>
<div class="paragraph">
<p>You can disable the Resilience4J auto-configuration by setting
<code>spring.cloud.circuitbreaker.resilience4j.enabled</code> to <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="default-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#default-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#default-configuration">.1.3. Default Configuration</a></h4>
<div class="paragraph">
<p>To provide a default configuration for all of your circuit breakers create a <code>Customize</code> bean that is passed a
<code>Resilience4JCircuitBreakerFactory</code> or <code>ReactiveResilience4JCircuitBreakerFactory</code>.
The <code>configureDefault</code> method can be used to provide a default configuration.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Customizer&lt;Resilience4JCircuitBreakerFactory&gt; <span class="hljs-title">defaultCustomizer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> factory -&gt; factory.configureDefault(id -&gt; <span class="hljs-keyword">new</span> Resilience4JConfigBuilder(id)
            .timeLimiterConfig(TimeLimiterConfig.custom().timeoutDuration(Duration.ofSeconds(<span class="hljs-number">4</span>)).build())
            .circuitBreakerConfig(CircuitBreakerConfig.ofDefaults())
            .build());
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reactive-example"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-example"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-example">Reactive Example</a></h5>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Customizer&lt;ReactiveResilience4JCircuitBreakerFactory&gt; <span class="hljs-title">defaultCustomizer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> factory -&gt; factory.configureDefault(id -&gt; <span class="hljs-keyword">new</span> Resilience4JConfigBuilder(id)
            .circuitBreakerConfig(CircuitBreakerConfig.ofDefaults())
            .timeLimiterConfig(TimeLimiterConfig.custom().timeoutDuration(Duration.ofSeconds(<span class="hljs-number">4</span>)).build()).build());
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="specific-circuit-breaker-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#specific-circuit-breaker-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#specific-circuit-breaker-configuration">.1.4. Specific Circuit Breaker Configuration</a></h4>
<div class="paragraph">
<p>Similarly to providing a default configuration, you can create a <code>Customize</code> bean this is passed a
<code>Resilience4JCircuitBreakerFactory</code> or <code>ReactiveResilience4JCircuitBreakerFactory</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Customizer&lt;Resilience4JCircuitBreakerFactory&gt; <span class="hljs-title">slowCustomizer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> factory -&gt; factory.configure(builder -&gt; builder.circuitBreakerConfig(CircuitBreakerConfig.ofDefaults())
            .timeLimiterConfig(TimeLimiterConfig.custom().timeoutDuration(Duration.ofSeconds(<span class="hljs-number">2</span>)).build()), <span class="hljs-string">"slow"</span>);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In addition to configuring the circuit breaker that is created you can also customize the circuit breaker after it has been created but before it is returned to the caller.
To do this you can use the <code>addCircuitBreakerCustomizer</code>
method.
This can be useful for adding event handlers to Resilience4J circuit breakers.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Customizer&lt;Resilience4JCircuitBreakerFactory&gt; <span class="hljs-title">slowCustomizer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> factory -&gt; factory.addCircuitBreakerCustomizer(circuitBreaker -&gt; circuitBreaker.getEventPublisher()
    .onError(normalFluxErrorConsumer).onSuccess(normalFluxSuccessConsumer), <span class="hljs-string">"normalflux"</span>);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reactive-example-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-example-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-example-2">Reactive Example</a></h5>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Customizer&lt;ReactiveResilience4JCircuitBreakerFactory&gt; <span class="hljs-title">slowCusomtizer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> factory -&gt; {
        factory.configure(builder -&gt; builder
        .timeLimiterConfig(TimeLimiterConfig.custom().timeoutDuration(Duration.ofSeconds(<span class="hljs-number">2</span>)).build())
        .circuitBreakerConfig(CircuitBreakerConfig.ofDefaults()), <span class="hljs-string">"slow"</span>, <span class="hljs-string">"slowflux"</span>);
        factory.addCircuitBreakerCustomizer(circuitBreaker -&gt; circuitBreaker.getEventPublisher()
            .onError(normalFluxErrorConsumer).onSuccess(normalFluxSuccessConsumer), <span class="hljs-string">"normalflux"</span>);
     };
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collecting-metrics"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#collecting-metrics"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#collecting-metrics">.1.5. Collecting Metrics</a></h4>
<div class="paragraph">
<p>Spring Cloud Circuit Breaker Resilience4j includes auto-configuration to setup metrics collection as long as the right
dependencies are on the classpath. To enable metric collection you must include <code>org.springframework.boot:spring-boot-starter-actuator</code>, and <code>io.github.resilience4j:resilience4j-micrometer</code>. For more information on the metrics that
get produced when these dependencies are present, see the <a href="https://resilience4j.readme.io/docs/micrometer">Resilience4j documentation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You don’t have to include <code>micrometer-core</code> directly as it is brought in by <code>spring-boot-starter-actuator</code>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-spring-retry-circuit-breakers"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-spring-retry-circuit-breakers"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-spring-retry-circuit-breakers">.2. Configuring Spring Retry Circuit Breakers</a></h3>
<div class="paragraph">
<p>Spring Retry provides declarative retry support for Spring applications.
A subset of the project includes the ability to implement circuit breaker functionality.
Spring Retry provides a circuit breaker implementation via a combination of it’s
<a href="https://github.com/spring-projects/spring-retry/blob/master/src/main/java/org/springframework/retry/policy/CircuitBreakerRetryPolicy.java"><code>CircuitBreakerRetryPolicy</code></a>
and a <a href="https://github.com/spring-projects/spring-retry#stateful-retry">stateful retry</a>.
All circuit breakers created using Spring Retry will be created using the <code>CircuitBreakerRetryPolicy</code> and a
<a href="https://github.com/spring-projects/spring-retry/blob/master/src/main/java/org/springframework/retry/support/DefaultRetryState.java"><code>DefaultRetryState</code></a>.
Both of these classes can be configured using <code>SpringRetryConfigBuilder</code>.</p>
</div>
<div class="sect3">
<h4 id="default-configuration-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#default-configuration-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#default-configuration-2">.2.1. Default Configuration</a></h4>
<div class="paragraph">
<p>To provide a default configuration for all of your circuit breakers create a <code>Customize</code> bean that is passed a
<code>SpringRetryCircuitBreakerFactory</code>.
The <code>configureDefault</code> method can be used to provide a default configuration.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Customizer&lt;SpringRetryCircuitBreakerFactory&gt; <span class="hljs-title">defaultCustomizer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> factory -&gt; factory.configureDefault(id -&gt; <span class="hljs-keyword">new</span> SpringRetryConfigBuilder(id)
        .retryPolicy(<span class="hljs-keyword">new</span> TimeoutRetryPolicy()).build());
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="specific-circuit-breaker-configuration-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#specific-circuit-breaker-configuration-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#specific-circuit-breaker-configuration-2">.2.2. Specific Circuit Breaker Configuration</a></h4>
<div class="paragraph">
<p>Similarly to providing a default configuration, you can create a <code>Customize</code> bean this is passed a
<code>SpringRetryCircuitBreakerFactory</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Customizer&lt;SpringRetryCircuitBreakerFactory&gt; <span class="hljs-title">slowCustomizer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> factory -&gt; factory.configure(builder -&gt; builder.retryPolicy(<span class="hljs-keyword">new</span> SimpleRetryPolicy(<span class="hljs-number">1</span>)).build(), <span class="hljs-string">"slow"</span>);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In addition to configuring the circuit breaker that is created you can also customize the circuit breaker after it has been created but before it is returned to the caller.
To do this you can use the <code>addRetryTemplateCustomizers</code>
method.
This can be useful for adding event handlers to the <code>RetryTemplate</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Customizer&lt;SpringRetryCircuitBreakerFactory&gt; <span class="hljs-title">slowCustomizer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> factory -&gt; factory.addRetryTemplateCustomizers(retryTemplate -&gt; retryTemplate.registerListener(<span class="hljs-keyword">new</span> RetryListener() {

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> &lt;T, E extends Throwable&gt; <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">open</span><span class="hljs-params">(RetryContext context, RetryCallback&lt;T, E&gt; callback)</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> &lt;T, E extends Throwable&gt; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">(RetryContext context, RetryCallback&lt;T, E&gt; callback, Throwable throwable)</span> </span>{

        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> &lt;T, E extends Throwable&gt; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(RetryContext context, RetryCallback&lt;T, E&gt; callback, Throwable throwable)</span> </span>{

        }
    }));
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#building"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#building">28. Building</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="basic-compile-and-test"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#basic-compile-and-test"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#basic-compile-and-test">28.1. Basic Compile and Test</a></h3>
<div class="paragraph">
<p>To build the source you will need to install JDK 1.8.</p>
</div>
<div class="paragraph">
<p>Spring Cloud uses Maven for most build-related activities, and you
should be able to get off the ground quite quickly by cloning the
project you are interested in and typing</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./mvnw install</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also install Maven (&gt;=3.3.3) yourself and run the <code>mvn</code> command
in place of <code>./mvnw</code> in the examples below. If you do that you also
might need to add <code>-P spring</code> if your local Maven settings do not
contain repository declarations for spring pre-release artifacts.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Be aware that you might need to increase the amount of memory
available to Maven by setting a <code>MAVEN_OPTS</code> environment variable with
a value like <code>-Xmx512m -XX:MaxPermSize=128m</code>. We try to cover this in
the <code>.mvn</code> configuration, so if you find you have to do it to make a
build succeed, please raise a ticket to get the settings added to
source control.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>For hints on how to build the project look in <code>.travis.yml</code> if there
is one. There should be a "script" and maybe "install" command. Also
look at the "services" section to see if any services need to be
running locally (e.g. mongo or rabbit). Ignore the git-related bits
that you might find in "before_install" since they’re related to setting git
credentials and you already have those.</p>
</div>
<div class="paragraph">
<p>The projects that require middleware generally include a
<code>docker-compose.yml</code>, so consider using
<a href="https://docs.docker.com/compose/">Docker Compose</a> to run the middeware servers
in Docker containers. See the README in the
<a href="https://github.com/spring-cloud-samples/scripts">scripts demo
repository</a> for specific instructions about the common cases of mongo,
rabbit and redis.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If all else fails, build with the command from <code>.travis.yml</code> (usually
<code>./mvnw install</code>).
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="documentation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#documentation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#documentation">28.2. Documentation</a></h3>
<div class="paragraph">
<p>The spring-cloud-build module has a "docs" profile, and if you switch
that on it will try to build asciidoc sources from
<code>src/main/asciidoc</code>. As part of that process it will look for a
<code>README.adoc</code> and process it by loading all the includes, but not
parsing or rendering it, just copying it to <code>${main.basedir}</code>
(defaults to <code>$/tmp/releaser-1613056757628-0/spring-cloud-release/train-docs/target/unpacked-docs</code>, i.e. the root of the project). If there are
any changes in the README it will then show up after a Maven build as
a modified file in the correct place. Just commit it and push the change.</p>
</div>
</div>
<div class="sect2">
<h3 id="working-with-the-code"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#working-with-the-code"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#working-with-the-code">28.3. Working with the code</a></h3>
<div class="paragraph">
<p>If you don’t have an IDE preference we would recommend that you use
<a href="https://www.springsource.com/developer/sts">Spring Tools Suite</a> or
<a href="https://eclipse.org/">Eclipse</a> when working with the code. We use the
<a href="https://eclipse.org/m2e/">m2eclipse</a> eclipse plugin for maven support. Other IDEs and tools
should also work without issue as long as they use Maven 3.3.3 or better.</p>
</div>
<div class="sect3">
<h4 id="activate-the-spring-maven-profile"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#activate-the-spring-maven-profile"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#activate-the-spring-maven-profile">28.3.1. Activate the Spring Maven profile</a></h4>
<div class="paragraph">
<p>Spring Cloud projects require the 'spring' Maven profile to be activated to resolve
the spring milestone and snapshot repositories. Use your preferred IDE to set this
profile to be active, or you may experience build errors.</p>
</div>
</div>
<div class="sect3">
<h4 id="importing-into-eclipse-with-m2eclipse"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#importing-into-eclipse-with-m2eclipse"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#importing-into-eclipse-with-m2eclipse">28.3.2. Importing into eclipse with m2eclipse</a></h4>
<div class="paragraph">
<p>We recommend the <a href="https://eclipse.org/m2e/">m2eclipse</a> eclipse plugin when working with
eclipse. If you don’t already have m2eclipse installed it is available from the "eclipse
marketplace".</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Older versions of m2e do not support Maven 3.3, so once the
projects are imported into Eclipse you will also need to tell
m2eclipse to use the right profile for the projects. If you
see many different errors related to the POMs in the projects, check
that you have an up to date installation. If you can’t upgrade m2e,
add the "spring" profile to your <code>settings.xml</code>. Alternatively you can
copy the repository settings from the "spring" profile of the parent
pom into your <code>settings.xml</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="importing-into-eclipse-without-m2eclipse"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#importing-into-eclipse-without-m2eclipse"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#importing-into-eclipse-without-m2eclipse">28.3.3. Importing into eclipse without m2eclipse</a></h4>
<div class="paragraph">
<p>If you prefer not to use m2eclipse you can generate eclipse project metadata using the
following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./mvnw eclipse:eclipse</pre>
</div>
</div>
<div class="paragraph">
<p>The generated eclipse projects can be imported by selecting <code>import existing projects</code>
from the <code>file</code> menu.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="contributing-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#contributing-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#contributing-2">29. Contributing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud is released under the non-restrictive Apache 2.0 license,
and follows a very standard Github development process, using Github
tracker for issues and merging pull requests into master. If you want
to contribute even something trivial please do not hesitate, but
follow the guidelines below.</p>
</div>
<div class="sect2">
<h3 id="sign-the-contributor-license-agreement-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sign-the-contributor-license-agreement-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sign-the-contributor-license-agreement-2">29.1. Sign the Contributor License Agreement</a></h3>
<div class="paragraph">
<p>Before we accept a non-trivial patch or pull request we will need you to sign the
<a href="https://cla.pivotal.io/sign/spring">Contributor License Agreement</a>.
Signing the contributor’s agreement does not grant anyone commit rights to the main
repository, but it does mean that we can accept your contributions, and you will get an
author credit if we do. Active contributors might be asked to join the core team, and
given the ability to merge pull requests.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-of-conduct-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-of-conduct-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-of-conduct-2">29.2. Code of Conduct</a></h3>
<div class="paragraph">
<p>This project adheres to the Contributor Covenant <a href="https://github.com/spring-cloud/spring-cloud-build/blob/master/docs/src/main/asciidoc/code-of-conduct.adoc">code of
conduct</a>. By participating, you are expected to uphold this code. Please report
unacceptable behavior to <a href="mailto:spring-code-of-conduct@pivotal.io">spring-code-of-conduct@pivotal.io</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-conventions-and-housekeeping-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-conventions-and-housekeeping-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-conventions-and-housekeeping-2">29.3. Code Conventions and Housekeeping</a></h3>
<div class="paragraph">
<p>None of these is essential for a pull request, but they will all help. They can also be
added after the original pull request but before a merge.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the Spring Framework code format conventions. If you use Eclipse
you can import formatter settings using the
<code>eclipse-code-formatter.xml</code> file from the
<a href="https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-dependencies-parent/eclipse-code-formatter.xml">Spring
Cloud Build</a> project. If using IntelliJ, you can use the
<a href="https://plugins.jetbrains.com/plugin/6546">Eclipse Code Formatter
Plugin</a> to import the same file.</p>
</li>
<li>
<p>Make sure all new <code>.java</code> files to have a simple Javadoc class comment with at least an
<code>@author</code> tag identifying you, and preferably at least a paragraph on what the class is
for.</p>
</li>
<li>
<p>Add the ASF license header comment to all new <code>.java</code> files (copy from existing files
in the project)</p>
</li>
<li>
<p>Add yourself as an <code>@author</code> to the .java files that you modify substantially (more
than cosmetic changes).</p>
</li>
<li>
<p>Add some Javadocs and, if you change the namespace, some XSD doc elements.</p>
</li>
<li>
<p>A few unit tests would help a lot as well — someone has to do it.</p>
</li>
<li>
<p>If no-one else is using your branch, please rebase it against the current master (or
other target branch in the main project).</p>
</li>
<li>
<p>When writing a commit message please follow <a href="https://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html">these conventions</a>,
if you are fixing an existing issue please add <code>Fixes gh-XXXX</code> at the end of the commit
message (where XXXX is the issue number).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="checkstyle-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#checkstyle-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#checkstyle-2">29.4. Checkstyle</a></h3>
<div class="paragraph">
<p>Spring Cloud Build comes with a set of checkstyle rules. You can find them in the <code>spring-cloud-build-tools</code> module. The most notable files under the module are:</p>
</div>
<div class="listingblock">
<div class="title">spring-cloud-build-tools/</div>
<div class="content">
<pre>└── src
 &nbsp;&nbsp; ├── checkstyle
 &nbsp;&nbsp; │&nbsp;&nbsp; └── checkstyle-suppressions.xml <i class="conum" data-value="3"></i><b>(3)</b>
 &nbsp;&nbsp; └── main
 &nbsp;&nbsp;     └── resources
 &nbsp;&nbsp;         ├── checkstyle-header.txt <i class="conum" data-value="2"></i><b>(2)</b>
 &nbsp;&nbsp;         └── checkstyle.xml <i class="conum" data-value="1"></i><b>(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Default Checkstyle rules</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>File header setup</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Default suppression rules</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="checkstyle-configuration-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#checkstyle-configuration-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#checkstyle-configuration-2">29.4.1. Checkstyle configuration</a></h4>
<div class="paragraph">
<p>Checkstyle rules are <strong>disabled by default</strong>. To add checkstyle to your project just define the following properties and plugins.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre>&lt;properties&gt;
&lt;maven-checkstyle-plugin.failsOnError&gt;true&lt;/maven-checkstyle-plugin.failsOnError&gt; <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;maven-checkstyle-plugin.failsOnViolation&gt;true
        &lt;/maven-checkstyle-plugin.failsOnViolation&gt; <i class="conum" data-value="2"></i><b>(2)</b>
        &lt;maven-checkstyle-plugin.includeTestSourceDirectory&gt;true
        &lt;/maven-checkstyle-plugin.includeTestSourceDirectory&gt; <i class="conum" data-value="3"></i><b>(3)</b>
&lt;/properties&gt;

&lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt; <i class="conum" data-value="4"></i><b>(4)</b>
                &lt;groupId&gt;io.spring.javaformat&lt;/groupId&gt;
                &lt;artifactId&gt;spring-javaformat-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt; <i class="conum" data-value="5"></i><b>(5)</b>
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;

    &lt;reporting&gt;
        &lt;plugins&gt;
            &lt;plugin&gt; <i class="conum" data-value="5"></i><b>(5)</b>
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/reporting&gt;
&lt;/build&gt;</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Fails the build upon Checkstyle errors</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Fails the build upon Checkstyle violations</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Checkstyle analyzes also the test sources</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Add the Spring Java Format plugin that will reformat your code to pass most of the Checkstyle formatting rules</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Add checkstyle plugin to your build and reporting phases</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you need to suppress some rules (e.g. line length needs to be longer), then it’s enough for you to define a file under <code>${project.root}/src/checkstyle/checkstyle-suppressions.xml</code> with your suppressions. Example:</p>
</div>
<div class="listingblock">
<div class="title">projectRoot/src/checkstyle/checkstyle-suppresions.xml</div>
<div class="content">
<pre>&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE suppressions PUBLIC
        "-//Puppy Crawl//DTD Suppressions 1.1//EN"
        "https://www.puppycrawl.com/dtds/suppressions_1_1.dtd"&gt;
&lt;suppressions&gt;
    &lt;suppress files=".*ConfigServerApplication\.java" checks="HideUtilityClassConstructor"/&gt;
    &lt;suppress files=".*ConfigClientWatch\.java" checks="LineLengthCheck"/&gt;
&lt;/suppressions&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>It’s advisable to copy the <code>${spring-cloud-build.rootFolder}/.editorconfig</code> and <code>${spring-cloud-build.rootFolder}/.springformat</code> to your project. That way, some default formatting rules will be applied. You can do so by running this script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/.editorconfig -o .editorconfig
$ touch .springformat</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ide-setup-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ide-setup-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ide-setup-2">29.5. IDE setup</a></h3>
<div class="sect3">
<h4 id="intellij-idea-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#intellij-idea-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#intellij-idea-2">29.5.1. Intellij IDEA</a></h4>
<div class="paragraph">
<p>In order to setup Intellij you should import our coding conventions, inspection profiles and set up the checkstyle plugin.
The following files can be found in the <a href="https://github.com/spring-cloud/spring-cloud-build/tree/master/spring-cloud-build-tools">Spring Cloud Build</a> project.</p>
</div>
<div class="listingblock">
<div class="title">spring-cloud-build-tools/</div>
<div class="content">
<pre>└── src
 &nbsp;&nbsp; ├── checkstyle
 &nbsp;&nbsp; │&nbsp;&nbsp; └── checkstyle-suppressions.xml <i class="conum" data-value="3"></i><b>(3)</b>
 &nbsp;&nbsp; └── main
 &nbsp;&nbsp;     └── resources
 &nbsp;&nbsp;         ├── checkstyle-header.txt <i class="conum" data-value="2"></i><b>(2)</b>
 &nbsp;&nbsp;         ├── checkstyle.xml <i class="conum" data-value="1"></i><b>(1)</b>
 &nbsp;&nbsp;         └── intellij
 &nbsp;&nbsp;          &nbsp;&nbsp; ├── Intellij_Project_Defaults.xml <i class="conum" data-value="4"></i><b>(4)</b>
 &nbsp;&nbsp;          &nbsp;&nbsp; └── Intellij_Spring_Boot_Java_Conventions.xml <i class="conum" data-value="5"></i><b>(5)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Default Checkstyle rules</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>File header setup</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Default suppression rules</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Project defaults for Intellij that apply most of Checkstyle rules</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Project style conventions for Intellij that apply most of Checkstyle rules</td>
</tr>
</tbody></table>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/docs/src/main/asciidoc/images/intellij-code-style.png" alt="Code style">
</div>
<div class="title">Figure 3. Code style</div>
</div>
<div class="paragraph">
<p>Go to <code>File</code> → <code>Settings</code> → <code>Editor</code> → <code>Code style</code>. There click on the icon next to the <code>Scheme</code> section. There, click on the <code>Import Scheme</code> value and pick the <code>Intellij IDEA code style XML</code> option. Import the <code>spring-cloud-build-tools/src/main/resources/intellij/Intellij_Spring_Boot_Java_Conventions.xml</code> file.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/intellij-inspections.png" alt="Code style">
</div>
<div class="title">Figure 4. Inspection profiles</div>
</div>
<div class="paragraph">
<p>Go to <code>File</code> → <code>Settings</code> → <code>Editor</code> → <code>Inspections</code>. There click on the icon next to the <code>Profile</code> section. There, click on the <code>Import Profile</code> and import the <code>spring-cloud-build-tools/src/main/resources/intellij/Intellij_Project_Defaults.xml</code> file.</p>
</div>
<div class="paragraph">
<div class="title">Checkstyle</div>
<p>To have Intellij work with Checkstyle, you have to install the <code>Checkstyle</code> plugin. It’s advisable to also install the <code>Assertions2Assertj</code> to automatically convert the JUnit assertions</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/intellij-checkstyle.png" alt="Checkstyle">
</div>
</div>
<div class="paragraph">
<p>Go to <code>File</code> → <code>Settings</code> → <code>Other settings</code> → <code>Checkstyle</code>. There click on the <code>+</code> icon in the <code>Configuration file</code> section. There, you’ll have to define where the checkstyle rules should be picked from. In the image above, we’ve picked the rules from the cloned Spring Cloud Build repository. However, you can point to the Spring Cloud Build’s GitHub repository (e.g. for the <code>checkstyle.xml</code> : <code><a href="https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/main/resources/checkstyle.xml" class="bare">raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/main/resources/checkstyle.xml</a></code>). We need to provide the following variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>checkstyle.header.file</code> - please point it to the Spring Cloud Build’s, <code>spring-cloud-build-tools/src/main/resources/checkstyle-header.txt</code> file either in your cloned repo or via the <code><a href="https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/main/resources/checkstyle-header.txt" class="bare">raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/main/resources/checkstyle-header.txt</a></code> URL.</p>
</li>
<li>
<p><code>checkstyle.suppressions.file</code> - default suppressions. Please point it to the Spring Cloud Build’s, <code>spring-cloud-build-tools/src/checkstyle/checkstyle-suppressions.xml</code> file either in your cloned repo or via the <code><a href="https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/checkstyle/checkstyle-suppressions.xml" class="bare">raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/checkstyle/checkstyle-suppressions.xml</a></code> URL.</p>
</li>
<li>
<p><code>checkstyle.additional.suppressions.file</code> - this variable corresponds to suppressions in your local project. E.g. you’re working on <code>spring-cloud-contract</code>. Then point to the <code>project-root/src/checkstyle/checkstyle-suppressions.xml</code> folder. Example for <code>spring-cloud-contract</code> would be: <code>/home/username/spring-cloud-contract/src/checkstyle/checkstyle-suppressions.xml</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Remember to set the <code>Scan Scope</code> to <code>All sources</code> since we apply checkstyle rules for production and test sources.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<h1 id="spring-boot-cloud-cli" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-cloud-cli"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-cloud-cli">Spring Boot Cloud CLI</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Spring Boot CLI provides <a href="https://projects.spring.io/spring-boot">Spring
Boot</a> command line features for <a href="https://github.com/spring-cloud">Spring
Cloud</a>. You can write Groovy scripts to run Spring Cloud component
applications (e.g. <code>@EnableEurekaServer</code>). You can also easily do
things like encryption and decryption to support Spring Cloud Config
clients with secret configuration values. With the Launcher CLI you
can launch services like Eureka, Zipkin, Config Server
conveniently all at once from the command line (very useful at
development time).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Cloud is released under the non-restrictive Apache 2.0 license. If you would like to contribute to this section of the documentation or if you find an error, please find the source code and issue trackers in the project at <a href="https://github.com/spring-cloud/spring-cloud">github</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#installation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#installation">30. Installation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To install, make
sure you have
<a href="https://github.com/spring-projects/spring-boot">Spring Boot CLI</a>
(2.0.0 or better):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ spring version
Spring CLI v2.2.3.RELEASE</pre>
</div>
</div>
<div class="paragraph">
<p>E.g. for SDKMan users</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sdk install springboot 2.2.3.RELEASE</span>
<span class="hljs-meta">$</span><span class="bash"> sdk use springboot 2.2.3.RELEASE</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and install the Spring Cloud plugin</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> mvn install</span>
<span class="hljs-meta">$</span><span class="bash"> spring install org.springframework.cloud:spring-cloud-cli:2.2.0.RELEASE</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<strong>Prerequisites:</strong> to use the encryption and decryption features
you need the full-strength JCE installed in your JVM (it’s not there by default).
You can download the "Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files"
from Oracle, and follow instructions for installation (essentially replace the 2 policy files
in the JRE lib/security directory with the ones that you downloaded).
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-spring-cloud-services-in-development"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#running-spring-cloud-services-in-development"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#running-spring-cloud-services-in-development">31. Running Spring Cloud Services in Development</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Launcher CLI can be used to run common services like Eureka,
Config Server etc. from the command line. To list the available
services you can do <code>spring cloud --list</code>, and to launch a default set
of services just <code>spring cloud</code>. To choose the services to deploy,
just list them on the command line, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ spring cloud eureka configserver h2 kafka stubrunner zipkin</pre>
</div>
</div>
<div class="paragraph">
<p>Summary of supported deployables:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eureka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eureka Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8761/" class="bare">localhost:8761</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eureka server for service registration and discovery. All the other services show up in its catalog by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configserver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Config Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8888/" class="bare">localhost:8888</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Cloud Config Server running in the "native" profile and serving configuration from the local directory ./launcher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">h2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">H2 Database</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:9095/" class="bare">localhost:9095</a> (console), jdbc:h2:tcp://localhost:9096/{data}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relation database service. Use a file path for <code>{data}</code> (e.g. <code>./target/test</code>) when you connect. Remember that you can add <code>;MODE=MYSQL</code> or <code>;MODE=POSTGRESQL</code> to connect with compatibility to other server types.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Broker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:9091/" class="bare">localhost:9091</a> (actuator endpoints), localhost:9092</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hystrixdashboard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hystrix Dashboard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:7979/" class="bare">localhost:7979</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any Spring Cloud app that declares Hystrix circuit breakers publishes metrics on <code>/hystrix.stream</code>. Type that address into the dashboard to visualize all the metrics,</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dataflow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dataflow Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:9393/" class="bare">localhost:9393</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Cloud Dataflow server with UI at /admin-ui. Connect the Dataflow shell to target at root path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zipkin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zipkin Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:9411/" class="bare">localhost:9411</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zipkin Server with UI for visualizing traces. Stores span data in memory and accepts them via HTTP POST of JSON data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stub Runner Boot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8750/" class="bare">localhost:8750</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Downloads WireMock stubs, starts WireMock and feeds the started servers with stored stubs. Pass <code>stubrunner.ids</code> to pass stub coordinates and then go to <code><a href="http://localhost:8750/stubs" class="bare">localhost:8750/stubs</a></code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each of these apps can be configured using a local YAML file with the same name (in the current
working directory or a subdirectory called "config" or in <code>~/.spring-cloud</code>). E.g. in <code>configserver.yml</code> you might want to
do something like this to locate a local git repository for the backend:</p>
</div>
<div class="listingblock">
<div class="title">configserver.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  profiles:
    active: git
  cloud:
    config:
      server:
        git:
          uri: file://${user.home}/dev/demo/config-repo</code></pre>
</div>
</div>
<div class="paragraph">
<p>E.g. in Stub Runner app you could fetch stubs from your local <code>.m2</code> in the following way.</p>
</div>
<div class="listingblock">
<div class="title">stubrunner.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">stubrunner:
  workOffline: true
  ids:
    - com.example:beer-api-producer:+:9876</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="adding-additional-applications"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#adding-additional-applications"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#adding-additional-applications">31.1. Adding Additional Applications</a></h3>
<div class="paragraph">
<p>Additional applications can be added to <code>./config/cloud.yml</code> (not
<code>./config.yml</code> because that would replace the defaults), e.g. with</p>
</div>
<div class="listingblock">
<div class="title">config/cloud.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    launcher:
      deployables:
        source:
          coordinates: maven://com.example:source:0.0.1-SNAPSHOT
          port: 7000
        sink:
          coordinates: maven://com.example:sink:0.0.1-SNAPSHOT
          port: 7001</code></pre>
</div>
</div>
<div class="paragraph">
<p>when you list the apps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">$ spring cloud --list
<span class="hljs-built_in">source</span> sink configserver dataflow eureka h2 hystrixdashboard kafka stubrunner zipkin</code></pre>
</div>
</div>
<div class="paragraph">
<p>(notice the additional apps at the start of the list).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-groovy-scripts-and-running-applications"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#writing-groovy-scripts-and-running-applications"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#writing-groovy-scripts-and-running-applications">32. Writing Groovy Scripts and Running Applications</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud CLI has support for most of the Spring Cloud declarative
features, such as the <code>@Enable*</code> class of annotations. For example,
here is a fully functional Eureka server</p>
</div>
<div class="listingblock">
<div class="title">app.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy"><span class="hljs-meta">@EnableEurekaServer</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Eureka</span> {</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>which you can run from the command line like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ spring run app.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>To include additional dependencies, often it suffices just to add the
appropriate feature-enabling annotation, e.g. <code>@EnableConfigServer</code>,
<code>@EnableOAuth2Sso</code> or <code>@EnableEurekaClient</code>. To manually include a
dependency you can use a <code>@Grab</code> with the special "Spring Boot" short
style artifact co-ordinates, i.e. with just the artifact ID (no need
for group or version information), e.g. to set up a client app to
listen on AMQP for management events from the Spring CLoud Bus:</p>
</div>
<div class="listingblock">
<div class="title">app.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy"><span class="hljs-meta">@Grab</span>(<span class="hljs-string">'spring-cloud-starter-bus-amqp'</span>)
<span class="hljs-meta">@RestController</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Service</span> {</span>
  <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">'/'</span>)
  <span class="hljs-keyword">def</span> home() { [<span class="hljs-string">message:</span> <span class="hljs-string">'Hello'</span>] }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="encryption-and-decryption"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#encryption-and-decryption"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#encryption-and-decryption">33. Encryption and Decryption</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Cloud CLI comes with an "encrypt" and a "decrypt"
command. Both accept arguments in the same form with a key specified
as a mandatory "--key", e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ spring encrypt mysecret --key foo
682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda
$ spring decrypt --key foo 682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda
mysecret</pre>
</div>
</div>
<div class="paragraph">
<p>To use a key in a file (e.g. an RSA public key for encyption) prepend
the key value with "@" and provide the file path, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ spring encrypt mysecret --key @${HOME}/.ssh/id_rsa.pub
AQAjPgt3eFZQXwt8tsHAVv/QHiY5sI2dRcR+...</pre>
</div>
</div>
</div>
</div>
<h1 id="spring-cloud-for-cloud-foundry" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-for-cloud-foundry"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-for-cloud-foundry">Spring Cloud for Cloud Foundry</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Spring Cloud for Cloudfoundry makes it easy to run
<a href="https://github.com/spring-cloud">Spring Cloud</a> apps in
<a href="https://github.com/cloudfoundry">Cloud Foundry</a> (the Platform as a
Service). Cloud Foundry has the notion of a "service", which is
middlware that you "bind" to an app, essentially providing it with an
environment variable containing credentials (e.g. the location and
username to use for the service).</p>
</div>
<div class="paragraph">
<p>The <code>spring-cloud-cloudfoundry-commons</code> module configures the
Reactor-based Cloud Foundry Java client, v 3.0, and can be used standalone.</p>
</div>
<div class="paragraph">
<p>The <code>spring-cloud-cloudfoundry-web</code> project provides basic support for
some enhanced features of webapps in Cloud Foundry: binding
automatically to single-sign-on services and optionally enabling
sticky routing for discovery.</p>
</div>
<div class="paragraph">
<p>The <code>spring-cloud-cloudfoundry-discovery</code> project provides an
implementation of Spring Cloud Commons <code>DiscoveryClient</code> so you can
<code>@EnableDiscoveryClient</code> and provide your credentials as
<code>spring.cloud.cloudfoundry.discovery.[username,password]</code> (also <code>*.url</code> if you are not connecting to <a href="https://run.pivotal.io/">Pivotal Web Services</a>) and then you
can use the <code>DiscoveryClient</code> directly or via a <code>LoadBalancerClient</code>.</p>
</div>
<div class="paragraph">
<p>The first time you use it the discovery client might be slow owing to
the fact that it has to get an access token from Cloud Foundry.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="discovery"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discovery"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discovery">34. Discovery</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here’s a Spring Cloud app with Cloud Foundry discovery:</p>
</div>
<div class="listingblock">
<div class="title">app.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Grab</span>(<span class="hljs-string">'org.springframework.cloud:spring-cloud-cloudfoundry'</span>)
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@EnableDiscoveryClient</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{

  <span class="hljs-meta">@Autowired</span>
  DiscoveryClient client

  <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">'/'</span>)
  <span class="hljs-function">String <span class="hljs-title">home</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-string">'Hello from '</span> + client.getLocalServiceInstance()
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you run it without any service bindings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ spring jar app.jar app.groovy
$ cf push -p app.jar</pre>
</div>
</div>
<div class="paragraph">
<p>It will show its app name in the home page.</p>
</div>
<div class="paragraph">
<p>The <code>DiscoveryClient</code> can lists all the apps in a space, according to
the credentials it is authenticated with, where the space defaults to
the one the client is running in (if any). If neither org nor space
are configured, they default per the user’s profile in Cloud Foundry.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="single-sign-on"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#single-sign-on"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#single-sign-on">35. Single Sign On</a></h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All of the OAuth2 SSO and resource server features moved to Spring Boot
in version 1.3. You can find documentation in the
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/">Spring Boot user guide</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This project provides automatic binding from CloudFoundry service
credentials to the Spring Boot features. If you have a CloudFoundry
service called "sso", for instance, with credentials containing
"client_id", "client_secret" and "auth_domain", it will bind
automatically to the Spring OAuth2 client that you enable with
<code>@EnableOAuth2Sso</code> (from Spring Boot). The name of the service can be
parameterized using <code>spring.oauth2.sso.serviceId</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration">36. Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To see the list of all Spring Cloud Sloud Foundry related configuration properties please check <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/appendix.html">the Appendix page</a>.</p>
</div>
</div>
</div>
<h1 id="cloud-native-applications" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-native-applications"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-native-applications">Cloud Native Applications</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><a href="https://pivotal.io/platform-as-a-service/migrating-to-cloud-native-application-architectures-ebook">Cloud Native</a> is a style of application development that encourages easy adoption of best practices in the areas of continuous delivery and value-driven development.
A related discipline is that of building <a href="https://12factor.net/">12-factor Applications</a>, in which development practices are aligned with delivery and operations goals — for instance, by using declarative programming and management and monitoring.
Spring Cloud facilitates these styles of development in a number of specific ways.
The starting point is a set of features to which all components in a distributed system need easy access.</p>
</div>
<div class="paragraph">
<p>Many of those features are covered by <a href="https://projects.spring.io/spring-boot">Spring Boot</a>, on which Spring Cloud builds. Some more features are delivered by Spring Cloud as two libraries: Spring Cloud Context and Spring Cloud Commons.
Spring Cloud Context provides utilities and special services for the <code>ApplicationContext</code> of a Spring Cloud application (bootstrap context, encryption, refresh scope, and environment endpoints). Spring Cloud Commons is a set of abstractions and common classes used in different Spring Cloud implementations (such as Spring Cloud Netflix and Spring Cloud Consul).</p>
</div>
<div class="paragraph">
<p>If you get an exception due to "Illegal key size" and you use Sun’s JDK, you need to install the Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files.
See the following links for more information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.oracle.com/technetwork/java/javase/downloads/jce-6-download-429243.html">Java 6 JCE</a></p>
</li>
<li>
<p><a href="https://www.oracle.com/technetwork/java/javase/downloads/jce-7-download-432124.html">Java 7 JCE</a></p>
</li>
<li>
<p><a href="https://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html">Java 8 JCE</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Extract the files into the JDK/jre/lib/security folder for whichever version of JRE/JDK x64/x86 you use.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Cloud is released under the non-restrictive Apache 2.0 license.
If you would like to contribute to this section of the documentation or if you find an error, you can find the source code and issue trackers for the project at <a href="https://github.com/spring-cloud/spring-cloud-cli/tree/master/docs/src/main/asciidoc">github</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-context-application-context-services"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-context-application-context-services"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-context-application-context-services">37. Spring Cloud Context: Application Context Services</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Boot has an opinionated view of how to build an application with Spring.
For instance, it has conventional locations for common configuration files and has endpoints for common management and monitoring tasks.
Spring Cloud builds on top of that and adds a few features that many components in a system would use or occasionally need.</p>
</div>
<div class="sect2">
<h3 id="the-bootstrap-application-context"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-bootstrap-application-context"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-bootstrap-application-context">37.1. The Bootstrap Application Context</a></h3>
<div class="paragraph">
<p>A Spring Cloud application operates by creating a “bootstrap” context, which is a parent context for the main application.
This context is responsible for loading configuration properties from the external sources and for decrypting properties in the local external configuration files.
The two contexts share an <code>Environment</code>, which is the source of external properties for any Spring application.
By default, bootstrap properties (not <code>bootstrap.properties</code> but properties that are loaded during the bootstrap phase) are added with high precedence, so they cannot be overridden by local configuration.</p>
</div>
<div class="paragraph">
<p>The bootstrap context uses a different convention for locating external configuration than the main application context.
Instead of <code>application.yml</code> (or <code>.properties</code>), you can use <code>bootstrap.yml</code>, keeping the external configuration for bootstrap and main context nicely separate.
The following listing shows an example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. bootstrap.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>spring:
  application:
    name: foo
  cloud:
    config:
      uri: ${SPRING_CONFIG_URI:http://localhost:8888}</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If your application needs any application-specific configuration from the server, it is a good idea to set the <code>spring.application.name</code> (in <code>bootstrap.yml</code> or <code>application.yml</code>).
For the property <code>spring.application.name</code> to be used as the application’s context ID, you must set it in <code>bootstrap.[properties | yml]</code>.</p>
</div>
<div class="paragraph">
<p>If you want to retrieve specific profile configuration, you should also set <code>spring.profiles.active</code> in <code>bootstrap.[properties | yml]</code>.</p>
</div>
<div class="paragraph">
<p>You can disable the bootstrap process completely by setting <code>spring.cloud.bootstrap.enabled=false</code> (for example, in system properties).</p>
</div>
</div>
<div class="sect2">
<h3 id="application-context-hierarchies"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#application-context-hierarchies"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#application-context-hierarchies">37.2. Application Context Hierarchies</a></h3>
<div class="paragraph">
<p>If you build an application context from <code>SpringApplication</code> or <code>SpringApplicationBuilder</code>, the Bootstrap context is added as a parent to that context.
It is a feature of Spring that child contexts inherit property sources and profiles from their parent, so the “main” application context contains additional property sources, compared to building the same context without Spring Cloud Config.
The additional property sources are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>“bootstrap”: If any <code>PropertySourceLocators</code> are found in the bootstrap context and if they have non-empty properties, an optional <code>CompositePropertySource</code> appears with high priority.
An example would be properties from the Spring Cloud Config Server.
See “<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-bootstrap-property-sources">Customizing the Bootstrap Property Sources</a>” for how to customize the contents of this property source.</p>
</li>
<li>
<p>“applicationConfig: [classpath:bootstrap.yml]” (and related files if Spring profiles are active): If you have a <code>bootstrap.yml</code> (or <code>.properties</code>), those properties are used to configure the bootstrap context.
Then they get added to the child context when its parent is set.
They have lower precedence than the <code>application.yml</code> (or <code>.properties</code>) and any other property sources that are added to the child as a normal part of the process of creating a Spring Boot application.
See “<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-bootstrap-properties">Changing the Location of Bootstrap Properties</a>” for how to customize the contents of these property sources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because of the ordering rules of property sources, the “bootstrap” entries take precedence.
However, note that these do not contain any data from <code>bootstrap.yml</code>, which has very low precedence but can be used to set defaults.</p>
</div>
<div class="paragraph">
<p>You can extend the context hierarchy by setting the parent context of any <code>ApplicationContext</code> you create — for example, by using its own interface or with the <code>SpringApplicationBuilder</code> convenience methods (<code>parent()</code>, <code>child()</code> and <code>sibling()</code>).
The bootstrap context is the parent of the most senior ancestor that you create yourself.
Every context in the hierarchy has its own “bootstrap” (possibly empty) property source to avoid promoting values inadvertently from parents down to their descendants.
If there is a config server, every context in the hierarchy can also (in principle) have a different <code>spring.application.name</code> and, hence, a different remote property source.
Normal Spring application context behavior rules apply to property resolution: properties from a child context override those in
the parent, by name and also by property source name.
(If the child has a property source with the same name as the parent, the value from the parent is not included in the child).</p>
</div>
<div class="paragraph">
<p>Note that the <code>SpringApplicationBuilder</code> lets you share an <code>Environment</code> amongst the whole hierarchy, but that is not the default.
Thus, sibling contexts (in particular) do not need to have the same profiles or property sources, even though they may share common values with their parent.</p>
</div>
</div>
<div class="sect2">
<h3 id="customizing-bootstrap-properties"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-bootstrap-properties"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-bootstrap-properties">37.3. Changing the Location of Bootstrap Properties</a></h3>
<div class="paragraph">
<p>The <code>bootstrap.yml</code> (or <code>.properties</code>) location can be specified by setting <code>spring.cloud.bootstrap.name</code> (default: <code>bootstrap</code>), <code>spring.cloud.bootstrap.location</code> (default: empty) or <code>spring.cloud.bootstrap.additional-location</code> (default: empty) — for example, in System properties.</p>
</div>
<div class="paragraph">
<p>Those properties behave like the <code>spring.config.*</code> variants with the same name.
With <code>spring.cloud.bootstrap.location</code> the default locations are replaced and only the specified ones are used.
To add locations to the list of default ones, <code>spring.cloud.bootstrap.additional-location</code> could be used.
In fact, they are used to set up the bootstrap <code>ApplicationContext</code> by setting those properties in its <code>Environment</code>.
If there is an active profile (from <code>spring.profiles.active</code> or through the <code>Environment</code> API in the context you are building), properties in that profile get loaded as well, the same as in a regular Spring Boot app — for example, from <code>bootstrap-development.properties</code> for a <code>development</code> profile.</p>
</div>
</div>
<div class="sect2">
<h3 id="overriding-bootstrap-properties"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#overriding-bootstrap-properties"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#overriding-bootstrap-properties">37.4. Overriding the Values of Remote Properties</a></h3>
<div class="paragraph">
<p>The property sources that are added to your application by the bootstrap context are often “remote” (from example, from Spring Cloud Config Server).
By default, they cannot be overridden locally.
If you want to let your applications override the remote properties with their own system properties or config files, the remote property source has to grant it permission by setting <code>spring.cloud.config.allowOverride=true</code> (it does not work to set this locally).
Once that flag is set, two finer-grained settings control the location of the remote properties in relation to system properties and the application’s local configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spring.cloud.config.overrideNone=true</code>: Override from any local property source.</p>
</li>
<li>
<p><code>spring.cloud.config.overrideSystemProperties=false</code>: Only system properties, command line arguments, and environment variables (but not the local config files) should override the remote settings.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="customizing-the-bootstrap-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-the-bootstrap-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-the-bootstrap-configuration">37.5. Customizing the Bootstrap Configuration</a></h3>
<div class="paragraph">
<p>The bootstrap context can be set to do anything you like by adding entries to <code>/META-INF/spring.factories</code> under a key named <code>org.springframework.cloud.bootstrap.BootstrapConfiguration</code>.
This holds a comma-separated list of Spring <code>@Configuration</code> classes that are used to create the context.
Any beans that you want to be available to the main application context for autowiring can be created here.
There is a special contract for <code>@Beans</code> of type <code>ApplicationContextInitializer</code>.
If you want to control the startup sequence, you can mark classes with the <code>@Order</code> annotation (the default order is <code>last</code>).</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
When adding custom <code>BootstrapConfiguration</code>, be careful that the classes you add are not <code>@ComponentScanned</code> by mistake into your “main” application context, where they might not be needed.
Use a separate package name for boot configuration classes and make sure that name is not already covered by your <code>@ComponentScan</code> or <code>@SpringBootApplication</code> annotated configuration classes.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The bootstrap process ends by injecting initializers into the main <code>SpringApplication</code> instance (which is the normal Spring Boot startup sequence, whether it runs as a standalone application or is deployed in an application server).
First, a bootstrap context is created from the classes found in <code>spring.factories</code>.
Then, all <code>@Beans</code> of type <code>ApplicationContextInitializer</code> are added to the main <code>SpringApplication</code> before it is started.</p>
</div>
</div>
<div class="sect2">
<h3 id="customizing-bootstrap-property-sources"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-bootstrap-property-sources"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-bootstrap-property-sources">37.6. Customizing the Bootstrap Property Sources</a></h3>
<div class="paragraph">
<p>The default property source for external configuration added by the bootstrap process is the Spring Cloud Config Server, but you can add additional sources by adding beans of type <code>PropertySourceLocator</code> to the bootstrap context (through <code>spring.factories</code>).
For instance, you can insert additional properties from a different server or from a database.</p>
</div>
<div class="paragraph">
<p>As an example, consider the following custom locator:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomPropertySourceLocator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">PropertySourceLocator</span> </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> PropertySource&lt;?&gt; locate(Environment environment) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MapPropertySource(<span class="hljs-string">"customProperty"</span>,
                Collections.&lt;String, Object&gt;singletonMap(<span class="hljs-string">"property.from.sample.custom.source"</span>, <span class="hljs-string">"worked as intended"</span>));
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>Environment</code> that is passed in is the one for the <code>ApplicationContext</code> about to be created — in other words, the one for which we supply additional property sources.
It already has its normal Spring Boot-provided property sources, so you can use those to locate a property source specific to this <code>Environment</code> (for example, by keying it on <code>spring.application.name</code>, as is done in the default Spring Cloud Config Server property source locator).</p>
</div>
<div class="paragraph">
<p>If you create a jar with this class in it and then add a <code>META-INF/spring.factories</code> containing the following setting, the <code>customProperty</code> <code>PropertySource</code> appears in any application that includes that jar on its classpath:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs">org.springframework.cloud.bootstrap.BootstrapConfiguration=sample.custom.CustomPropertySourceLocator</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="logging-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#logging-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#logging-configuration">37.7. Logging Configuration</a></h3>
<div class="paragraph">
<p>If you use Spring Boot to configure log settings, you should place this configuration in <code>bootstrap.[yml | properties]</code> if you would like it to apply to all events.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Spring Cloud to initialize logging configuration properly, you cannot use a custom prefix.
For example, using <code>custom.loggin.logpath</code> is not recognized by Spring Cloud when initializing the logging system.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="environment-changes"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#environment-changes"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#environment-changes">37.8. Environment Changes</a></h3>
<div class="paragraph">
<p>The application listens for an <code>EnvironmentChangeEvent</code> and reacts to the change in a couple of standard ways (additional <code>ApplicationListeners</code> can be added as <code>@Beans</code> in the normal way).
When an <code>EnvironmentChangeEvent</code> is observed, it has a list of key values that have changed, and the application uses those to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Re-bind any <code>@ConfigurationProperties</code> beans in the context.</p>
</li>
<li>
<p>Set the logger levels for any properties in <code>logging.level.*</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the Spring Cloud Config Client does not, by default, poll for changes in the <code>Environment</code>.
Generally, we would not recommend that approach for detecting changes (although you could set it up with a
<code>@Scheduled</code> annotation).
If you have a scaled-out client application, it is better to broadcast the <code>EnvironmentChangeEvent</code> to all the instances instead of having them polling for changes (for example, by using the <a href="https://github.com/spring-cloud/spring-cloud-bus">Spring Cloud Bus</a>).</p>
</div>
<div class="paragraph">
<p>The <code>EnvironmentChangeEvent</code> covers a large class of refresh use cases, as long as you can actually make a change to the <code>Environment</code> and publish the event.
Note that those APIs are public and part of core Spring).
You can verify that the changes are bound to <code>@ConfigurationProperties</code> beans by visiting the <code>/configprops</code> endpoint (a standard Spring Boot Actuator feature).
For instance, a <code>DataSource</code> can have its <code>maxPoolSize</code> changed at runtime (the default <code>DataSource</code> created by Spring Boot is a <code>@ConfigurationProperties</code> bean) and grow capacity dynamically.
Re-binding <code>@ConfigurationProperties</code> does not cover another large class of use cases, where you need more control over the refresh and where you need a change to be atomic over the whole <code>ApplicationContext</code>.
To address those concerns, we have <code>@RefreshScope</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="refresh-scope"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#refresh-scope"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#refresh-scope">37.9. Refresh Scope</a></h3>
<div class="paragraph">
<p>When there is a configuration change, a Spring <code>@Bean</code> that is marked as <code>@RefreshScope</code> gets special treatment.
This feature addresses the problem of stateful beans that get their configuration injected only when they are initialized.
For instance, if a <code>DataSource</code> has open connections when the database URL is changed through the <code>Environment</code>, you probably want the holders of those connections to be able to complete what they are doing.
Then, the next time something borrows a connection from the pool, it gets one with the new URL.</p>
</div>
<div class="paragraph">
<p>Sometimes, it might even be mandatory to apply the <code>@RefreshScope</code> annotation on some beans that can be only initialized once.
If a bean is “immutable”, you have to either annotate the bean with <code>@RefreshScope</code> or specify the classname under the property key: <code>spring.cloud.refresh.extra-refreshable</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you hava a <code>DataSource</code> bean that is a <code>HikariDataSource</code>, it can not be
refreshed. It is the default value for <code>spring.cloud.refresh.never-refreshable</code>. Choose a
different <code>DataSource</code> implementation if you need it to be refreshed.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Refresh scope beans are lazy proxies that initialize when they are used (that is, when a method is called), and the scope acts as a cache of initialized values.
To force a bean to re-initialize on the next method call, you must invalidate its cache entry.</p>
</div>
<div class="paragraph">
<p>The <code>RefreshScope</code> is a bean in the context and has a public <code>refreshAll()</code> method to refresh all beans in the scope by clearing the target cache.
The <code>/refresh</code> endpoint exposes this functionality (over HTTP or JMX).
To refresh an individual bean by name, there is also a <code>refresh(String)</code> method.</p>
</div>
<div class="paragraph">
<p>To expose the <code>/refresh</code> endpoint, you need to add following configuration to your application:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">management:
  endpoints:
    web:
      exposure:
        include: refresh</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>@RefreshScope</code> works (technically) on a <code>@Configuration</code> class, but it might lead to surprising behavior.
For example, it does not mean that all the <code>@Beans</code> defined in that class are themselves in <code>@RefreshScope</code>.
Specifically, anything that depends on those beans cannot rely on them being updated when a refresh is initiated, unless it is itself in <code>@RefreshScope</code>.
In that case, it is rebuilt on a refresh and its dependencies are re-injected.
At that point, they are re-initialized from the refreshed <code>@Configuration</code>).
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="encryption-and-decryption-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#encryption-and-decryption-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#encryption-and-decryption-2">37.10. Encryption and Decryption</a></h3>
<div class="paragraph">
<p>Spring Cloud has an <code>Environment</code> pre-processor for decrypting property values locally.
It follows the same rules as the Spring Cloud Config Server and has the same external configuration through <code>encrypt.*</code>.
Thus, you can use encrypted values in the form of <code>{cipher}*</code>, and, as long as there is a valid key, they are decrypted before the main application context gets the <code>Environment</code> settings.
To use the encryption features in an application, you need to include Spring Security RSA in your classpath (Maven co-ordinates: <code>org.springframework.security:spring-security-rsa</code>), and you also need the full strength JCE extensions in your JVM.</p>
</div>
<div class="paragraph">
<p>If you get an exception due to "Illegal key size" and you use Sun’s JDK, you need to install the Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files.
See the following links for more information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.oracle.com/technetwork/java/javase/downloads/jce-6-download-429243.html">Java 6 JCE</a></p>
</li>
<li>
<p><a href="https://www.oracle.com/technetwork/java/javase/downloads/jce-7-download-432124.html">Java 7 JCE</a></p>
</li>
<li>
<p><a href="https://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html">Java 8 JCE</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Extract the files into the JDK/jre/lib/security folder for whichever version of JRE/JDK x64/x86 you use.</p>
</div>
</div>
<div class="sect2">
<h3 id="endpoints"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#endpoints"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#endpoints">37.11. Endpoints</a></h3>
<div class="paragraph">
<p>For a Spring Boot Actuator application, some additional management endpoints are available. You can use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>POST</code> to <code>/actuator/env</code> to update the <code>Environment</code> and rebind <code>@ConfigurationProperties</code> and log levels.</p>
</li>
<li>
<p><code>/actuator/refresh</code> to re-load the boot strap context and refresh the <code>@RefreshScope</code> beans.</p>
</li>
<li>
<p><code>/actuator/restart</code> to close the <code>ApplicationContext</code> and restart it (disabled by default).</p>
</li>
<li>
<p><code>/actuator/pause</code> and <code>/actuator/resume</code> for calling the <code>Lifecycle</code> methods (<code>stop()</code> and <code>start()</code> on the <code>ApplicationContext</code>).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you disable the <code>/actuator/restart</code> endpoint then the <code>/actuator/pause</code> and <code>/actuator/resume</code> endpoints
will also be disabled since they are just a special case of <code>/actuator/restart</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-commons-common-abstractions"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-commons-common-abstractions"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-commons-common-abstractions">38. Spring Cloud Commons: Common Abstractions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Patterns such as service discovery, load balancing, and circuit breakers lend themselves to a common abstraction layer that can be consumed by all Spring Cloud clients, independent of the implementation (for example, discovery with Eureka or Consul).</p>
</div>
<div class="sect2">
<h3 id="discovery-client"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discovery-client"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discovery-client">38.1. The <code>@EnableDiscoveryClient</code> Annotation</a></h3>
<div class="paragraph">
<p>Spring Cloud Commons provides the <code>@EnableDiscoveryClient</code> annotation.
This looks for implementations of the <code>DiscoveryClient</code> and <code>ReactiveDiscoveryClient</code> interfaces with <code>META-INF/spring.factories</code>.
Implementations of the discovery client add a configuration class to <code>spring.factories</code> under the <code>org.springframework.cloud.client.discovery.EnableDiscoveryClient</code> key.
Examples of <code>DiscoveryClient</code> implementations include <a href="https://cloud.spring.io/spring-cloud-netflix/">Spring Cloud Netflix Eureka</a>, <a href="https://cloud.spring.io/spring-cloud-consul/">Spring Cloud Consul Discovery</a>, and <a href="https://cloud.spring.io/spring-cloud-zookeeper/">Spring Cloud Zookeeper Discovery</a>.</p>
</div>
<div class="paragraph">
<p>Spring Cloud will provide both the blocking and reactive service discovery clients by default.
You can disable the blocking and/or reactive clients easily by setting <code>spring.cloud.discovery.blocking.enabled=false</code> or <code>spring.cloud.discovery.reactive.enabled=false</code>.
To completely disable service discovery you just need to set <code>spring.cloud.discovery.enabled=false</code>.</p>
</div>
<div class="paragraph">
<p>By default, implementations of <code>DiscoveryClient</code> auto-register the local Spring Boot server with the remote discovery server.
This behavior can be disabled by setting <code>autoRegister=false</code> in <code>@EnableDiscoveryClient</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>@EnableDiscoveryClient</code> is no longer required.
You can put a <code>DiscoveryClient</code> implementation on the classpath to cause the Spring Boot application to register with the service discovery server.
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="health-indicator"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#health-indicator"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#health-indicator">38.1.1. Health Indicator</a></h4>
<div class="paragraph">
<p>Commons creates a Spring Boot <code>HealthIndicator</code> that <code>DiscoveryClient</code> implementations can participate in by implementing <code>DiscoveryHealthIndicator</code>.
To disable the composite <code>HealthIndicator</code>, set <code>spring.cloud.discovery.client.composite-indicator.enabled=false</code>.
A generic <code>HealthIndicator</code> based on <code>DiscoveryClient</code> is auto-configured (<code>DiscoveryClientHealthIndicator</code>).
To disable it, set <code>spring.cloud.discovery.client.health-indicator.enabled=false</code>.
To disable the description field of the <code>DiscoveryClientHealthIndicator</code>, set <code>spring.cloud.discovery.client.health-indicator.include-description=false</code>.
Otherwise, it can bubble up as the <code>description</code> of the rolled up <code>HealthIndicator</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ordering-discoveryclient-instances"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ordering-discoveryclient-instances"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ordering-discoveryclient-instances">38.1.2. Ordering <code>DiscoveryClient</code> instances</a></h4>
<div class="paragraph">
<p><code>DiscoveryClient</code> interface extends <code>Ordered</code>. This is useful when using multiple discovery
clients, as it allows you to define the order of the returned discovery clients, similar to
how you can order the beans loaded by a Spring application. By default, the order of any <code>DiscoveryClient</code> is set to
<code>0</code>. If you want to set a different order for your custom <code>DiscoveryClient</code> implementations, you just need to override
the <code>getOrder()</code> method so that it returns the value that is suitable for your setup. Apart from this, you can use
properties to set the order of the <code>DiscoveryClient</code>
implementations provided by Spring Cloud, among others <code>ConsulDiscoveryClient</code>, <code>EurekaDiscoveryClient</code> and
<code>ZookeeperDiscoveryClient</code>. In order to do it, you just need to set the
<code>spring.cloud.{clientIdentifier}.discovery.order</code> (or <code>eureka.client.order</code> for Eureka) property to the desired value.</p>
</div>
</div>
<div class="sect3">
<h4 id="simplediscoveryclient"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#simplediscoveryclient"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#simplediscoveryclient">38.1.3. SimpleDiscoveryClient</a></h4>
<div class="paragraph">
<p>If there is no Service-Registry-backed <code>DiscoveryClient</code> in the classpath, <code>SimpleDiscoveryClient</code>
instance, that uses properties to get information on service and instances, will be used.</p>
</div>
<div class="paragraph">
<p>The information about the available instances should be passed to via properties in the following format:
<code>spring.cloud.discovery.client.simple.instances.service1[0].uri=http://s11:8080</code>, where
<code>spring.cloud.discovery.client.simple.instances</code> is the common prefix, then <code>service1</code> stands
for the ID of the service in question, while <code>[0]</code> indicates the index number of the instance
(as visible in the example, indexes start with <code>0</code>), and then the value of <code>uri</code> is
the actual URI under which the instance is available.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serviceregistry"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serviceregistry"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serviceregistry">38.2. ServiceRegistry</a></h3>
<div class="paragraph">
<p>Commons now provides a <code>ServiceRegistry</code> interface that provides methods such as <code>register(Registration)</code> and <code>deregister(Registration)</code>, which let you provide custom registered services.
<code>Registration</code> is a marker interface.</p>
</div>
<div class="paragraph">
<p>The following example shows the <code>ServiceRegistry</code> in use:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableDiscoveryClient</span>(autoRegister=<span class="hljs-keyword">false</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfiguration</span> </span>{
    <span class="hljs-keyword">private</span> ServiceRegistry registry;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyConfiguration</span><span class="hljs-params">(ServiceRegistry registry)</span> </span>{
        <span class="hljs-keyword">this</span>.registry = registry;
    }

    <span class="hljs-comment">// called through some external process, such as an event or a custom actuator endpoint</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">()</span> </span>{
        Registration registration = constructRegistration();
        <span class="hljs-keyword">this</span>.registry.register(registration);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Each <code>ServiceRegistry</code> implementation has its own <code>Registry</code> implementation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ZookeeperRegistration</code> used with <code>ZookeeperServiceRegistry</code></p>
</li>
<li>
<p><code>EurekaRegistration</code> used with <code>EurekaServiceRegistry</code></p>
</li>
<li>
<p><code>ConsulRegistration</code> used with <code>ConsulServiceRegistry</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are using the <code>ServiceRegistry</code> interface, you are going to need to pass the
correct <code>Registry</code> implementation for the <code>ServiceRegistry</code> implementation you
are using.</p>
</div>
<div class="sect3">
<h4 id="serviceregistry-auto-registration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serviceregistry-auto-registration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serviceregistry-auto-registration">38.2.1. ServiceRegistry Auto-Registration</a></h4>
<div class="paragraph">
<p>By default, the <code>ServiceRegistry</code> implementation auto-registers the running service.
To disable that behavior, you can set:
* <code>@EnableDiscoveryClient(autoRegister=false)</code> to permanently disable auto-registration.
* <code>spring.cloud.service-registry.auto-registration.enabled=false</code> to disable the behavior through configuration.</p>
</div>
<div class="sect4">
<h5 id="serviceregistry-auto-registration-events"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serviceregistry-auto-registration-events"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serviceregistry-auto-registration-events">ServiceRegistry Auto-Registration Events</a></h5>
<div class="paragraph">
<p>There are two events that will be fired when a service auto-registers. The first event, called
<code>InstancePreRegisteredEvent</code>, is fired before the service is registered. The second
event, called <code>InstanceRegisteredEvent</code>, is fired after the service is registered. You can register an
<code>ApplicationListener</code>(s) to listen to and react to these events.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These events will not be fired if the <code>spring.cloud.service-registry.auto-registration.enabled</code> property is set to <code>false</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="service-registry-actuator-endpoint"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-registry-actuator-endpoint"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-registry-actuator-endpoint">38.2.2. Service Registry Actuator Endpoint</a></h4>
<div class="paragraph">
<p>Spring Cloud Commons provides a <code>/service-registry</code> actuator endpoint.
This endpoint relies on a <code>Registration</code> bean in the Spring Application Context.
Calling <code>/service-registry</code> with GET returns the status of the <code>Registration</code>.
Using POST to the same endpoint with a JSON body changes the status of the current <code>Registration</code> to the new value.
The JSON body has to include the <code>status</code> field with the preferred value.
Please see the documentation of the <code>ServiceRegistry</code> implementation you use for the allowed values when updating the status and the values returned for the status.
For instance, Eureka’s supported statuses are <code>UP</code>, <code>DOWN</code>, <code>OUT_OF_SERVICE</code>, and <code>UNKNOWN</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rest-template-loadbalancer-client"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rest-template-loadbalancer-client"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rest-template-loadbalancer-client">38.3. Spring RestTemplate as a Load Balancer Client</a></h3>
<div class="paragraph">
<p>You can configure a <code>RestTemplate</code> to use a Load-balancer client.
To create a load-balanced <code>RestTemplate</code>, create a <code>RestTemplate</code> <code>@Bean</code> and use the <code>@LoadBalanced</code> qualifier, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfiguration</span> </span>{

    <span class="hljs-meta">@LoadBalanced</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RestTemplate restTemplate;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doOtherStuff</span><span class="hljs-params">()</span> </span>{
        String results = restTemplate.getForObject(<span class="hljs-string">"http://stores/stores"</span>, String.class);
        <span class="hljs-keyword">return</span> results;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
A <code>RestTemplate</code> bean is no longer created through auto-configuration.
Individual applications must create it.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The URI needs to use a virtual host name (that is, a service name, not a host name).
The Ribbon client is used to create a full physical address.
See {githubroot}/spring-cloud-netflix/blob/master/spring-cloud-netflix-ribbon/src/main/java/org/springframework/cloud/netflix/ribbon/RibbonAutoConfiguration.java[<code>RibbonAutoConfiguration</code>] for the details of how the <code>RestTemplate</code> is set up.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To use a load-balanced <code>RestTemplate</code>, you need to have a load-balancer implementation in your classpath.
The recommended implementation is <code>BlockingLoadBalancerClient</code>.
Add <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-loadbalancer-starter">Spring Cloud LoadBalancer starter</a> to your project in order to use it.
The
<code>RibbonLoadBalancerClient</code> also can be used, but it’s now under maintenance and we do not recommend adding it to new projects.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
By default, if you have both <code>RibbonLoadBalancerClient</code> and <code>BlockingLoadBalancerClient</code>, to
preserve backward compatibility, <code>RibbonLoadBalancerClient</code> is used.
To override it, you can set the <code>spring.cloud.loadbalancer.ribbon.enabled</code> property to <code>false</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="webclinet-loadbalancer-client"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#webclinet-loadbalancer-client"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#webclinet-loadbalancer-client">38.4. Spring WebClient as a Load Balancer Client</a></h3>
<div class="paragraph">
<p>You can configure <code>WebClient</code> to automatically use a load-balancer client.
To create a load-balanced <code>WebClient</code>, create a <code>WebClient.Builder</code> <code>@Bean</code> and use the <code>@LoadBalanced</code> qualifier, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfiguration</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@LoadBalanced</span>
    <span class="hljs-keyword">public</span> WebClient.<span class="hljs-function">Builder <span class="hljs-title">loadBalancedWebClientBuilder</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> WebClient.builder();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> WebClient.Builder webClientBuilder;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;String&gt; <span class="hljs-title">doOtherStuff</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> webClientBuilder.build().get().uri(<span class="hljs-string">"http://stores/stores"</span>)
                        .retrieve().bodyToMono(String.class);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The URI needs to use a virtual host name (that is, a service name, not a host name).
The Ribbon client or Spring Cloud LoadBalancer is used to create a full physical address.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you want to use a <code>@LoadBalanced WebClient.Builder</code>, you need to have a load balancer
implementation in the classpath. We recommend that you add the
<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-loadbalancer-starter">Spring Cloud LoadBalancer starter</a> to your project.
Then, <code>ReactiveLoadBalancer</code> is used underneath.
Alternatively, this functionality also works with <code>spring-cloud-starter-netflix-ribbon</code>, but the request
is handled by a non-reactive <code>LoadBalancerClient</code> under the hood. Additionally,
<code>spring-cloud-starter-netflix-ribbon</code> is already in maintenance mode, so we do not recommend
adding it to new projects.
If you have both <code>spring-cloud-starter-loadbalancer</code> and <code>spring-cloud-starter-netflix-ribbon</code>
in your classpath, Ribbon is used by default. To switch to Spring Cloud LoadBalancer,
set the <code>spring.cloud.loadbalancer.ribbon.enabled</code> property to <code>false</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="retrying-failed-requests"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#retrying-failed-requests"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#retrying-failed-requests">38.4.1. Retrying Failed Requests</a></h4>
<div class="paragraph">
<p>A load-balanced <code>RestTemplate</code> can be configured to retry failed requests.
By default, this logic is disabled.
For the non-reactive version (with <code>RestTemplate</code>), you can enable it by adding <a href="https://github.com/spring-projects/spring-retry">Spring Retry</a> to your application’s classpath.</p>
</div>
<div class="paragraph">
<p>To use the reactive version of load-balanced retries in the Hoxton release train, you will need to instantiate your own <code>RetryableLoadBalancerExchangeFilterFunction</code> bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfiguration</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">RetryableLoadBalancerExchangeFilterFunction <span class="hljs-title">retryableLoadBalancerExchangeFilterFunction</span><span class="hljs-params">(
            LoadBalancerRetryProperties properties,
            ReactiveLoadBalancer.Factory&lt;ServiceInstance&gt; factory)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RetryableLoadBalancerExchangeFilterFunction(
                <span class="hljs-keyword">new</span> RetryableExchangeFilterFunctionLoadBalancerRetryPolicy(
                        properties),
                factory, properties);
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can use it as a filter while building <code>webClient</code> instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RetryableLoadBalancerExchangeFilterFunction retryableLbFunction;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;String&gt; <span class="hljs-title">doOtherStuff</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> WebClient.builder().baseUrl(<span class="hljs-string">"http://stores"</span>)
            .filter(retryableLbFunction)
            .build()
            .get()
            .uri(<span class="hljs-string">"/stores"</span>)
            .retrieve()
            .bodyToMono(String.class);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you would like to disable the retry logic with Spring Retry on the classpath, you can set <code>spring.cloud.loadbalancer.retry.enabled=false</code>.</p>
</div>
<div class="paragraph">
<p>For the non-reactive implementation, if you would like to implement a <code>BackOffPolicy</code> in your retries, you need to create a bean of type <code>LoadBalancedRetryFactory</code> and override the <code>createBackOffPolicy()</code> method.</p>
</div>
<div class="paragraph">
<p>For the reactive implementation, you just need to enable it by setting <code>spring.cloud.loadbalancer.retry.backoff.enabled</code> to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>You can set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spring.cloud.loadbalancer.retry.maxRetriesOnSameServiceInstance</code> - indicates how many times a request should be retried on the same <code>ServiceInstance</code> (counted separately for every selected instance)</p>
</li>
<li>
<p><code>spring.cloud.loadbalancer.retry.maxRetriesOnNextServiceInstance</code> - indicates how many times a request should be retried a newly selected <code>ServiceInstance</code></p>
</li>
<li>
<p><code>spring.cloud.loadbalancer.retry.retryableStatusCodes</code> - the status codes on which to always retry a failed request.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the reactive implementation, you can additionally set:
- <code>spring.cloud.loadbalancer.retry.backoff.minBackoff</code> - Sets the minimum backoff duration (by default, 5 milliseconds)
- <code>spring.cloud.loadbalancer.retry.backoff.maxBackoff</code> - Sets the maximum backoff duration (by default, max long value of milliseconds)
- <code>spring.cloud.loadbalancer.retry.backoff.jitter</code> - Sets the jitter used for calculationg the actual backoff duration for each call (by default, 0.5).</p>
</div>
<div class="paragraph">
<p>For the reactive implementation, you can also implement your own <code>LoadBalancerRetryPolicy</code> to have more detailed control over the load-balanced call retries.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">WARN</dt>
<dd>
<p>For the non-reactive version, if you chose to override the <code>LoadBalancedRetryFactory</code> while using the Spring Cloud LoadBalancer-backed approach, make sure you annotate your bean with <code>@Order</code> and set it to a higher precedence than <code>1000</code>, which is the order set on the <code>BlockingLoadBalancedRetryFactory</code>.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="ribbon-based-retries"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ribbon-based-retries"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ribbon-based-retries">Ribbon-based retries</a></h5>
<div class="paragraph">
<p>For the Ribbon-backed implementation, the load-balanced <code>RestTemplate</code> honors some of the Ribbon configuration values related to retrying failed requests.
You can use the <code>client.ribbon.MaxAutoRetries</code>, <code>client.ribbon.MaxAutoRetriesNextServer</code>, and <code>client.ribbon.OkToRetryOnAllOperations</code> properties.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://github.com/Netflix/ribbon/wiki/Getting-Started#the-properties-file-sample-clientproperties">Ribbon documentation</a> for a description of what these properties do.</p>
</div>
</div>
<div class="sect4">
<h5 id="spring-cloud-loadbalancer-based-retries"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-loadbalancer-based-retries"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-loadbalancer-based-retries">Spring Cloud LoadBalancer-based retries</a></h5>
<div class="paragraph">
<p>For the Spring Cloud LoadBalancer-backed implementation, you can set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spring.cloud.loadbalancer.retry.maxRetriesOnSameServiceInstance</code> - indicates how many times a request should be retried on the same <code>ServiceInstance</code> (counted separately for every selected instance)</p>
</li>
<li>
<p><code>spring.cloud.loadbalancer.retry.maxRetriesOnNextServiceInstance</code> - indicates how many times a request should be retried a newly selected <code>ServiceInstance</code></p>
</li>
<li>
<p><code>spring.cloud.loadbalancer.retry.retryableStatusCodes</code> - the status codes on which to always retry a failed request.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">WARN</dt>
<dd>
<p>If you chose to override the <code>LoadBalancedRetryFactory</code> while using the Spring Cloud LoadBalancer-backed approach, make sure you annotate your bean with <code>@Order</code> and set it to a higher precedence than <code>1000</code>, which is the order set on the <code>BlockingLoadBalancedRetryFactory</code>.</p>
</dd>
</dl>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>client</code> in the preceding examples should be replaced with your Ribbon client’s name.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you want to add one or more <code>RetryListener</code> implementations to your retry functionality, you need to
create a bean of type <code>LoadBalancedRetryListenerFactory</code> and return the <code>RetryListener</code> array
you would like to use for a given service, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfiguration</span> </span>{
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">LoadBalancedRetryListenerFactory <span class="hljs-title">retryListenerFactory</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LoadBalancedRetryListenerFactory() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> RetryListener[] createRetryListeners(String service) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RetryListener[]{<span class="hljs-keyword">new</span> RetryListener() {
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> &lt;T, E extends Throwable&gt; <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">open</span><span class="hljs-params">(RetryContext context, RetryCallback&lt;T, E&gt; callback)</span> </span>{
                        <span class="hljs-comment">//TODO Do you business...</span>
                        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
                    }

                    <span class="hljs-meta">@Override</span>
                     <span class="hljs-keyword">public</span> &lt;T, E extends Throwable&gt; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">(RetryContext context, RetryCallback&lt;T, E&gt; callback, Throwable throwable)</span> </span>{
                        <span class="hljs-comment">//TODO Do you business...</span>
                    }

                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> &lt;T, E extends Throwable&gt; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(RetryContext context, RetryCallback&lt;T, E&gt; callback, Throwable throwable)</span> </span>{
                        <span class="hljs-comment">//TODO Do you business...</span>
                    }
                }};
            }
        };
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multiple-resttemplate-objects"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#multiple-resttemplate-objects"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#multiple-resttemplate-objects">38.5. Multiple <code>RestTemplate</code> Objects</a></h3>
<div class="paragraph">
<p>If you want a <code>RestTemplate</code> that is not load-balanced, create a <code>RestTemplate</code> bean and inject it.
To access the load-balanced <code>RestTemplate</code>, use the <code>@LoadBalanced</code> qualifier when you create your <code>@Bean</code>, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfiguration</span> </span>{

    <span class="hljs-meta">@LoadBalanced</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">RestTemplate <span class="hljs-title">loadBalanced</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate();
    }

    <span class="hljs-meta">@Primary</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> </span>{
<span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> RestTemplate restTemplate;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-meta">@LoadBalanced</span>
    <span class="hljs-keyword">private</span> RestTemplate loadBalanced;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doOtherStuff</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> loadBalanced.getForObject(<span class="hljs-string">"http://stores/stores"</span>, String.class);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doStuff</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> restTemplate.getForObject(<span class="hljs-string">"http://example.com"</span>, String.class);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Notice the use of the <code>@Primary</code> annotation on the plain <code>RestTemplate</code> declaration in the preceding example to disambiguate the unqualified <code>@Autowired</code> injection.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you see errors such as <code>java.lang.IllegalArgumentException: Can not set org.springframework.web.client.RestTemplate field com.my.app.Foo.restTemplate to com.sun.proxy.$Proxy89</code>, try injecting <code>RestOperations</code> or setting <code>spring.aop.proxyTargetClass=true</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="multiple-webclient-objects"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#multiple-webclient-objects"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#multiple-webclient-objects">38.6. Multiple WebClient Objects</a></h3>
<div class="paragraph">
<p>If you want a <code>WebClient</code> that is not load-balanced, create a <code>WebClient</code> bean and inject it.
To access the load-balanced <code>WebClient</code>, use the <code>@LoadBalanced</code> qualifier when you create your <code>@Bean</code>, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfiguration</span> </span>{

    <span class="hljs-meta">@LoadBalanced</span>
    <span class="hljs-meta">@Bean</span>
    WebClient.<span class="hljs-function">Builder <span class="hljs-title">loadBalanced</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> WebClient.builder();
    }

    <span class="hljs-meta">@Primary</span>
    <span class="hljs-meta">@Bean</span>
    WebClient.<span class="hljs-function">Builder <span class="hljs-title">webClient</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> WebClient.builder();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> WebClient.Builder webClientBuilder;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-meta">@LoadBalanced</span>
    <span class="hljs-keyword">private</span> WebClient.Builder loadBalanced;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;String&gt; <span class="hljs-title">doOtherStuff</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> loadBalanced.build().get().uri(<span class="hljs-string">"http://stores/stores"</span>)
                        .retrieve().bodyToMono(String.class);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;String&gt; <span class="hljs-title">doStuff</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> webClientBuilder.build().get().uri(<span class="hljs-string">"http://example.com"</span>)
                        .retrieve().bodyToMono(String.class);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="loadbalanced-webclient"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#loadbalanced-webclient"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#loadbalanced-webclient">38.7. Spring WebFlux <code>WebClient</code> as a Load Balancer Client</a></h3>
<div class="paragraph">
<p>The Spring WebFlux can work with both reactive and non-reactive <code>WebClient</code> configurations, as the topics describe:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#webflux-with-reactive-loadbalancer">Spring WebFlux <code>WebClient</code> with <code>ReactorLoadBalancerExchangeFilterFunction</code></a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#load-balancer-exchange-filter-functionload-balancer-exchange-filter-function">[load-balancer-exchange-filter-functionload-balancer-exchange-filter-function]</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="webflux-with-reactive-loadbalancer"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#webflux-with-reactive-loadbalancer"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#webflux-with-reactive-loadbalancer">38.7.1. Spring WebFlux <code>WebClient</code> with <code>ReactorLoadBalancerExchangeFilterFunction</code></a></h4>
<div class="paragraph">
<p>You can configure <code>WebClient</code> to use the <code>ReactiveLoadBalancer</code>.
If you add <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-loadbalancer-starter">Spring Cloud LoadBalancer starter</a> to your project
and if <code>spring-webflux</code> is on the classpath, <code>ReactorLoadBalancerExchangeFilterFunction</code> is auto-configured.
The following example shows how to configure a <code>WebClient</code> to use reactive load-balancer:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReactorLoadBalancerExchangeFilterFunction lbFunction;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;String&gt; <span class="hljs-title">doOtherStuff</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> WebClient.builder().baseUrl(<span class="hljs-string">"http://stores"</span>)
            .filter(lbFunction)
            .build()
            .get()
            .uri(<span class="hljs-string">"/stores"</span>)
            .retrieve()
            .bodyToMono(String.class);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The URI needs to use a virtual host name (that is, a service name, not a host name).
The <code>ReactorLoadBalancer</code> is used to create a full physical address.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, if you have <code>spring-cloud-netflix-ribbon</code> in your classpath, <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#load-balancer-exchange-filter-function"><code>LoadBalancerExchangeFilterFunction</code></a>
is used to maintain backward compatibility. To use
<code>ReactorLoadBalancerExchangeFilterFunction</code>, set the <code>spring.cloud.loadbalancer.ribbon.enabled</code> property
to <code>false</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="load-balancer-exchange-filter-function"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#load-balancer-exchange-filter-function"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#load-balancer-exchange-filter-function">38.7.2. Spring WebFlux <code>WebClient</code> with a Non-reactive Load Balancer Client</a></h4>
<div class="paragraph">
<p>If you you do not have <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-loadbalancer-starter">Spring Cloud LoadBalancer starter</a> in your project
but you do have spring-cloud-starter-netflix-ribbon, you can still use <code>WebClient</code> with <code>LoadBalancerClient</code>.
If <code>spring-webflux</code> is on the classpath, <code>LoadBalancerExchangeFilterFunction</code>
is auto-configured. Note, however, that this
uses a non-reactive client under the hood.
The following example shows how to configure a <code>WebClient</code> to use load-balancer:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LoadBalancerExchangeFilterFunction lbFunction;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;String&gt; <span class="hljs-title">doOtherStuff</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> WebClient.builder().baseUrl(<span class="hljs-string">"http://stores"</span>)
            .filter(lbFunction)
            .build()
            .get()
            .uri(<span class="hljs-string">"/stores"</span>)
            .retrieve()
            .bodyToMono(String.class);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The URI needs to use a virtual host name (that is, a service name, not a host name).
The <code>LoadBalancerClient</code> is used to create a full physical address.</p>
</div>
<div class="paragraph">
<p>WARN: This approach is now deprecated.
We suggest that you use <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#webflux-with-reactive-loadbalancer">WebFlux with reactive Load-Balancer</a>
instead.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ignore-network-interfaces"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ignore-network-interfaces"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ignore-network-interfaces">38.8. Ignore Network Interfaces</a></h3>
<div class="paragraph">
<p>Sometimes, it is useful to ignore certain named network interfaces so that they can be excluded from Service Discovery registration (for example, when running in a Docker container).
A list of regular expressions can be set to cause the desired network interfaces to be ignored.
The following configuration ignores the <code>docker0</code> interface and all interfaces that start with <code>veth</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>spring:
  cloud:
    inetutils:
      ignoredInterfaces:
        - docker0
        - veth.*</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also force the use of only specified network addresses by using a list of regular expressions, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. bootstrap.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>spring:
  cloud:
    inetutils:
      preferredNetworks:
        - 192.168
        - 10.0</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also force the use of only site-local addresses, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>spring:
  cloud:
    inetutils:
      useOnlySiteLocalInterfaces: true</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://docs.oracle.com/javase/8/docs/api/java/net/Inet4Address.html#isSiteLocalAddress--">Inet4Address.html.isSiteLocalAddress()</a> for more details about what constitutes a site-local address.</p>
</div>
</div>
<div class="sect2">
<h3 id="http-clients"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-clients"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-clients">38.9. HTTP Client Factories</a></h3>
<div class="paragraph">
<p>Spring Cloud Commons provides beans for creating both Apache HTTP clients (<code>ApacheHttpClientFactory</code>) and OK HTTP clients (<code>OkHttpClientFactory</code>).
The <code>OkHttpClientFactory</code> bean is created only if the OK HTTP jar is on the classpath.
In addition, Spring Cloud Commons provides beans for creating the connection managers used by both clients: <code>ApacheHttpClientConnectionManagerFactory</code> for the Apache HTTP client and <code>OkHttpClientConnectionPoolFactory</code> for the OK HTTP client.
If you would like to customize how the HTTP clients are created in downstream projects, you can provide your own implementation of these beans.
In addition, if you provide a bean of type <code>HttpClientBuilder</code> or <code>OkHttpClient.Builder</code>, the default factories use these builders as the basis for the builders returned to downstream projects.
You can also disable the creation of these beans by setting <code>spring.cloud.httpclientfactories.apache.enabled</code> or <code>spring.cloud.httpclientfactories.ok.enabled</code> to <code>false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="enabled-features"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enabled-features"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enabled-features">38.10. Enabled Features</a></h3>
<div class="paragraph">
<p>Spring Cloud Commons provides a <code>/features</code> actuator endpoint.
This endpoint returns features available on the classpath and whether they are enabled.
The information returned includes the feature type, name, version, and vendor.</p>
</div>
<div class="sect3">
<h4 id="feature-types"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feature-types"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feature-types">38.10.1. Feature types</a></h4>
<div class="paragraph">
<p>There are two types of 'features': abstract and named.</p>
</div>
<div class="paragraph">
<p>Abstract features are features where an interface or abstract class is defined and that an implementation the creates, such as <code>DiscoveryClient</code>, <code>LoadBalancerClient</code>, or <code>LockService</code>.
The abstract class or interface is used to find a bean of that type in the context.
The version displayed is <code>bean.getClass().getPackage().getImplementationVersion()</code>.</p>
</div>
<div class="paragraph">
<p>Named features are features that do not have a particular class they implement. These features include “Circuit Breaker”, “API Gateway”, “Spring Cloud Bus”, and others. These features require a name and a bean type.</p>
</div>
</div>
<div class="sect3">
<h4 id="declaring-features"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#declaring-features"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#declaring-features">38.10.2. Declaring features</a></h4>
<div class="paragraph">
<p>Any module can declare any number of <code>HasFeature</code> beans, as the following examples show:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> HasFeatures <span class="hljs-title">commonsFeatures</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> HasFeatures.abstractFeatures(DiscoveryClient.class, LoadBalancerClient.class);
}

<span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> HasFeatures <span class="hljs-title">consulFeatures</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> HasFeatures.namedFeatures(
    <span class="hljs-keyword">new</span> NamedFeature(<span class="hljs-string">"Spring Cloud Bus"</span>, ConsulBusAutoConfiguration.class),
    <span class="hljs-keyword">new</span> NamedFeature(<span class="hljs-string">"Circuit Breaker"</span>, HystrixCommandAspect.class));
}

<span class="hljs-meta">@Bean</span>
<span class="hljs-function">HasFeatures <span class="hljs-title">localFeatures</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> HasFeatures.builder()
      .abstractFeature(Something.class)
      .namedFeature(<span class="hljs-keyword">new</span> NamedFeature(<span class="hljs-string">"Some Other Feature"</span>, Someother.class))
      .abstractFeature(Somethingelse.class)
      .build();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Each of these beans should go in an appropriately guarded <code>@Configuration</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-compatibility-verification"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-compatibility-verification"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-compatibility-verification">38.11. Spring Cloud Compatibility Verification</a></h3>
<div class="paragraph">
<p>Due to the fact that some users have problem with setting up Spring Cloud application, we’ve decided
to add a compatibility verification mechanism. It will break if your current setup is not compatible
with Spring Cloud requirements, together with a report, showing what exactly went wrong.</p>
</div>
<div class="paragraph">
<p>At the moment we verify which version of Spring Boot is added to your classpath.</p>
</div>
<div class="paragraph">
<p>Example of a report</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>***************************
APPLICATION FAILED TO START
***************************

Description:

Your project setup is incompatible with our requirements due to following reasons:

- Spring Boot [2.1.0.RELEASE] is not compatible with this Spring Cloud release train


Action:

Consider applying the following actions:

- Change Spring Boot version to one of the following versions [1.2.x, 1.3.x] .
You can find the latest Spring Boot versions here [https://spring.io/projects/spring-boot#learn].
If you want to learn more about the Spring Cloud Release train compatibility, you can visit this page [https://spring.io/projects/spring-cloud#overview] and check the [Release Trains] section.</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In order to disable this feature, set <code>spring.cloud.compatibility-verifier.enabled</code> to <code>false</code>.
If you want to override the compatible Spring Boot versions, just set the
<code>spring.cloud.compatibility-verifier.compatible-boot-versions</code> property with a comma separated list
of compatible Spring Boot versions.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-loadbalancer"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-loadbalancer"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-loadbalancer">39. Spring Cloud LoadBalancer</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud provides its own client-side load-balancer abstraction and implementation. For the load-balancing
mechanism, <code>ReactiveLoadBalancer</code> interface has been added and a <strong>Round-Robin-based</strong> and <strong>Random</strong> implementations
have been provided for it. In order to get instances to select from reactive <code>ServiceInstanceListSupplier</code>
is used. Currently we support a service-discovery-based implementation of <code>ServiceInstanceListSupplier</code>
that retrieves available instances from Service Discovery using a <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discovery-client">Discovery Client</a> available in the classpath.</p>
</div>
<div class="sect2">
<h3 id="switching-between-the-load-balancing-algorithms"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#switching-between-the-load-balancing-algorithms"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#switching-between-the-load-balancing-algorithms">39.1. Switching between the load-balancing algorithms</a></h3>
<div class="paragraph">
<p>The <code>ReactiveLoadBalancer</code> implementation that is used by default is <code>RoundRobinLoadBalancer</code>. To switch to a different implementation, either for selected services or all of them, you can use the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-loadbalancer-configuration">custom LoadBalancer configurations mechanism</a>.</p>
</div>
<div class="paragraph">
<p>For example, the following configuration can be passed via <code>@LoadBalancerClient</code> annotation to switch to using the <code>RandomLoadBalancer</code>:</p>
</div>
<div id="random-loadbalancer-configuration" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomLoadBalancerConfiguration</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">ReactorLoadBalancer&lt;ServiceInstance&gt; <span class="hljs-title">randomLoadBalancer</span><span class="hljs-params">(Environment environment,
            LoadBalancerClientFactory loadBalancerClientFactory)</span> </span>{
        String name = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RandomLoadBalancer(loadBalancerClientFactory
                .getLazyProvider(name, ServiceInstanceListSupplier.class),
                name);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-loadbalancer-integrations"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-loadbalancer-integrations"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-loadbalancer-integrations">39.2. Spring Cloud LoadBalancer integrations</a></h3>
<div class="paragraph">
<p>In order to make it easy to use Spring Cloud LoadBalancer, we provide <code>ReactorLoadBalancerExchangeFilterFunction</code> that can be used with <code>WebClient</code> and <code>BlockingLoadBalancerClient</code> that works with <code>RestTemplate</code>.
You can see more information and examples of usage in the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rest-template-loadbalancer-client">Spring RestTemplate as a Load Balancer Client</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#webclinet-loadbalancer-client">Spring WebClient as a Load Balancer Client</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#webflux-with-reactive-loadbalancer">Spring WebFlux WebClient with <code>ReactorLoadBalancerExchangeFilterFunction</code></a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="loadbalancer-caching"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#loadbalancer-caching"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#loadbalancer-caching">39.3. Spring Cloud LoadBalancer Caching</a></h3>
<div class="paragraph">
<p>Apart from the basic <code>ServiceInstanceListSupplier</code> implementation that retrieves instances via <code>DiscoveryClient</code> each time it has to choose an instance, we provide two caching implementations.</p>
</div>
<div class="sect3">
<h4 id="caffeine-backed-loadbalancer-cache-implementation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#caffeine-backed-loadbalancer-cache-implementation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#caffeine-backed-loadbalancer-cache-implementation">39.3.1. </a><a href="https://github.com/ben-manes/caffeine">Caffeine</a>-backed LoadBalancer Cache Implementation</h4>
<div class="paragraph">
<p>If you have <code>com.github.ben-manes.caffeine:caffeine</code> in the classpath, Caffeine-based implementation will be used.
See the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#loadbalancer-cache-configuration">LoadBalancerCacheConfiguration</a> section for information on how to configure it.</p>
</div>
<div class="paragraph">
<p>If you are using Caffeine, you can also override the default Caffeine Cache setup for the LoadBalancer by passing your own <a href="https://static.javadoc.io/com.github.ben-manes.caffeine/caffeine/2.2.2/com/github/benmanes/caffeine/cache/CaffeineSpec.html">Caffeine Specification</a>
in the <code>spring.cloud.loadbalancer.cache.caffeine.spec</code> property.</p>
</div>
<div class="paragraph">
<p>WARN: Passing your own Caffeine specification will override any other LoadBalancerCache settings, including <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#loadbalancer-cache-configuration">General LoadBalancer Cache Configuration</a> fields, such as <code>ttl</code> and <code>capacity</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="default-loadbalancer-cache-implementation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#default-loadbalancer-cache-implementation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#default-loadbalancer-cache-implementation">39.3.2. Default LoadBalancer Cache Implementation</a></h4>
<div class="paragraph">
<p>If you do not have Caffeine in the classpath, the <code>DefaultLoadBalancerCache</code>, which comes automatically with <code>spring-cloud-starter-loadbalancer</code>, will be used.
See the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#loadbalancer-cache-configuration">LoadBalancerCacheConfiguration</a> section for information on how to configure it.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To use Caffeine instead of the default cache, add the <code>com.github.ben-manes.caffeine:caffeine</code> dependency to classpath.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="loadbalancer-cache-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#loadbalancer-cache-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#loadbalancer-cache-configuration">39.3.3. LoadBalancer Cache Configuration</a></h4>
<div class="paragraph">
<p>You can set your own <code>ttl</code> value (the time after write after which entries should be expired), expressed as <code>Duration</code>, by passing a <code>String</code> compliant with the <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config-conversion-duration">Spring Boot <code>String</code> to <code>Duration</code> converter syntax</a>.
as the value of the <code>spring.cloud.loadbalancer.cache.ttl</code> property.
You can also set your own LoadBalancer cache initial capacity by setting the value of the <code>spring.cloud.loadbalancer.cache.capacity</code> property.</p>
</div>
<div class="paragraph">
<p>The default setup includes <code>ttl</code> set to 35 seconds and the default <code>initialCapacity</code> is <code>256</code>.</p>
</div>
<div class="paragraph">
<p>You can also altogether disable loadBalancer caching by setting the value of <code>spring.cloud.loadbalancer.cache.enabled</code>
to <code>false</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Although the basic, non-cached, implementation is useful for prototyping and testing, it’s much less efficient than the cached versions, so we recommend always using the cached version in production.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="zone-based-load-balancing"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zone-based-load-balancing"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zone-based-load-balancing">39.4. Zone-Based Load-Balancing</a></h3>
<div class="paragraph">
<p>To enable zone-based load-balancing, we provide the <code>ZonePreferenceServiceInstanceListSupplier</code>.
We use <code>DiscoveryClient</code>-specific <code>zone</code> configuration (for example, <code>eureka.instance.metadata-map.zone</code>) to pick the zone that the client tries to filter available service instances for.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also override <code>DiscoveryClient</code>-specific zone setup by setting the value of <code>spring.cloud.loadbalancer.zone</code> property.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
For the time being, only Eureka Discovery Client is instrumented to set the LoadBalancer zone. For other discovery client, set the <code>spring.cloud.loadbalancer.zone</code> property. More instrumentations coming shortly.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To determine the zone of a retrieved <code>ServiceInstance</code>, we check the value under the <code>"zone"</code> key in its metadata map.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>ZonePreferenceServiceInstanceListSupplier</code> filters retrieved instances and only returns the ones within the same zone.
If the zone is <code>null</code> or there are no instances within the same zone, it returns all the retrieved instances.</p>
</div>
<div class="paragraph">
<p>In order to use the zone-based load-balancing approach, you will have to instantiate a <code>ZonePreferenceServiceInstanceListSupplier</code> bean in a <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-loadbalancer-configuration">custom configuration</a>.</p>
</div>
<div class="paragraph">
<p>We use delegates to work with <code>ServiceInstanceListSupplier</code> beans.
We suggest passing a <code>DiscoveryClientServiceInstanceListSupplier</code> delegate in the constructor of <code>ZonePreferenceServiceInstanceListSupplier</code> and, in turn, wrapping the latter with a <code>CachingServiceInstanceListSupplier</code> to leverage <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#loadbalancer-caching">LoadBalancer caching mechanism</a>.</p>
</div>
<div class="paragraph">
<p>You could use this sample configuration to set it up:</p>
</div>
<div id="zoned-based-custom-loadbalancer-configuration" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomLoadBalancerConfiguration</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ServiceInstanceListSupplier <span class="hljs-title">discoveryClientServiceInstanceListSupplier</span><span class="hljs-params">(
            ConfigurableApplicationContext context)</span> </span>{
        <span class="hljs-keyword">return</span> ServiceInstanceListSuppliers.builder()
                    .withDiscoveryClient()
                    .withZonePreference()
                    .withCaching()
                    .build(context);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="instance-health-check-for-loadbalancer"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#instance-health-check-for-loadbalancer"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#instance-health-check-for-loadbalancer">39.5. Instance Health-Check for LoadBalancer</a></h3>
<div class="paragraph">
<p>It is possible to enable a scheduled HealthCheck for the LoadBalancer. The <code>HealthCheckServiceInstanceListSupplier</code>
is provided for that. It regularly verifies if the instances provided by a delegate
<code>ServiceInstanceListSupplier</code> are still alive and only returns the healthy instances,
unless there are none - then it returns all the retrieved instances.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This mechanism is particularly helpful while using the <code>SimpleDiscoveryClient</code>. For the
clients backed by an actual Service Registry, it’s not necessary to use, as we already get
healthy instances after querying the external ServiceDiscovery.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This supplier is also recommended for setups with a small number of instances per service
in order to avoid retrying calls on a failing instance.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If using any of the Service Discovery-backed suppliers, adding this health-check mechanism is usually not necessary, as we retrieve the health state of the instances directly
from the Service Registry.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>HealthCheckServiceInstanceListSupplier</code> relies on having updated instances provided by a delegate flux. In the rare cases when you want to use a delegate that does not refresh the instances, even though the list of instances may change (such as the <code>ReactiveDiscoveryClientServiceInstanceListSupplier</code> provided by us), you can set <code>spring.cloud.loadbalancer.health-check.refetch-instances</code> to <code>true</code> to have the instance list refreshed by the <code>HealthCheckServiceInstanceListSupplier</code>. You can then also adjust the refretch intervals by modifying the value of <code>spring.cloud.loadbalancer.health-check.refetch-instances-interval</code> and opt to disable the additional healthcheck repetitions by setting <code>spring.cloud.loadbalancer.repeat-health-check</code> to <code>fasle</code> as every instances refetch
will also trigger a healthcheck.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><code>HealthCheckServiceInstanceListSupplier</code> uses properties prefixed with
<code>spring.cloud.loadbalancer.health-check</code>. You can set the <code>initialDelay</code> and <code>interval</code>
for the scheduler. You can set the default path for the healthcheck URL by setting
the value of the <code>spring.cloud.loadbalancer.health-check.path.default</code>. You can also set a specific value
for any given service by setting the value of the <code>spring.cloud.loadbalancer.health-check.path.[SERVICE_ID]</code>, substituting the <code>[SERVICE_ID]</code> with the correct ID of your service. If the path is not set, <code>/actuator/health</code> is used by default.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you rely on the default path (<code>/actuator/health</code>), make sure you add <code>spring-boot-starter-actuator</code> to your collaborator’s dependencies, unless you are planning to add such an endpoint on your own.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In order to use the health-check scheduler approach, you will have to instantiate a <code>HealthCheckServiceInstanceListSupplier</code> bean in a <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-loadbalancer-configuration">custom configuration</a>.</p>
</div>
<div class="paragraph">
<p>We use delegates to work with <code>ServiceInstanceListSupplier</code> beans.
We suggest passing a <code>DiscoveryClientServiceInstanceListSupplier</code> delegate in the constructor of <code>HealthCheckServiceInstanceListSupplier</code>.</p>
</div>
<div class="paragraph">
<p>You could use this sample configuration to set it up:</p>
</div>
<div id="health-check-based-custom-loadbalancer-configuration" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomLoadBalancerConfiguration</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ServiceInstanceListSupplier <span class="hljs-title">discoveryClientServiceInstanceListSupplier</span><span class="hljs-params">(
            ConfigurableApplicationContext context)</span> </span>{
        <span class="hljs-keyword">return</span> ServiceInstanceListSupplier.builder()
                    .withDiscoveryClient()
                    .withHealthChecks()
                    .build(context);
        }
    }</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>HealthCheckServiceInstanceListSupplier</code> has its own caching mechanism based on Reactor Flux <code>replay()</code>. Therefore, if it’s being used, you may want to skip wrapping that supplier with <code>CachingServiceInstanceListSupplier</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="same-instance-preference-for-loadbalancer"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#same-instance-preference-for-loadbalancer"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#same-instance-preference-for-loadbalancer">39.6. Same instance preference for LoadBalancer</a></h3>
<div class="paragraph">
<p>You can set up the LoadBalancer in such a way that it prefers the instance that was previously selected, if that instance is available.</p>
</div>
<div class="paragraph">
<p>For that, you need to use <code>SameInstancePreferenceServiceInstanceListSupplier</code>. You can configure it either by setting the value of <code>spring.cloud.loadbalancer.configurations</code> to <code>same-instance-preference</code> or by providing your own <code>ServiceInstanceListSupplier</code> bean — for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomLoadBalancerConfiguration</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ServiceInstanceListSupplier <span class="hljs-title">discoveryClientServiceInstanceListSupplier</span><span class="hljs-params">(
            ConfigurableApplicationContext context)</span> </span>{
        <span class="hljs-keyword">return</span> ServiceInstanceListSupplier.builder()
                    .withDiscoveryClient()
                    .withSameInstancePreference()
                    .build(context);
        }
    }</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is also a replacement for Zookeeper <code>StickyRule</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-loadbalancer-starter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-loadbalancer-starter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-loadbalancer-starter">39.7. Spring Cloud LoadBalancer Starter</a></h3>
<div class="paragraph">
<p>We also provide a starter that allows you to easily add Spring Cloud LoadBalancer in a Spring Boot app.
In order to use it, just add <code>org.springframework.cloud:spring-cloud-starter-loadbalancer</code> to your Spring Cloud dependencies in your build file.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Cloud LoadBalancer starter includes
<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-caching.html">Spring Boot Caching</a>
and <a href="https://github.com/stoyanr/Evictor">Evictor</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you have both Ribbon and Spring Cloud LoadBalancer int the classpath, in order to maintain backward compatibility, Ribbon-based implementations will be used by default.
In order to switch to using Spring Cloud LoadBalancer under the hood, make sure you set the property <code>spring.cloud.loadbalancer.ribbon.enabled</code> to <code>false</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="custom-loadbalancer-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-loadbalancer-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-loadbalancer-configuration">39.8. Passing Your Own Spring Cloud LoadBalancer Configuration</a></h3>
<div class="paragraph">
<p>You can also use the <code>@LoadBalancerClient</code> annotation to pass your own load-balancer client configuration, passing the name of the load-balancer client and the configuration class, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@LoadBalancerClient</span>(value = <span class="hljs-string">"stores"</span>, configuration = CustomLoadBalancerConfiguration.class)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfiguration</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@LoadBalanced</span>
    <span class="hljs-keyword">public</span> WebClient.<span class="hljs-function">Builder <span class="hljs-title">loadBalancedWebClientBuilder</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> WebClient.builder();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TIP</dt>
<dd>
<p>In order to make working on your own LoadBalancer configuration easier, we have added a <code>builder()</code> method to the <code>ServiceInstanceListSupplier</code> class.</p>
</dd>
<dt class="hdlist1">TIP</dt>
<dd>
<p>You can also use our alternative predefined configurations in place of the default ones by setting the value of <code>spring.cloud.loadbalancer.configurations</code> property to <code>zone-preference</code> to use <code>ZonePreferenceServiceInstanceListSupplier</code> with caching or to <code>health-check</code> to use <code>HealthCheckServiceInstanceListSupplier</code> with caching.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use this feature to instantiate different implementations of <code>ServiceInstanceListSupplier</code> or <code>ReactorLoadBalancer</code>, either written by you, or provided by us as alternatives (for example <code>ZonePreferenceServiceInstanceListSupplier</code>) to override the default setup.</p>
</div>
<div class="paragraph">
<p>You can see an example of a custom configuration <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zoned-based-custom-loadbalancer-configuration">here</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The annotation <code>value</code> arguments (<code>stores</code> in the example above) specifies the service id of the service that we should send the requests to with the given custom configuration.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can also pass multiple configurations (for more than one load-balancer client) through the <code>@LoadBalancerClients</code> annotation, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@LoadBalancerClients</span>({<span class="hljs-meta">@LoadBalancerClient</span>(value = <span class="hljs-string">"stores"</span>, configuration = StoresLoadBalancerClientConfiguration.class), <span class="hljs-meta">@LoadBalancerClient</span>(value = <span class="hljs-string">"customers"</span>, configuration = CustomersLoadBalancerClientConfiguration.class)})
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfiguration</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@LoadBalanced</span>
    <span class="hljs-keyword">public</span> WebClient.<span class="hljs-function">Builder <span class="hljs-title">loadBalancedWebClientBuilder</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> WebClient.builder();
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-circuit-breaker-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-circuit-breaker-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-circuit-breaker-2">40. Spring Cloud Circuit Breaker</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#introduction"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#introduction">40.1. Introduction</a></h3>
<div class="paragraph">
<p>Spring Cloud Circuit breaker provides an abstraction across different circuit breaker implementations.
It provides a consistent API to use in your applications, letting you, the developer, choose the circuit breaker implementation that best fits your needs for your application.</p>
</div>
<div class="sect3">
<h4 id="supported-implementations"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#supported-implementations"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#supported-implementations">40.1.1. Supported Implementations</a></h4>
<div class="paragraph">
<p>Spring Cloud supports the following circuit-breaker implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/Netflix/Hystrix">Netflix Hystrix</a></p>
</li>
<li>
<p><a href="https://github.com/resilience4j/resilience4j">Resilience4J</a></p>
</li>
<li>
<p><a href="https://github.com/alibaba/Sentinel">Sentinel</a></p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-retry">Spring Retry</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="core-concepts"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#core-concepts"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#core-concepts">40.2. Core Concepts</a></h3>
<div class="paragraph">
<p>To create a circuit breaker in your code, you can use the <code>CircuitBreakerFactory</code> API. When you include a Spring Cloud Circuit Breaker starter on your classpath, a bean that implements this API is automatically created for you.
The following example shows a simple example of how to use this API:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DemoControllerService</span> </span>{
    <span class="hljs-keyword">private</span> RestTemplate rest;
    <span class="hljs-keyword">private</span> CircuitBreakerFactory cbFactory;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DemoControllerService</span><span class="hljs-params">(RestTemplate rest, CircuitBreakerFactory cbFactory)</span> </span>{
        <span class="hljs-keyword">this</span>.rest = rest;
        <span class="hljs-keyword">this</span>.cbFactory = cbFactory;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">slow</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> cbFactory.create(<span class="hljs-string">"slow"</span>).run(() -&gt; rest.getForObject(<span class="hljs-string">"/slow"</span>, String.class), throwable -&gt; <span class="hljs-string">"fallback"</span>);
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>CircuitBreakerFactory.create</code> API creates an instance of a class called <code>CircuitBreaker</code>.
The <code>run</code> method takes a <code>Supplier</code> and a <code>Function</code>.
The <code>Supplier</code> is the code that you are going to wrap in a circuit breaker.
The <code>Function</code> is the fallback that is executed if the circuit breaker is tripped.
The function is passed the <code>Throwable</code> that caused the fallback to be triggered.
You can optionally exclude the fallback if you do not want to provide one.</p>
</div>
<div class="sect3">
<h4 id="circuit-breakers-in-reactive-code"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#circuit-breakers-in-reactive-code"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#circuit-breakers-in-reactive-code">40.2.1. Circuit Breakers In Reactive Code</a></h4>
<div class="paragraph">
<p>If Project Reactor is on the class path, you can also use <code>ReactiveCircuitBreakerFactory</code> for your reactive code.
The following example shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DemoControllerService</span> </span>{
    <span class="hljs-keyword">private</span> ReactiveCircuitBreakerFactory cbFactory;
    <span class="hljs-keyword">private</span> WebClient webClient;


    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DemoControllerService</span><span class="hljs-params">(WebClient webClient, ReactiveCircuitBreakerFactory cbFactory)</span> </span>{
        <span class="hljs-keyword">this</span>.webClient = webClient;
        <span class="hljs-keyword">this</span>.cbFactory = cbFactory;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;String&gt; <span class="hljs-title">slow</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> webClient.get().uri(<span class="hljs-string">"/slow"</span>).retrieve().bodyToMono(String.class).transform(
        it -&gt; cbFactory.create(<span class="hljs-string">"slow"</span>).run(it, throwable -&gt; <span class="hljs-keyword">return</span> Mono.just(<span class="hljs-string">"fallback"</span>)));
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>ReactiveCircuitBreakerFactory.create</code> API creates an instance of a class called <code>ReactiveCircuitBreaker</code>.
The <code>run</code> method takes a <code>Mono</code> or a <code>Flux</code> and wraps it in a circuit breaker.
You can optionally profile a fallback <code>Function</code>, which will be called if the circuit breaker is tripped and is passed the <code>Throwable</code>
that caused the failure.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-2">40.3. Configuration</a></h3>
<div class="paragraph">
<p>You can configure your circuit breakers by creating beans of type <code>Customizer</code>.
The <code>Customizer</code> interface has a single method (called <code>customize</code>) that takes the <code>Object</code> to customize.</p>
</div>
<div class="paragraph">
<p>For detailed information on how to customize a given implementation see
the following documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-cloud/spring-cloud-netflix/current/reference/html/#circuit-breaker-spring-cloud-circuit-breaker-with-hystrix">Hystrix</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/spring-cloud-circuitbreaker/current/reference/html/spring-cloud-circuitbreaker.html#configuring-resilience4j-circuit-breakers">Resilience4J</a></p>
</li>
<li>
<p><a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-docs/src/main/asciidoc/circuitbreaker-sentinel.adoc#circuit-breaker-spring-cloud-circuit-breaker-with-sentinel%E2%80%94%E2%80%8Bconfiguring-sentinel-circuit-breakers">Sentinal</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/spring-cloud-circuitbreaker/current/reference/html/spring-cloud-circuitbreaker.html#configuring-spring-retry-circuit-breakers">Spring Retry</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some <code>CircuitBreaker</code> implementations such as <code>Resilience4JCircuitBreaker</code> call <code>customize</code> method every time <code>CircuitBreaker#run</code> is called.
It can be inefficient. In that case, you can use <code>CircuitBreaker#once</code> method. It is useful where calling <code>customize</code> many times doesn’t make sense,
for example, in case of <a href="https://resilience4j.readme.io/docs/circuitbreaker#section-consume-emitted-circuitbreakerevents">consuming Resilience4j’s events</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows the way for each <code>io.github.resilience4j.circuitbreaker.CircuitBreaker</code> to consume events.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Customizer.once(circuitBreaker -&gt; {
  circuitBreaker.getEventPublisher()
    .onStateTransition(event -&gt; log.info(<span class="hljs-string">"{}: {}"</span>, event.getCircuitBreakerName(), event.getStateTransition()));
}, CircuitBreaker::getName)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cachedrandompropertysource"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cachedrandompropertysource"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cachedrandompropertysource">41. CachedRandomPropertySource</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Context provides a <code>PropertySource</code> that caches random values based on a key. Outside of the caching
functionality it works the same as Spring Boot’s <a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/env/RandomValuePropertySource.java"><code>RandomValuePropertySource</code></a>.
This random value might be useful in the case where you want a random value that is consistent even after the Spring Application
context restarts. The property value takes the form of <code>cachedrandom.[yourkey].[type]</code> where <code>yourkey</code> is the key in the cache. The <code>type</code> value can
be any type supported by Spring Boot’s <code>RandomValuePropertySource</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"><span class="hljs-attr">myrandom</span>=<span class="hljs-string">${cachedrandom.appname.value}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-properties-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-3">42. Configuration Properties</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To see the list of all Spring Cloud Commons related configuration properties please check <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/appendix.html">the Appendix page</a>.</p>
</div>
</div>
</div>
<h1 id="spring-cloud-config" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config">Spring Cloud Config</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><strong>Hoxton.SR10</strong></p>
</div>
<div class="paragraph">
<p>Spring Cloud Config provides server-side and client-side support for externalized configuration in a distributed system. With the Config Server, you have a central place to manage external properties for applications across all environments.
The concepts on both client and server map identically to the Spring <code>Environment</code> and <code>PropertySource</code> abstractions, so they fit very well with Spring applications but can be used with any application running in any language.
As an application moves through the deployment pipeline from dev to test and into production, you can manage the configuration between those environments and be certain that applications have everything they need to run when they migrate.
The default implementation of the server storage backend uses git, so it easily supports labelled versions of configuration environments as well as being accessible to a wide range of tooling for managing the content.
It is easy to add alternative implementations and plug them in with Spring configuration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quick-start-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quick-start-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quick-start-2">43. Quick Start</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This quick start walks through using both the server and the client of Spring Cloud Config Server.</p>
</div>
<div class="paragraph">
<p>First, start the server, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cd spring-cloud-config-server
$ ../mvnw spring-boot:run</pre>
</div>
</div>
<div class="paragraph">
<p>The server is a Spring Boot application, so you can run it from your IDE if you prefer to do so (the main class is <code>ConfigServerApplication</code>).</p>
</div>
<div class="paragraph">
<p>Next try out a client, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl localhost:8888/foo/development
{"name":"foo","label":"master","propertySources":[
  {"name":"https://github.com/scratches/config-repo/foo-development.properties","source":{"bar":"spam"}},
  {"name":"https://github.com/scratches/config-repo/foo.properties","source":{"foo":"bar"}}
]}</pre>
</div>
</div>
<div class="paragraph">
<p>The default strategy for locating property sources is to clone a git repository (at <code>spring.cloud.config.server.git.uri</code>) and use it to initialize a mini <code>SpringApplication</code>.
The mini-application’s <code>Environment</code> is used to enumerate property sources and publish them at a JSON endpoint.</p>
</div>
<div class="paragraph">
<p>The HTTP service has resources in the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/{application}/{profile}[/{label}]
/{application}-{profile}.yml
/{label}/{application}-{profile}.yml
/{application}-{profile}.properties
/{label}/{application}-{profile}.properties</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>application</code> is injected as the <code>spring.config.name</code> in the <code>SpringApplication</code> (what is normally <code>application</code> in a regular Spring Boot app), <code>profile</code> is an active profile (or comma-separated list of properties), and <code>label</code> is an optional git label (defaults to <code>master</code>.)</p>
</div>
<div class="paragraph">
<p>Spring Cloud Config Server pulls configuration for remote clients from various sources. The following example gets configuration from a git repository (which must be provided), as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/spring-cloud-samples/config-repo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other sources are any JDBC compatible database, Subversion, Hashicorp Vault, Credhub and local filesystems.</p>
</div>
<div class="sect2">
<h3 id="client-side-usage"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#client-side-usage"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#client-side-usage">43.1. Client Side Usage</a></h3>
<div class="paragraph">
<p>To use these features in an application, you can build it as a Spring Boot application that depends on spring-cloud-config-client (for an example, see the test cases for the config-client or the sample application).
The most convenient way to add the dependency is with a Spring Boot starter <code>org.springframework.cloud:spring-cloud-starter-config</code>.
There is also a parent pom and BOM (<code>spring-cloud-starter-parent</code>) for Maven users and a Spring IO version management properties file for Gradle and Spring CLI users. The following example shows a typical Maven configuration:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>{spring-boot-docs-version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span> /&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>{spring-cloud-version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>

<span class="hljs-comment">&lt;!-- repositories also needed for snapshots and milestones --&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can create a standard Spring Boot application, such as the following HTTP server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@SpringBootApplication
@RestController
public class Application {

    @RequestMapping("/")
    public String home() {
        return "Hello World!";
    }

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }

}</pre>
</div>
</div>
<div class="paragraph">
<p>When this HTTP server runs, it picks up the external configuration from the default local config server (if it is running) on port 8888.
To modify the startup behavior, you can change the location of the config server by using <code>bootstrap.properties</code> (similar to <code>application.properties</code> but for the bootstrap phase of an application context), as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.cloud.config.uri: http://myconfigserver.com</pre>
</div>
</div>
<div class="paragraph">
<p>By default, if no application name is set, <code>application</code> will be used. To modify the name, the following property can be added to the <code>bootstrap.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.application.name: myapp</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When setting the property <code>${spring.application.name}</code> do not prefix your app name with the reserved word <code>application-</code> to prevent issues resolving the correct property source.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The bootstrap properties show up in the <code>/env</code> endpoint as a high-priority property source, as shown in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl localhost:8080/env
{
  "profiles":[],
  "configService:https://github.com/spring-cloud-samples/config-repo/bar.properties":{"foo":"bar"},
  "servletContextInitParams":{},
  "systemProperties":{...},
  ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>A property source called <code>configService:&lt;URL of remote repository&gt;/&lt;file name&gt;</code> contains the <code>foo</code> property with a value of <code>bar</code> and is the highest priority.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The URL in the property source name is the git repository, not the config server URL.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-config-server"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-server"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-server">44. Spring Cloud Config Server</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Config Server provides an HTTP resource-based API for external configuration (name-value pairs or equivalent YAML content).
The server is embeddable in a Spring Boot application, by using the <code>@EnableConfigServer</code> annotation.
Consequently, the following application is a config server:</p>
</div>
<div class="listingblock">
<div class="title">ConfigServer.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableConfigServer</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConfigServer</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
    SpringApplication.run(ConfigServer.class, args);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Like all Spring Boot applications, it runs on port 8080 by default, but you can switch it to the more conventional port 8888 in various ways.
The easiest, which also sets a default configuration repository, is by launching it with <code>spring.config.name=configserver</code> (there is a <code>configserver.yml</code> in the Config Server jar).
Another is to use your own <code>application.properties</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"><span class="hljs-meta">server.port</span>: <span class="hljs-string">8888</span>
<span class="hljs-meta">spring.cloud.config.server.git.uri</span>: <span class="hljs-string">file://${user.home}/config-repo</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>${user.home}/config-repo</code> is a git repository containing YAML and properties files.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
On Windows, you need an extra "/" in the file URL if it is absolute with a drive prefix (for example,<code><a href="file:///$%7Buser.home%7D/config-repo" class="bare">/${user.home}/config-repo</a></code>).
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following listing shows a recipe for creating the git repository in the preceding example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cd $HOME
$ mkdir config-repo
$ cd config-repo
$ git init .
$ echo info.foo: bar &gt; application.properties
$ git add -A .
$ git commit -m "Add application.properties"</pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Using the local filesystem for your git repository is intended for testing only.
You should use a server to host your configuration repositories in production.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The initial clone of your configuration repository can be quick and efficient if you keep only text files in it.
If you store binary files, especially large ones, you may experience delays on the first request for configuration or encounter out of memory errors in the server.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="environment-repository"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#environment-repository"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#environment-repository">44.1. Environment Repository</a></h3>
<div class="paragraph">
<p>Where should you store the configuration data for the Config Server?
The strategy that governs this behaviour is the <code>EnvironmentRepository</code>, serving <code>Environment</code> objects.
This <code>Environment</code> is a shallow copy of the domain from the Spring <code>Environment</code> (including <code>propertySources</code> as the main feature).
The <code>Environment</code> resources are parametrized by three variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>{application}</code>, which maps to <code>spring.application.name</code> on the client side.</p>
</li>
<li>
<p><code>{profile}</code>, which maps to <code>spring.profiles.active</code> on the client (comma-separated list).</p>
</li>
<li>
<p><code>{label}</code>, which is a server side feature labelling a "versioned" set of config files.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Repository implementations generally behave like a Spring Boot application, loading configuration files from a <code>spring.config.name</code> equal to the <code>{application}</code> parameter, and <code>spring.profiles.active</code> equal to the <code>{profiles}</code> parameter.
Precedence rules for profiles are also the same as in a regular Spring Boot application: Active profiles take precedence over defaults, and, if there are multiple profiles, the last one wins (similar to adding entries to a <code>Map</code>).</p>
</div>
<div class="paragraph">
<p>The following sample client application has this bootstrap configuration:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  application:
    name: foo
  profiles:
    active: dev,mysql</code></pre>
</div>
</div>
<div class="paragraph">
<p>(As usual with a Spring Boot application, these properties could also be set by environment variables or command line arguments).</p>
</div>
<div class="paragraph">
<p>If the repository is file-based, the server creates an
<code>Environment</code> from <code>application.yml</code> (shared between all clients) and
<code>foo.yml</code> (with <code>foo.yml</code> taking precedence).
If the YAML files have documents inside them that point to Spring profiles, those are applied with higher precedence (in order of the profiles listed).
If there are profile-specific YAML (or properties) files, these are also applied with higher precedence than the defaults.
Higher precedence translates to a <code>PropertySource</code> listed earlier in the <code>Environment</code>.
(These same rules apply in a standalone Spring Boot application.)</p>
</div>
<div class="paragraph">
<p>You can set spring.cloud.config.server.accept-empty to false so that Server would return a HTTP 404 status, if the application is not found.By default, this flag is set to true.</p>
</div>
<div class="sect3">
<h4 id="git-backend"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#git-backend"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#git-backend">44.1.1. Git Backend</a></h4>
<div class="paragraph">
<p>The default implementation of <code>EnvironmentRepository</code> uses a Git backend, which is very convenient for managing upgrades and physical environments and for auditing changes.
To change the location of the repository, you can set the <code>spring.cloud.config.server.git.uri</code> configuration property in the Config Server (for example in <code>application.yml</code>).
If you set it with a <code>file:</code> prefix, it should work from a local repository so that you can get started quickly and easily without a server. However, in that case, the server operates directly on the local repository without cloning it (it does not matter if it is not bare because the Config Server never makes changes to the "remote" repository).
To scale the Config Server up and make it highly available, you need to have all instances of the server pointing to the same repository, so only a shared file system would work.
Even in that case, it is better to use the <code>ssh:</code> protocol for a shared filesystem repository, so that the server can clone it and use a local working copy as a cache.</p>
</div>
<div class="paragraph">
<p>This repository implementation maps the <code>{label}</code> parameter of the HTTP resource to a git label (commit id, branch name, or tag).
If the git branch or tag name contains a slash (<code>/</code>), then the label in the HTTP URL should instead be specified with the special string <code>(_)</code> (to avoid ambiguity with other URL paths).
For example, if the label is <code>foo/bar</code>, replacing the slash would result in the following label: <code>foo(_)bar</code>.
The inclusion of the special string <code>(_)</code> can also be applied to the <code>{application}</code> parameter.
If you use a command-line client such as curl, be careful with the brackets in the URL — you should escape them from the shell with single quotes ('').</p>
</div>
<div class="sect4">
<h5 id="skipping-ssl-certificate-validation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#skipping-ssl-certificate-validation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#skipping-ssl-certificate-validation">Skipping SSL Certificate Validation</a></h5>
<div class="paragraph">
<p>The configuration server’s validation of the Git server’s SSL certificate can be disabled by setting the <code>git.skipSslValidation</code> property to <code>true</code> (default is <code>false</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://example.com/my/repo
          skipSslValidation: true</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="setting-http-connection-timeout"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#setting-http-connection-timeout"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#setting-http-connection-timeout">Setting HTTP Connection Timeout</a></h5>
<div class="paragraph">
<p>You can configure the time, in seconds, that the configuration server will wait to acquire an HTTP connection. Use the <code>git.timeout</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://example.com/my/repo
          timeout: 4</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="placeholders-in-git-uri"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#placeholders-in-git-uri"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#placeholders-in-git-uri">Placeholders in Git URI</a></h5>
<div class="paragraph">
<p>Spring Cloud Config Server supports a git repository URL with placeholders for the <code>{application}</code> and <code>{profile}</code> (and <code>{label}</code> if you need it, but remember that the label is applied as a git label anyway).
So you can support a “one repository per application” policy by using a structure similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/myorg/{application}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also support a “one repository per profile” policy by using a similar pattern but with
<code>{profile}</code>.</p>
</div>
<div class="paragraph">
<p>Additionally, using the special string "(_)" within your <code>{application}</code> parameters can enable support for multiple
organizations, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/{application}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>{application}</code> is provided at request time in the following format: <code>organization(_)application</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="pattern-matching-and-multiple-repositories"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pattern-matching-and-multiple-repositories"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pattern-matching-and-multiple-repositories">Pattern Matching and Multiple Repositories</a></h5>
<div class="paragraph">
<p>Spring Cloud Config also includes support for more complex requirements with pattern
matching on the application and profile name.
The pattern format is a comma-separated list of <code>{application}/{profile}</code> names with wildcards (note that a pattern beginning with a wildcard may need to be quoted), as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/spring-cloud-samples/config-repo
          repos:
            simple: https://github.com/simple/config-repo
            special:
              pattern: special*/dev*,*special*/dev*
              uri: https://github.com/special/config-repo
            local:
              pattern: local*
              uri: file:/home/configsvc/config-repo</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>{application}/{profile}</code> does not match any of the patterns, it uses the default URI defined under <code>spring.cloud.config.server.git.uri</code>.
In the above example, for the “simple” repository, the pattern is <code>simple/*</code> (it only matches one application named <code>simple</code> in all profiles). The “local” repository matches all application names beginning with <code>local</code> in all profiles (the <code>/*</code> suffix is added automatically to any pattern that does not have a profile matcher).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The “one-liner” short cut used in the “simple” example can be used only if the only property to be set is the URI.
If you need to set anything else (credentials, pattern, and so on) you need to use the full form.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>pattern</code> property in the repo is actually an array, so you can use a YAML array (or <code>[0]</code>, <code>[1]</code>, etc. suffixes in properties files) to bind to multiple patterns.
You may need to do so if you are going to run apps with multiple profiles, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/spring-cloud-samples/config-repo
          repos:
            development:
              pattern:
                - '*/development'
                - '*/staging'
              uri: https://github.com/development/config-repo
            staging:
              pattern:
                - '*/qa'
                - '*/production'
              uri: https://github.com/staging/config-repo</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Cloud guesses that a pattern containing a profile that does not end in <code>*</code> implies that you actually want to match a list of profiles starting with this pattern (so <code>*/staging</code> is a shortcut for <code>["*/staging", "*/staging,*"]</code>, and so on).
This is common where, for instance, you need to run applications in the “development” profile locally but also the “cloud” profile remotely.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Every repository can also optionally store config files in sub-directories, and patterns to search for those directories can be specified as <code>searchPaths</code>.
The following example shows a config file at the top level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/spring-cloud-samples/config-repo
          searchPaths: foo,bar*</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the server searches for config files in the top level and in the <code>foo/</code> sub-directory and also any sub-directory whose name begins with <code>bar</code>.</p>
</div>
<div class="paragraph">
<p>By default, the server clones remote repositories when configuration
is first requested.
The server can be configured to clone the repositories at startup, as shown in the following top-level example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://git/common/config-repo.git
          repos:
            team-a:
                pattern: team-a-*
                cloneOnStart: true
                uri: https://git/team-a/config-repo.git
            team-b:
                pattern: team-b-*
                cloneOnStart: false
                uri: https://git/team-b/config-repo.git
            team-c:
                pattern: team-c-*
                uri: https://git/team-a/config-repo.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the server clones team-a’s config-repo on startup, before it
accepts any requests.
All other repositories are not cloned until configuration from the repository is requested.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Setting a repository to be cloned when the Config Server starts up can help to identify a misconfigured configuration source (such as an invalid repository URI) quickly, while the Config Server is starting up.
With <code>cloneOnStart</code> not enabled for a configuration source, the Config Server may start successfully with a misconfigured or invalid configuration source and not detect an error until an application requests configuration from that configuration source.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="authentication"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#authentication"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#authentication">Authentication</a></h5>
<div class="paragraph">
<p>To use HTTP basic authentication on the remote repository, add the <code>username</code> and <code>password</code> properties separately (not in the URL), as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/spring-cloud-samples/config-repo
          username: trolley
          password: strongpassword</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you do not use HTTPS and user credentials, SSH should also work out of the box when you store keys in the default directories (<code>~/.ssh</code>) and the URI points to an SSH location, such as <code>git@github.com:configuration/cloud-configuration</code>.
It is important that an entry for the Git server be present in the <code>~/.ssh/known_hosts</code> file and that it is in <code>ssh-rsa</code> format.
Other formats (such as <code>ecdsa-sha2-nistp256</code>) are not supported.
To avoid surprises, you should ensure that only one entry is present in the <code>known_hosts</code> file for the Git server and that it matches the URL you provided to the config server.
If you use a hostname in the URL, you want to have exactly that (not the IP) in the <code>known_hosts</code> file.
The repository is accessed by using JGit, so any documentation you find on that should be applicable.
HTTPS proxy settings can be set in <code>~/.git/config</code> or (in the same way as for any other JVM process) with
system properties (<code>-Dhttps.proxyHost</code> and <code>-Dhttps.proxyPort</code>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you do not know where your <code>~/.git</code> directory is, use <code>git config --global</code> to manipulate the settings (for example, <code>git config --global http.sslVerify false</code>).
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>JGit requires RSA keys in PEM format. Below is an example ssh-keygen (from openssh) command that will generate a key in the corect format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ssh-keygen -m PEM -t rsa -b 4096 -f ~/config_server_deploy_key.rsa</code></pre>
</div>
</div>
<div class="paragraph">
<p>Warning: When working with SSH keys, the expected ssh private-key must begin with <code><code>-----BEGIN RSA PRIVATE KEY-----</code></code>. If the key starts with <code><code>-----BEGIN OPENSSH PRIVATE KEY-----</code></code> then the RSA key will not load when spring-cloud-config server is started. The error looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs kotlin">- Error <span class="hljs-keyword">in</span> <span class="hljs-keyword">object</span> <span class="hljs-string">'spring.cloud.config.server.git'</span>: codes [PrivateKeyIsValid.spring.cloud.config.server.git,PrivateKeyIsValid]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [spring.cloud.config.server.git.,]; arguments []; <span class="hljs-keyword">default</span> message []]; <span class="hljs-keyword">default</span> message [Property <span class="hljs-string">'spring.cloud.config.server.git.privateKey'</span> <span class="hljs-keyword">is</span> not a valid <span class="hljs-keyword">private</span> key]</code></pre>
</div>
</div>
<div class="paragraph">
<p>To correct the above error the RSA key must be converted to PEM format. An example using openssh is provided above for generating a new key in the appropriate format.</p>
</div>
</div>
<div class="sect4">
<h5 id="authentication-with-aws-codecommit"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#authentication-with-aws-codecommit"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#authentication-with-aws-codecommit">Authentication with AWS CodeCommit</a></h5>
<div class="paragraph">
<p>Spring Cloud Config Server also supports <a href="https://docs.aws.amazon.com/codecommit/latest/userguide/welcome.html">AWS CodeCommit</a> authentication.
AWS CodeCommit uses an authentication helper when using Git from the command line.
This helper is not used with the JGit library, so a JGit CredentialProvider for AWS CodeCommit is created if the Git URI matches the AWS CodeCommit pattern.
AWS CodeCommit URIs follow this pattern://git-codecommit.${AWS_REGION}.amazonaws.com/${repopath}.</p>
</div>
<div class="paragraph">
<p>If you provide a username and password with an AWS CodeCommit URI, they must be the <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSGettingStartedGuide/AWSCredentials.html">AWS accessKeyId and secretAccessKey</a> that provide access to the repository.
If you do not specify a username and password, the accessKeyId and secretAccessKey are retrieved by using the <a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/credentials.html">AWS Default Credential Provider Chain</a>.</p>
</div>
<div class="paragraph">
<p>If your Git URI matches the CodeCommit URI pattern (shown earlier), you must provide valid AWS credentials in the username and password or in one of the locations supported by the default credential provider chain.
AWS EC2 instances may use <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html">IAM Roles for EC2 Instances</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>aws-java-sdk-core</code> jar is an optional dependency.
If the <code>aws-java-sdk-core</code> jar is not on your classpath, the AWS Code Commit credential provider is not created, regardless of the git server URI.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="authentication-with-google-cloud-source"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#authentication-with-google-cloud-source"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#authentication-with-google-cloud-source">Authentication with Google Cloud Source</a></h5>
<div class="paragraph">
<p>Spring Cloud Config Server also supports authenticating against <a href="https://cloud.google.com/source-repositories/">Google Cloud Source</a> repositories.</p>
</div>
<div class="paragraph">
<p>If your Git URI uses the <code>http</code> or <code>https</code> protocol and the domain name is <code>source.developers.google.com</code>, the Google Cloud Source credentials provider will be used. A Google Cloud Source repository URI has the format <code><a href="https://source.developers.google.com/p/$%7BGCP_PROJECT%7D/r/$%7BREPO%7D" class="bare">source.developers.google.com/p/${GCP_PROJECT}/r/${REPO}</a></code>. To obtain the URI for your repository, click on "Clone" in the Google Cloud Source UI, and select "Manually generated credentials". Do not generate any credentials, simply copy the displayed URI.</p>
</div>
<div class="paragraph">
<p>The Google Cloud Source credentials provider will use Google Cloud Platform application default credentials. See <a href="https://cloud.google.com/sdk/gcloud/reference/auth/application-default/login">Google Cloud SDK documentation</a> on how to create application default credentials for a system. This approach will work for user accounts in dev environments and for service accounts in production environments.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>com.google.auth:google-auth-library-oauth2-http</code> is an optional dependency.
If the <code>google-auth-library-oauth2-http</code> jar is not on your classpath, the Google Cloud Source credential provider is not created, regardless of the git server URI.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="git-ssh-configuration-using-properties"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#git-ssh-configuration-using-properties"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#git-ssh-configuration-using-properties">Git SSH configuration using properties</a></h5>
<div class="paragraph">
<p>By default, the JGit library used by Spring Cloud Config Server uses SSH configuration files such as <code>~/.ssh/known_hosts</code> and <code>/etc/ssh/ssh_config</code> when connecting to Git repositories by using an SSH URI.
In cloud environments such as Cloud Foundry, the local filesystem may be ephemeral or not easily accessible.
For those cases, SSH configuration can be set by using Java properties.
In order to activate property-based SSH configuration, the <code>spring.cloud.config.server.git.ignoreLocalSshSettings</code> property must be set to <code>true</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  spring:
    cloud:
      config:
        server:
          git:
            uri: git@gitserver.com:team/repo1.git
            ignoreLocalSshSettings: true
            hostKey: someHostKey
            hostKeyAlgorithm: ssh-rsa
            privateKey: |
                         -----BEGIN RSA PRIVATE KEY-----
                         MIIEpgIBAAKCAQEAx4UbaDzY5xjW6hc9jwN0mX33XpTDVW9WqHp5AKaRbtAC3DqX
                         IXFMPgw3K45jxRb93f8tv9vL3rD9CUG1Gv4FM+o7ds7FRES5RTjv2RT/JVNJCoqF
                         ol8+ngLqRZCyBtQN7zYByWMRirPGoDUqdPYrj2yq+ObBBNhg5N+hOwKjjpzdj2Ud
                         1l7R+wxIqmJo1IYyy16xS8WsjyQuyC0lL456qkd5BDZ0Ag8j2X9H9D5220Ln7s9i
                         oezTipXipS7p7Jekf3Ywx6abJwOmB0rX79dV4qiNcGgzATnG1PkXxqt76VhcGa0W
                         DDVHEEYGbSQ6hIGSh0I7BQun0aLRZojfE3gqHQIDAQABAoIBAQCZmGrk8BK6tXCd
                         fY6yTiKxFzwb38IQP0ojIUWNrq0+9Xt+NsypviLHkXfXXCKKU4zUHeIGVRq5MN9b
                         BO56/RrcQHHOoJdUWuOV2qMqJvPUtC0CpGkD+valhfD75MxoXU7s3FK7yjxy3rsG
                         EmfA6tHV8/4a5umo5TqSd2YTm5B19AhRqiuUVI1wTB41DjULUGiMYrnYrhzQlVvj
                         5MjnKTlYu3V8PoYDfv1GmxPPh6vlpafXEeEYN8VB97e5x3DGHjZ5UrurAmTLTdO8
                         +AahyoKsIY612TkkQthJlt7FJAwnCGMgY6podzzvzICLFmmTXYiZ/28I4BX/mOSe
                         pZVnfRixAoGBAO6Uiwt40/PKs53mCEWngslSCsh9oGAaLTf/XdvMns5VmuyyAyKG
                         ti8Ol5wqBMi4GIUzjbgUvSUt+IowIrG3f5tN85wpjQ1UGVcpTnl5Qo9xaS1PFScQ
                         xrtWZ9eNj2TsIAMp/svJsyGG3OibxfnuAIpSXNQiJPwRlW3irzpGgVx/AoGBANYW
                         dnhshUcEHMJi3aXwR12OTDnaLoanVGLwLnkqLSYUZA7ZegpKq90UAuBdcEfgdpyi
                         PhKpeaeIiAaNnFo8m9aoTKr+7I6/uMTlwrVnfrsVTZv3orxjwQV20YIBCVRKD1uX
                         VhE0ozPZxwwKSPAFocpyWpGHGreGF1AIYBE9UBtjAoGBAI8bfPgJpyFyMiGBjO6z
                         FwlJc/xlFqDusrcHL7abW5qq0L4v3R+FrJw3ZYufzLTVcKfdj6GelwJJO+8wBm+R
                         gTKYJItEhT48duLIfTDyIpHGVm9+I1MGhh5zKuCqIhxIYr9jHloBB7kRm0rPvYY4
                         VAykcNgyDvtAVODP+4m6JvhjAoGBALbtTqErKN47V0+JJpapLnF0KxGrqeGIjIRV
                         cYA6V4WYGr7NeIfesecfOC356PyhgPfpcVyEztwlvwTKb3RzIT1TZN8fH4YBr6Ee
                         KTbTjefRFhVUjQqnucAvfGi29f+9oE3Ei9f7wA+H35ocF6JvTYUsHNMIO/3gZ38N
                         CPjyCMa9AoGBAMhsITNe3QcbsXAbdUR00dDsIFVROzyFJ2m40i4KCRM35bC/BIBs
                         q0TY3we+ERB40U8Z2BvU61QuwaunJ2+uGadHo58VSVdggqAo0BSkH58innKKt96J
                         69pcVH/4rmLbXdcmNYGm6iu+MlPQk4BUZknHSmVHIFdJ0EPupVaQ8RHT
                         -----END RSA PRIVATE KEY-----</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table describes the SSH configuration properties.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. SSH Configuration Properties</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ignoreLocalSshSettings</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, use property-based instead of file-based SSH config. Must be set at as <code>spring.cloud.config.server.git.ignoreLocalSshSettings</code>, <strong>not</strong> inside a repository definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>privateKey</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valid SSH private key. Must be set if <code>ignoreLocalSshSettings</code> is true and Git URI is SSH format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>hostKey</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valid SSH host key. Must be set if <code>hostKeyAlgorithm</code> is also set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>hostKeyAlgorithm</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of <code>ssh-dss, ssh-rsa, ecdsa-sha2-nistp256, ecdsa-sha2-nistp384, or ecdsa-sha2-nistp521</code>. Must be set if <code>hostKey</code> is also set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>strictHostKeyChecking</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code>. If false, ignore errors with host key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>knownHostsFile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of custom <code>.known_hosts</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>preferredAuthentications</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Override server authentication method order. This should allow for evading login prompts if server has keyboard-interactive authentication before the <code>publickey</code> method.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="placeholders-in-git-search-paths"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#placeholders-in-git-search-paths"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#placeholders-in-git-search-paths">Placeholders in Git Search Paths</a></h5>
<div class="paragraph">
<p>Spring Cloud Config Server also supports a search path with placeholders for the <code>{application}</code> and <code>{profile}</code> (and <code>{label}</code> if
you need it), as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/spring-cloud-samples/config-repo
          searchPaths: '{application}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding listing causes a search of the repository for files in the same name as the directory (as well as the top level).
Wildcards are also valid in a search path with placeholders (any matching directory is included in the search).</p>
</div>
</div>
<div class="sect4">
<h5 id="force-pull-in-git-repositories"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#force-pull-in-git-repositories"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#force-pull-in-git-repositories">Force pull in Git Repositories</a></h5>
<div class="paragraph">
<p>As mentioned earlier, Spring Cloud Config Server makes a clone of the remote git repository in case the local copy gets dirty (for example,
folder content changes by an OS process) such that Spring Cloud Config Server cannot update the local copy from remote repository.</p>
</div>
<div class="paragraph">
<p>To solve this issue, there is a <code>force-pull</code> property that makes Spring Cloud Config Server force pull from the remote repository if the local copy is dirty, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/spring-cloud-samples/config-repo
          force-pull: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have a multiple-repositories configuration, you can configure the <code>force-pull</code> property per repository, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://git/common/config-repo.git
          force-pull: true
          repos:
            team-a:
                pattern: team-a-*
                uri: https://git/team-a/config-repo.git
                force-pull: true
            team-b:
                pattern: team-b-*
                uri: https://git/team-b/config-repo.git
                force-pull: true
            team-c:
                pattern: team-c-*
                uri: https://git/team-a/config-repo.git</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default value for <code>force-pull</code> property is <code>false</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="deleting-untracked-branches-in-git-repositories"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#deleting-untracked-branches-in-git-repositories"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#deleting-untracked-branches-in-git-repositories">Deleting untracked branches in Git Repositories</a></h5>
<div class="paragraph">
<p>As Spring Cloud Config Server has a clone of the remote git repository
after check-outing branch to local repo (e.g fetching properties by label) it will keep this branch
forever or till the next server restart (which creates new local repo).
So there could be a case when remote branch is deleted but local copy of it is still available for fetching.
And if Spring Cloud Config Server client service starts with <code>--spring.cloud.config.label=deletedRemoteBranch,master</code>
it will fetch properties from <code>deletedRemoteBranch</code> local branch, but not from <code>master</code>.</p>
</div>
<div class="paragraph">
<p>In order to keep local repository branches clean and up to remote - <code>deleteUntrackedBranches</code> property could be set.
It will make Spring Cloud Config Server <strong>force</strong> delete untracked branches from local repository.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/spring-cloud-samples/config-repo
          deleteUntrackedBranches: true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default value for <code>deleteUntrackedBranches</code> property is <code>false</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="git-refresh-rate"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#git-refresh-rate"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#git-refresh-rate">Git Refresh Rate</a></h5>
<div class="paragraph">
<p>You can control how often the config server will fetch updated configuration data
from your Git backend by using <code>spring.cloud.config.server.git.refreshRate</code>. The
value of this property is specified in seconds. By default the value is 0, meaning
the config server will fetch updated configuration from the Git repo every time it
is requested.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="version-control-backend-filesystem-use"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#version-control-backend-filesystem-use"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#version-control-backend-filesystem-use">44.1.2. Version Control Backend Filesystem Use</a></h4>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
With VCS-based backends (git, svn), files are checked out or cloned to the local filesystem.
By default, they are put in the system temporary directory with a prefix of <code>config-repo-</code>.
On linux, for example, it could be <code>/tmp/config-repo-&lt;randomid&gt;</code>.
Some operating systems <a href="https://serverfault.com/questions/377348/when-does-tmp-get-cleared/377349#377349">routinely clean out</a> temporary directories.
This can lead to unexpected behavior, such as missing properties.
To avoid this problem, change the directory that Config Server uses by setting <code>spring.cloud.config.server.git.basedir</code> or <code>spring.cloud.config.server.svn.basedir</code> to a directory that does not reside in the system temp structure.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="file-system-backend"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#file-system-backend"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#file-system-backend">44.1.3. File System Backend</a></h4>
<div class="paragraph">
<p>There is also a “native” profile in the Config Server that does not use Git but loads the config files from the local classpath or file system (any static URL you want to point to with <code>spring.cloud.config.server.native.searchLocations</code>).
To use the native profile, launch the Config Server with <code>spring.profiles.active=native</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember to use the <code>file:</code> prefix for file resources (the default without a prefix is usually the classpath).
As with any Spring Boot configuration, you can embed <code>${}</code>-style environment placeholders, but remember that absolute paths in Windows require an extra <code>/</code> (for example, <code><a href="file:///$%7Buser.home%7D/config-repo" class="bare">/${user.home}/config-repo</a></code>).
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The default value of the <code>searchLocations</code> is identical to a local Spring Boot application (that is, <code>[classpath:/, classpath:/config,
file:./, file:./config]</code>).
This does not expose the <code>application.properties</code> from the server to all clients, because any property sources present in the server are removed before being sent to the client.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A filesystem backend is great for getting started quickly and for testing.
To use it in production, you need to be sure that the file system is reliable and shared across all instances of the Config Server.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The search locations can contain placeholders for <code>{application}</code>, <code>{profile}</code>, and <code>{label}</code>.
In this way, you can segregate the directories in the path and choose a strategy that makes sense for you (such as subdirectory per application or subdirectory per profile).</p>
</div>
<div class="paragraph">
<p>If you do not use placeholders in the search locations, this repository also appends the <code>{label}</code> parameter of the HTTP resource to a suffix on the search path, so properties files are loaded from each search location <strong>and</strong> a subdirectory with the same name as the label (the labelled properties take precedence in the Spring Environment).
Thus, the default behaviour with no placeholders is the same as adding a search location ending with <code>/{label}/</code>.
For example, <code>file:/tmp/config</code> is the same as <code>file:/tmp/config,file:/tmp/config/{label}</code>.
This behavior can be disabled by setting <code>spring.cloud.config.server.native.addLabelLocations=false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="vault-backend"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault-backend"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault-backend">44.1.4. Vault Backend</a></h4>
<div class="paragraph">
<p>Spring Cloud Config Server also supports <a href="https://www.vaultproject.io/">Vault</a> as a backend.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Vault is a tool for securely accessing secrets.
A secret is anything that to which you want to tightly control access, such as API keys, passwords, certificates, and other sensitive information. Vault provides a unified interface to any secret while providing tight access control and recording a detailed audit log.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>For more information on Vault, see the <a href="https://learn.hashicorp.com/vault/?track=getting-started#getting-started">Vault quick start guide</a>.</p>
</div>
<div class="paragraph">
<p>To enable the config server to use a Vault backend, you can run your config server with the <code>vault</code> profile.
For example, in your config server’s <code>application.properties</code>, you can add <code>spring.profiles.active=vault</code>.</p>
</div>
<div class="paragraph">
<p>By default, the config server assumes that your Vault server runs at <code><a href="http://127.0.0.1:8200/" class="bare">127.0.0.1:8200</a></code>.
It also assumes that the name of backend is <code>secret</code> and the key is <code>application</code>.
All of these defaults can be configured in your config server’s <code>application.properties</code>.
The following table describes configurable Vault properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">127.0.0.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8200</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">backend</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaultKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">profileSeparator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">,</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kvVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">skipSslValidation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All of the properties in the preceding table must be prefixed with <code>spring.cloud.config.server.vault</code> or placed in the correct Vault section of a composite configuration.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>All configurable properties can be found in <code>org.springframework.cloud.config.server.environment.VaultEnvironmentProperties</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Vault 0.10.0 introduced a versioned key-value backend (k/v backend version 2) that exposes a different API than earlier versions, it now requires a <code>data/</code> between the mount path and the actual context path and wraps secrets in a <code>data</code> object. Setting <code>spring.cloud.config.server.vault.kv-version=2</code> will take this into account.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Optionally, there is support for the Vault Enterprise <code>X-Vault-Namespace</code> header. To have it sent to Vault set the <code>namespace</code> property.</p>
</div>
<div class="paragraph">
<p>With your config server running, you can make HTTP requests to the server to retrieve
values from the Vault backend.
To do so, you need a token for your Vault server.</p>
</div>
<div class="paragraph">
<p>First, place some data in you Vault, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs bash" data-lang="sh">$ vault kv put secret/application foo=bar baz=bam
$ vault kv put secret/myapp foo=myappsbar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Second, make an HTTP request to your config server to retrieve the values, as shown in the following example:</p>
</div>
<div class="paragraph">
<p><code>$ curl -X "GET" "http://localhost:8888/myapp/default" -H "X-Config-Token: yourtoken"</code></p>
</div>
<div class="paragraph">
<p>You should see a response similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   <span class="hljs-attr">"name"</span>:<span class="hljs-string">"myapp"</span>,
   <span class="hljs-attr">"profiles"</span>:[
      <span class="hljs-string">"default"</span>
   ],
   <span class="hljs-attr">"label"</span>:<span class="hljs-literal">null</span>,
   <span class="hljs-attr">"version"</span>:<span class="hljs-literal">null</span>,
   <span class="hljs-attr">"state"</span>:<span class="hljs-literal">null</span>,
   <span class="hljs-attr">"propertySources"</span>:[
      {
         <span class="hljs-attr">"name"</span>:<span class="hljs-string">"vault:myapp"</span>,
         <span class="hljs-attr">"source"</span>:{
            <span class="hljs-attr">"foo"</span>:<span class="hljs-string">"myappsbar"</span>
         }
      },
      {
         <span class="hljs-attr">"name"</span>:<span class="hljs-string">"vault:application"</span>,
         <span class="hljs-attr">"source"</span>:{
            <span class="hljs-attr">"baz"</span>:<span class="hljs-string">"bam"</span>,
            <span class="hljs-attr">"foo"</span>:<span class="hljs-string">"bar"</span>
         }
      }
   ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default way for a client to provide the necessary authentication to let Config Server talk to Vault is to set the X-Config-Token header.
However, you can instead omit the header and configure the authentication in the server, by setting the same configuration properties as Spring Cloud Vault.
The property to set is <code>spring.cloud.config.server.vault.authentication</code>.
It should be set to one of the supported authentication methods.
You may also need to set other properties specific to the authentication method you use, by using the same property names as documented for <code>spring.cloud.vault</code> but instead using the <code>spring.cloud.config.server.vault</code> prefix.
See the <a href="https://cloud.spring.io/spring-cloud-vault/reference/html/#vault.config.authentication">Spring Cloud Vault Reference Guide</a> for more detail.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you omit the X-Config-Token header and use a server property to set the authentication, the Config Server application needs an additional dependency on Spring Vault to enable the additional authentication options.
See the <a href="https://docs.spring.io/spring-vault/docs/current/reference/html/#dependencies">Spring Vault Reference Guide</a> for how to add that dependency.
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="multiple-properties-sources"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#multiple-properties-sources"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#multiple-properties-sources">Multiple Properties Sources</a></h5>
<div class="paragraph">
<p>When using Vault, you can provide your applications with multiple properties sources.
For example, assume you have written data to the following paths in Vault:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs bash" data-lang="sh">secret/myApp,dev
secret/myApp
secret/application,dev
secret/application</code></pre>
</div>
</div>
<div class="paragraph">
<p>Properties written to <code>secret/application</code> are available to <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#_vault_server">all applications using the Config Server</a>.
An application with the name, <code>myApp</code>, would have any properties written to <code>secret/myApp</code> and <code>secret/application</code> available to it.
When <code>myApp</code> has the <code>dev</code> profile enabled, properties written to all of the above paths would be available to it, with properties in the first path in the list taking priority over the others.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="accessing-backends-through-a-proxy"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#accessing-backends-through-a-proxy"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#accessing-backends-through-a-proxy">44.1.5. Accessing Backends Through a Proxy</a></h4>
<div class="paragraph">
<p>The configuration server can access a Git or Vault backend through an HTTP or HTTPS proxy. This behavior is controlled for either Git or Vault by settings under <code>proxy.http</code> and <code>proxy.https</code>. These settings are per repository, so if you are using a <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#composite-environment-repositories">composite environment repository</a> you must configure proxy settings for each backend in the composite individually. If using a network which requires separate proxy servers for HTTP and HTTPS URLs, you can configure both the HTTP and the HTTPS proxy settings for a single backend.</p>
</div>
<div class="paragraph">
<p>The following table describes the proxy configuration properties for both HTTP and HTTPS proxies. All of these properties must be prefixed by <code>proxy.http</code> or <code>proxy.https</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Proxy Configuration Properties</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>host</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host of the proxy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>port</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port with which to access the proxy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>nonProxyHosts</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any hosts which the configuration server should access outside the proxy. If values are provided for both <code>proxy.http.nonProxyHosts</code> and <code>proxy.https.nonProxyHosts</code>, the <code>proxy.http</code> value will be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>username</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username with which to authenticate to the proxy. If values are provided for both <code>proxy.http.username</code> and <code>proxy.https.username</code>, the <code>proxy.http</code> value will be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>password</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password with which to authenticate to the proxy. If values are provided for both <code>proxy.http.password</code> and <code>proxy.https.password</code>, the <code>proxy.http</code> value will be used.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following configuration uses an HTTPS proxy to access a Git repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  profiles:
    active: git
  cloud:
    config:
      server:
        git:
          uri: https://github.com/spring-cloud-samples/config-repo
          proxy:
            https:
              host: my-proxy.host.io
              password: myproxypassword
              port: '3128'
              username: myproxyusername
              nonProxyHosts: example.com</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sharing-configuration-with-all-applications"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sharing-configuration-with-all-applications"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sharing-configuration-with-all-applications">44.1.6. Sharing Configuration With All Applications</a></h4>
<div class="paragraph">
<p>Sharing configuration between all applications varies according to which approach you take, as described in the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-server-file-based-repositories">File Based Repositories</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-server-vault-server">Vault Server</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="spring-cloud-config-server-file-based-repositories"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-server-file-based-repositories"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-server-file-based-repositories">File Based Repositories</a></h5>
<div class="paragraph">
<p>With file-based (git, svn, and native) repositories, resources with file names in <code>application*</code> (<code>application.properties</code>, <code>application.yml</code>, <code>application-*.properties</code>, and so on) are shared between all client applications.
You can use resources with these file names to configure global defaults and have them be overridden by application-specific files as necessary.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#property-overrides">property overrides</a> feature can also be used for setting global defaults, with placeholders applications
allowed to override them locally.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
With the “native” profile (a local file system backend) , you should use an explicit search location that is not part of the server’s own configuration.
Otherwise, the <code>application*</code> resources in the default search locations get removed because they are part of the server.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="spring-cloud-config-server-vault-server"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-server-vault-server"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-server-vault-server">Vault Server</a></h5>
<div class="paragraph">
<p>When using Vault as a backend, you can share configuration with all applications by placing configuration in <code>secret/application</code>.
For example, if you run the following Vault command, all applications using the config server will have the properties <code>foo</code> and <code>baz</code> available to them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs bash" data-lang="sh">$ vault write secret/application foo=bar baz=bam</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="credhub-server"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#credhub-server"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#credhub-server">CredHub Server</a></h5>
<div class="paragraph">
<p>When using CredHub as a backend, you can share configuration with all applications by placing configuration in <code>/application/</code> or by placing it in the <code>default</code> profile for the application.
For example, if you run the following CredHub command, all applications using the config server will have the properties <code>shared.color1</code> and <code>shared.color2</code> available to them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs bash" data-lang="sh">credhub <span class="hljs-built_in">set</span> --name <span class="hljs-string">"/application/profile/master/shared"</span> --<span class="hljs-built_in">type</span>=json
value: {<span class="hljs-string">"shared.color1"</span>: <span class="hljs-string">"blue"</span>, <span class="hljs-string">"shared.color"</span>: <span class="hljs-string">"red"</span>}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs bash" data-lang="sh">credhub <span class="hljs-built_in">set</span> --name <span class="hljs-string">"/my-app/default/master/more-shared"</span> --<span class="hljs-built_in">type</span>=json
value: {<span class="hljs-string">"shared.word1"</span>: <span class="hljs-string">"hello"</span>, <span class="hljs-string">"shared.word2"</span>: <span class="hljs-string">"world"</span>}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jdbc-backend"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#jdbc-backend"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#jdbc-backend">44.1.7. JDBC Backend</a></h4>
<div class="paragraph">
<p>Spring Cloud Config Server supports JDBC (relational database) as a backend for configuration properties.
You can enable this feature by adding <code>spring-jdbc</code> to the classpath and using the <code>jdbc</code> profile or by adding a bean of type <code>JdbcEnvironmentRepository</code>.
If you include the right dependencies on the classpath (see the user guide for more details on that), Spring Boot configures a data source.</p>
</div>
<div class="paragraph">
<p>You can disable autoconfiguration for <code>JdbcEnvironmentRepository</code> by setting the <code>spring.cloud.config.server.jdbc.enabled</code> property to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>The database needs to have a table called <code>PROPERTIES</code> with columns called <code>APPLICATION</code>, <code>PROFILE</code>, and <code>LABEL</code> (with the usual <code>Environment</code> meaning), plus <code>KEY</code> and <code>VALUE</code> for the key and value pairs in <code>Properties</code> style.
All fields are of type String in Java, so you can make them <code>VARCHAR</code> of whatever length you need.
Property values behave in the same way as they would if they came from Spring Boot properties files named <code>{application}-{profile}.properties</code>, including all the encryption and decryption, which will be applied as post-processing steps (that is, not in the repository implementation directly).</p>
</div>
</div>
<div class="sect3">
<h4 id="redis-backend"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#redis-backend"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#redis-backend">44.1.8. Redis Backend</a></h4>
<div class="paragraph">
<p>Spring Cloud Config Server supports Redis as a backend for configuration properties.
You can enable this feature by adding a dependency to <a href="https://spring.io/projects/spring-data-redis">Spring Data Redis</a>.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following configuration uses Spring Data <code>RedisTemplate</code> to access a Redis. We can use <code>spring.redis.*</code> properties to override default connection settings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  profiles:
    active: redis
  redis:
    host: redis
    port: 16379</code></pre>
</div>
</div>
<div class="paragraph">
<p>The properties should be stored as fields in a hash. The name of hash should be the same as <code>spring.application.name</code> property or conjunction of <code>spring.application.name</code> and <code>spring.profiles.active[n]</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs bash" data-lang="sh">HMSET sample-app server.port <span class="hljs-string">"8100"</span> sample.topic.name <span class="hljs-string">"test"</span> test.property1 <span class="hljs-string">"property1"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After executing the command visible above a hash should contain the following keys with values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HGETALL sample-app
{
  "server.port": "8100",
  "sample.topic.name": "test",
  "test.property1": "property1"
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When no profile is specified <code>default</code> will be used.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="aws-s3-backend"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#aws-s3-backend"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#aws-s3-backend">44.1.9. AWS S3 Backend</a></h4>
<div class="paragraph">
<p>Spring Cloud Config Server supports AWS S3 as a backend for configuration properties.
You can enable this feature by adding a dependency to the <a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/examples-s3.html">AWS Java SDK For Amazon S3</a>.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.amazonaws<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aws-java-sdk-s3<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following configuration uses the AWS S3 client to access configuration files. We can use <code>spring.awss3.*</code> properties to select the bucket where your configuration is stored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  profiles:
    active: awss3
  cloud:
    config:
      server:
        awss3:
          region: us-east-1
          bucket: bucket1</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to specify an AWS URL to <a href="https://aws.amazon.com/blogs/developer/using-new-regions-and-endpoints/">override the standard endpoint</a> of your S3 service with <code>spring.awss3.endpoint</code>. This allows support for beta regions of S3, and other S3 compatible storage APIs.</p>
</div>
<div class="paragraph">
<p>Credentials are found using the <a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/credentials.html">Default AWS Credential Provider Chain</a>. Versioned and encrypted buckets are supported without further configuration.</p>
</div>
<div class="paragraph">
<p>Configuration files are stored in your bucket as <code>{application}-{profile}.properties</code>, <code>{application}-{profile}.yml</code> or <code>{application}-{profile}.json</code>. An optional label can be provided to specify a directory path to the file.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When no profile is specified <code>default</code> will be used.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="credhub-backend"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#credhub-backend"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#credhub-backend">44.1.10. CredHub Backend</a></h4>
<div class="paragraph">
<p>Spring Cloud Config Server supports <a href="https://docs.cloudfoundry.org/credhub">CredHub</a> as a backend for configuration properties.
You can enable this feature by adding a dependency to <a href="https://spring.io/projects/spring-credhub">Spring CredHub</a>.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.credhub<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-credhub-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following configuration uses mutual TLS to access a CredHub:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  profiles:
    active: credhub
  cloud:
    config:
      server:
        credhub:
          url: https://credhub:8844</code></pre>
</div>
</div>
<div class="paragraph">
<p>The properties should be stored as JSON, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs bash" data-lang="sh">credhub <span class="hljs-built_in">set</span> --name <span class="hljs-string">"/demo-app/default/master/toggles"</span> --<span class="hljs-built_in">type</span>=json
value: {<span class="hljs-string">"toggle.button"</span>: <span class="hljs-string">"blue"</span>, <span class="hljs-string">"toggle.link"</span>: <span class="hljs-string">"red"</span>}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs bash" data-lang="sh">credhub <span class="hljs-built_in">set</span> --name <span class="hljs-string">"/demo-app/default/master/abs"</span> --<span class="hljs-built_in">type</span>=json
value: {<span class="hljs-string">"marketing.enabled"</span>: <span class="hljs-literal">true</span>, <span class="hljs-string">"external.enabled"</span>: <span class="hljs-literal">false</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All client applications with the name <code>spring.cloud.config.name=demo-app</code> will have the following properties available to them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    toggle.button: "blue",
    toggle.link: "red",
    marketing.enabled: true,
    external.enabled: false
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When no profile is specified <code>default</code> will be used and when no label is specified <code>master</code> will be used as a default value.
NOTE: Values added to <code>application</code> will be shared by all the applications.
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="oauth-2-0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#oauth-2-0"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#oauth-2-0">OAuth 2.0</a></h5>
<div class="paragraph">
<p>You can authenticate with <a href="https://oauth.net/2/">OAuth 2.0</a> using <a href="https://docs.cloudfoundry.org/concepts/architecture/uaa.html">UAA</a> as a provider.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-oauth2-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following configuration uses OAuth 2.0 and UAA to access a CredHub:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  profiles:
    active: credhub
  cloud:
    config:
      server:
        credhub:
          url: https://credhub:8844
          oauth2:
            registration-id: credhub-client
  security:
    oauth2:
      client:
        registration:
          credhub-client:
            provider: uaa
            client-id: credhub_config_server
            client-secret: asecret
            authorization-grant-type: client_credentials
        provider:
          uaa:
            token-uri: https://uaa:8443/oauth/token</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The used UAA client-id should have <code>credhub.read</code> as scope.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="composite-environment-repositories"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#composite-environment-repositories"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#composite-environment-repositories">44.1.11. Composite Environment Repositories</a></h4>
<div class="paragraph">
<p>In some scenarios, you may wish to pull configuration data from multiple environment repositories.
To do so, you can enable the <code>composite</code> profile in your configuration server’s application properties or YAML file.
If, for example, you want to pull configuration data from a Subversion repository as well as two Git repositories, you can set the following properties for your configuration server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  profiles:
    active: composite
  cloud:
    config:
      server:
        composite:
        -
          type: svn
          uri: file:///path/to/svn/repo
        -
          type: git
          uri: file:///path/to/rex/git/repo
        -
          type: git
          uri: file:///path/to/walter/git/repo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this configuration, precedence is determined by the order in which repositories are listed under the <code>composite</code> key.
In the above example, the Subversion repository is listed first, so a value found in the Subversion repository will override values found for the same property in one of the Git repositories.
A value found in the <code>rex</code> Git repository will be used before a value found for the same property in the <code>walter</code> Git repository.</p>
</div>
<div class="paragraph">
<p>If you want to pull configuration data only from repositories that are each of distinct types, you can enable the corresponding profiles, rather than the <code>composite</code> profile, in your configuration server’s application properties or YAML file.
If, for example, you want to pull configuration data from a single Git repository and a single HashiCorp Vault server, you can set the following properties for your configuration server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  profiles:
    active: git, vault
  cloud:
    config:
      server:
        git:
          uri: file:///path/to/git/repo
          order: 2
        vault:
          host: 127.0.0.1
          port: 8200
          order: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this configuration, precedence can be determined by an <code>order</code> property.
You can use the <code>order</code> property to specify the priority order for all your repositories.
The lower the numerical value of the <code>order</code> property, the higher priority it has.
The priority order of a repository helps resolve any potential conflicts between repositories that contain values for the same properties.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your composite environment includes a Vault server as in the previous example, you must include a Vault token in every request made to the configuration server. See <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault-backend">Vault Backend</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Any type of failure when retrieving values from an environment repository results in a failure for the entire composite environment.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using a composite environment, it is important that all repositories contain the same labels.
If you have an environment similar to those in the preceding examples and you request configuration data with the <code>master</code> label but the Subversion repository does not contain a branch called <code>master</code>, the entire request fails.
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="custom-composite-environment-repositories"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-composite-environment-repositories"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-composite-environment-repositories">Custom Composite Environment Repositories</a></h5>
<div class="paragraph">
<p>In addition to using one of the environment repositories from Spring Cloud, you can also provide your own <code>EnvironmentRepository</code> bean to be included as part of a composite environment.
To do so, your bean must implement the <code>EnvironmentRepository</code> interface.
If you want to control the priority of your custom <code>EnvironmentRepository</code> within the composite environment, you should also implement the <code>Ordered</code> interface and override the <code>getOrdered</code> method.
If you do not implement the <code>Ordered</code> interface, your <code>EnvironmentRepository</code> is given the lowest priority.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="property-overrides"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#property-overrides"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#property-overrides">44.1.12. Property Overrides</a></h4>
<div class="paragraph">
<p>The Config Server has an “overrides” feature that lets the operator provide configuration properties to all applications.
The overridden properties cannot be accidentally changed by the application with the normal Spring Boot hooks.
To declare overrides, add a map of name-value pairs to <code>spring.cloud.config.server.overrides</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        overrides:
          foo: bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding examples causes all applications that are config clients to read <code>foo=bar</code>, independent of their own configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A configuration system cannot force an application to use configuration data in any particular way.
Consequently, overrides are not enforceable.
However, they do provide useful default behavior for Spring Cloud Config clients.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Normally, Spring environment placeholders with <code>${}</code> can be escaped (and resolved on the client) by using backslash (<code>\</code>) to escape the <code>$</code> or the <code>{</code>.
For example, <code>\${app.foo:bar}</code> resolves to <code>bar</code>, unless the app provides its own <code>app.foo</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In YAML, you do not need to escape the backslash itself.
However, in properties files, you do need to escape the backslash, when you configure the overrides on the server.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can change the priority of all overrides in the client to be more like default values, letting applications supply their own values in environment variables or System properties, by setting the <code>spring.cloud.config.overrideNone=true</code> flag (the default is false) in the remote repository.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="health-indicator-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#health-indicator-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#health-indicator-2">44.2. Health Indicator</a></h3>
<div class="paragraph">
<p>Config Server comes with a Health Indicator that checks whether the configured <code>EnvironmentRepository</code> is working.
By default, it asks the <code>EnvironmentRepository</code> for an application named <code>app</code>, the <code>default</code> profile, and the default label provided by the <code>EnvironmentRepository</code> implementation.</p>
</div>
<div class="paragraph">
<p>You can configure the Health Indicator to check more applications along with custom profiles and custom labels, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      server:
        health:
          repositories:
            myservice:
              label: mylabel
            myservice-dev:
              name: myservice
              profiles: development</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can disable the Health Indicator by setting <code>health.config.enabled=false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="security"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#security"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#security">44.3. Security</a></h3>
<div class="paragraph">
<p>You can secure your Config Server in any way that makes sense to you (from physical network security to OAuth2 bearer tokens), because Spring Security and Spring Boot offer support for many security arrangements.</p>
</div>
<div class="paragraph">
<p>To use the default Spring Boot-configured HTTP Basic security, include Spring Security on the classpath (for example, through <code>spring-boot-starter-security</code>).
The default is a username of <code>user</code> and a randomly generated password. A random password is not useful in practice, so we recommend you configure the password (by setting <code>spring.security.user.password</code>) and encrypt it (see below for instructions on how to do that).</p>
</div>
</div>
<div class="sect2">
<h3 id="encryption-and-decryption-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#encryption-and-decryption-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#encryption-and-decryption-3">44.4. Encryption and Decryption</a></h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To use the encryption and decryption features you need the full-strength JCE installed in your JVM (it is not included by default).
You can download the “Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files” from Oracle and follow the installation instructions (essentially, you need to replace the two policy files in the JRE lib/security directory with the ones that you downloaded).
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If the remote property sources contain encrypted content (values starting with <code>{cipher}</code>), they are decrypted before sending to clients over HTTP.
The main advantage of this setup is that the property values need not be in plain text when they are “at rest” (for example, in a git repository).
If a value cannot be decrypted, it is removed from the property source and an additional property is added with the same key but prefixed with <code>invalid</code> and a value that means “not applicable” (usually <code>&lt;n/a&gt;</code>).
This is largely to prevent cipher text being used as a password and accidentally leaking.</p>
</div>
<div class="paragraph">
<p>If you set up a remote config repository for config client applications, it might contain an <code>application.yml</code> similar to the following:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  datasource:
    username: dbuser
    password: '{cipher}FKSAJDFGYOS8F7GLHAKERGFHLSAJ'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Encrypted values in <code>application.properties</code> file must not be wrapped in quotes. Otherwise, the value is not decrypted. The following example shows values that would work:</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre>spring.datasource.username: dbuser
spring.datasource.password: {cipher}FKSAJDFGYOS8F7GLHAKERGFHLSAJ</pre>
</div>
</div>
<div class="paragraph">
<p>You can safely push this plain text to a shared git repository, and the secret password remains protected.</p>
</div>
<div class="paragraph">
<p>The server also exposes <code>/encrypt</code> and <code>/decrypt</code> endpoints (on the assumption that these are secured and only accessed by authorized agents).
If you edit a remote config file, you can use the Config Server to encrypt values by POSTing to the <code>/encrypt</code> endpoint, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl localhost:8888/encrypt -s -d mysecret
682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are testing with curl, then use <code>--data-urlencode</code> (instead of <code>-d</code>) and prefix the value to encrypt with <code>=</code> (curl requires this) or set an explicit <code>Content-Type: text/plain</code> to make sure curl encodes the data correctly when there are special characters ('+' is particularly tricky).
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Be sure not to include any of the curl command statistics in the encrypted value, this is why the examples use the <code>-s</code> option to silence them. Outputting the value to a file can help avoid this problem.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The inverse operation is also available through <code>/decrypt</code> (provided the server is
configured with a symmetric key or a full key pair), as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl localhost:8888/decrypt -s -d 682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda
mysecret</pre>
</div>
</div>
<div class="paragraph">
<p>Take the encrypted value and add the <code>{cipher}</code> prefix before you put it in the YAML or properties file and before you commit and push it to a remote (potentially insecure) store.</p>
</div>
<div class="paragraph">
<p>The <code>/encrypt</code> and <code>/decrypt</code> endpoints also both accept paths in the form of <code>/*/{application}/{profiles}</code>, which can be used to control cryptography on a per-application (name) and per-profile basis when clients call into the main environment resource.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To control the cryptography in this granular way, you must also provide a <code>@Bean</code> of type <code>TextEncryptorLocator</code> that creates a different encryptor per name and profiles.
The one that is provided by default does not do so (all encryptions use the same key).
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>spring</code> command line client (with Spring Cloud CLI extensions
installed) can also be used to encrypt and decrypt, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ spring encrypt mysecret --key foo
682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda
$ spring decrypt --key foo 682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda
mysecret</pre>
</div>
</div>
<div class="paragraph">
<p>To use a key in a file (such as an RSA public key for encryption), prepend
the key value with "@" and provide the file path, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ spring encrypt mysecret --key @${HOME}/.ssh/id_rsa.pub
AQAjPgt3eFZQXwt8tsHAVv/QHiY5sI2dRcR+...</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>--key</code> argument is mandatory (despite having a <code>--</code> prefix).
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="key-management"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#key-management"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#key-management">44.5. Key Management</a></h3>
<div class="paragraph">
<p>The Config Server can use a symmetric (shared) key or an asymmetric one (RSA key pair).
The asymmetric choice is superior in terms of security, but it is often more convenient to use a symmetric key since it is a single property value to configure in the <code>bootstrap.properties</code>.</p>
</div>
<div class="paragraph">
<p>To configure a symmetric key, you need to set <code>encrypt.key</code> to a secret String (or use the <code>ENCRYPT_KEY</code> environment variable to keep it out of plain-text configuration files).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot configure an asymmetric key using <code>encrypt.key</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To configure an asymmetric key use a keystore (e.g. as
created by the <code>keytool</code> utility that comes with the JDK). The
keystore properties are <code>encrypt.keyStore.*</code> with <code>*</code> equal to</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Property</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>encrypt.keyStore.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains a <code>Resource</code> location</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>encrypt.keyStore.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds the password that unlocks the keystore</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>encrypt.keyStore.alias</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies which key in the store to use</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>encrypt.keyStore.type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of KeyStore to create. Defaults to <code>jks</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The encryption is done with the public key, and a private key is
needed for decryption.
Thus, in principle, you can configure only the public key in the server if you want to only encrypt (and are prepared to decrypt the values yourself locally with the private key).
In practice, you might not want to do decrypt locally, because it spreads the key management process around all the clients, instead of
concentrating it in the server.
On the other hand, it can be a useful option if your config server is relatively insecure and only a handful of clients need the encrypted properties.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-key-store-for-testing"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-a-key-store-for-testing"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-a-key-store-for-testing">44.6. Creating a Key Store for Testing</a></h3>
<div class="paragraph">
<p>To create a keystore for testing, you can use a command resembling the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ keytool -genkeypair -alias mytestkey -keyalg RSA \
  -dname "CN=Web Server,OU=Unit,O=Organization,L=City,S=State,C=US" \
  -keypass changeme -keystore server.jks -storepass letmein</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using JDK 11 or above you may get the following warning when using the command above. In this case
you probably want to make sure the <code>keypass</code> and <code>storepass</code> values match.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre>Warning:  Different store and key passwords not supported for PKCS12 KeyStores. Ignoring user-specified -keypass value.</pre>
</div>
</div>
<div class="paragraph">
<p>Put the <code>server.jks</code> file in the classpath (for instance) and then, in
your <code>bootstrap.yml</code>, for the Config Server, create the following settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">encrypt:
  keyStore:
    location: classpath:/server.jks
    password: letmein
    alias: mytestkey
    secret: changeme</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-multiple-keys-and-key-rotation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-multiple-keys-and-key-rotation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-multiple-keys-and-key-rotation">44.7. Using Multiple Keys and Key Rotation</a></h3>
<div class="paragraph">
<p>In addition to the <code>{cipher}</code> prefix in encrypted property values, the Config Server looks for zero or more <code>{name:value}</code> prefixes before the start of the (Base64 encoded) cipher text.
The keys are passed to a <code>TextEncryptorLocator</code>, which can do whatever logic it needs to locate a <code>TextEncryptor</code> for the cipher.
If you have configured a keystore (<code>encrypt.keystore.location</code>), the default locator looks for keys with aliases supplied by the <code>key</code> prefix, with a cipher text like resembling the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">foo:
  bar: `{cipher}{key:testkey}...`</code></pre>
</div>
</div>
<div class="paragraph">
<p>The locator looks for a key named "testkey".
A secret can also be supplied by using a <code>{secret:…​}</code> value in the prefix.
However, if it is not supplied, the default is to use the keystore password (which is what you get when you build a keystore and do not specify a secret).
If you do supply a secret, you should also encrypt the secret using a custom <code>SecretLocator</code>.</p>
</div>
<div class="paragraph">
<p>When the keys are being used only to encrypt a few bytes of configuration data (that is, they are not being used elsewhere), key rotation is hardly ever necessary on cryptographic grounds.
However, you might occasionally need to change the keys (for example, in the event of a security breach).
In that case, all the clients would need to change their source config files (for example, in git) and use a new <code>{key:…​}</code> prefix in all the ciphers.
Note that the clients need to first check that the key alias is available in the Config Server keystore.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to let the Config Server handle all encryption as well as decryption, the <code>{name:value}</code> prefixes can also be added as plain text posted to the <code>/encrypt</code> endpoint, .
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="serving-encrypted-properties"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serving-encrypted-properties"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serving-encrypted-properties">44.8. Serving Encrypted Properties</a></h3>
<div class="paragraph">
<p>Sometimes you want the clients to decrypt the configuration locally, instead of doing it in the server.
In that case, if you provide the <code>encrypt.*</code> configuration to locate a key, you can still have <code>/encrypt</code> and <code>/decrypt</code> endpoints, but you need to explicitly switch off the decryption of outgoing properties by placing <code>spring.cloud.config.server.encrypt.enabled=false</code> in <code>bootstrap.[yml|properties]</code>.
If you do not care about the endpoints, it should work if you do not configure either the key or the enabled flag.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serving-alternative-formats"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serving-alternative-formats"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serving-alternative-formats">45. Serving Alternative Formats</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default JSON format from the environment endpoints is perfect for consumption by Spring applications, because it maps directly onto the <code>Environment</code> abstraction.
If you prefer, you can consume the same data as YAML or Java properties by adding a suffix (".yml", ".yaml" or ".properties") to the resource path.
This can be useful for consumption by applications that do not care about the structure of the JSON endpoints or the extra metadata they provide (for example, an application that is not using Spring might benefit from the simplicity of this approach).</p>
</div>
<div class="paragraph">
<p>The YAML and properties representations have an additional flag (provided as a boolean query parameter called <code>resolvePlaceholders</code>) to signal that placeholders in the source documents (in the standard Spring <code>${…​}</code> form) should be resolved in the output before rendering, where possible.
This is a useful feature for consumers that do not know about the Spring placeholder conventions.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There are limitations in using the YAML or properties formats, mainly in relation to the loss of metadata.
For example, the JSON is structured as an ordered list of property sources, with names that correlate with the source.
The YAML and properties forms are coalesced into a single map, even if the origin of the values has multiple sources, and the names of the original source files are lost.
Also, the YAML representation is not necessarily a faithful representation of the YAML source in a backing repository either. It is constructed from a list of flat property sources, and assumptions have to be made about the form of the keys.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serving-plain-text"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serving-plain-text"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serving-plain-text">46. Serving Plain Text</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of using the <code>Environment</code> abstraction (or one of the alternative representations of it in YAML or properties format), your applications might need generic plain-text configuration files that are tailored to their environment.
The Config Server provides these through an additional endpoint at <code>/{application}/{profile}/{label}/{path}</code>, where <code>application</code>, <code>profile</code>, and <code>label</code> have the same meaning as the regular environment endpoint, but <code>path</code> is a path to a file name (such as <code>log.xml</code>).
The source files for this endpoint are located in the same way as for the environment endpoints.
The same search path is used for properties and YAML files.
However, instead of aggregating all matching resources, only the first one to match is returned.</p>
</div>
<div class="paragraph">
<p>After a resource is located, placeholders in the normal format (<code>${…​}</code>) are resolved by using the effective <code>Environment</code> for the supplied application name, profile, and label.
In this way, the resource endpoint is tightly integrated with the environment endpoints.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As with the source files for environment configuration, the <code>profile</code> is used to resolve the file name.
So, if you want a profile-specific file, <code>/*/development/*/logback.xml</code> can be resolved by a file called <code>logback-development.xml</code> (in preference to <code>logback.xml</code>).
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you do not want to supply the <code>label</code> and let the server use the default label, you can supply a <code>useDefaultLabel</code> request parameter.
Consequently, the preceding example for the <code>default</code> profile could be <code>/sample/default/nginx.conf?useDefaultLabel</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>At present, Spring Cloud Config can serve plaintext for git, SVN, native backends, and AWS S3.
The support for git, SVN, and native backends is identical. AWS S3 works a bit differently.
The following sections show how each one works:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-serving-plain-text-git-svn-native-backends">Git, SVN, and Native Backends</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-serving-plain-text-aws-s3">AWS S3</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="spring-cloud-config-serving-plain-text-git-svn-native-backends"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-serving-plain-text-git-svn-native-backends"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-serving-plain-text-git-svn-native-backends">46.1. Git, SVN, and Native Backends</a></h3>
<div class="paragraph">
<p>Consider the following example for a GIT or SVN repository or a native backend:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-selector-tag">application</span><span class="hljs-selector-class">.yml</span>
<span class="hljs-selector-tag">nginx</span><span class="hljs-selector-class">.conf</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>nginx.conf</code> might resemble the following listing:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs properties"><span class="hljs-attr">server</span> <span class="hljs-string">{</span>
    <span class="hljs-attr">listen</span>              <span class="hljs-string">80;</span>
    <span class="hljs-attr">server_name</span>         <span class="hljs-string">${nginx.server.name};</span>
<span class="hljs-attr">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>application.yml</code> might resemble the following listing:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">nginx:
  server:
    name: example.com
---
spring:
  profiles: development
nginx:
  server:
    name: develop.com</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>/sample/default/master/nginx.conf</code> resource might be as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs properties"><span class="hljs-attr">server</span> <span class="hljs-string">{</span>
    <span class="hljs-attr">listen</span>              <span class="hljs-string">80;</span>
    <span class="hljs-attr">server_name</span>         <span class="hljs-string">example.com;</span>
<span class="hljs-attr">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>/sample/development/master/nginx.conf</code> might be as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs properties"><span class="hljs-attr">server</span> <span class="hljs-string">{</span>
    <span class="hljs-attr">listen</span>              <span class="hljs-string">80;</span>
    <span class="hljs-attr">server_name</span>         <span class="hljs-string">develop.com;</span>
<span class="hljs-attr">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-config-serving-plain-text-aws-s3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-serving-plain-text-aws-s3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-serving-plain-text-aws-s3">46.2. AWS S3</a></h3>
<div class="paragraph">
<p>To enable serving plain text for AWS s3, the Config Server application needs to include a dependency on Spring Cloud AWS.
For details on how to set up that dependency, see the
<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.1.3.RELEASE/single/spring-cloud-aws.html#_spring_cloud_aws_maven_dependency_management">Spring Cloud AWS Reference Guide</a>.
Then you need to configure Spring Cloud AWS, as described in the
<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.1.3.RELEASE/single/spring-cloud-aws.html#_configuring_credentials">Spring Cloud AWS Reference Guide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="decrypting-plain-text"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#decrypting-plain-text"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#decrypting-plain-text">46.3. Decrypting Plain Text</a></h3>
<div class="paragraph">
<p>By default, encrypted values in plain text files are not decrypted. In order to enable decryption for plain text files, set <code>spring.cloud.config.server.encrypt.enabled=true</code> and <code>spring.cloud.config.server.encrypt.plainTextEncrypt=true</code> in <code>bootstrap.[yml|properties]</code></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Decrypting plain text files is only supported for YAML, JSON, and properties file extensions.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If this feature is enabled, and an unsupported file extention is requested, any encrypted values in the file will not be decrypted.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="embedding-the-config-server"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#embedding-the-config-server"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#embedding-the-config-server">47. Embedding the Config Server</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Config Server runs best as a standalone application.
However, if need be, you can embed it in another application.
To do so, use the <code>@EnableConfigServer</code> annotation.
An optional property named <code>spring.cloud.config.server.bootstrap</code> can be useful in this case.
It is a flag to indicate whether the server should configure itself from its own remote repository.
By default, the flag is off, because it can delay startup.
However, when embedded in another application, it makes sense to initialize the same way as any other application.
When setting <code>spring.cloud.config.server.bootstrap</code> to <code>true</code> you must also use a <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#composite-environment-repositories">composite environment repository configuration</a>.
For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  application:
    name: configserver
  profiles:
    active: composite
  cloud:
    config:
      server:
        composite:
          - type: native
            search-locations: ${HOME}/Desktop/config
        bootstrap: true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use the bootstrap flag, the config server needs to have its name and repository URI configured in <code>bootstrap.yml</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To change the location of the server endpoints, you can (optionally) set <code>spring.cloud.config.server.prefix</code> (for example, <code>/config</code>), to serve the resources under a prefix.
The prefix should start but not end with a <code>/</code>.
It is applied to the <code>@RequestMappings</code> in the Config Server (that is, underneath the Spring Boot <code>server.servletPath</code> and <code>server.contextPath</code> prefixes).</p>
</div>
<div class="paragraph">
<p>If you want to read the configuration for an application directly from the backend repository (instead of from the config server), you
basically want an embedded config server with no endpoints.
You can switch off the endpoints entirely by not using the <code>@EnableConfigServer</code> annotation (set <code>spring.cloud.config.server.bootstrap=true</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="push-notifications-and-spring-cloud-bus"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#push-notifications-and-spring-cloud-bus"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#push-notifications-and-spring-cloud-bus">48. Push Notifications and Spring Cloud Bus</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Many source code repository providers (such as Github, Gitlab, Gitea, Gitee, Gogs, or Bitbucket) notify you of changes in a repository through a webhook.
You can configure the webhook through the provider’s user interface as a URL and a set of events in which you are interested.
For instance, <a href="https://developer.github.com/v3/activity/events/types/#pushevent">Github</a> uses a POST to the webhook with a JSON body containing a list of commits and a header (<code>X-Github-Event</code>) set to <code>push</code>.
If you add a dependency on the <code>spring-cloud-config-monitor</code> library and activate the Spring Cloud Bus in your Config Server, then a <code>/monitor</code> endpoint is enabled.</p>
</div>
<div class="paragraph">
<p>When the webhook is activated, the Config Server sends a <code>RefreshRemoteApplicationEvent</code> targeted at the applications it thinks might have changed.
The change detection can be strategized.
However, by default, it looks for changes in files that match the application name (for example, <code>foo.properties</code> is targeted at the <code>foo</code> application, while <code>application.properties</code> is targeted at all applications).
The strategy to use when you want to override the behavior is <code>PropertyPathNotificationExtractor</code>, which accepts the request headers and body as parameters and returns a list of file paths that changed.</p>
</div>
<div class="paragraph">
<p>The default configuration works out of the box with Github, Gitlab, Gitea, Gitee, Gogs or Bitbucket.
In addition to the JSON notifications from Github, Gitlab, Gitee, or Bitbucket, you can trigger a change notification by POSTing to <code>/monitor</code> with form-encoded body parameters in the pattern of <code>path={application}</code>.
Doing so broadcasts to applications matching the <code>{application}</code> pattern (which can contain wildcards).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>RefreshRemoteApplicationEvent</code> is transmitted only if the <code>spring-cloud-bus</code> is activated in both the Config Server and in the client application.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default configuration also detects filesystem changes in local git repositories. In that case, the webhook is not used. However, as soon as you edit a config file, a refresh is broadcast.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-config-client"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-client"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-config-client">49. Spring Cloud Config Client</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Spring Boot application can take immediate advantage of the Spring Config Server (or other external property sources provided by the application developer).
It also picks up some additional useful features related to <code>Environment</code> change events.</p>
</div>
<div class="sect2">
<h3 id="config-first-bootstrap"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#config-first-bootstrap"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#config-first-bootstrap">49.1. Config First Bootstrap</a></h3>
<div class="paragraph">
<p>The default behavior for any application that has the Spring Cloud Config Client on the classpath is as follows:
When a config client starts, it binds to the Config Server (through the <code>spring.cloud.config.uri</code> bootstrap configuration property) and initializes Spring <code>Environment</code> with remote property sources.</p>
</div>
<div class="paragraph">
<p>The net result of this behavior is that all client applications that want to consume the Config Server need a <code>bootstrap.yml</code> (or an environment variable) with the server address set in <code>spring.cloud.config.uri</code> (it defaults to "http://localhost:8888").</p>
</div>
</div>
<div class="sect2">
<h3 id="discovery-first-bootstrap"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discovery-first-bootstrap"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discovery-first-bootstrap">49.2. Discovery First Bootstrap</a></h3>
<div class="paragraph">
<p>If you use a <code>DiscoveryClient</code> implementation, such as Spring Cloud Netflix and Eureka Service Discovery or Spring Cloud Consul, you can have the Config Server register with the Discovery Service.
However, in the default “Config First” mode, clients cannot take advantage of the registration.</p>
</div>
<div class="paragraph">
<p>If you prefer to use <code>DiscoveryClient</code> to locate the Config Server, you can do so by setting <code>spring.cloud.config.discovery.enabled=true</code> (the default is <code>false</code>).
The net result of doing so is that client applications all need a <code>bootstrap.yml</code> (or an environment variable) with the appropriate discovery configuration.
For example, with Spring Cloud Netflix, you need to define the Eureka server address (for example, in <code>eureka.client.serviceUrl.defaultZone</code>).
The price for using this option is an extra network round trip on startup, to locate the service registration.
The benefit is that, as long as the Discovery Service is a fixed point, the Config Server can change its coordinates.
The default service ID is <code>configserver</code>, but you can change that on the client by setting <code>spring.cloud.config.discovery.serviceId</code> (and on the server, in the usual way for a service, such as by setting <code>spring.application.name</code>).</p>
</div>
<div class="paragraph">
<p>The discovery client implementations all support some kind of metadata map (for example, we have <code>eureka.instance.metadataMap</code> for Eureka).
Some additional properties of the Config Server may need to be configured in its service registration metadata so that clients can connect correctly.
If the Config Server is secured with HTTP Basic, you can configure the credentials as <code>user</code> and <code>password</code>.
Also, if the Config Server has a context path, you can set <code>configPath</code>.
For example, the following YAML file is for a Config Server that is a Eureka client:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">eureka:
  instance:
    ...
    metadataMap:
      user: osufhalskjrtl
      password: lviuhlszvaorhvlo5847
      configPath: /config</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="config-client-fail-fast"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#config-client-fail-fast"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#config-client-fail-fast">49.3. Config Client Fail Fast</a></h3>
<div class="paragraph">
<p>In some cases, you may want to fail startup of a service if it cannot connect to the Config Server.
If this is the desired behavior, set the bootstrap configuration property <code>spring.cloud.config.fail-fast=true</code> to make the client halt with an Exception.</p>
</div>
</div>
<div class="sect2">
<h3 id="config-client-retry"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#config-client-retry"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#config-client-retry">49.4. Config Client Retry</a></h3>
<div class="paragraph">
<p>If you expect that the config server may occasionally be unavailable when your application starts, you can make it keep trying after a failure.
First, you need to set <code>spring.cloud.config.fail-fast=true</code>.
Then you need to add <code>spring-retry</code> and <code>spring-boot-starter-aop</code> to your classpath.
The default behavior is to retry six times with an initial backoff interval of 1000ms and an exponential multiplier of 1.1 for subsequent backoffs.
You can configure these properties (and others) by setting the <code>spring.cloud.config.retry.*</code> configuration properties.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To take full control of the retry behavior, add a <code>@Bean</code> of type <code>RetryOperationsInterceptor</code> with an ID of <code>configServerRetryInterceptor</code>.
Spring Retry has a <code>RetryInterceptorBuilder</code> that supports creating one.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="locating-remote-configuration-resources"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#locating-remote-configuration-resources"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#locating-remote-configuration-resources">49.5. Locating Remote Configuration Resources</a></h3>
<div class="paragraph">
<p>The Config Service serves property sources from <code>/{application}/{profile}/{label}</code>, where the default bindings in the client app are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"name" = <code>${spring.application.name}</code></p>
</li>
<li>
<p>"profile" = <code>${spring.profiles.active}</code> (actually <code>Environment.getActiveProfiles()</code>)</p>
</li>
<li>
<p>"label" = "master"</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When setting the property <code>${spring.application.name}</code> do not prefix your app name with the reserved word <code>application-</code> to prevent issues resolving the correct property source.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can override all of them by setting <code>spring.cloud.config.*</code> (where <code>*</code> is <code>name</code>, <code>profile</code> or <code>label</code>).
The <code>label</code> is useful for rolling back to previous versions of configuration.
With the default Config Server implementation, it can be a git label, branch name, or commit ID.
Label can also be provided as a comma-separated list.
In that case, the items in the list are tried one by one until one succeeds.
This behavior can be useful when working on a feature branch.
For instance, you might want to align the config label with your branch but make it optional (in that case, use <code>spring.cloud.config.label=myfeature,develop</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="specifying-multiple-urls-for-the-config-server"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#specifying-multiple-urls-for-the-config-server"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#specifying-multiple-urls-for-the-config-server">49.6. Specifying Multiple Urls for the Config Server</a></h3>
<div class="paragraph">
<p>To ensure high availability when you have multiple instances of Config Server deployed and expect one or more instances to be unavailable from time to time, you can either specify multiple URLs (as a comma-separated list under the <code>spring.cloud.config.uri</code> property) or have all your instances register in a Service Registry like Eureka ( if using Discovery-First Bootstrap mode ). Note that doing so ensures high availability only when the Config Server is not running (that is, when the application has exited) or when a connection timeout has occurred. For example, if the Config Server returns a 500 (Internal Server Error) response or the Config Client receives a 401 from the Config Server (due to bad credentials or other causes), the Config Client does not try to fetch properties from other URLs. An error of that kind indicates a user issue rather than an availability problem.</p>
</div>
<div class="paragraph">
<p>If you use HTTP basic security on your Config Server, it is currently possible to support per-Config Server auth credentials only if you embed the credentials in each URL you specify under the <code>spring.cloud.config.uri</code> property. If you use any other kind of security mechanism, you cannot (currently) support per-Config Server authentication and authorization.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-timeouts"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-timeouts"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-timeouts">49.7. Configuring Timeouts</a></h3>
<div class="paragraph">
<p>If you want to configure timeout thresholds:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Read timeouts can be configured by using the property <code>spring.cloud.config.request-read-timeout</code>.</p>
</li>
<li>
<p>Connection timeouts can be configured by using the property <code>spring.cloud.config.request-connect-timeout</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="security-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#security-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#security-2">49.8. Security</a></h3>
<div class="paragraph">
<p>If you use HTTP Basic security on the server, clients need to know the password (and username if it is not the default).
You can specify the username and password through the config server URI or via separate username and password properties, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
     uri: https://user:secret@myconfig.mycompany.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows an alternate way to pass the same information:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
     uri: https://myconfig.mycompany.com
     username: user
     password: secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>spring.cloud.config.password</code> and <code>spring.cloud.config.username</code> values override anything that is provided in the URI.</p>
</div>
<div class="paragraph">
<p>If you deploy your apps on Cloud Foundry, the best way to provide the password is through service credentials (such as in the URI, since it does not need to be in a config file).
The following example works locally and for a user-provided service on Cloud Foundry named <code>configserver</code>:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
     uri: ${vcap.services.configserver.credentials.uri:http://user:password@localhost:8888}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If config server requires client side TLS certificate, you can configure client side TLS certificate and trust store via properties, as shown in following example:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      uri: https://myconfig.myconfig.com
      tls:
        enabled: true
        key-store: &lt;path-of-key-store&gt;
        key-store-type: PKCS12
        key-store-password: &lt;key-store-password&gt;
        key-password: &lt;key-password&gt;
        trust-store: &lt;path-of-trust-store&gt;
        trust-store-type: PKCS12
        trust-store-password: &lt;trust-store-password&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>spring.cloud.config.tls.enabled</code> needs to be true to enable config client side TLS. When <code>spring.cloud.config.tls.trust-store</code> is omitted, a JVM default trust store is used. The default value for <code>spring.cloud.config.tls.key-store-type</code> and <code>spring.cloud.config.tls.trust-store-type</code> is PKCS12. When password properties are omitted, empty password is assumed.</p>
</div>
<div class="paragraph">
<p>If you use another form of security, you might need to <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-rest-template">provide a <code>RestTemplate</code></a> to the <code>ConfigServicePropertySourceLocator</code> (for example, by grabbing it in the bootstrap context and injecting it).</p>
</div>
<div class="sect3">
<h4 id="health-indicator-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#health-indicator-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#health-indicator-3">49.8.1. Health Indicator</a></h4>
<div class="paragraph">
<p>The Config Client supplies a Spring Boot Health Indicator that attempts to load configuration from the Config Server.
The health indicator can be disabled by setting <code>health.config.enabled=false</code>.
The response is also cached for performance reasons.
The default cache time to live is 5 minutes.
To change that value, set the <code>health.config.time-to-live</code> property (in milliseconds).</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-rest-template"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-rest-template"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-rest-template">49.8.2. Providing A Custom RestTemplate</a></h4>
<div class="paragraph">
<p>In some cases, you might need to customize the requests made to the config server from the client.
Typically, doing so involves passing special <code>Authorization</code> headers to authenticate requests to the server.
To provide a custom <code>RestTemplate</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new configuration bean with an implementation of <code>PropertySourceLocator</code>, as shown in the following example:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">CustomConfigServiceBootstrapConfiguration.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomConfigServiceBootstrapConfiguration</span> </span>{
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ConfigServicePropertySourceLocator <span class="hljs-title">configServicePropertySourceLocator</span><span class="hljs-params">()</span> </span>{
        ConfigClientProperties clientProperties = configClientProperties();
       ConfigServicePropertySourceLocator configServicePropertySourceLocator =  <span class="hljs-keyword">new</span> ConfigServicePropertySourceLocator(clientProperties);
        configServicePropertySourceLocator.setRestTemplate(customRestTemplate(clientProperties));
        <span class="hljs-keyword">return</span> configServicePropertySourceLocator;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For a simplified approach to adding <code>Authorization</code> headers, the <code>spring.cloud.config.headers.*</code> property can be used instead.
</td>
</tr>
</tbody></table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In <code>resources/META-INF</code>, create a file called
<code>spring.factories</code> and specify your custom configuration, as shown in the following example:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">spring.factories</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"><span class="hljs-meta">org.springframework.cloud.bootstrap.BootstrapConfiguration</span> = <span class="hljs-string">com.my.config.client.CustomConfigServiceBootstrapConfiguration</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="vault"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault">49.8.3. Vault</a></h4>
<div class="paragraph">
<p>When using Vault as a backend to your config server, the client needs to supply a token for the server to retrieve values from Vault.
This token can be provided within the client by setting <code>spring.cloud.config.token</code>
in <code>bootstrap.yml</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    config:
      token: YourVaultToken</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="nested-keys-in-vault"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#nested-keys-in-vault"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#nested-keys-in-vault">49.9. Nested Keys In Vault</a></h3>
<div class="paragraph">
<p>Vault supports the ability to nest keys in a value stored in Vault, as shown in the following example:</p>
</div>
<div class="paragraph">
<p><code>echo -n '{"appA": {"secret": "appAsecret"}, "bar": "baz"}' | vault write secret/myapp -</code></p>
</div>
<div class="paragraph">
<p>This command writes a JSON object to your Vault.
To access these values in Spring, you would use the traditional dot(<code>.</code>) annotation, as shown in the following example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Value</span>(<span class="hljs-string">"${appA.secret}"</span>)
String name = <span class="hljs-string">"World"</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding code would sets the value of the <code>name</code> variable to <code>appAsecret</code>.</p>
</div>
</div>
</div>
</div>
<h1 id="spring-cloud-consul" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul">Spring Cloud Consul</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><strong>Hoxton.SR10</strong></p>
</div>
<div class="paragraph">
<p>This project provides Consul integrations for Spring Boot apps through autoconfiguration
and binding to the Spring Environment and other Spring programming model idioms. With a few
simple annotations you can quickly enable and configure the common patterns inside your
application and build large distributed systems with Consul based components. The
patterns provided include Service Discovery, Control Bus and Configuration.
Intelligent Routing (Zuul) and Client Side Load Balancing (Ribbon), Circuit Breaker
(Hystrix) are provided by integration with Spring Cloud Netflix.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-install"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-install"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-install">50. Install Consul</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Please see the <a href="https://www.consul.io/intro/getting-started/install.html">installation documentation</a> for instructions on how to install Consul.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-agent"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-agent"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-agent">51. Consul Agent</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Consul Agent client must be available to all Spring Cloud Consul applications. By default, the Agent client is expected to be at <code>localhost:8500</code>. See the <a href="https://consul.io/docs/agent/basics.html">Agent documentation</a> for specifics on how to start an Agent client and how to connect to a cluster of Consul Agent Servers. For development, after you have installed consul, you may start a Consul Agent using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./src/main/bash/local_run_consul.sh</pre>
</div>
</div>
<div class="paragraph">
<p>This will start an agent in server mode on port 8500, with the ui available at <a href="http://localhost:8500/" class="bare">localhost:8500</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-discovery"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-discovery"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-discovery">52. Service Discovery with Consul</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Service Discovery is one of the key tenets of a microservice based architecture. Trying to hand configure each client or some form of convention can be very difficult to do and can be very brittle. Consul provides Service Discovery services via an <a href="https://www.consul.io/docs/agent/http.html">HTTP API</a> and <a href="https://www.consul.io/docs/agent/dns.html">DNS</a>. Spring Cloud Consul leverages the HTTP API for service registration and discovery. This does not prevent non-Spring Cloud applications from leveraging the DNS interface. Consul Agents servers are run in a <a href="https://www.consul.io/docs/internals/architecture.html">cluster</a> that communicates via a <a href="https://www.consul.io/docs/internals/gossip.html">gossip protocol</a> and uses the <a href="https://www.consul.io/docs/internals/consensus.html">Raft consensus protocol</a>.</p>
</div>
<div class="sect2">
<h3 id="how-to-activate"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-activate"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-activate">52.1. How to activate</a></h3>
<div class="paragraph">
<p>To activate Consul Service Discovery use the starter with group <code>org.springframework.cloud</code> and artifact id <code>spring-cloud-starter-consul-discovery</code>. See the <a href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a> for details on setting up your build system with the current Spring Cloud Release Train.</p>
</div>
</div>
<div class="sect2">
<h3 id="registering-with-consul"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-with-consul"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-with-consul">52.2. Registering with Consul</a></h3>
<div class="paragraph">
<p>When a client registers with Consul, it provides meta-data about itself such as host and port, id, name and tags. An HTTP <a href="https://www.consul.io/docs/agent/checks.html">Check</a> is created by default that Consul hits the <code>/actuator/health</code> endpoint every 10 seconds. If the health check fails, the service instance is marked as critical.</p>
</div>
<div class="paragraph">
<p>Example Consul client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{

    <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">home</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello world"</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        <span class="hljs-keyword">new</span> SpringApplicationBuilder(Application.class).web(<span class="hljs-keyword">true</span>).run(args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>(i.e. utterly normal Spring Boot app). If the Consul client is located somewhere other than <code>localhost:8500</code>, the configuration is required to locate the client. Example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>spring:
  cloud:
    consul:
      host: localhost
      port: 8500</pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
If you use <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-config">Spring Cloud Consul Config</a>, the above values will need to be placed in <code>bootstrap.yml</code> instead of <code>application.yml</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The default service name, instance id and port, taken from the <code>Environment</code>, are <code>${spring.application.name}</code>, the Spring Context ID and <code>${server.port}</code> respectively.</p>
</div>
<div class="paragraph">
<p>To disable the Consul Discovery Client you can set <code>spring.cloud.consul.discovery.enabled</code> to <code>false</code>. Consul Discovery Client will also be disabled when <code>spring.cloud.discovery.enabled</code> is set to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>To disable the service registration you can set <code>spring.cloud.consul.discovery.register</code> to <code>false</code>.</p>
</div>
<div class="sect3">
<h4 id="registering-management-as-a-separate-service"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-management-as-a-separate-service"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-management-as-a-separate-service">52.2.1. Registering Management as a Separate Service</a></h4>
<div class="paragraph">
<p>When management server port is set to something different than the application port, by setting <code>management.server.port</code> property, management service will be registered as a separate service than the application service. For example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>spring:
  application:
    name: myApp
management:
  server:
    port: 4452</pre>
</div>
</div>
<div class="paragraph">
<p>Above configuration will register following 2 services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application Service:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>ID: myApp
Name: myApp</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Management Service:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>ID: myApp-management
Name: myApp-management</pre>
</div>
</div>
<div class="paragraph">
<p>Management service will inherit its <code>instanceId</code> and <code>serviceName</code> from the application service. For example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>spring:
  application:
    name: myApp
management:
  server:
    port: 4452
spring:
  cloud:
    consul:
      discovery:
        instance-id: custom-service-id
        serviceName: myprefix-${spring.application.name}</pre>
</div>
</div>
<div class="paragraph">
<p>Above configuration will register following 2 services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application Service:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>ID: custom-service-id
Name: myprefix-myApp</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Management Service:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>ID: custom-service-id-management
Name: myprefix-myApp-management</pre>
</div>
</div>
<div class="paragraph">
<p>Further customization is possible via following properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/** Port to register the management service under (defaults to management port) */
spring.cloud.consul.discovery.management-port

/** Suffix to use when registering management service (defaults to "management" */
spring.cloud.consul.discovery.management-suffix

/** Tags to use when registering management service (defaults to "management" */
spring.cloud.consul.discovery.management-tags</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http-health-check"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-health-check"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-health-check">52.2.2. HTTP Health Check</a></h4>
<div class="paragraph">
<p>The health check for a Consul instance defaults to "/actuator/health", which is the default location of the health endpoint in a Spring Boot Actuator application. You need to change this, even for an Actuator application, if you use a non-default context path or servlet path (e.g. <code>server.servletPath=/foo</code>) or management endpoint path (e.g. <code>management.server.servlet.context-path=/admin</code>).</p>
</div>
<div class="paragraph">
<p>The interval that Consul uses to check the health endpoint may also be configured. "10s" and "1m" represent 10 seconds and 1 minute respectively.</p>
</div>
<div class="paragraph">
<p>This example illustrates the above (see the <code>spring.cloud.consul.discovery.health-check-*</code> properties in <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/appendix.html">the appendix page</a> for more options).</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>spring:
  cloud:
    consul:
      discovery:
        healthCheckPath: ${management.server.servlet.context-path}/actuator/health
        healthCheckInterval: 15s</pre>
</div>
</div>
<div class="paragraph">
<p>You can disable the HTTP health check entirely by setting <code>spring.cloud.consul.discovery.register-health-check=false</code>.</p>
</div>
<div class="sect4">
<h5 id="applying-headers"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#applying-headers"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#applying-headers">Applying Headers</a></h5>
<div class="paragraph">
<p>Headers can be applied to health check requests. For example, if you’re trying to register a <a href="https://cloud.spring.io/spring-cloud-config/">Spring Cloud Config</a> server that uses <a href="https://github.com/spring-cloud/spring-cloud-config/blob/master/docs/src/main/asciidoc/spring-cloud-config.adoc#vault-backend">Vault Backend</a>:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>spring:
  cloud:
    consul:
      discovery:
        health-check-headers:
          X-Config-Token: 6442e58b-d1ea-182e-cfa5-cf9cddef0722</pre>
</div>
</div>
<div class="paragraph">
<p>According to the HTTP standard, each header can have more than one values, in which case, an array can be supplied:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>spring:
  cloud:
    consul:
      discovery:
        health-check-headers:
          X-Config-Token:
            - "6442e58b-d1ea-182e-cfa5-cf9cddef0722"
            - "Some other value"</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="actuator-health-indicators"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#actuator-health-indicators"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#actuator-health-indicators">52.2.3. Actuator Health Indicator(s)</a></h4>
<div class="paragraph">
<p>If the service instance is a Spring Boot Actuator application, it may be provided the following Actuator health indicators.</p>
</div>
<div class="sect4">
<h5 id="discoveryclienthealthindicator"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discoveryclienthealthindicator"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discoveryclienthealthindicator">DiscoveryClientHealthIndicator</a></h5>
<div class="paragraph">
<p>When Consul Service Discovery is active, a <a href="https://cloud.spring.io/spring-cloud-commons/2.2.x/reference/html/#health-indicator">DiscoverClientHealthIndicator</a> is configured and made available to the Actuator health endpoint.
See <a href="https://cloud.spring.io/spring-cloud-commons/2.2.x/reference/html/#health-indicator">here</a> for configuration options.</p>
</div>
</div>
<div class="sect4">
<h5 id="consulhealthindicator"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#consulhealthindicator"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#consulhealthindicator">ConsulHealthIndicator</a></h5>
<div class="paragraph">
<p>An indicator is configured that verifies the health of the <code>ConsulClient</code>.</p>
</div>
<div class="paragraph">
<p>By default, it retrieves the Consul leader node status and all registered services.
In deployments that have many registered services it may be costly to retrieve all services on every health check.
To skip the service retrieval and only check the leader node status set <code>spring.cloud.consul.health-indicator.include-services-query=false</code>.</p>
</div>
<div class="paragraph">
<p>To disable the indicator set <code>management.health.consul.enabled=false</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
When the application runs in <a href="https://cloud.spring.io/spring-cloud-commons/2.2.x/reference/html/#the-bootstrap-application-context">bootstrap context mode</a> (the default),
this indicator is loaded into the bootstrap context and is not made available to the Actuator health endpoint.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="metadata-and-consul-tags"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#metadata-and-consul-tags"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#metadata-and-consul-tags">52.2.4. Metadata and Consul tags</a></h4>
<div class="paragraph">
<p>Consul does not yet support metadata on services. Spring Cloud’s <code>ServiceInstance</code> has a <code>Map&lt;String, String&gt; metadata</code> field. Spring Cloud Consul uses Consul tags to approximate metadata until Consul officially supports metadata. Tags with the form <code>key=value</code> will be split and used as a <code>Map</code> key and value respectively. Tags without the equal <code>=</code> sign, will be used as both the key and value.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>spring:
  cloud:
    consul:
      discovery:
        tags: foo=bar, baz</pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration will result in a map with <code>foo→bar</code> and <code>baz→baz</code>.</p>
</div>
<div class="sect4">
<h5 id="generated-metadata"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#generated-metadata"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#generated-metadata">Generated Metadata</a></h5>
<div class="paragraph">
<p>The Consul Auto Registration will generate a few entries automatically.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Auto Generated Metadata</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'group'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property <code>spring.cloud.consul.discovery.instance-group</code>. This values is only generated if <code>instance-group</code> is not empty.'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'secure'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True if property <code>spring.cloud.consul.discovery.scheme</code> equals 'https', otherwise false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property <code>spring.cloud.consul.discovery.default-zone-metadata-name</code>, defaults to 'zone'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property <code>spring.cloud.consul.discovery.instance-zone</code>. This values is only generated if <code>instance-zone</code> is not empty.'</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="official-consul-metadata"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#official-consul-metadata"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#official-consul-metadata">Official Consul Metadata</a></h5>
<div class="paragraph">
<p>Consul added official support for a <code>meta</code> field that is a <code>Map&lt;String, String&gt;</code>. Spring Cloud Consul has added <code>spring.cloud.consul.discovery.metadata</code> and <code>spring.cloud.consul.discovery.management-metadata</code> properties to support it.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, the <code>ServiceInstance.getMetadata()</code> method from Spring Cloud Commons will continue to populated by parsing the <code>spring.cloud.consul.discovery.tags</code> property for backwards compatibility. To change this behaviour set <code>spring.cloud.consul.discovery.tags-as-metadata=false</code> and the metadata will be populated from <code>spring.cloud.consul.discovery.metadata</code>. In a future version, parsing the <code>tags</code> property will be removed.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="making-the-consul-instance-id-unique"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#making-the-consul-instance-id-unique"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#making-the-consul-instance-id-unique">52.2.5. Making the Consul Instance ID Unique</a></h4>
<div class="paragraph">
<p>By default a consul instance is registered with an ID that is equal to its Spring Application Context ID. By default, the Spring Application Context ID is <code>${spring.application.name}:comma,separated,profiles:${server.port}</code>. For most cases, this will allow multiple instances of one service to run on one machine. If further uniqueness is required, Using Spring Cloud you can override this by providing a unique identifier in <code>spring.cloud.consul.discovery.instanceId</code>. For example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>spring:
  cloud:
    consul:
      discovery:
        instanceId: ${spring.application.name}:${vcap.application.instance_id:${spring.application.instance_id:${random.value}}}</pre>
</div>
</div>
<div class="paragraph">
<p>With this metadata, and multiple service instances deployed on localhost, the random value will kick in there to make the instance unique. In Cloudfoundry the <code>vcap.application.instance_id</code> will be populated automatically in a Spring Boot application, so the random value will not be needed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="looking-up-services"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#looking-up-services"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#looking-up-services">52.3. Looking up services</a></h3>
<div class="sect3">
<h4 id="using-load-balancer"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-load-balancer"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-load-balancer">52.3.1. Using Load-balancer</a></h4>
<div class="paragraph">
<p>Spring Cloud has support for <a href="https://github.com/spring-cloud/spring-cloud-netflix/blob/master/docs/src/main/asciidoc/spring-cloud-netflix.adoc#spring-cloud-feign">Feign</a> (a REST client builder) and also <a href="https://github.com/spring-cloud/spring-cloud-netflix/blob/master/docs/src/main/asciidoc/spring-cloud-netflix.adoc#spring-cloud-ribbon">Spring <code>RestTemplate</code></a>
for looking up services using the logical service names/ids instead of physical URLs. Both Feign and the discovery-aware RestTemplate utilize <a href="https://cloud.spring.io/spring-cloud-netflix/single/spring-cloud-netflix.html#spring-cloud-ribbon">Ribbon</a> for client-side load balancing.</p>
</div>
<div class="paragraph">
<p>If you want to access service STORES using the RestTemplate simply declare:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@LoadBalanced
@Bean
public RestTemplate loadbalancedRestTemplate() {
     return new RestTemplate();
}</pre>
</div>
</div>
<div class="paragraph">
<p>and use it like this (notice how we use the STORES service name/id from Consul instead of a fully qualified domainname):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@Autowired
RestTemplate restTemplate;

public String getFirstProduct() {
   return this.restTemplate.getForObject("https://STORES/products/1", String.class);
}</pre>
</div>
</div>
<div class="paragraph">
<p>If you have Consul clusters in multiple datacenters and you want to access a service in another datacenter a service name/id alone is not enough. In that case
you use property <code>spring.cloud.consul.discovery.datacenters.STORES=dc-west</code> where <code>STORES</code> is the service name/id and <code>dc-west</code> is the datacenter
where the STORES service lives.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Spring Cloud now also offers support for
<a href="https://cloud.spring.io/spring-cloud-commons/reference/html/#_spring_resttemplate_as_a_load_balancer_client">Spring Cloud LoadBalancer</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As Spring Cloud Ribbon is now under maintenance, we suggest you set <code>spring.cloud.loadbalancer.ribbon.enabled</code>
to <code>false</code>, so that <code>BlockingLoadBalancerClient</code> is used instead of <code>RibbonLoadBalancerClient</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-the-discoveryclient"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-the-discoveryclient"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-the-discoveryclient">52.3.2. Using the DiscoveryClient</a></h4>
<div class="paragraph">
<p>You can also use the <code>org.springframework.cloud.client.discovery.DiscoveryClient</code> which provides a simple API for discovery clients that is not specific to Netflix, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@Autowired
private DiscoveryClient discoveryClient;

public String serviceUrl() {
    List&lt;ServiceInstance&gt; list = discoveryClient.getInstances("STORES");
    if (list != null &amp;&amp; list.size() &gt; 0 ) {
        return list.get(0).getUri();
    }
    return null;
}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="consul-catalog-watch"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#consul-catalog-watch"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#consul-catalog-watch">52.4. Consul Catalog Watch</a></h3>
<div class="paragraph">
<p>The Consul Catalog Watch takes advantage of the ability of consul to <a href="https://www.consul.io/docs/agent/watches.html#services">watch services</a>. The Catalog Watch makes a blocking Consul HTTP API call to determine if any services have changed. If there is new service data a Heartbeat Event is published.</p>
</div>
<div class="paragraph">
<p>To change the frequency of when the Config Watch is called change <code>spring.cloud.consul.config.discovery.catalog-services-watch-delay</code>. The default value is 1000, which is in milliseconds. The delay is the amount of time after the end of the previous invocation and the start of the next.</p>
</div>
<div class="paragraph">
<p>To disable the Catalog Watch set <code>spring.cloud.consul.discovery.catalogServicesWatch.enabled=false</code>.</p>
</div>
<div class="paragraph">
<p>The watch uses a Spring <code>TaskScheduler</code> to schedule the call to consul. By default it is a <code>ThreadPoolTaskScheduler</code> with a <code>poolSize</code> of 1. To change the <code>TaskScheduler</code>, create a bean of type <code>TaskScheduler</code> named with the <code>ConsulDiscoveryClientConfiguration.CATALOG_WATCH_TASK_SCHEDULER_NAME</code> constant.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-config"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-config"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-config">53. Distributed Configuration with Consul</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consul provides a <a href="https://consul.io/docs/agent/http/kv.html">Key/Value Store</a> for storing configuration and other metadata. Spring Cloud Consul Config is an alternative to the <a href="https://github.com/spring-cloud/spring-cloud-config">Config Server and Client</a>. Configuration is loaded into the Spring Environment during the special "bootstrap" phase. Configuration is stored in the <code>/config</code> folder by default. Multiple <code>PropertySource</code> instances are created based on the application’s name and the active profiles that mimicks the Spring Cloud Config order of resolving properties. For example, an application with the name "testApp" and with the "dev" profile will have the following property sources created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>config/testApp,dev/
config/testApp/
config/application,dev/
config/application/</pre>
</div>
</div>
<div class="paragraph">
<p>The most specific property source is at the top, with the least specific at the bottom. Properties in the <code>config/application</code> folder are applicable to all applications using consul for configuration. Properties in the <code>config/testApp</code> folder are only available to the instances of the service named "testApp".</p>
</div>
<div class="paragraph">
<p>Configuration is currently read on startup of the application. Sending a HTTP POST to <code>/refresh</code> will cause the configuration to be reloaded. <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-config-watch">Config Watch</a> will also automatically detect changes and reload the application context.</p>
</div>
<div class="sect2">
<h3 id="how-to-activate-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-activate-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-activate-2">53.1. How to activate</a></h3>
<div class="paragraph">
<p>To get started with Consul Configuration use the starter with group <code>org.springframework.cloud</code> and artifact id <code>spring-cloud-starter-consul-config</code>. See the <a href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a> for details on setting up your build system with the current Spring Cloud Release Train.</p>
</div>
<div class="paragraph">
<p>This will enable auto-configuration that will setup Spring Cloud Consul Config.</p>
</div>
</div>
<div class="sect2">
<h3 id="customizing"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing">53.2. Customizing</a></h3>
<div class="paragraph">
<p>Consul Config may be customized using the following properties:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre>spring:
  cloud:
    consul:
      config:
        enabled: true
        prefix: configuration
        defaultContext: apps
        profileSeparator: '::'</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> setting this value to "false" disables Consul Config</p>
</li>
<li>
<p><code>prefix</code> sets the base folder for configuration values</p>
</li>
<li>
<p><code>defaultContext</code> sets the folder name used by all applications</p>
</li>
<li>
<p><code>profileSeparator</code> sets the value of the separator used to separate the profile name in property sources with profiles</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-consul-config-watch"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-config-watch"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-config-watch">53.3. Config Watch</a></h3>
<div class="paragraph">
<p>The Consul Config Watch takes advantage of the ability of consul to <a href="https://www.consul.io/docs/agent/watches.html#keyprefix">watch a key prefix</a>. The Config Watch makes a blocking Consul HTTP API call to determine if any relevant configuration data has changed for the current application. If there is new configuration data a Refresh Event is published. This is equivalent to calling the <code>/refresh</code> actuator endpoint.</p>
</div>
<div class="paragraph">
<p>To change the frequency of when the Config Watch is called change <code>spring.cloud.consul.config.watch.delay</code>. The default value is 1000, which is in milliseconds. The delay is the amount of time after the end of the previous invocation and the start of the next.</p>
</div>
<div class="paragraph">
<p>To disable the Config Watch set <code>spring.cloud.consul.config.watch.enabled=false</code>.</p>
</div>
<div class="paragraph">
<p>The watch uses a Spring <code>TaskScheduler</code> to schedule the call to consul. By default it is a <code>ThreadPoolTaskScheduler</code> with a <code>poolSize</code> of 1. To change the <code>TaskScheduler</code>, create a bean of type <code>TaskScheduler</code> named with the <code>ConsulConfigAutoConfiguration.CONFIG_WATCH_TASK_SCHEDULER_NAME</code> constant.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-consul-config-format"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-config-format"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-config-format">53.4. YAML or Properties with Config</a></h3>
<div class="paragraph">
<p>It may be more convenient to store a blob of properties in YAML or Properties format as opposed to individual key/value pairs. Set the <code>spring.cloud.consul.config.format</code> property to <code>YAML</code> or <code>PROPERTIES</code>. For example to use YAML:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre>spring:
  cloud:
    consul:
      config:
        format: YAML</pre>
</div>
</div>
<div class="paragraph">
<p>YAML must be set in the appropriate <code>data</code> key in consul. Using the defaults above the keys would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>config/testApp,dev/data
config/testApp/data
config/application,dev/data
config/application/data</pre>
</div>
</div>
<div class="paragraph">
<p>You could store a YAML document in any of the keys listed above.</p>
</div>
<div class="paragraph">
<p>You can change the data key using <code>spring.cloud.consul.config.data-key</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-consul-config-git2consul"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-config-git2consul"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-config-git2consul">53.5. git2consul with Config</a></h3>
<div class="paragraph">
<p>git2consul is a Consul community project that loads files from a git repository to individual keys into Consul. By default the names of the keys are names of the files. YAML and Properties files are supported with file extensions of <code>.yml</code> and <code>.properties</code> respectively. Set the <code>spring.cloud.consul.config.format</code> property to <code>FILES</code>. For example:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre>spring:
  cloud:
    consul:
      config:
        format: FILES</pre>
</div>
</div>
<div class="paragraph">
<p>Given the following keys in <code>/config</code>, the <code>development</code> profile and an application name of <code>foo</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.gitignore
application.yml
bar.properties
foo-development.properties
foo-production.yml
foo.properties
master.ref</pre>
</div>
</div>
<div class="paragraph">
<p>the following property sources would be created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>config/foo-development.properties
config/foo.properties
config/application.yml</pre>
</div>
</div>
<div class="paragraph">
<p>The value of each key needs to be a properly formatted YAML or Properties file.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-consul-failfast"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-failfast"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-failfast">53.6. Fail Fast</a></h3>
<div class="paragraph">
<p>It may be convenient in certain circumstances (like local development or certain test scenarios) to not fail if consul isn’t available for configuration. Setting <code>spring.cloud.consul.config.failFast=false</code> in <code>bootstrap.yml</code> will cause the configuration module to log a warning rather than throw an exception. This will allow the application to continue startup normally.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-retry"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-retry"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-retry">54. Consul Retry</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you expect that the consul agent may occasionally be unavailable when
your app starts, you can ask it to keep trying after a failure. You need to add
<code>spring-retry</code> and <code>spring-boot-starter-aop</code> to your classpath. The default
behaviour is to retry 6 times with an initial backoff interval of 1000ms and an
exponential multiplier of 1.1 for subsequent backoffs. You can configure these
properties (and others) using <code>spring.cloud.consul.retry.*</code> configuration properties.
This works with both Spring Cloud Consul Config and Discovery registration.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To take full control of the retry add a <code>@Bean</code> of type
<code>RetryOperationsInterceptor</code> with id "consulRetryInterceptor". Spring
Retry has a <code>RetryInterceptorBuilder</code> that makes it easy to create one.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-bus"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-bus"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-bus">55. Spring Cloud Bus with Consul</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="how-to-activate-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-activate-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-activate-3">55.1. How to activate</a></h3>
<div class="paragraph">
<p>To get started with the Consul Bus use the starter with group <code>org.springframework.cloud</code> and artifact id <code>spring-cloud-starter-consul-bus</code>. See the <a href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a> for details on setting up your build system with the current Spring Cloud Release Train.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://cloud.spring.io/spring-cloud-bus/">Spring Cloud Bus</a> documentation for the available actuator endpoints and howto send custom messages.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-hystrix"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-hystrix"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-hystrix">56. Circuit Breaker with Hystrix</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Applications can use the Hystrix Circuit Breaker provided by the Spring Cloud Netflix project by including this starter in the projects pom.xml: <code>spring-cloud-starter-hystrix</code>. Hystrix doesn’t depend on the Netflix Discovery Client. The <code>@EnableHystrix</code> annotation should be placed on a configuration class (usually the main class). Then methods can be annotated with <code>@HystrixCommand</code> to be protected by a circuit breaker. See <a href="https://projects.spring.io/spring-cloud/spring-cloud.html#_circuit_breaker_hystrix_clients">the documentation</a> for more details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-consul-turbine"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-turbine"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-consul-turbine">57. Hystrix metrics aggregation with Turbine and Consul</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Turbine (provided by the Spring Cloud Netflix project), aggregates multiple instances Hystrix metrics streams, so the dashboard can display an aggregate view. Turbine uses the <code>DiscoveryClient</code> interface to lookup relevant instances. To use Turbine with Spring Cloud Consul, configure the Turbine application in a manner similar to the following examples:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-netflix-turbine&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the Turbine dependency is not a starter. The turbine starter includes support for Netflix Eureka.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>spring.application.name: turbine
applications: consulhystrixclient
turbine:
  aggregator:
    clusterConfig: ${applications}
  appConfig: ${applications}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>clusterConfig</code> and <code>appConfig</code> sections must match, so it’s useful to put the comma-separated list of service ID’s into a separate configuration property.</p>
</div>
<div class="listingblock">
<div class="title">Turbine.java</div>
<div class="content">
<pre>@EnableTurbine
@SpringBootApplication
public class Turbine {
    public static void main(String[] args) {
        SpringApplication.run(DemoturbinecommonsApplication.class, args);
    }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-properties-4"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-4"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-4">58. Configuration Properties</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To see the list of all Consul related configuration properties please check <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/appendix.html">the Appendix page</a>.</p>
</div>
<div class="paragraph">
<p>index.htmladoc</p>
</div>
</div>
</div>
<h1 id="spring-cloud-function" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-function"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-function">Spring Cloud Function</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Mark Fisher, Dave Syer, Oleg Zhurakousky, Anshul Mehra</p>
</div>
<div class="paragraph">
<p><strong>3.0.13.RELEASE</strong></p>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="introduction-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#introduction-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#introduction-2">59. Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Function is a project with the following high-level goals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Promote the implementation of business logic via functions.</p>
</li>
<li>
<p>Decouple the development lifecycle of business logic from any specific runtime target so that the same code can run as a web endpoint, a stream processor, or a task.</p>
</li>
<li>
<p>Support a uniform programming model across serverless providers, as well as the ability to run standalone (locally or in a PaaS).</p>
</li>
<li>
<p>Enable Spring Boot features (auto-configuration, dependency injection, metrics) on serverless providers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It abstracts away all of the transport details and
infrastructure, allowing the developer to keep all the familiar tools
and processes, and focus firmly on business logic.</p>
</div>
<div class="paragraph">
<p>Here’s a complete, executable, testable Spring Boot application
(implementing a simple string manipulation):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{

  <span class="hljs-meta">@Bean</span>
  <span class="hljs-keyword">public</span> Function&lt;Flux&lt;String&gt;, Flux&lt;String&gt;&gt; uppercase() {
    <span class="hljs-keyword">return</span> flux -&gt; flux.map(value -&gt; value.toUpperCase());
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
    SpringApplication.run(Application.class, args);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It’s just a Spring Boot application, so it can be built, run and
tested, locally and in a CI build, the same way as any other Spring
Boot application. The <code>Function</code> is from <code>java.util</code> and <code>Flux</code> is a
<a href="https://www.reactive-streams.org/">Reactive Streams</a> <code>Publisher</code> from
<a href="https://projectreactor.io/">Project Reactor</a>. The function can be
accessed over HTTP or messaging.</p>
</div>
<div class="paragraph">
<p>Spring Cloud Function has 4 main features:</p>
</div>
<div class="paragraph">
<p>In the nutshell Spring Cloud Function provides the following features:
1. Wrappers for <code>@Beans</code> of type <code>Function</code>, <code>Consumer</code> and
<code>Supplier</code>, exposing them to the outside world as either HTTP
endpoints and/or message stream listeners/publishers with RabbitMQ, Kafka etc.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Choice of programming styles - reactive, imperative or hybrid.</em></p>
</li>
<li>
<p><em>Function composition and adaptation (e.g., composing imperative functions with reactive).</em></p>
</li>
<li>
<p><em>Support for reactive function with multiple inputs and outputs allowing merging, joining and other complex streaming operation to be handled by functions.</em></p>
</li>
<li>
<p><em>Transparent type conversion of inputs and outputs.</em></p>
</li>
<li>
<p><em>Packaging functions for deployments, specific to the target platform (e.g., Project Riff, AWS Lambda and more)</em></p>
</li>
<li>
<p><em>Adapters to expose function to the outside world as HTTP endpoints etc.</em></p>
</li>
<li>
<p><em>Deploying a JAR file containing such an application context with an isolated classloader, so that you can pack them together in a single JVM.</em></p>
</li>
<li>
<p><em>Compiling strings which are Java function bodies into bytecode, and then turning them into <code>@Beans</code> that can be wrapped as above.</em></p>
</li>
<li>
<p><em>Adapters for <a href="https://github.com/spring-cloud/spring-cloud-function/tree/master/spring-cloud-function-adapters/spring-cloud-function-adapter-aws">AWS Lambda</a>, <a href="https://github.com/spring-cloud/spring-cloud-function/tree/master/spring-cloud-function-adapters/spring-cloud-function-adapter-azure">Azure</a>, <a href="https://github.com/spring-cloud/spring-cloud-function/tree/master/spring-cloud-function-adapters/spring-cloud-function-adapter-gcp">Google Cloud Functions</a>, <a href="https://github.com/spring-cloud/spring-cloud-function/tree/master/spring-cloud-function-adapters/spring-cloud-function-adapter-openwhisk">Apache OpenWhisk</a> and possibly other "serverless" service providers.</em></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Cloud is released under the non-restrictive Apache 2.0 license. If you would like to contribute to this section of the documentation or if you find an error, please find the source code and issue trackers in the project at <a href="https://github.com/spring-cloud/spring-cloud">github</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started">60. Getting Started</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Build from the command line (and "install" the samples):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./mvnw clean install</pre>
</div>
</div>
<div class="paragraph">
<p>(If you like to YOLO add <code>-DskipTests</code>.)</p>
</div>
<div class="paragraph">
<p>Run one of the samples, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ java -jar spring-cloud-function-samples/function-sample/target/*.jar</pre>
</div>
</div>
<div class="paragraph">
<p>This runs the app and exposes its functions over HTTP, so you can
convert a string to uppercase, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -H "Content-Type: text/plain" localhost:8080/uppercase -d Hello
HELLO</pre>
</div>
</div>
<div class="paragraph">
<p>You can convert multiple strings (a <code>Flux&lt;String&gt;</code>) by separating them
with new lines</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -H "Content-Type: text/plain" localhost:8080/uppercase -d 'Hello
&gt; World'
HELLOWORLD</pre>
</div>
</div>
<div class="paragraph">
<p>(You can use <code><sup>Q</sup>J</code> in a terminal to insert a new line in a literal
string like that.)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="programming-model"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#programming-model"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#programming-model">61. Programming model</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="function-catalog-and-flexible-function-signatures"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-catalog-and-flexible-function-signatures"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-catalog-and-flexible-function-signatures">61.1. Function Catalog and Flexible Function Signatures</a></h3>
<div class="paragraph">
<p>One of the main features of Spring Cloud Function is to adapt and support a range of type signatures for user-defined functions,
while providing a consistent execution model.
That’s why all user defined functions are transformed into a canonical representation by <code>FunctionCatalog</code>.</p>
</div>
<div class="paragraph">
<p>While users don’t normally have to care about the <code>FunctionCatalog</code> at all, it is useful to know what
kind of functions are supported in user code.</p>
</div>
<div class="paragraph">
<p>It is also important to understand that Spring Cloud Function provides first class support for reactive API
provided by <a href="https://projectreactor.io/">Project Reactor</a> allowing reactive primitives such as <code>Mono</code> and <code>Flux</code>
to be used as types in user defined functions providing greater flexibility when choosing programming model for
your function implementation.
Reactive programming model also enables functional support for features that would be otherwise difficult to impossible to implement
using imperative programming style. For more on this please read <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-arity">Function Arity</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="java-8-function-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#java-8-function-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#java-8-function-support">61.2. Java 8 function support</a></h3>
<div class="paragraph">
<p>Spring Cloud Function embraces and builds on top of the 3 core functional interfaces defined by Java
and available to us since Java 8.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Supplier&lt;O&gt;</p>
</li>
<li>
<p>Function&lt;I, O&gt;</p>
</li>
<li>
<p>Consumer&lt;I&gt;</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="supplier"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#supplier"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#supplier">61.2.1. Supplier</a></h4>
<div class="paragraph">
<p>Supplier can be <em>reactive</em> - <code>Supplier&lt;Flux&lt;T&gt;&gt;</code>
or <em>imperative</em> - <code>Supplier&lt;T&gt;</code>. From the invocation standpoint this should make no difference
to the implementor of such Supplier. However, when used within frameworks
(e.g., <a href="https://spring.io/projects/spring-cloud-stream">Spring Cloud Stream</a>), Suppliers, especially reactive,
often used to represent the source of the stream, therefore they are invoked once to get the stream (e.g., Flux)
to which consumers can subscribe to. In other words such suppliers represent an equivalent of an <em>infinite stream</em>.
However, the same reactive suppliers can also represent <em>finite</em> stream(s) (e.g., result set on the polled JDBC data).
In those cases such reactive suppliers must be hooked up to some polling mechanism of the underlying framework.</p>
</div>
<div class="paragraph">
<p>To assist with that Spring Cloud Function provides a marker annotation
<code>org.springframework.cloud.function.context.PollableSupplier</code> to signal that such supplier produces a
finite stream and may need to be polled again. That said, it is important to understand that Spring Cloud Function itself
provides no behavior for this annotation.</p>
</div>
<div class="paragraph">
<p>In addition <code>PollableSupplier</code> annotation exposes a <em>splittable</em> attribute to signal that produced stream
needs to be split (see <a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/Sequencer.html">Splitter EIP</a>)</p>
</div>
<div class="paragraph">
<p>Here is the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@PollableSupplier</span>(splittable = <span class="hljs-keyword">true</span>)
<span class="hljs-keyword">public</span> Supplier&lt;Flux&lt;String&gt;&gt; someSupplier() {
    <span class="hljs-keyword">return</span> () -&gt; {
        String v1 = String.valueOf(System.nanoTime());
        String v2 = String.valueOf(System.nanoTime());
        String v3 = String.valueOf(System.nanoTime());
        <span class="hljs-keyword">return</span> Flux.just(v1, v2, v3);
    };
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="function"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function">61.2.2. Function</a></h4>
<div class="paragraph">
<p>Function can also be written in imperative or reactive way, yet unlike Supplier and Consumer there are
no special considerations for the implementor other then understanding that when used within frameworks
such as <a href="https://spring.io/projects/spring-cloud-stream">Spring Cloud Stream</a> and others, reactive function is
invoked only once to pass a reference to the stream (Flux or Mono) and imperative is invoked once per event.</p>
</div>
</div>
<div class="sect3">
<h4 id="consumer"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#consumer"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#consumer">61.2.3. Consumer</a></h4>
<div class="paragraph">
<p>Consumer is a little bit special because it has a <code>void</code> return type,
which implies blocking, at least potentially. Most likely you will not
need to write <code>Consumer&lt;Flux&lt;?&gt;&gt;</code>, but if you do need to do that,
remember to subscribe to the input flux.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="function-composition"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-composition"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-composition">61.3. Function Composition</a></h3>
<div class="paragraph">
<p>Function Composition is a feature that allows one to compose several functions into one.
The core support is based on function composition feature available with <a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Function.html#andThen-java.util.function.Function-">Function.andThen(..)</a>
support available since Java 8. However on top of it, we provide few additional features.</p>
</div>
<div class="sect3">
<h4 id="declarative-function-composition"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#declarative-function-composition"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#declarative-function-composition">61.3.1. Declarative Function Composition</a></h4>
<div class="paragraph">
<p>This feature allows you to provide composition instruction in a declarative way using <code>|</code> (pipe) or <code>,</code> (comma) delimiter
when providing <code>spring.cloud.function.definition</code> property.</p>
</div>
<div class="paragraph">
<p>For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--spring.cloud.function.definition=uppercase|reverse</pre>
</div>
</div>
<div class="paragraph">
<p>Here we effectively provided a definition of a single function which itself is a composition of
function <code>uppercase</code> and function <code>reverse</code>. In fact that is one of the reasons why the property name is <em>definition</em> and not <em>name</em>,
since the definition of a function can be a composition of several named functions.
And as mentioned you can use <code>,</code> instead of pipe (such as <code>…​definition=uppercase,reverse</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="composing-non-functions"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#composing-non-functions"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#composing-non-functions">61.3.2. Composing non-Functions</a></h4>
<div class="paragraph">
<p>Spring Cloud Function also supports composing Supplier with <code>Consumer</code> or <code>Function</code> as well as <code>Function</code> with <code>Consumer</code>.
What’s important here is to understand the end product of such definitions.
Composing Supplier with Function still results in Supplier while composing Supplier with Consumer will effectively render Runnable.
Following the same logic composing Function with Consumer will result in Consumer.</p>
</div>
<div class="paragraph">
<p>And of course you can’t compose uncomposable such as Consumer and Function, Consumer and Supplier etc.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="function-routing-and-filtering"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-routing-and-filtering"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-routing-and-filtering">61.4. Function Routing and Filtering</a></h3>
<div class="paragraph">
<p>Since version 2.2 Spring Cloud Function provides routing feature allowing
you to invoke a single function which acts as a router to an actual function you wish to invoke
This feature is very useful in certain FAAS environments where maintaining configurations
for several functions could be cumbersome or exposing more then one function is not possible.</p>
</div>
<div class="paragraph">
<p>The <code>RoutingFunction</code> is registered in <em>FunctionCatalog</em> under the name <code>functionRouter</code>. For simplicity
and consistency you can also refer to <code>RoutingFunction.FUNCTION_NAME</code> constant.</p>
</div>
<div class="paragraph">
<p>This function has the following signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoutingFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">Object</span>, <span class="hljs-title">Object</span>&gt; </span>{
. . .
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The routing instructions could be communicated in several ways;</p>
</div>
<div class="paragraph">
<p><strong>Message Headers</strong></p>
</div>
<div class="paragraph">
<p>If the input argument is of type <code>Message&lt;?&gt;</code>, you can communicate routing instruction by setting one of
<code>spring.cloud.function.definition</code> or <code>spring.cloud.function.routing-expression</code> Message headers.
For more static cases you can use <code>spring.cloud.function.definition</code> header which allows you to provide
the name of a single function (e.g., <code>…​definition=foo</code>) or a composition instruction (e.g., <code>…​definition=foo|bar|baz</code>).
For more dynamic cases you can use <code>spring.cloud.function.routing-expression</code> header which allows
you to use Spring Expression Language (SpEL) and provide SpEL expression that should resolve
into definition of a function (as described above).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
SpEL evaluation context’s root object is the
actual input argument, so in he case of <code>Message&lt;?&gt;</code> you can construct expression that has access
to both <code>payload</code> and <code>headers</code> (e.g., <code>spring.cloud.function.routing-expression=headers.function_name</code>).
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In specific execution environments/models the adapters are responsible to translate and communicate
<code>spring.cloud.function.definition</code> and/or <code>spring.cloud.function.routing-expression</code> via Message header.
For example, when using <em>spring-cloud-function-web</em> you can provide <code>spring.cloud.function.definition</code> as an HTTP
header and the framework will propagate it as well as other HTTP headers as Message headers.</p>
</div>
<div class="paragraph">
<p><strong>Application Properties</strong></p>
</div>
<div class="paragraph">
<p>Routing instruction can also be communicated via <code>spring.cloud.function.definition</code>
or <code>spring.cloud.function.routing-expression</code> as application properties. The rules described in the
previous section apply here as well. The only difference is you provide these instructions as
application properties (e.g., <code>--spring.cloud.function.definition=foo</code>).</p>
</div>
<div class="paragraph">
<p><strong>Function Filtering</strong>
Filtering is the type of routing where there are only tow paths - 'go' or 'discard'. In terms of functions it mean
you only want to invoke a certain function if some condition returns 'true', otherwise you want to discard input.
However, when it comes to discarding input there are many interpretation of what it could mean in the context of your application.
For example, you may want to log it, or you may want to maintain the counter of discarded messages. you may also want to do nothing at all.
Because of these different paths, we do not provide a general configuration option for how to deal with discarded messages.
Instead we simply recommend to define a simple Consumer which would signify the 'discard' path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Consumer&lt;?&gt; devNull() {
   <span class="hljs-comment">// log, count or whatever</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can have routing expression that really only has two paths effectively becoming a filter. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">--spring.cloud.function.routing-expression=headers.contentType.toString().equals('text/plain') ? 'echo' : 'devNull'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every message that does not fit criteria to go to 'echo' function will go to 'devNull' where you can simply do nothing with it.
The signature <code>Consumer&lt;?&gt;</code> will also ensure that no type conversion will be attempted resulting in almost no execution overhead.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When dealing with reactive inputs (e.g., Publisher), routing instructions must only be provided via Function properties. This is
due to the nature of the reactive functions which are invoked only once to pass a Publisher and the rest
is handled by the reactor, hence we can not access and/or rely on the routing instructions communicated via individual
values (e.g., Message).
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="function-arity"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-arity"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-arity">61.5. Function Arity</a></h3>
<div class="paragraph">
<p>There are times when a stream of data needs to be categorized and organized. For example,
consider a classic big-data use case of dealing with unorganized data containing, let’s say,
‘orders’ and ‘invoices’, and you want each to go into a separate data store.
This is where function arity (functions with multiple inputs and outputs) support
comes to play.</p>
</div>
<div class="paragraph">
<p>Let’s look at an example of such a function (full implementation details are available
<a href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/test/java/org/springframework/cloud/stream/function/MultipleInputOutputFunctionTests.java#L342">here</a>),</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Function&lt;Flux&lt;Integer&gt;, Tuple2&lt;Flux&lt;String&gt;, Flux&lt;String&gt;&gt;&gt; organise() {
    <span class="hljs-keyword">return</span> flux -&gt; ...;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given that Project Reactor is a core dependency of SCF, we are using its Tuple library.
Tuples give us a unique advantage by communicating to us both <em>cardinality</em> and <em>type</em> information.
Both are extremely important in the context of SCSt. Cardinality lets us know
how many input and output bindings need to be created and bound to the corresponding
inputs and outputs of a function. Awareness of the type information ensures proper type
conversion.</p>
</div>
<div class="paragraph">
<p>Also, this is where the ‘index’ part of the naming convention for binding
names comes into play, since, in this function, the two output binding
names are <code>organise-out-0</code> and <code>organise-out-1</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
IMPORTANT: At the moment, function arity is <strong>only</strong> supported for reactive functions
(<code>Function&lt;TupleN&lt;Flux&lt;?&gt;…​&gt;, TupleN&lt;Flux&lt;?&gt;…​&gt;&gt;</code>) centered on Complex event processing
where evaluation and computation on confluence of events typically requires view into a
stream of events rather than single event.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="type-conversion-content-type-negotiation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#type-conversion-content-type-negotiation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#type-conversion-content-type-negotiation">61.6. Type conversion (Content-Type negotiation)</a></h3>
<div class="paragraph">
<p>Content-Type negotiation is one of the core features of Spring Cloud Function as it allows to not only transform the incoming data to the types declared
by the function signature, but to do the same transformation during function composition making otherwise un-composable (by type) functions composable.</p>
</div>
<div class="paragraph">
<p>To better understand the mechanics and the necessity behind content-type negotiation, we take a look at a very simple use case by
using the following function as an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Function&lt;Person, String&gt; personFunction {..}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function shown in the preceding example expects a <code>Person</code> object as an argument and produces a String type as an output. If such function is
invoked with the type <code>Person</code>, than all works fine. But typically function plays a role of a handler for the incoming data which most often comes
in the raw format such as <code>byte[]</code>, <code>JSON String</code> etc. In order for the framework to succeed in passing the incoming data as an argument to
this function, it has to somehow transform the incoming data to a <code>Person</code> type.</p>
</div>
<div class="paragraph">
<p>Spring Cloud Function relies on two native to Spring mechanisms to accomplish that.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>MessageConverter</em> - to convert from incoming Message data to a type declared by the function.</p>
</li>
<li>
<p><em>ConversionService</em> - to convert from incoming non-Message data to a type declared by the function.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This means that depending on the type of the raw data (Message or non-Message) Spring Cloud Function will apply one or the other mechanisms.</p>
</div>
<div class="paragraph">
<p>For most cases when dealing with functions that are invoked as part of some other request (e.g., HTTP, Messaging etc) the framework relies on <code>MessageConverters</code>,
since such requests already converted to Spring <code>Message</code>. In other words, the framework locates and applies the appropriate <code>MessageConverter</code>.
To accomplish that, the framework needs some instructions from the user. One of these instructions is already provided by the signature of the function
itself (Person type). Consequently, in theory, that should be (and, in some cases, is) enough. However, for the majority of use cases, in order to
select the appropriate <code>MessageConverter</code>, the framework needs an additional piece of information. That missing piece is <code>contentType</code> header.</p>
</div>
<div class="paragraph">
<p>Such header usually comes as part of the Message where it is injected by the corresponding adapter that created such Message in the first place.
For example, HTTP POST request will have its content-type HTTP header copied to <code>contentType</code> header of the Message.</p>
</div>
<div class="paragraph">
<p>For cases when such header does not exist framework relies on the default content type as <code>application/json</code>.</p>
</div>
<div class="sect3">
<h4 id="content-type-versus-argument-type"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#content-type-versus-argument-type"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#content-type-versus-argument-type">61.6.1. Content Type versus Argument Type</a></h4>
<div class="paragraph">
<p>As mentioned earlier, for the framework to select the appropriate <code>MessageConverter</code>, it requires argument type and, optionally, content type information.
The logic for selecting the appropriate <code>MessageConverter</code> resides with the argument resolvers which trigger right before the invocation of the user-defined
function (which is when the actual argument type is known to the framework).
If the argument type does not match the type of the current payload, the framework delegates to the stack of the
pre-configured <code>MessageConverters</code> to see if any one of them can convert the payload.</p>
</div>
<div class="paragraph">
<p>The combination of <code>contentType</code> and argument type is the mechanism by which framework determines if message can be converted to a target type by locating
the appropriate <code>MessageConverter</code>.
If no appropriate <code>MessageConverter</code> is found, an exception is thrown, which you can handle by adding a custom <code>MessageConverter</code>
(see <code><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#user-defined-message-converters">User-defined Message Converters</a></code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Do not expect <code>Message</code> to be converted into some other type based only on the <code>contentType</code>.
Remember that the <code>contentType</code> is complementary to the target type.
It is a hint, which <code>MessageConverter</code> may or may not take into consideration.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="message-converters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#message-converters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#message-converters">61.6.2. Message Converters</a></h4>
<div class="paragraph">
<p><code>MessageConverters</code> define two methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function">Object <span class="hljs-title">fromMessage</span><span class="hljs-params">(Message&lt;?&gt; message, Class&lt;?&gt; targetClass)</span></span>;

Message&lt;?&gt; toMessage(Object payload, <span class="hljs-meta">@Nullable</span> MessageHeaders headers);</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important to understand the contract of these methods and their usage, specifically in the context of Spring Cloud Stream.</p>
</div>
<div class="paragraph">
<p>The <code>fromMessage</code> method converts an incoming <code>Message</code> to an argument type.
The payload of the <code>Message</code> could be any type, and it is
up to the actual implementation of the <code>MessageConverter</code> to support multiple types.</p>
</div>
</div>
<div class="sect3">
<h4 id="provided-messageconverters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#provided-messageconverters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#provided-messageconverters">61.6.3. Provided MessageConverters</a></h4>
<div class="paragraph">
<p>As mentioned earlier, the framework already provides a stack of <code>MessageConverters</code> to handle most common use cases.
The following list describes the provided <code>MessageConverters</code>, in order of precedence (the first <code>MessageConverter</code> that works is used):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>JsonMessageConverter</code>: Supports conversion of the payload of the <code>Message</code> to/from POJO for cases when <code>contentType</code> is <code>application/json</code> using Jackson or Gson libraries (DEFAULT).</p>
</li>
<li>
<p><code>ByteArrayMessageConverter</code>: Supports conversion of the payload of the <code>Message</code> from <code>byte[]</code> to <code>byte[]</code> for cases when <code>contentType</code> is <code>application/octet-stream</code>. It is essentially a pass through and exists primarily for backward compatibility.</p>
</li>
<li>
<p><code>StringMessageConverter</code>: Supports conversion of any type to a <code>String</code> when <code>contentType</code> is <code>text/plain</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When no appropriate converter is found, the framework throws an exception. When that happens, you should check your code and configuration and ensure you did
not miss anything (that is, ensure that you provided a <code>contentType</code> by using a binding or a header).
However, most likely, you found some uncommon case (such as a custom <code>contentType</code> perhaps) and the current stack of provided <code>MessageConverters</code>
does not know how to convert. If that is the case, you can add custom <code>MessageConverter</code>. See <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#user-defined-message-converters">User-defined Message Converters</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="user-defined-message-converters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#user-defined-message-converters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#user-defined-message-converters">61.6.4. User-defined Message Converters</a></h4>
<div class="paragraph">
<p>Spring Cloud Function exposes a mechanism to define and register additional <code>MessageConverters</code>.
To use it, implement <code>org.springframework.messaging.converter.MessageConverter</code>, configure it as a <code>@Bean</code>.
It is then appended to the existing stack of `MessageConverter`s.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important to understand that custom <code>MessageConverter</code> implementations are added to the head of the existing stack.
Consequently, custom <code>MessageConverter</code> implementations take precedence over the existing ones, which lets you override as well as add to the existing converters.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following example shows how to create a message converter bean to support a new content type called <code>application/bar</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SinkApplication</span> </span>{

    ...

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> MessageConverter <span class="hljs-title">customMessageConverter</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyCustomMessageConverter();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyCustomMessageConverter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractMessageConverter</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyCustomMessageConverter</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>(<span class="hljs-keyword">new</span> MimeType(<span class="hljs-string">"application"</span>, <span class="hljs-string">"bar"</span>));
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(Class&lt;?&gt; clazz)</span> </span>{
        <span class="hljs-keyword">return</span> (Bar.class.equals(clazz));
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> Object <span class="hljs-title">convertFromInternal</span><span class="hljs-params">(Message&lt;?&gt; message, Class&lt;?&gt; targetClass, Object conversionHint)</span> </span>{
        Object payload = message.getPayload();
        <span class="hljs-keyword">return</span> (payload <span class="hljs-keyword">instanceof</span> Bar ? payload : <span class="hljs-keyword">new</span> Bar((<span class="hljs-keyword">byte</span>[]) payload));
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kotlin-lambda-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kotlin-lambda-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kotlin-lambda-support">61.7. Kotlin Lambda support</a></h3>
<div class="paragraph">
<p>We also provide support for Kotlin lambdas (since v2.0).
Consider the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function">open fun <span class="hljs-title">kotlinSupplier</span><span class="hljs-params">()</span>: <span class="hljs-params">()</span> -&gt; String </span>{
    <span class="hljs-keyword">return</span>  { <span class="hljs-string">"Hello from Kotlin"</span> }
}

<span class="hljs-meta">@Bean</span>
<span class="hljs-function">open fun <span class="hljs-title">kotlinFunction</span><span class="hljs-params">()</span>: <span class="hljs-params">(String)</span> -&gt; String </span>{
    <span class="hljs-keyword">return</span>  { it.toUpperCase() }
}

<span class="hljs-meta">@Bean</span>
<span class="hljs-function">open fun <span class="hljs-title">kotlinConsumer</span><span class="hljs-params">()</span>: <span class="hljs-params">(String)</span> -&gt; Unit </span>{
    <span class="hljs-keyword">return</span>  { println(it) }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above represents Kotlin lambdas configured as Spring beans. The signature of each maps to a Java equivalent of
<code>Supplier</code>, <code>Function</code> and <code>Consumer</code>, and thus supported/recognized signatures by the framework.
While mechanics of Kotlin-to-Java mapping are outside of the scope of this documentation, it is important to understand that the
same rules for signature transformation outlined in "Java 8 function support" section are applied here as well.</p>
</div>
<div class="paragraph">
<p>To enable Kotlin support all you need is to add <code>spring-cloud-function-kotlin</code> module to your classpath which contains the appropriate
autoconfiguration and supporting classes.</p>
</div>
</div>
<div class="sect2">
<h3 id="function-component-scan"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-component-scan"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-component-scan">61.8. Function Component Scan</a></h3>
<div class="paragraph">
<p>Spring Cloud Function will scan for implementations of <code>Function</code>,
<code>Consumer</code> and <code>Supplier</code> in a package called <code>functions</code> if it
exists. Using this feature you can write functions that have no
dependencies on Spring - not even the <code>@Component</code> annotation is
needed. If you want to use a different package, you can set
<code>spring.cloud.function.scan.packages</code>. You can also use
<code>spring.cloud.function.scan.enabled=false</code> to switch off the scan
completely.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="standalone-web-applications"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#standalone-web-applications"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#standalone-web-applications">62. Standalone Web Applications</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Functions could be automatically exported as HTTP endpoints.</p>
</div>
<div class="paragraph">
<p>The <code>spring-cloud-function-web</code> module has autoconfiguration that
activates when it is included in a Spring Boot web application (with
MVC support). There is also a <code>spring-cloud-starter-function-web</code> to
collect all the optional dependencies in case you just want a simple
getting started experience.</p>
</div>
<div class="paragraph">
<p>With the web configurations activated your app will have an MVC
endpoint (on "/" by default, but configurable with
<code>spring.cloud.function.web.path</code>) that can be used to access the
functions in the application context where function name becomes part of the URL path. The supported content types are
plain text and JSON.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Request</th>
<th class="tableblock halign-left valign-top">Response</th>
<th class="tableblock halign-left valign-top">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/{supplier}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Items from the named supplier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200 OK</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/{consumer}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON object or text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mirrors input and pushes request body into consumer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">202 Accepted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/{consumer}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON array or text with new lines</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mirrors input and pushes body into consumer one by one</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">202 Accepted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/{function}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON object or text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The result of applying the named function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200 OK</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/{function}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON array or text with new lines</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The result of applying the named function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200 OK</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/{function}/{item}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convert the item into an object and return the result of applying the function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200 OK</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As the table above shows the behaviour of the endpoint depends on the method and also the type of incoming request data. When the incoming data
is single valued, and the target function is declared as obviously single valued (i.e. not returning a collection or <code>Flux</code>), then the response
will also contain a single value.
For multi-valued responses the client can ask for a server-sent event stream by sending `Accept: text/event-stream".</p>
</div>
<div class="paragraph">
<p>Functions and consumers that are declared with input and output in <code>Message&lt;?&gt;</code> will see the request headers on the input messages, and the output message headers will be converted to HTTP headers.</p>
</div>
<div class="paragraph">
<p>When POSTing text the response format might be different with Spring Boot 2.0 and older versions, depending on the content negotiation (provide content type and accept headers for the best results).</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#testing-functional-applications">Testing Functional Applications</a> to see the details and example on how to test such application.</p>
</div>
<div class="sect2">
<h3 id="function-mapping-rules"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-mapping-rules"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-mapping-rules">62.1. Function Mapping rules</a></h3>
<div class="paragraph">
<p>If there is only a single function (consumer etc.) in the catalog, the name in the path is optional.
In other words, providing you only have <code>uppercase</code> function in catalog
<code>curl -H "Content-Type: text/plain" localhost:8080/uppercase -d hello</code> and <code>curl -H "Content-Type: text/plain" localhost:8080/ -d hello</code> calls are identical.</p>
</div>
<div class="paragraph">
<p>Composite functions can be addressed using pipes or commas to separate function names (pipes are legal in URL paths, but a bit awkward to type on the command line).
For example, <code>curl -H "Content-Type: text/plain" localhost:8080/uppercase,reverse -d hello</code>.</p>
</div>
<div class="paragraph">
<p>For cases where there is more then a single function in catalog, each function will be exported and mapped with function name being
part of the path (e.g., <code>localhost:8080/uppercase</code>).
In this scenario you can still map specific function or function composition to the root path by providing
<code>spring.cloud.function.definition</code> property</p>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--spring.cloud.function.definition=foo|bar</pre>
</div>
</div>
<div class="paragraph">
<p>The above property will compose 'foo' and 'bar' function and map the composed function to the "/" path.</p>
</div>
</div>
<div class="sect2">
<h3 id="function-filtering-rules"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-filtering-rules"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#function-filtering-rules">62.2. Function Filtering rules</a></h3>
<div class="paragraph">
<p>In situations where there are more then one function in catalog there may be a need to only export certain functions or function compositions. In that case you can use
the same <code>spring.cloud.function.definition</code> property listing functions you intend to export delimited by <code>;</code>.
Note that in this case nothing will be mapped to the root path and functions that are not listed (including compositions) are not going to be exported</p>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--spring.cloud.function.definition=foo;bar</pre>
</div>
</div>
<div class="paragraph">
<p>This will only export function <code>foo</code> and function <code>bar</code> regardless how many functions are available in catalog (e.g., <code>localhost:8080/foo</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--spring.cloud.function.definition=foo|bar;baz</pre>
</div>
</div>
<div class="paragraph">
<p>This will only export function composition <code>foo|bar</code> and function <code>baz</code> regardless how many functions are available in catalog (e.g., <code>localhost:8080/foo,bar</code>).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="standalone-streaming-applications"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#standalone-streaming-applications"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#standalone-streaming-applications">63. Standalone Streaming Applications</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To send or receive messages from a broker (such as RabbitMQ or Kafka) you can leverage <code>spring-cloud-stream</code> project and it’s integration with Spring Cloud Function.
Please refer to <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-stream/current/reference/html/spring-cloud-stream.html#spring_cloud_function">Spring Cloud Function</a> section of the Spring Cloud Stream reference manual for more details and examples.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploying-a-packaged-function"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#deploying-a-packaged-function"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#deploying-a-packaged-function">64. Deploying a Packaged Function</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Function provides a "deployer" library that allows you to launch a jar file (or exploded archive, or set of jar files) with an isolated class loader and expose the functions defined in it. This is quite a powerful tool that would allow you to, for instance, adapt a function to a range of different input-output adapters without changing the target jar file. Serverless platforms often have this kind of feature built in, so you could see it as a building block for a function invoker in such a platform (indeed the <a href="https://projectriff.io/">Riff</a> Java function invoker uses this library).</p>
</div>
<div class="paragraph">
<p>The standard entry point is to add <code>spring-cloud-function-deployer</code> to the classpath, the deployer kicks in and looks for some configuration to tell it where to find the function jar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-function-deployer<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring.cloud.function.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At a minimum the user has to provide a <code>spring.cloud.function.location</code> which is a URL or resource location for the archive containing
the functions. It can optionally use a <code>maven:</code> prefix to locate the artifact via a dependency lookup (see <code>FunctionProperties</code>
for complete details). A Spring Boot application is bootstrapped from the jar file, using the <code>MANIFEST.MF</code> to locate a start class, so
that a standard Spring Boot fat jar works well, for example. If the target jar can be launched successfully then the result is a function
registered in the main application’s <code>FunctionCatalog</code>. The registered function can be applied by code in the main application, even though
it was created in an isolated class loader (by deault).</p>
</div>
<div class="paragraph">
<p>Here is the example of deploying a JAR which contains an 'uppercase' function and invoking it .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DeployFunctionDemo</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        ApplicationContext context = SpringApplication.run(DeployFunctionDemo.class,
                <span class="hljs-string">"--spring.cloud.function.location=..../target/uppercase-0.0.1-SNAPSHOT.jar"</span>,
                <span class="hljs-string">"--spring.cloud.function.definition=uppercase"</span>);

        FunctionCatalog catalog = context.getBean(FunctionCatalog.class);
        Function&lt;String, String&gt; function = catalog.lookup(<span class="hljs-string">"uppercase"</span>);
        System.out.println(function.apply(<span class="hljs-string">"hello"</span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is the example using Maven URI (taken from one of the tests in <code>FunctionDeployerTests</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DeployFunctionDemo</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        String[] args = <span class="hljs-keyword">new</span> String[] {
                <span class="hljs-string">"--spring.cloud.function.location=maven://oz.demo:demo-uppercase:0.0.1-SNAPSHOT"</span>,
                <span class="hljs-string">"--spring.cloud.function.function-class=oz.demo.uppercase.MyFunction"</span> };

        ApplicationContext context = SpringApplication.run(DeployerApplication.class, args);
        FunctionCatalog catalog = context.getBean(FunctionCatalog.class);
        Function&lt;String, String&gt; function = catalog.lookup(<span class="hljs-string">"myFunction"</span>);

        assertThat(function.apply(<span class="hljs-string">"bob"</span>)).isEqualTo(<span class="hljs-string">"BOB"</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keep in mind that Maven resource such as local and remote repositories, user, password and more are resolved using default MavenProperties which
effectively use local defaults and will work for majority of cases. However if you need to customize you can simply provide a bean of type
<code>MavenProperties</code> where you can set additional properties (see example below).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> MavenProperties <span class="hljs-title">mavenProperties</span><span class="hljs-params">()</span> </span>{
    MavenProperties properties = <span class="hljs-keyword">new</span> MavenProperties();
    properties.setLocalRepository(<span class="hljs-string">"target/it/"</span>);
    <span class="hljs-keyword">return</span> properties;
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="supported-packaging-scenarios"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#supported-packaging-scenarios"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#supported-packaging-scenarios">64.1. Supported Packaging Scenarios</a></h3>
<div class="paragraph">
<p>Currently Spring Cloud Function supports several packaging scenarios to give you the most flexibility when it comes to deploying functions.</p>
</div>
<div class="sect3">
<h4 id="simple-jar"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#simple-jar"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#simple-jar">64.1.1. Simple JAR</a></h4>
<div class="paragraph">
<p>This packaging option implies no dependency on anything related to Spring.
For example; Consider that such JAR contains the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">package</span> function.example;
. . .
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UpperCaseFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">String</span>&gt; </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">apply</span><span class="hljs-params">(String value)</span> </span>{
        <span class="hljs-keyword">return</span> value.toUpperCase();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All you need to do is specify <code>location</code> and <code>function-class</code> properties when deploying such package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs aspectj">--spring.cloud.function.location=<span class="hljs-keyword">target</span>/it/simplestjar/<span class="hljs-keyword">target</span>/simplestjar<span class="hljs-number">-1.0</span><span class="hljs-number">.0</span>.RELEASE.jar
--spring.cloud.function.function-<span class="hljs-class"><span class="hljs-keyword">class</span></span>=function.example.UpperCaseFunction</code></pre>
</div>
</div>
<div class="paragraph">
<p>It’s conceivable in some cases that you might want to package multiple functions together. For such scenarios you can use
<code>spring.cloud.function.function-class</code> property to list several classes delimiting them by <code>;</code>.</p>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs kotlin">--spring.cloud.function.function-<span class="hljs-class"><span class="hljs-keyword">class</span>=<span class="hljs-title">function</span>.<span class="hljs-title">example</span>.<span class="hljs-title">UpperCaseFunction</span>;<span class="hljs-title">function</span>.<span class="hljs-title">example</span>.<span class="hljs-title">ReverseFunction</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we are identifying two functions to deploy, which we can now access in function catalog by name (e.g., <code>catalog.lookup("reverseFunction");</code>).</p>
</div>
<div class="paragraph">
<p>For more details please reference the complete sample available <a href="https://github.com/spring-cloud/spring-cloud-function/tree/master/spring-cloud-function-deployer/src/it/simplestjar">here</a>.
You can also find a corresponding test in <a href="https://github.com/spring-cloud/spring-cloud-function/blob/master/spring-cloud-function-deployer/src/test/java/org/springframework/cloud/function/deployer/FunctionDeployerTests.java#L70">FunctionDeployerTests</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="spring-boot-jar"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-jar"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-jar">64.1.2. Spring Boot JAR</a></h4>
<div class="paragraph">
<p>This packaging option implies there is a dependency on Spring Boot and that the JAR was generated as Spring Boot JAR. That said, given that the deployed JAR
runs in the isolated class loader, there will not be any version conflict with the Spring Boot version used by the actual deployer.
For example; Consider that such JAR contains the following class (which could have some additional Spring dependencies providing Spring/Spring Boot is on the classpath):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">package</span> function.example;
. . .
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UpperCaseFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">String</span>&gt; </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">apply</span><span class="hljs-params">(String value)</span> </span>{
        <span class="hljs-keyword">return</span> value.toUpperCase();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As before all you need to do is specify <code>location</code> and <code>function-class</code> properties when deploying such package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs aspectj">--spring.cloud.function.location=<span class="hljs-keyword">target</span>/it/simplestjar/<span class="hljs-keyword">target</span>/simplestjar<span class="hljs-number">-1.0</span><span class="hljs-number">.0</span>.RELEASE.jar
--spring.cloud.function.function-<span class="hljs-class"><span class="hljs-keyword">class</span></span>=function.example.UpperCaseFunction</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details please reference the complete sample available <a href="https://github.com/spring-cloud/spring-cloud-function/tree/master/spring-cloud-function-deployer/src/it/bootjar">here</a>.
You can also find a corresponding test in <a href="https://github.com/spring-cloud/spring-cloud-function/blob/master/spring-cloud-function-deployer/src/test/java/org/springframework/cloud/function/deployer/FunctionDeployerTests.java#L50">FunctionDeployerTests</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="spring-boot-application"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-application"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-application">64.1.3. Spring Boot Application</a></h4>
<div class="paragraph">
<p>This packaging option implies your JAR is complete stand alone Spring Boot application with functions as managed Spring beans.
As before there is an obvious assumption that there is a dependency on Spring Boot and that the JAR was generated as Spring Boot JAR. That said, given that the deployed JAR
runs in the isolated class loader, there will not be any version conflict with the Spring Boot version used by the actual deployer.
For example; Consider that such JAR contains the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">package</span> function.example;
. . .
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleFunctionAppApplication</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        SpringApplication.run(SimpleFunctionAppApplication.class, args);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Function&lt;String, String&gt; <span class="hljs-title">uppercase</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> value -&gt; value.toUpperCase();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given that we’re effectively dealing with another Spring Application context and that functions are spring managed beans,
in addition to the <code>location</code> property we also specify <code>definition</code> property instead of <code>function-class</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs diff"><span class="hljs-deletion">--spring.cloud.function.location=target/it/bootapp/target/bootapp-1.0.0.RELEASE-exec.jar</span>
<span class="hljs-deletion">--spring.cloud.function.definition=uppercase</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details please reference the complete sample available <a href="https://github.com/spring-cloud/spring-cloud-function/tree/master/spring-cloud-function-deployer/src/it/bootapp">here</a>.
You can also find a corresponding test in <a href="https://github.com/spring-cloud/spring-cloud-function/blob/master/spring-cloud-function-deployer/src/test/java/org/springframework/cloud/function/deployer/FunctionDeployerTests.java#L164">FunctionDeployerTests</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This particular deployment option may or may not have Spring Cloud Function on it’s classpath. From the deployer perspective this doesn’t matter.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="functional-bean-definitions"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#functional-bean-definitions"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#functional-bean-definitions">65. Functional Bean Definitions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Function supports a "functional" style of bean declarations for small apps where you need fast startup. The functional style of bean declaration was a feature of Spring Framework 5.0 with significant enhancements in 5.1.</p>
</div>
<div class="sect2">
<h3 id="comparing-functional-with-traditional-bean-definitions"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#comparing-functional-with-traditional-bean-definitions"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#comparing-functional-with-traditional-bean-definitions">65.1. Comparing Functional with Traditional Bean Definitions</a></h3>
<div class="paragraph">
<p>Here’s a vanilla Spring Cloud Function application from with the
familiar <code>@Configuration</code> and <code>@Bean</code> declaration style:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DemoApplication</span> </span>{

  <span class="hljs-meta">@Bean</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> Function&lt;String, String&gt; <span class="hljs-title">uppercase</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> value -&gt; value.toUpperCase();
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
    SpringApplication.run(DemoApplication.class, args);
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now for the functional beans: the user application code can be recast into "functional"
form, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootConfiguration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DemoApplication</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ApplicationContextInitializer</span>&lt;<span class="hljs-title">GenericApplicationContext</span>&gt; </span>{

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
    FunctionalSpringApplication.run(DemoApplication.class, args);
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> Function&lt;String, String&gt; <span class="hljs-title">uppercase</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> value -&gt; value.toUpperCase();
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">(GenericApplicationContext context)</span> </span>{
    context.registerBean(<span class="hljs-string">"demo"</span>, FunctionRegistration.class,
        () -&gt; <span class="hljs-keyword">new</span> FunctionRegistration&lt;&gt;(uppercase())
            .type(FunctionType.from(String.class).to(String.class)));
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The main differences are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The main class is an <code>ApplicationContextInitializer</code>.</p>
</li>
<li>
<p>The <code>@Bean</code> methods have been converted to calls to <code>context.registerBean()</code></p>
</li>
<li>
<p>The <code>@SpringBootApplication</code> has been replaced with
<code>@SpringBootConfiguration</code> to signify that we are not enabling Spring
Boot autoconfiguration, and yet still marking the class as an "entry
point".</p>
</li>
<li>
<p>The <code>SpringApplication</code> from Spring Boot has been replaced with a
<code>FunctionalSpringApplication</code> from Spring Cloud Function (it’s a
subclass).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The business logic beans that you register in a Spring Cloud Function app are of type <code>FunctionRegistration</code>.
This is a wrapper that contains both the function and information about the input and output types. In the <code>@Bean</code>
form of the application that information can be derived reflectively, but in a functional bean registration some of
it is lost unless we use a <code>FunctionRegistration</code>.</p>
</div>
<div class="paragraph">
<p>An alternative to using an <code>ApplicationContextInitializer</code> and <code>FunctionRegistration</code> is to make the application
itself implement <code>Function</code> (or <code>Consumer</code> or <code>Supplier</code>). Example (equivalent to the above):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootConfiguration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DemoApplication</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">String</span>&gt; </span>{

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
    FunctionalSpringApplication.run(DemoApplication.class, args);
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">apply</span><span class="hljs-params">(String value)</span> </span>{
    <span class="hljs-keyword">return</span> value.toUpperCase();
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It would also work if you add a separate, standalone class of type <code>Function</code> and register it with
the <code>SpringApplication</code> using an alternative form of the <code>run()</code> method. The main thing is that the generic
type information is available at runtime through the class declaration.</p>
</div>
<div class="paragraph">
<p>Suppose you have</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Function</span>&lt;<span class="hljs-title">Flux</span>&lt;<span class="hljs-title">Foo</span>&gt;, <span class="hljs-title">Flux</span>&lt;<span class="hljs-title">Bar</span>&gt;&gt; </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Flux&lt;Bar&gt; <span class="hljs-title">apply</span><span class="hljs-params">(Flux&lt;Foo&gt; flux)</span> </span>{
        <span class="hljs-keyword">return</span> flux.map(foo -&gt; <span class="hljs-keyword">new</span> Bar(<span class="hljs-string">"This is a Bar object from Foo value: "</span> + foo.getValue()));
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You register it as such:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">(GenericApplicationContext context)</span> </span>{
        context.registerBean(<span class="hljs-string">"function"</span>, FunctionRegistration.class,
                () -&gt; <span class="hljs-keyword">new</span> FunctionRegistration&lt;&gt;(<span class="hljs-keyword">new</span> CustomFunction()).type(CustomFunction.class));
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="limitations-of-functional-bean-declaration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#limitations-of-functional-bean-declaration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#limitations-of-functional-bean-declaration">65.2. Limitations of Functional Bean Declaration</a></h3>
<div class="paragraph">
<p>Most Spring Cloud Function apps have a relatively small scope compared to the whole of Spring Boot,
so we are able to adapt it to these functional bean definitions easily. If you step outside that limited scope,
you can extend your Spring Cloud Function app by switching back to <code>@Bean</code> style configuration, or by using a hybrid
approach. If you want to take advantage of Spring Boot autoconfiguration for integrations with external datastores,
for example, you will need to use <code>@EnableAutoConfiguration</code>. Your functions can still be defined using the functional
declarations if you want (i.e. the "hybrid" style), but in that case you will need to explicitly switch off the "full
functional mode" using <code>spring.functional.enabled=false</code> so that Spring Boot can take back control.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-functional-applications"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#testing-functional-applications"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#testing-functional-applications">66. Testing Functional Applications</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Function also has some utilities for integration testing that will be very familiar to Spring Boot users.</p>
</div>
<div class="paragraph">
<p>Suppose this is your application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SampleFunctionApplication</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        SpringApplication.run(SampleFunctionApplication.class, args);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Function&lt;String, String&gt; <span class="hljs-title">uppercase</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> v -&gt; v.toUpperCase();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an integration test for the HTTP server wrapping this application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootTest</span>(classes = SampleFunctionApplication.class,
            webEnvironment = WebEnvironment.RANDOM_PORT)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebFunctionTests</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> TestRestTemplate rest;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        ResponseEntity&lt;String&gt; result = <span class="hljs-keyword">this</span>.rest.exchange(
            RequestEntity.post(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"/uppercase"</span>)).body(<span class="hljs-string">"hello"</span>), String.class);
        System.out.println(result.getBody());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or when function bean definition style is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FunctionalSpringBootTest</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebFunctionTests</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> TestRestTemplate rest;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        ResponseEntity&lt;String&gt; result = <span class="hljs-keyword">this</span>.rest.exchange(
            RequestEntity.post(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"/uppercase"</span>)).body(<span class="hljs-string">"hello"</span>), String.class);
        System.out.println(result.getBody());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This test is almost identical to the one you would write for the <code>@Bean</code> version of the same app - the only difference
is the <code>@FunctionalSpringBootTest</code> annotation, instead of the regular <code>@SpringBootTest</code>. All the other pieces,
like the <code>@Autowired</code> <code>TestRestTemplate</code>, are standard Spring Boot features.</p>
</div>
<div class="paragraph">
<p>And to help with correct dependencies here is the excerpt from POM</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>
    . . . .
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-function-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.1.BUILD-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you could write a test for a non-HTTP app using just the <code>FunctionCatalog</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@RunWith</span>(SpringRunner.class)
<span class="hljs-meta">@FunctionalSpringBootTest</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FunctionalTests</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> FunctionCatalog catalog;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">words</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        Function&lt;String, String&gt; function = catalog.lookup(Function.class,
                <span class="hljs-string">"uppercase"</span>);
        assertThat(function.apply(<span class="hljs-string">"hello"</span>)).isEqualTo(<span class="hljs-string">"HELLO"</span>);
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dynamic-compilation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dynamic-compilation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dynamic-compilation">67. Dynamic Compilation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is a sample app that uses the function compiler to create a
function from a configuration property. The vanilla "function-sample"
also has that feature. And there are some scripts that you can run to
see the compilation happening at run time. To run these examples,
change into the <code>scripts</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cd scripts</pre>
</div>
</div>
<div class="paragraph">
<p>Also, start a RabbitMQ server locally (e.g. execute <code>rabbitmq-server</code>).</p>
</div>
<div class="paragraph">
<p>Start the Function Registry Service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./function-registry.sh</pre>
</div>
</div>
<div class="paragraph">
<p>Register a Function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./registerFunction.sh -n uppercase -f "f-&gt;f.map(s-&gt;s.toString().toUpperCase())"</pre>
</div>
</div>
<div class="paragraph">
<p>Run a REST Microservice using that Function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./web.sh -f uppercase -p 9000
curl -H "Content-Type: text/plain" -H "Accept: text/plain" localhost:9000/uppercase -d foo</pre>
</div>
</div>
<div class="paragraph">
<p>Register a Supplier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./registerSupplier.sh -n words -f "()-&gt;Flux.just(\"foo\",\"bar\")"</pre>
</div>
</div>
<div class="paragraph">
<p>Run a REST Microservice using that Supplier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./web.sh -s words -p 9001
curl -H "Accept: application/json" localhost:9001/words</pre>
</div>
</div>
<div class="paragraph">
<p>Register a Consumer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./registerConsumer.sh -n print -t String -f "System.out::println"</pre>
</div>
</div>
<div class="paragraph">
<p>Run a REST Microservice using that Consumer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./web.sh -c print -p 9002
curl -X POST -H "Content-Type: text/plain" -d foo localhost:9002/print</pre>
</div>
</div>
<div class="paragraph">
<p>Run Stream Processing Microservices:</p>
</div>
<div class="paragraph">
<p>First register a streaming words supplier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./registerSupplier.sh -n wordstream -f "()-&gt;Flux.interval(Duration.ofMillis(1000)).map(i-&gt;\"message-\"+i)"</pre>
</div>
</div>
<div class="paragraph">
<p>Then start the source (supplier), processor (function), and sink (consumer) apps
(in reverse order):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./stream.sh -p 9103 -i uppercaseWords -c print
./stream.sh -p 9102 -i words -f uppercase -o uppercaseWords
./stream.sh -p 9101 -s wordstream -o words</pre>
</div>
</div>
<div class="paragraph">
<p>The output will appear in the console of the sink app (one message per second, converted to uppercase):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>MESSAGE-0
MESSAGE-1
MESSAGE-2
MESSAGE-3
MESSAGE-4
MESSAGE-5
MESSAGE-6
MESSAGE-7
MESSAGE-8
MESSAGE-9
...</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-platform-adapters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serverless-platform-adapters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#serverless-platform-adapters">68. Serverless Platform Adapters</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>As well as being able to run as a standalone process, a Spring Cloud
Function application can be adapted to run one of the existing
serverless platforms. In the project there are adapters for
<a href="https://github.com/spring-cloud/spring-cloud-function/tree/master/spring-cloud-function-adapters/spring-cloud-function-adapter-aws">AWS
Lambda</a>,
<a href="https://github.com/spring-cloud/spring-cloud-function/tree/master/spring-cloud-function-adapters/spring-cloud-function-adapter-azure">Azure</a>,
and
<a href="https://github.com/spring-cloud/spring-cloud-function/tree/master/spring-cloud-function-adapters/spring-cloud-function-adapter-openwhisk">Apache
OpenWhisk</a>. The <a href="https://github.com/fnproject/fn">Oracle Fn platform</a>
has its own Spring Cloud Function adapter. And
<a href="https://projectriff.io/">Riff</a> supports Java functions and its
<a href="https://github.com/projectriff/java-function-invoker">Java Function
Invoker</a> acts natively is an adapter for Spring Cloud Function jars.</p>
</div>
<div class="sect2">
<h3 id="aws-lambda"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#aws-lambda"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#aws-lambda">68.1. AWS Lambda</a></h3>
<div class="paragraph">
<p>The <a href="https://aws.amazon.com/">AWS</a> adapter takes a Spring Cloud Function app and converts it to a form that can run in AWS Lambda.</p>
</div>
<div class="paragraph">
<p>The details of how to get stared with AWS Lambda is out of scope of this document, so the expectation is that user has some familiarity with
AWS and AWS Lambda and wants to learn what additional value spring provides.</p>
</div>
<div class="sect3">
<h4 id="getting-started-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-2">68.1.1. Getting Started</a></h4>
<div class="paragraph">
<p>One of the goals of Spring Cloud Function framework is to provide necessary infrastructure elements to enable a <em>simple function application</em>
to interact in a certain way in a particular environment.
A simple function application (in context or Spring) is an application that contains beans of type Supplier, Function or Consumer.
So, with AWS it means that a simple function bean should somehow be recognised and executed in AWS Lambda environment.</p>
</div>
<div class="paragraph">
<p>Let’s look at the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FunctionConfiguration</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        SpringApplication.run(FunctionConfiguration.class, args);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Function&lt;String, String&gt; <span class="hljs-title">uppercase</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> value -&gt; value.toUpperCase();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It shows a complete Spring Boot application with a function bean defined in it. What’s interesting is that on the surface this is just
another boot app, but in the context of AWS Adapter it is also a perfectly valid AWS Lambda application. No other code or configuration
is required. All you need to do is package it and deploy it, so let’s look how we can do that.</p>
</div>
<div class="paragraph">
<p>To make things simpler we’ve provided a sample project ready to be built and deployed and you can access it
<a href="https://github.com/spring-cloud/spring-cloud-function/tree/master/spring-cloud-function-samples/function-sample-aws">here</a>.</p>
</div>
<div class="paragraph">
<p>You simply execute <code>./mvnw clean package</code> to generate JAR file. All the necessary maven plugins have already been setup to generate
appropriate AWS deployable JAR file. (You can read more details about JAR layout in <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#notes-on-jar-layout">Notes on JAR Layout</a>).</p>
</div>
<div class="paragraph">
<p>Then you have to upload the JAR file (via AWS dashboard or AWS CLI) to AWS.</p>
</div>
<div class="paragraph">
<p>When ask about <em>handler</em> you specify <code>org.springframework.cloud.function.adapter.aws.FunctionInvoker::handleRequest</code> which is a generic request handler.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./Spring Cloud_files/AWS-deploy.png" alt="AWS deploy" width="800">
</div>
</div>
<div class="paragraph">
<p>That is all. Save and execute the function with some sample data which for this function is expected to be a
String which function will uppercase and return back.</p>
</div>
<div class="paragraph">
<p>While <code>org.springframework.cloud.function.adapter.aws.FunctionInvoker</code> is a general purpose AWS’s <code>RequestHandler</code> implementation aimed at completely
isolating you from the specifics of AWS Lambda API, for some cases you may want to specify which specific AWS’s <code>RequestHandler</code> you want
to use. The next section will explain you how you can accomplish just that.</p>
</div>
</div>
<div class="sect3">
<h4 id="aws-request-handlers"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#aws-request-handlers"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#aws-request-handlers">68.1.2. AWS Request Handlers</a></h4>
<div class="paragraph">
<p>The adapter has a couple of generic request handlers that you can use. The most generic is (and the one we used in the Getting Started section)
is <code>org.springframework.cloud.function.adapter.aws.FunctionInvoker</code> which is the implementation of AWS’s <code>RequestStreamHandler</code>.
User doesn’t need to do anything other then specify it as 'handler' on AWS dashborad when deploying function.
It will handle most of the case including Kinesis, streaming etc. .</p>
</div>
<div class="paragraph">
<p>If your app has more than one <code>@Bean</code> of type <code>Function</code> etc. then you can choose the one to use by configuring <code>spring.cloud.function.definition</code>
property or environment variable. The functions are extracted from the Spring Cloud <code>FunctionCatalog</code>. In the event you don’t specify <code>spring.cloud.function.definition</code>
the framework will attempt to find a default following the search order where it searches first for <code>Function</code> then <code>Consumer</code> and finally <code>Supplier</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="notes-on-jar-layout"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#notes-on-jar-layout"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#notes-on-jar-layout">68.1.3. Notes on JAR Layout</a></h4>
<div class="paragraph">
<p>You don’t need the Spring Cloud Function Web or Stream adapter at runtime in Lambda, so you might
need to exclude those before you create the JAR you send to AWS. A Lambda application has to be
shaded, but a Spring Boot standalone application does not, so you can run the same app using 2
separate jars (as per the sample). The sample app creates 2 jar files, one with an <code>aws</code>
classifier for deploying in Lambda, and one <a id="thin-jar"></a> executable (thin) jar that includes <code>spring-cloud-function-web</code>
at runtime. Spring Cloud Function will try and locate a "main class" for you from the JAR file
manifest, using the <code>Start-Class</code> attribute (which will be added for you by the Spring Boot
tooling if you use the starter parent). If there is no <code>Start-Class</code> in your manifest you can
use an environment variable or system property <code>MAIN_CLASS</code> when you deploy the function to AWS.</p>
</div>
<div class="paragraph">
<p>If you are not using the functional bean definitions but relying on Spring Boot’s auto-configuration,
then additional transformers must be configured as part of the maven-shade-plugin execution.</p>
</div>
<div id="shade-plugin-setup" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-shade-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">createDependencyReducedPom</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">createDependencyReducedPom</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">shadedArtifactAttached</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">shadedArtifactAttached</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">shadedClassifierName</span>&gt;</span>aws<span class="hljs-tag">&lt;/<span class="hljs-name">shadedClassifierName</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">transformers</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">transformer</span> <span class="hljs-attr">implementation</span>=<span class="hljs-string">"org.apache.maven.plugins.shade.resource.AppendingTransformer"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>META-INF/spring.handlers<span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">transformer</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">transformer</span> <span class="hljs-attr">implementation</span>=<span class="hljs-string">"org.springframework.boot.maven.PropertiesMergingResourceTransformer"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>META-INF/spring.factories<span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">transformer</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">transformer</span> <span class="hljs-attr">implementation</span>=<span class="hljs-string">"org.apache.maven.plugins.shade.resource.AppendingTransformer"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>META-INF/spring.schemas<span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">transformer</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">transformers</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="build-file-setup"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#build-file-setup"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#build-file-setup">68.1.4. Build file setup</a></h4>
<div class="paragraph">
<p>In order to run Spring Cloud Function applications on AWS Lambda, you can leverage Maven or Gradle
plugins offered by the cloud platform provider.</p>
</div>
<div class="sect4">
<h5 id="maven"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#maven"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#maven">Maven</a></h5>
<div class="paragraph">
<p>In order to use the adapter plugin for Maven, add the plugin dependency to your <code>pom.xml</code>
file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-function-adapter-aws<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As pointed out in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#notes-on-jar-layout">Notes on JAR Layout</a>, you will need a shaded jar in order to upload it
to AWS Lambda. You can use the <a href="https://maven.apache.org/plugins/maven-shade-plugin/">Maven Shade Plugin</a> for that.
The example of the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#shade-plugin-setup">setup</a> can be found above.</p>
</div>
<div class="paragraph">
<p>You can use theSpring Boot Maven Plugin to generate the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#thin-jar">thin jar</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot.experimental<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-thin-layout<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${wrapper.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find the entire sample <code>pom.xml</code> file for deploying Spring Cloud Function
applications to AWS Lambda with Maven <a href="https://github.com/spring-cloud/spring-cloud-function/blob/master/spring-cloud-function-samples/function-sample-aws/pom.xml">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="gradle"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gradle"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gradle">Gradle</a></h5>
<div class="paragraph">
<p>In order to use the adapter plugin for Gradle, add the dependency to your <code>build.gradle</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    compile(<span class="hljs-string">"org.springframework.cloud:spring-cloud-function-adapter-aws:${version}"</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As pointed out in <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#notes-on-jar-layout">Notes on JAR Layout</a>, you will need a shaded jar in order to upload it
to AWS Lambda. You can use the <a href="https://plugins.gradle.org/plugin/com.github.johnrengelman.shadow/">Gradle Shadow Plugin</a> for that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">buildscript {
    dependencies {
        classpath <span class="hljs-string">"com.github.jengelman.gradle.plugins:shadow:${shadowPluginVersion}"</span>
    }
}
apply <span class="hljs-string">plugin:</span> <span class="hljs-string">'com.github.johnrengelman.shadow'</span>

assemble.dependsOn = [shadowJar]

<span class="hljs-keyword">import</span> com.github.jengelman.gradle.plugins.shadow.transformers.*

shadowJar {
    classifier = <span class="hljs-string">'aws'</span>
    dependencies {
        exclude(
            dependency(<span class="hljs-string">"org.springframework.cloud:spring-cloud-function-web:${springCloudFunctionVersion}"</span>))
    }
    <span class="hljs-comment">// Required for Spring</span>
    mergeServiceFiles()
    append <span class="hljs-string">'META-INF/spring.handlers'</span>
    append <span class="hljs-string">'META-INF/spring.schemas'</span>
    append <span class="hljs-string">'META-INF/spring.tooling'</span>
    transform(PropertiesFileTransformer) {
        paths = [<span class="hljs-string">'META-INF/spring.factories'</span>]
        mergeStrategy = <span class="hljs-string">"append"</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the Spring Boot Gradle Plugin and Spring Boot Thin Gradle Plugin to generate
the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#thin-jar">thin jar</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">buildscript {
    dependencies {
        classpath(<span class="hljs-string">"org.springframework.boot.experimental:spring-boot-thin-gradle-plugin:${wrapperVersion}"</span>)
        classpath(<span class="hljs-string">"org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}"</span>)
    }
}
apply <span class="hljs-string">plugin:</span> <span class="hljs-string">'org.springframework.boot'</span>
apply <span class="hljs-string">plugin:</span> <span class="hljs-string">'org.springframework.boot.experimental.thin-launcher'</span>
assemble.dependsOn = [thinJar]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find the entire sample <code>build.gradle</code> file for deploying Spring Cloud Function
applications to AWS Lambda with Gradle <a href="https://github.com/spring-cloud/spring-cloud-function/blob/master/spring-cloud-function-samples/function-sample-aws/build.gradle">here</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="upload"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#upload"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#upload">68.1.5. Upload</a></h4>
<div class="paragraph">
<p>Build the sample under <code>spring-cloud-function-samples/function-sample-aws</code> and upload the <code>-aws</code> jar file to Lambda. The handler can be <code>example.Handler</code> or <code>org.springframework.cloud.function.adapter.aws.SpringBootStreamHandler</code> (FQN of the class, <em>not</em> a method reference, although Lambda does accept method references).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./mvnw -U clean package</pre>
</div>
</div>
<div class="paragraph">
<p>Using the AWS command line tools it looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>aws lambda create-function --function-name Uppercase --role arn:aws:iam::[USERID]:role/service-role/[ROLE] --zip-file fileb://function-sample-aws/target/function-sample-aws-2.0.0.BUILD-SNAPSHOT-aws.jar --handler org.springframework.cloud.function.adapter.aws.SpringBootStreamHandler --description "Spring Cloud Function Adapter Example" --runtime java8 --region us-east-1 --timeout 30 --memory-size 1024 --publish</pre>
</div>
</div>
<div class="paragraph">
<p>The input type for the function in the AWS sample is a Foo with a single property called "value". So you would need this to test it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "value": "test"
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The AWS sample app is written in the "functional" style (as an <code>ApplicationContextInitializer</code>). This is much faster on startup in Lambda than the traditional <code>@Bean</code> style, so if you don’t need <code>@Beans</code> (or <code>@EnableAutoConfiguration</code>) it’s a good choice. Warm starts are not affected.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="type-conversion"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#type-conversion"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#type-conversion">68.1.6. Type Conversion</a></h4>
<div class="paragraph">
<p>Spring Cloud Function will attempt to transparently handle type conversion between the raw
input stream and types declared by your function.</p>
</div>
<div class="paragraph">
<p>For example, if your function signature is as such <code>Function&lt;Foo, Bar&gt;</code> we will attempt to convert
incoming stream event to an instance of <code>Foo</code>.</p>
</div>
<div class="paragraph">
<p>In the event type is not known or can not be determined (e.g., <code>Function&lt;?, ?&gt;</code>) we will attempt to
convert an incoming stream event to a generic <code>Map</code>.</p>
</div>
<div class="sect5">
<h6 id="raw-input"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#raw-input"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#raw-input">Raw Input</a></h6>
<div class="paragraph">
<p>There are times when you may want to have access to a raw input. In this case all you need is to declare your
function signature to accept <code>InputStream</code>. For example, <code>Function&lt;InputStream, ?&gt;</code>. In this case
we will not attempt any conversion and will pass the raw input directly to a function.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="microsoft-azure"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#microsoft-azure"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#microsoft-azure">68.2. Microsoft Azure</a></h3>
<div class="paragraph">
<p>The <a href="https://azure.microsoft.com/">Azure</a> adapter bootstraps a Spring Cloud Function context and channels function calls from the Azure framework into the user functions, using Spring Boot configuration where necessary. Azure Functions has quite a unique, but invasive programming model, involving annotations in user code that are specific to the platform. The easiest way to use it with Spring Cloud is to extend a base class and write a method in it with the <code>@FunctionName</code> annotation which delegates to a base class method.</p>
</div>
<div class="paragraph">
<p>This project provides an adapter layer for a Spring Cloud Function application onto Azure.
You can write an app with a single <code>@Bean</code> of type <code>Function</code> and it will be deployable in Azure if you get the JAR file laid out right.</p>
</div>
<div class="paragraph">
<p>There is an <code>AzureSpringBootRequestHandler</code> which you must extend, and provide the input and output types as annotated method parameters (enabling Azure to inspect the class and create JSON bindings). The base class has two useful methods (<code>handleRequest</code> and <code>handleOutput</code>) to which you can delegate the actual function call, so mostly the function will only ever have one line.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AzureSpringBootRequestHandler</span>&lt;<span class="hljs-title">Foo</span>, <span class="hljs-title">Bar</span>&gt; </span>{
    <span class="hljs-meta">@FunctionName</span>(<span class="hljs-string">"uppercase"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> Bar <span class="hljs-title">execute</span><span class="hljs-params">(@HttpTrigger(name = <span class="hljs-string">"req"</span>, methods = {HttpMethod.GET,
            HttpMethod.POST}, authLevel = AuthorizationLevel.ANONYMOUS)</span> HttpRequestMessage&lt;Optional&lt;Foo&gt;&gt; request,
        ExecutionContext context) </span>{
        <span class="hljs-keyword">return</span> handleRequest(request.getBody().get(), context);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This Azure handler will delegate to a <code>Function&lt;Foo,Bar&gt;</code> bean (or a <code>Function&lt;Publisher&lt;Foo&gt;,Publisher&lt;Bar&gt;&gt;</code>). Some Azure triggers (e.g. <code>@CosmosDBTrigger</code>) result in a input type of <code>List</code> and in that case you can bind to <code>List</code> in the Azure handler, or <code>String</code> (the raw JSON). The <code>List</code> input delegates to a <code>Function</code> with input type <code>Map&lt;String,Object&gt;</code>, or <code>Publisher</code> or <code>List</code> of the same type. The output of the <code>Function</code> can be a <code>List</code> (one-for-one) or a single value (aggregation), and the output binding in the Azure declaration should match.</p>
</div>
<div class="paragraph">
<p>If your app has more than one <code>@Bean</code> of type <code>Function</code> etc. then you can choose the one to use by configuring <code>function.name</code>. Or if you make the <code>@FunctionName</code> in the Azure handler method match the function name it should work that way (also for function apps with multiple functions). The functions are extracted from the Spring Cloud <code>FunctionCatalog</code> so the default function names are the same as the bean names.</p>
</div>
<div class="sect3">
<h4 id="accessing-azure-executioncontext"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#accessing-azure-executioncontext"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#accessing-azure-executioncontext">68.2.1. Accessing Azure ExecutionContext</a></h4>
<div class="paragraph">
<p>Some time there is a need to access the target execution context provided by Azure runtime in the form of <code>com.microsoft.azure.functions.ExecutionContext</code>.
For example one of such needs is logging, so it can appear in the Azure console.</p>
</div>
<div class="paragraph">
<p>For that purpose Spring Cloud Function will register <code>ExecutionContext</code> as bean in the Application context, so it could be injected into your function.
For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Function&lt;Foo, Bar&gt; <span class="hljs-title">uppercase</span><span class="hljs-params">(ExecutionContext targetContext)</span> </span>{
    <span class="hljs-keyword">return</span> foo -&gt; {
        targetContext.getLogger().info(<span class="hljs-string">"Invoking 'uppercase' on "</span> + foo.getValue());
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Bar(foo.getValue().toUpperCase());
    };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Normally type-based injection should suffice, however if need to you can also utilise the bean name under which it is registered which is <code>targetExecutionContext</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="notes-on-jar-layout-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#notes-on-jar-layout-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#notes-on-jar-layout-2">68.2.2. Notes on JAR Layout</a></h4>
<div class="paragraph">
<p>You don’t need the Spring Cloud Function Web at runtime in Azure, so you can exclude this
before you create the JAR you deploy to Azure, but it won’t be used if you include it, so
it doesn’t hurt to leave it in. A function application on Azure is an archive generated by
the Maven plugin. The function lives in the JAR file generated by this project.
The sample creates it as an executable jar, using the thin layout, so that Azure can find
the handler classes. If you prefer you can just use a regular flat JAR file.
The dependencies should <strong>not</strong> be included.</p>
</div>
</div>
<div class="sect3">
<h4 id="build-file-setup-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#build-file-setup-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#build-file-setup-2">68.2.3. Build file setup</a></h4>
<div class="paragraph">
<p>In order to run Spring Cloud Function applications on Microsoft Azure, you can leverage the Maven
plugin offered by the cloud platform provider.</p>
</div>
<div class="paragraph">
<p>In order to use the adapter plugin for Maven, add the plugin dependency to your <code>pom.xml</code>
file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-function-adapter-azure<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, configure the plugin. You will need to provide Azure-specific configuration for your
application, specifying the <code>resourceGroup</code>, <code>appName</code> and other optional properties, and
add the <code>package</code> goal execution so that the <code>function.json</code> file required by Azure is
generated for you. Full plugin documentation can be found in the <a href="https://github.com/microsoft/azure-maven-plugins">plugin repository</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.microsoft.azure<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>azure-functions-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resourceGroup</span>&gt;</span>${functionResourceGroup}<span class="hljs-tag">&lt;/<span class="hljs-name">resourceGroup</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">appName</span>&gt;</span>${functionAppName}<span class="hljs-tag">&lt;/<span class="hljs-name">appName</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>package-functions<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You will also have to ensure that the files to be scanned by the plugin can be found in the
Azure functions staging directory (see the <a href="https://github.com/microsoft/azure-maven-plugins">plugin repository</a>
for more details on the staging directory and it’s default location).</p>
</div>
<div class="paragraph">
<p>You can find the entire sample <code>pom.xml</code> file for deploying Spring Cloud Function
applications to Microsoft Azure with Maven <a href="https://github.com/spring-cloud/spring-cloud-function/blob/master/spring-cloud-function-samples/function-sample-azure/pom.xml">here</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of yet, only Maven plugin is available. Gradle plugin has not been created by
the cloud platform provider.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="build"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#build"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#build">68.2.4. Build</a></h4>
<div class="listingblock">
<div class="content">
<pre>./mvnw -U clean package</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-sample"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#running-the-sample"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#running-the-sample">68.2.5. Running the sample</a></h4>
<div class="paragraph">
<p>You can run the sample locally, just like the other Spring Cloud Function samples:</p>
</div>
<hr>
<hr>
<div class="paragraph">
<p>and <code>curl -H "Content-Type: text/plain" localhost:8080/api/uppercase -d '{"value": "hello foobar"}'</code>.</p>
</div>
<div class="paragraph">
<p>You will need the <code>az</code> CLI app (see <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-first-java-maven" class="bare">docs.microsoft.com/en-us/azure/azure-functions/functions-create-first-java-maven</a> for more detail). To deploy the function on Azure runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ az login
$ mvn azure-functions:deploy</pre>
</div>
</div>
<div class="paragraph">
<p>On another terminal try this: <code>curl <a href="https://%3Cazure-function-url-from-the-log%3E/api/uppercase" class="bare">&lt;azure-function-url-from-the-log&gt;/api/uppercase</a> -d '{"value": "hello foobar!"}'</code>. Please ensure that you use the right URL for the function above. Alternatively you can test the function in the Azure Dashboard UI (click on the function name, go to the right hand side and click "Test" and to the bottom right, "Run").</p>
</div>
<div class="paragraph">
<p>The input type for the function in the Azure sample is a Foo with a single property called "value". So you need this to test it with something like below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "value": "foobar"
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Azure sample app is written in the "non-functional" style (using <code>@Bean</code>). The functional style (with just <code>Function</code> or <code>ApplicationContextInitializer</code>) is much faster on startup in Azure than the traditional <code>@Bean</code> style, so if you don’t need <code>@Beans</code> (or <code>@EnableAutoConfiguration</code>) it’s a good choice. Warm starts are not affected.
:branch: master
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="google-cloud-functions-alpha"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#google-cloud-functions-alpha"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#google-cloud-functions-alpha">68.3. Google Cloud Functions (Alpha)</a></h3>
<div class="paragraph">
<p>The Google Cloud Functions adapter enables Spring Cloud Function apps to run on the <a href="https://cloud.google.com/functions">Google Cloud Functions</a> serverless platform.
You can either run the function locally using the open source <a href="https://github.com/GoogleCloudPlatform/functions-framework-java">Google Functions Framework for Java</a> or on GCP.</p>
</div>
<div class="sect3">
<h4 id="project-dependencies"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#project-dependencies"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#project-dependencies">68.3.1. Project Dependencies</a></h4>
<div class="paragraph">
<p>Start by adding the <code>spring-cloud-function-adapter-gcp</code> dependency to your project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-function-adapter-gcp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    ...
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, add the <code>spring-boot-maven-plugin</code> which will build the JAR of the function to deploy.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Notice that we also reference <code>spring-cloud-function-adapter-gcp</code> as a dependency of the <code>spring-boot-maven-plugin</code>. This is necessary because it modifies the plugin to package your function in the correct JAR format for deployment on Google Cloud Functions.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>target/deploy<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-function-adapter-gcp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, add the Maven plugin provided as part of the Google Functions Framework for Java.
This allows you to test your functions locally via <code>mvn function:run</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The function target should always be set to <code>org.springframework.cloud.function.adapter.gcp.GcfJarLauncher</code>; this is an adapter class which acts as the entry point to your Spring Cloud Function from the Google Cloud Functions platform.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.cloud.functions<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>function-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">functionTarget</span>&gt;</span>org.springframework.cloud.function.adapter.gcp.GcfJarLauncher<span class="hljs-tag">&lt;/<span class="hljs-name">functionTarget</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span>8080<span class="hljs-tag">&lt;/<span class="hljs-name">port</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A full example of a working <code>pom.xml</code> can be found in the <a href="https://github.com/spring-cloud/spring-cloud-function/blob/master/spring-cloud-function-samples/function-sample-gcp-http/pom.xml">Spring Cloud Functions GCP sample</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="http-functions"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-functions"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-functions">68.3.2. HTTP Functions</a></h4>
<div class="paragraph">
<p>Google Cloud Functions supports deploying <a href="https://cloud.google.com/functions/docs/writing/http">HTTP Functions</a>, which are functions that are invoked by HTTP request. The sections below describe instructions for deploying a Spring Cloud Function as an HTTP Function.</p>
</div>
<div class="sect4">
<h5 id="getting-started-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-3">Getting Started</a></h5>
<div class="paragraph">
<p>Let’s start with a simple Spring Cloud Function example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CloudFunctionMain</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        SpringApplication.run(CloudFunctionMain.class, args);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Function&lt;String, String&gt; <span class="hljs-title">uppercase</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> value -&gt; value.toUpperCase();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specify your configuration main class in <code>resources/META-INF/MANIFEST.MF</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-selector-tag">Main-Class</span>: <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.CloudFunctionMain</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then run the function locally.
This is provided by the Google Cloud Functions <code>function-maven-plugin</code> described in the project dependencies section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn function:run</pre>
</div>
</div>
<div class="paragraph">
<p>Invoke the HTTP function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl http://localhost:8080/ -d "hello"</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="deploy-to-gcp"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#deploy-to-gcp"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#deploy-to-gcp">Deploy to GCP</a></h5>
<div class="paragraph">
<p>As of March 2020, Google Cloud Functions for Java is in Alpha.
You can get on the <a href="https://docs.google.com/forms/d/e/1FAIpQLScC98jGi7CfG0n3UYlj7Xad8XScvZC8-BBOg7Pk3uSZx_2cdQ/viewform">whitelist</a> to try it out.</p>
</div>
<div class="paragraph">
<p>Start by packaging your application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn package</pre>
</div>
</div>
<div class="paragraph">
<p>If you added the custom <code>spring-boot-maven-plugin</code> plugin defined above, you should see the resulting JAR in <code>target/deploy</code> directory.
This JAR is correctly formatted for deployment to Google Cloud Functions.</p>
</div>
<div class="paragraph">
<p>Next, make sure that you have the <a href="https://cloud.google.com/sdk/install">Cloud SDK CLI</a> installed.</p>
</div>
<div class="paragraph">
<p>From the project base directory run the following command to deploy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gcloud alpha functions deploy function-sample-gcp-http \
--entry-point org.springframework.cloud.function.adapter.gcp.GcfJarLauncher \
--runtime java11 \
--trigger-http \
--source target/deploy \
--memory 512MB</pre>
</div>
</div>
<div class="paragraph">
<p>Invoke the HTTP function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl https://REGION-PROJECT_ID.cloudfunctions.net/function-sample-gcp-http -d "hello"</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="background-functions"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#background-functions"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#background-functions">68.3.3. Background Functions</a></h4>
<div class="paragraph">
<p>Google Cloud Functions also supports deploying <a href="https://cloud.google.com/functions/docs/writing/background">Background Functions</a> which are invoked indirectly in response to an event, such as a message on a <a href="https://cloud.google.com/pubsub">Cloud Pub/Sub</a> topic, a change in a <a href="https://cloud.google.com/storage">Cloud Storage</a> bucket, or a <a href="https://firebase.google.com/">Firebase</a> event.</p>
</div>
<div class="paragraph">
<p>The <code>spring-cloud-function-adapter-gcp</code> allows for functions to be deployed as background functions as well.</p>
</div>
<div class="paragraph">
<p>The sections below describe the process for writing a Cloud Pub/Sub topic background function.
However, there are a number of different event types that can trigger a background function to execute which are not discussed here; these are described in the <a href="https://cloud.google.com/functions/docs/calling">Background Function triggers documentation</a>.</p>
</div>
<div class="sect4">
<h5 id="getting-started-4"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-4"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-4">Getting Started</a></h5>
<div class="paragraph">
<p>Let’s start with a simple Spring Cloud Function which will run as a GCF background function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BackgroundFunctionMain</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        SpringApplication.run(BackgroundFunctionMain.class, args);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Consumer&lt;PubSubMessage&gt; <span class="hljs-title">pubSubFunction</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> message -&gt; System.out.println(<span class="hljs-string">"The Pub/Sub message data: "</span> + message.getData());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, create <code>PubSubMessage</code> class in the project with the below definition.
This class represents the <a href="https://cloud.google.com/functions/docs/calling/pubsub#event_structure">Pub/Sub event structure</a> which gets passed to your function on a Pub/Sub topic event.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PubSubMessage</span> </span>{

    <span class="hljs-keyword">private</span> String data;

    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; attributes;

    <span class="hljs-keyword">private</span> String messageId;

    <span class="hljs-keyword">private</span> String publishTime;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getData</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> data;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setData</span><span class="hljs-params">(String data)</span> </span>{
        <span class="hljs-keyword">this</span>.data = data;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, String&gt; <span class="hljs-title">getAttributes</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> attributes;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAttributes</span><span class="hljs-params">(Map&lt;String, String&gt; attributes)</span> </span>{
        <span class="hljs-keyword">this</span>.attributes = attributes;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getMessageId</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> messageId;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMessageId</span><span class="hljs-params">(String messageId)</span> </span>{
        <span class="hljs-keyword">this</span>.messageId = messageId;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPublishTime</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> publishTime;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPublishTime</span><span class="hljs-params">(String publishTime)</span> </span>{
        <span class="hljs-keyword">this</span>.publishTime = publishTime;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specify your configuration main class in <code>resources/META-INF/MANIFEST.MF</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-selector-tag">Main-Class</span>: <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.BackgroundFunctionMain</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then run the function locally.
This is provided by the Google Cloud Functions <code>function-maven-plugin</code> described in the project dependencies section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn function:run</pre>
</div>
</div>
<div class="paragraph">
<p>Invoke the HTTP function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl localhost:8080 -H "Content-Type: application/json" -d '{"data":"hello"}'</pre>
</div>
</div>
<div class="paragraph">
<p>Verify that the function was invoked by viewing the logs.</p>
</div>
</div>
<div class="sect4">
<h5 id="deploy-to-gcp-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#deploy-to-gcp-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#deploy-to-gcp-2">Deploy to GCP</a></h5>
<div class="paragraph">
<p>In order to deploy your background function to GCP, first package your application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn package</pre>
</div>
</div>
<div class="paragraph">
<p>If you added the custom <code>spring-boot-maven-plugin</code> plugin defined above, you should see the resulting JAR in <code>target/deploy</code> directory.
This JAR is correctly formatted for deployment to Google Cloud Functions.</p>
</div>
<div class="paragraph">
<p>Next, make sure that you have the <a href="https://cloud.google.com/sdk/install">Cloud SDK CLI</a> installed.</p>
</div>
<div class="paragraph">
<p>From the project base directory run the following command to deploy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gcloud alpha functions deploy function-sample-gcp-background \
--entry-point org.springframework.cloud.function.adapter.gcp.GcfJarLauncher \
--runtime java11 \
--trigger-topic my-functions-topic \
--source target/deploy \
--memory 512MB</pre>
</div>
</div>
<div class="paragraph">
<p>Google Cloud Function will now invoke the function every time a message is published to the topic specified by <code>--trigger-topic</code>.</p>
</div>
<div class="paragraph">
<p>For a walkthrough on testing and verifying your background function, see the instructions for running the <a href="https://github.com/spring-cloud/spring-cloud-function/tree/master/spring-cloud-function-samples/function-sample-gcp-background/">GCF Background Function sample</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sample-functions"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-functions"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-functions">68.3.4. Sample Functions</a></h4>
<div class="paragraph">
<p>The project provides the following sample functions as reference:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://github.com/spring-cloud/spring-cloud-function/tree/master/spring-cloud-function-samples/function-sample-gcp-http/">function-sample-gcp-http</a> is an HTTP Function which you can test locally and try deploying.</p>
</li>
<li>
<p>The <a href="https://github.com/spring-cloud/spring-cloud-function/tree/master/spring-cloud-function-samples/function-sample-gcp-background/">function-sample-gcp-background</a> shows an example of a background function that is triggered by a message being published to a specified Pub/Sub topic.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<h1 id="spring-cloud-gateway" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gateway"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gateway">Spring Cloud Gateway</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><strong>Hoxton.SR10</strong></p>
</div>
<div class="paragraph">
<p>This project provides an API Gateway built on top of the Spring Ecosystem, including: Spring 5, Spring Boot 2 and Project Reactor. Spring Cloud Gateway aims to provide a simple, yet effective way to route to APIs and provide cross cutting concerns to them such as: security, monitoring/metrics, and resiliency.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gateway-starter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-starter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-starter">69. How to Include Spring Cloud Gateway</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To include Spring Cloud Gateway in your project, use the starter with a group ID of <code>org.springframework.cloud</code> and an artifact ID of <code>spring-cloud-starter-gateway</code>.
See the <a href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a> for details on setting up your build system with the current Spring Cloud Release Train.</p>
</div>
<div class="paragraph">
<p>If you include the starter, but you do not want the gateway to be enabled, set <code>spring.cloud.gateway.enabled=false</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Spring Cloud Gateway is built on <a href="https://spring.io/projects/spring-boot#learn">Spring Boot 2.x</a>, <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html">Spring WebFlux</a>, and <a href="https://projectreactor.io/docs">Project Reactor</a>.
As a consequence, many of the familiar synchronous libraries (Spring Data and Spring Security, for example) and patterns you know may not apply when you use Spring Cloud Gateway.
If you are unfamiliar with these projects, we suggest you begin by reading their documentation to familiarize yourself with some of the new concepts before working with Spring Cloud Gateway.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Spring Cloud Gateway requires the Netty runtime provided by Spring Boot and Spring Webflux.
It does not work in a traditional Servlet Container or when built as a WAR.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="glossary"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#glossary"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#glossary">70. Glossary</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Route</strong>: The basic building block of the gateway.
It is defined by an ID, a destination URI, a collection of predicates, and a collection of filters. A route is matched if the aggregate predicate is true.</p>
</li>
<li>
<p><strong>Predicate</strong>: This is a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Predicate.html">Java 8 Function Predicate</a>. The input type is a <a href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/ServerWebExchange.html">Spring Framework <code>ServerWebExchange</code></a>.
This lets you match on anything from the HTTP request, such as headers or parameters.</p>
</li>
<li>
<p><strong>Filter</strong>: These are instances of <a href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/GatewayFilter.html">Spring Framework <code>GatewayFilter</code></a> that have been constructed with a specific factory.
Here, you can modify requests and responses before or after sending the downstream request.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gateway-how-it-works"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-how-it-works"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-how-it-works">71. How It Works</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following diagram provides a high-level overview of how Spring Cloud Gateway works:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/spring_cloud_gateway_diagram.png" alt="Spring Cloud Gateway Diagram">
</div>
</div>
<div class="paragraph">
<p>Clients make requests to Spring Cloud Gateway. If the Gateway Handler Mapping determines that a request matches a route, it is sent to the Gateway Web Handler.
This handler runs the request through a filter chain that is specific to the request.
The reason the filters are divided by the dotted line is that filters can run logic both before and after the proxy request is sent.
All “pre” filter logic is executed. Then the proxy request is made. After the proxy request is made, the “post” filter logic is run.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
URIs defined in routes without a port get default port values of 80 and 443 for the HTTP and HTTPS URIs, respectively.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-route-predicate-factories-and-gateway-filter-factories"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-route-predicate-factories-and-gateway-filter-factories"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-route-predicate-factories-and-gateway-filter-factories">72. Configuring Route Predicate Factories and Gateway Filter Factories</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two ways to configure predicates and filters: shortcuts and fully expanded arguments. Most examples below use the shortcut way.</p>
</div>
<div class="paragraph">
<p>The name and argument names will be listed as <code>code</code> in the first sentance or two of the each section. The arguments are typically listed in the order that would be needed for the shortcut configuration.</p>
</div>
<div class="sect2">
<h3 id="shortcut-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#shortcut-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#shortcut-configuration">72.1. Shortcut Configuration</a></h3>
<div class="paragraph">
<p>Shortcut configuration is recognized by the filter name, followed by an equals sign (<code>=</code>), followed by argument values separated by commas (<code>,</code>).</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: after_route
        uri: https://example.org
        predicates:
        - Cookie=mycookie,mycookievalue</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous sample defines the <code>Cookie</code> Route Predicate Factory with two arguments, the cookie name, <code>mycookie</code> and the value to match <code>mycookievalue</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="fully-expanded-arguments"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#fully-expanded-arguments"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#fully-expanded-arguments">72.2. Fully Expanded Arguments</a></h3>
<div class="paragraph">
<p>Fully expanded arguments appear more like standard yaml configuration with name/value pairs. Typically, there will be a <code>name</code> key and an <code>args</code> key. The <code>args</code> key is a map of key value pairs to configure the predicate or filter.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: after_route
        uri: https://example.org
        predicates:
        - name: Cookie
          args:
            name: mycookie
            regexp: mycookievalue</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the full configuration of the shortcut configuration of the <code>Cookie</code> predicate shown above.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gateway-request-predicates-factories"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-request-predicates-factories"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-request-predicates-factories">73. Route Predicate Factories</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Gateway matches routes as part of the Spring WebFlux <code>HandlerMapping</code> infrastructure.
Spring Cloud Gateway includes many built-in route predicate factories.
All of these predicates match on different attributes of the HTTP request.
You can combine multiple route predicate factories with logical <code>and</code> statements.</p>
</div>
<div class="sect2">
<h3 id="the-after-route-predicate-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-after-route-predicate-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-after-route-predicate-factory">73.1. The After Route Predicate Factory</a></h3>
<div class="paragraph">
<p>The <code>After</code> route predicate factory takes one parameter, a <code>datetime</code> (which is a java <code>ZonedDateTime</code>).
This predicate matches requests that happen after the specified datetime.
The following example configures an after route predicate:</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: after_route
        uri: https://example.org
        predicates:
        - After=2017-01-20T17:42:47.789-07:00[America/Denver]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This route matches any request made after Jan 20, 2017 17:42 Mountain Time (Denver).</p>
</div>
</div>
<div class="sect2">
<h3 id="the-before-route-predicate-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-before-route-predicate-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-before-route-predicate-factory">73.2. The Before Route Predicate Factory</a></h3>
<div class="paragraph">
<p>The <code>Before</code> route predicate factory takes one parameter, a <code>datetime</code> (which is a java <code>ZonedDateTime</code>).
This predicate matches requests that happen before the specified <code>datetime</code>.
The following example configures a before route predicate:</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: before_route
        uri: https://example.org
        predicates:
        - Before=2017-01-20T17:42:47.789-07:00[America/Denver]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This route matches any request made before Jan 20, 2017 17:42 Mountain Time (Denver).</p>
</div>
</div>
<div class="sect2">
<h3 id="the-between-route-predicate-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-between-route-predicate-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-between-route-predicate-factory">73.3. The Between Route Predicate Factory</a></h3>
<div class="paragraph">
<p>The <code>Between</code> route predicate factory takes two parameters, <code>datetime1</code> and <code>datetime2</code>
which are java <code>ZonedDateTime</code> objects.
This predicate matches requests that happen after <code>datetime1</code> and before <code>datetime2</code>.
The <code>datetime2</code> parameter must be after <code>datetime1</code>.
The following example configures a between route predicate:</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: between_route
        uri: https://example.org
        predicates:
        - Between=2017-01-20T17:42:47.789-07:00[America/Denver], 2017-01-21T17:42:47.789-07:00[America/Denver]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This route matches any request made after Jan 20, 2017 17:42 Mountain Time (Denver) and before Jan 21, 2017 17:42 Mountain Time (Denver).
This could be useful for maintenance windows.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-cookie-route-predicate-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-cookie-route-predicate-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-cookie-route-predicate-factory">73.4. The Cookie Route Predicate Factory</a></h3>
<div class="paragraph">
<p>The <code>Cookie</code> route predicate factory takes two parameters, the cookie <code>name</code> and a <code>regexp</code> (which is a Java regular expression).
This predicate matches cookies that have the given name and whose values match the regular expression.
The following example configures a cookie route predicate factory:</p>
</div>
<div class="exampleblock">
<div class="title">Example 8. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: cookie_route
        uri: https://example.org
        predicates:
        - Cookie=chocolate, ch.p</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This route matches requests that have a cookie named <code>chocolate</code> whose value matches the <code>ch.p</code> regular expression.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-header-route-predicate-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-header-route-predicate-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-header-route-predicate-factory">73.5. The Header Route Predicate Factory</a></h3>
<div class="paragraph">
<p>The <code>Header</code> route predicate factory takes two parameters, the header <code>name</code> and a <code>regexp</code> (which is a Java regular expression).
This predicate matches with a header that has the given name whose value matches the regular expression.
The following example configures a header route predicate:</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: header_route
        uri: https://example.org
        predicates:
        - Header=X-Request-Id, \d+</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This route matches if the request has a header named <code>X-Request-Id</code> whose value matches the <code>\d+</code> regular expression (that is, it has a value of one or more digits).</p>
</div>
</div>
<div class="sect2">
<h3 id="the-host-route-predicate-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-host-route-predicate-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-host-route-predicate-factory">73.6. The Host Route Predicate Factory</a></h3>
<div class="paragraph">
<p>The <code>Host</code> route predicate factory takes one parameter: a list of host name <code>patterns</code>.
The pattern is an Ant-style pattern with <code>.</code> as the separator.
This predicates matches the <code>Host</code> header that matches the pattern.
The following example configures a host route predicate:</p>
</div>
<div class="exampleblock">
<div class="title">Example 10. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: host_route
        uri: https://example.org
        predicates:
        - Host=**.somehost.org,**.anotherhost.org</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>URI template variables (such as <code>{sub}.myhost.org</code>) are supported as well.</p>
</div>
<div class="paragraph">
<p>This route matches if the request has a <code>Host</code> header with a value of <code>www.somehost.org</code> or <code>beta.somehost.org</code> or <code>www.anotherhost.org</code>.</p>
</div>
<div class="paragraph">
<p>This predicate extracts the URI template variables (such as <code>sub</code>, defined in the preceding example) as a map of names and values and places it in the <code>ServerWebExchange.getAttributes()</code> with a key defined in <code>ServerWebExchangeUtils.URI_TEMPLATE_VARIABLES_ATTRIBUTE</code>.
Those values are then available for use by <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-route-filters"><code>GatewayFilter</code> factories</a></p>
</div>
</div>
<div class="sect2">
<h3 id="the-method-route-predicate-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-method-route-predicate-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-method-route-predicate-factory">73.7. The Method Route Predicate Factory</a></h3>
<div class="paragraph">
<p>The <code>Method</code> Route Predicate Factory takes a <code>methods</code> argument which is one or more parameters: the HTTP methods to match.
The following example configures a method route predicate:</p>
</div>
<div class="exampleblock">
<div class="title">Example 11. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: method_route
        uri: https://example.org
        predicates:
        - Method=GET,POST</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This route matches if the request method was a <code>GET</code> or a <code>POST</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-path-route-predicate-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-path-route-predicate-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-path-route-predicate-factory">73.8. The Path Route Predicate Factory</a></h3>
<div class="paragraph">
<p>The <code>Path</code> Route Predicate Factory takes two parameters: a list of Spring <code>PathMatcher</code> <code>patterns</code> and an optional flag called <code>matchOptionalTrailingSeparator</code>.
The following example configures a path route predicate:</p>
</div>
<div class="exampleblock">
<div class="title">Example 12. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: path_route
        uri: https://example.org
        predicates:
        - Path=/red/{segment},/blue/{segment}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This route matches if the request path was, for example: <code>/red/1</code> or <code>/red/blue</code> or <code>/blue/green</code>.</p>
</div>
<div class="paragraph">
<p>This predicate extracts the URI template variables (such as <code>segment</code>, defined in the preceding example) as a map of names and values and places it in the <code>ServerWebExchange.getAttributes()</code> with a key defined in <code>ServerWebExchangeUtils.URI_TEMPLATE_VARIABLES_ATTRIBUTE</code>.
Those values are then available for use by <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-route-filters"><code>GatewayFilter</code> factories</a></p>
</div>
<div class="paragraph">
<p>A utility method (called <code>get</code>) is available to make access to these variables easier.
The following example shows how to use the <code>get</code> method:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Map&lt;String, String&gt; uriVariables = ServerWebExchangeUtils.getPathPredicateVariables(exchange);

String segment = uriVariables.get(<span class="hljs-string">"segment"</span>);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-query-route-predicate-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-query-route-predicate-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-query-route-predicate-factory">73.9. The Query Route Predicate Factory</a></h3>
<div class="paragraph">
<p>The <code>Query</code> route predicate factory takes two parameters: a required <code>param</code> and an optional <code>regexp</code> (which is a Java regular expression).
The following example configures a query route predicate:</p>
</div>
<div class="exampleblock">
<div class="title">Example 13. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: query_route
        uri: https://example.org
        predicates:
        - Query=green</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding route matches if the request contained a <code>green</code> query parameter.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: query_route
        uri: https://example.org
        predicates:
        - Query=red, gree.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding route matches if the request contained a <code>red</code> query parameter whose value matched the <code>gree.</code> regexp, so <code>green</code> and <code>greet</code> would match.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-remoteaddr-route-predicate-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-remoteaddr-route-predicate-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-remoteaddr-route-predicate-factory">73.10. The RemoteAddr Route Predicate Factory</a></h3>
<div class="paragraph">
<p>The <code>RemoteAddr</code> route predicate factory takes a list (min size 1) of <code>sources</code>, which are CIDR-notation (IPv4 or IPv6) strings, such as <code>192.168.0.1/16</code> (where <code>192.168.0.1</code> is an IP address and <code>16</code> is a subnet mask).
The following example configures a RemoteAddr route predicate:</p>
</div>
<div class="exampleblock">
<div class="title">Example 14. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: remoteaddr_route
        uri: https://example.org
        predicates:
        - RemoteAddr=192.168.1.1/24</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This route matches if the remote address of the request was, for example, <code>192.168.1.10</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-weight-route-predicate-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-weight-route-predicate-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-weight-route-predicate-factory">73.11. The Weight Route Predicate Factory</a></h3>
<div class="paragraph">
<p>The <code>Weight</code> route predicate factory takes two arguments: <code>group</code> and <code>weight</code> (an int). The weights are calculated per group.
The following example configures a weight route predicate:</p>
</div>
<div class="exampleblock">
<div class="title">Example 15. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: weight_high
        uri: https://weighthigh.org
        predicates:
        - Weight=group1, 8
      - id: weight_low
        uri: https://weightlow.org
        predicates:
        - Weight=group1, 2</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This route would forward ~80% of traffic to <a href="https://weighthigh.org/" class="bare">weighthigh.org</a> and ~20% of traffic to <a href="https://weighlow.org/" class="bare">weighlow.org</a></p>
</div>
<div class="sect3">
<h4 id="modifying-the-way-remote-addresses-are-resolved"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#modifying-the-way-remote-addresses-are-resolved"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#modifying-the-way-remote-addresses-are-resolved">73.11.1. Modifying the Way Remote Addresses Are Resolved</a></h4>
<div class="paragraph">
<p>By default, the RemoteAddr route predicate factory uses the remote address from the incoming request.
This may not match the actual client IP address if Spring Cloud Gateway sits behind a proxy layer.</p>
</div>
<div class="paragraph">
<p>You can customize the way that the remote address is resolved by setting a custom <code>RemoteAddressResolver</code>.
Spring Cloud Gateway comes with one non-default remote address resolver that is based off of the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For">X-Forwarded-For header</a>, <code>XForwardedRemoteAddressResolver</code>.</p>
</div>
<div class="paragraph">
<p><code>XForwardedRemoteAddressResolver</code> has two static constructor methods, which take different approaches to security:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>XForwardedRemoteAddressResolver::trustAll</code> returns a <code>RemoteAddressResolver</code> that always takes the first IP address found in the <code>X-Forwarded-For</code> header.
This approach is vulnerable to spoofing, as a malicious client could set an initial value for the <code>X-Forwarded-For</code>, which would be accepted by the resolver.</p>
</li>
<li>
<p><code>XForwardedRemoteAddressResolver::maxTrustedIndex</code> takes an index that correlates to the number of trusted infrastructure running in front of Spring Cloud Gateway.
If Spring Cloud Gateway is, for example only accessible through HAProxy, then a value of 1 should be used.
If two hops of trusted infrastructure are required before Spring Cloud Gateway is accessible, then a value of 2 should be used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Consider the following header value:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-selector-tag">X-Forwarded-For</span>: 0<span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.1</span>, 0<span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.2</span>, 0<span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.3</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following <code>maxTrustedIndex</code> values yield the following remote addresses:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>maxTrustedIndex</code></th>
<th class="tableblock halign-left valign-top">result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[<code>Integer.MIN_VALUE</code>,0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(invalid, <code>IllegalArgumentException</code> during initialization)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[4, <code>Integer.MAX_VALUE</code>]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.1</p></td>
</tr>
</tbody>
</table>
<div id="gateway-route-filters" class="paragraph">
<p>The following example shows how to achieve the same configuration with Java:</p>
</div>
<div class="exampleblock">
<div class="title">Example 16. GatewayConfig.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RemoteAddressResolver resolver = XForwardedRemoteAddressResolver
    .maxTrustedIndex(<span class="hljs-number">1</span>);

...

.route(<span class="hljs-string">"direct-route"</span>,
    r -&gt; r.remoteAddr(<span class="hljs-string">"10.1.1.1"</span>, <span class="hljs-string">"10.10.1.1/24"</span>)
        .uri(<span class="hljs-string">"https://downstream1"</span>)
.route(<span class="hljs-string">"proxied-route"</span>,
    r -&gt; r.remoteAddr(resolver, <span class="hljs-string">"10.10.1.1"</span>, <span class="hljs-string">"10.10.1.1/24"</span>)
        .uri(<span class="hljs-string">"https://downstream2"</span>)
)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gatewayfilter-factories"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gatewayfilter-factories"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gatewayfilter-factories">74. <code>GatewayFilter</code> Factories</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Route filters allow the modification of the incoming HTTP request or outgoing HTTP response in some manner.
Route filters are scoped to a particular route.
Spring Cloud Gateway includes many built-in GatewayFilter Factories.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more detailed examples of how to use any of the following filters, take a look at the <a href="https://github.com/spring-cloud/spring-cloud-gateway/tree/master/spring-cloud-gateway-server/src/test/java/org/springframework/cloud/gateway/filter/factory">unit tests</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="the-addrequestheader-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-addrequestheader-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-addrequestheader-gatewayfilter-factory">74.1. The <code>AddRequestHeader</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>AddRequestHeader</code> <code>GatewayFilter</code> factory takes a <code>name</code> and <code>value</code> parameter.
The following example configures an <code>AddRequestHeader</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 17. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: add_request_header_route
        uri: https://example.org
        filters:
        - AddRequestHeader=X-Request-red, blue</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This listing adds <code>X-Request-red:blue</code> header to the downstream request’s headers for all matching requests.</p>
</div>
<div class="paragraph">
<p><code>AddRequestHeader</code> is aware of the URI variables used to match a path or host.
URI variables may be used in the value and are expanded at runtime.
The following example configures an <code>AddRequestHeader</code> <code>GatewayFilter</code> that uses a variable:</p>
</div>
<div class="exampleblock">
<div class="title">Example 18. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: add_request_header_route
        uri: https://example.org
        predicates:
        - Path=/red/{segment}
        filters:
        - AddRequestHeader=X-Request-Red, Blue-{segment}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-addrequestparameter-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-addrequestparameter-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-addrequestparameter-gatewayfilter-factory">74.2. The <code>AddRequestParameter</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>AddRequestParameter</code> <code>GatewayFilter</code> Factory takes a <code>name</code> and <code>value</code> parameter.
The following example configures an <code>AddRequestParameter</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 19. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: add_request_parameter_route
        uri: https://example.org
        filters:
        - AddRequestParameter=red, blue</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will add <code>red=blue</code> to the downstream request’s query string for all matching requests.</p>
</div>
<div class="paragraph">
<p><code>AddRequestParameter</code> is aware of the URI variables used to match a path or host.
URI variables may be used in the value and are expanded at runtime.
The following example configures an <code>AddRequestParameter</code> <code>GatewayFilter</code> that uses a variable:</p>
</div>
<div class="exampleblock">
<div class="title">Example 20. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: add_request_parameter_route
        uri: https://example.org
        predicates:
        - Host: {segment}.myhost.org
        filters:
        - AddRequestParameter=foo, bar-{segment}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-addresponseheader-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-addresponseheader-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-addresponseheader-gatewayfilter-factory">74.3. The <code>AddResponseHeader</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>AddResponseHeader</code> <code>GatewayFilter</code> Factory takes a <code>name</code> and <code>value</code> parameter.
The following example configures an <code>AddResponseHeader</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 21. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: add_response_header_route
        uri: https://example.org
        filters:
        - AddResponseHeader=X-Response-Red, Blue</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This adds <code>X-Response-Foo:Bar</code> header to the downstream response’s headers for all matching requests.</p>
</div>
<div class="paragraph">
<p><code>AddResponseHeader</code> is aware of URI variables used to match a path or host.
URI variables may be used in the value and are expanded at runtime.
The following example configures an <code>AddResponseHeader</code> <code>GatewayFilter</code> that uses a variable:</p>
</div>
<div class="exampleblock">
<div class="title">Example 22. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: add_response_header_route
        uri: https://example.org
        predicates:
        - Host: {segment}.myhost.org
        filters:
        - AddResponseHeader=foo, bar-{segment}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-deduperesponseheader-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-deduperesponseheader-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-deduperesponseheader-gatewayfilter-factory">74.4. The <code>DedupeResponseHeader</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The DedupeResponseHeader GatewayFilter factory takes a <code>name</code> parameter and an optional <code>strategy</code> parameter. <code>name</code> can contain a space-separated list of header names.
The following example configures a <code>DedupeResponseHeader</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 23. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: dedupe_response_header_route
        uri: https://example.org
        filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This removes duplicate values of <code>Access-Control-Allow-Credentials</code> and <code>Access-Control-Allow-Origin</code> response headers in cases when both the gateway CORS logic and the downstream logic add them.</p>
</div>
<div class="paragraph">
<p>The <code>DedupeResponseHeader</code> filter also accepts an optional <code>strategy</code> parameter.
The accepted values are <code>RETAIN_FIRST</code> (default), <code>RETAIN_LAST</code>, and <code>RETAIN_UNIQUE</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="hystrix"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix">74.5. The Hystrix <code>GatewayFilter</code> Factory</a></h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="https://cloud.spring.io/spring-cloud-netflix/multi/multi__modules_in_maintenance_mode.html">Netflix has put Hystrix in maintenance mode</a>. We suggest you use the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-circuitbreaker-filter-factory">Spring Cloud CircuitBreaker
Gateway Filter</a> with Resilience4J, as support for Hystrix will be removed in a future release.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><a href="https://github.com/Netflix/Hystrix">Hystrix</a> is a library from Netflix that implements the <a href="https://martinfowler.com/bliki/CircuitBreaker.html">circuit breaker pattern</a>.
The <code>Hystrix</code> <code>GatewayFilter</code> lets you introduce circuit breakers to your gateway routes, protecting your services from cascading failures and letting you provide fallback responses in the event of downstream failures.</p>
</div>
<div class="paragraph">
<p>To enable <code>Hystrix</code> <code>GatewayFilter</code> instances in your project, add a dependency on <code>spring-cloud-starter-netflix-hystrix</code> from <a href="https://cloud.spring.io/spring-cloud-netflix/">Spring Cloud Netflix</a>.</p>
</div>
<div class="paragraph">
<p>The <code>Hystrix</code> <code>GatewayFilter</code> factory requires a single <code>name</code> parameter, which is the name of the <code>HystrixCommand</code>.
The following example configures a Hystrix <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 24. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: hystrix_route
        uri: https://example.org
        filters:
        - Hystrix=myCommandName</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This wraps the remaining filters in a <code>HystrixCommand</code> with a command name of <code>myCommandName</code>.</p>
</div>
<div class="paragraph">
<p>The Hystrix filter can also accept an optional <code>fallbackUri</code> parameter. Currently, only <code>forward:</code> schemed URIs are supported. If the fallback is called, the request is forwarded to the controller matched by the URI.
The following example configures such a fallback:</p>
</div>
<div class="exampleblock">
<div class="title">Example 25. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: hystrix_route
        uri: lb://backing-service:8088
        predicates:
        - Path=/consumingserviceendpoint
        filters:
        - name: Hystrix
          args:
            name: fallbackcmd
            fallbackUri: forward:/incaseoffailureusethis
        - RewritePath=/consumingserviceendpoint, /backingserviceendpoint</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will forward to the <code>/incaseoffailureusethis</code> URI when the Hystrix fallback is called. Note that this example also demonstrates (optional) Spring Cloud Netflix Ribbon load-balancing (defined the <code>lb</code> prefix on the destination URI).</p>
</div>
<div class="paragraph">
<p>The primary scenario is to use the <code>fallbackUri</code> to an internal controller or handler within the gateway app.
However, you can also reroute the request to a controller or handler in an external application, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 26. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: ingredients
        uri: lb://ingredients
        predicates:
        - Path=//ingredients/**
        filters:
        - name: Hystrix
          args:
            name: fetchIngredients
            fallbackUri: forward:/fallback
      - id: ingredients-fallback
        uri: http://localhost:9994
        predicates:
        - Path=/fallback</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, there is no <code>fallback</code> endpoint or handler in the gateway application.
However, there is one in another application, registered under <code><a href="http://localhost:9994/" class="bare">localhost:9994</a></code>.</p>
</div>
<div class="paragraph">
<p>In case of the request being forwarded to the fallback, the Hystrix Gateway filter also provides the <code>Throwable</code> that has caused it.
It is added to the <code>ServerWebExchange</code> as the <code>ServerWebExchangeUtils.HYSTRIX_EXECUTION_EXCEPTION_ATTR</code> attribute, which you can use when handling the fallback within the gateway application.</p>
</div>
<div class="paragraph">
<p>For the external controller/handler scenario, you can add headers with exception details.
You can find more information on doing so in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#fallback-headers">FallbackHeaders GatewayFilter Factory section</a>.</p>
</div>
<div class="paragraph">
<p>You can configured Hystrix settings (such as timeouts) with global defaults or on a route-by-route basis by using application properties, as explained on the <a href="https://github.com/Netflix/Hystrix/wiki/Configuration">Hystrix wiki</a>.</p>
</div>
<div class="paragraph">
<p>To set a five-second timeout for the example route shown earlier, you could use the following configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 27. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">hystrix.command.fallbackcmd.execution.isolation.thread.timeoutInMilliseconds: 5000</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-circuitbreaker-filter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-circuitbreaker-filter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-circuitbreaker-filter-factory">74.6. Spring Cloud CircuitBreaker GatewayFilter Factory</a></h3>
<div class="paragraph">
<p>The Spring Cloud CircuitBreaker GatewayFilter factory uses the Spring Cloud CircuitBreaker APIs to wrap Gateway routes in
a circuit breaker. Spring Cloud CircuitBreaker supports two libraries that can be used with Spring Cloud Gateway, Hystrix
and Resilience4J. Since Netflix has placed Hystrix in maintenance-only mode, we suggest that you use Resilience4J.</p>
</div>
<div class="paragraph">
<p>To enable the Spring Cloud CircuitBreaker filter, you need to place either <code>spring-cloud-starter-circuitbreaker-reactor-resilience4j</code> or <code>spring-cloud-starter-netflix-hystrix</code> on the classpath.
The following example configures a Spring Cloud CircuitBreaker <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 28. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: circuitbreaker_route
        uri: https://example.org
        filters:
        - CircuitBreaker=myCircuitBreaker</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To configure the circuit breaker, see the configuration for the underlying circuit breaker implementation you are using.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://cloud.spring.io/spring-cloud-circuitbreaker/reference/html/spring-cloud-circuitbreaker.html">Resilience4J Documentation</a></p>
</li>
<li>
<p><a href="https://cloud.spring.io/spring-cloud-netflix/reference/html/">Hystrix Documentation</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Spring Cloud CircuitBreaker filter can also accept an optional <code>fallbackUri</code> parameter.
Currently, only <code>forward:</code> schemed URIs are supported.
If the fallback is called, the request is forwarded to the controller matched by the URI.
The following example configures such a fallback:</p>
</div>
<div class="exampleblock">
<div class="title">Example 29. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: circuitbreaker_route
        uri: lb://backing-service:8088
        predicates:
        - Path=/consumingServiceEndpoint
        filters:
        - name: CircuitBreaker
          args:
            name: myCircuitBreaker
            fallbackUri: forward:/inCaseOfFailureUseThis
        - RewritePath=/consumingServiceEndpoint, /backingServiceEndpoint</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following listing does the same thing in Java:</p>
</div>
<div class="exampleblock">
<div class="title">Example 30. Application.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> RouteLocator <span class="hljs-title">routes</span><span class="hljs-params">(RouteLocatorBuilder builder)</span> </span>{
    <span class="hljs-keyword">return</span> builder.routes()
        .route(<span class="hljs-string">"circuitbreaker_route"</span>, r -&gt; r.path(<span class="hljs-string">"/consumingServiceEndpoint"</span>)
            .filters(f -&gt; f.circuitBreaker(c -&gt; c.name(<span class="hljs-string">"myCircuitBreaker"</span>).fallbackUri(<span class="hljs-string">"forward:/inCaseOfFailureUseThis"</span>))
                .rewritePath(<span class="hljs-string">"/consumingServiceEndpoint"</span>, <span class="hljs-string">"/backingServiceEndpoint"</span>)).uri(<span class="hljs-string">"lb://backing-service:8088"</span>)
        .build();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This example forwards to the <code>/inCaseofFailureUseThis</code> URI when the circuit breaker fallback is called.
Note that this example also demonstrates the (optional) Spring Cloud Netflix Ribbon load-balancing (defined by the <code>lb</code> prefix on the destination URI).</p>
</div>
<div class="paragraph">
<p>The primary scenario is to use the <code>fallbackUri</code> to define an internal controller or handler within the gateway application.
However, you can also reroute the request to a controller or handler in an external application, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 31. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: ingredients
        uri: lb://ingredients
        predicates:
        - Path=//ingredients/**
        filters:
        - name: CircuitBreaker
          args:
            name: fetchIngredients
            fallbackUri: forward:/fallback
      - id: ingredients-fallback
        uri: http://localhost:9994
        predicates:
        - Path=/fallback</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, there is no <code>fallback</code> endpoint or handler in the gateway application.
However, there is one in another application, registered under <code><a href="http://localhost:9994/" class="bare">localhost:9994</a></code>.</p>
</div>
<div class="paragraph">
<p>In case of the request being forwarded to fallback, the Spring Cloud CircuitBreaker Gateway filter also provides the <code>Throwable</code> that has caused it.
It is added to the <code>ServerWebExchange</code> as the <code>ServerWebExchangeUtils.CIRCUITBREAKER_EXECUTION_EXCEPTION_ATTR</code> attribute that can be used when handling the fallback within the gateway application.</p>
</div>
<div class="paragraph">
<p>For the external controller/handler scenario, headers can be added with exception details.
You can find more information on doing so in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#fallback-headers">FallbackHeaders GatewayFilter Factory section</a>.</p>
</div>
<div class="sect3">
<h4 id="circuit-breaker-status-codes"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#circuit-breaker-status-codes"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#circuit-breaker-status-codes">74.6.1. Tripping The Circuit Breaker On Status Codes</a></h4>
<div class="paragraph">
<p>In some cases you might want to trip a circuit breaker based on the status code
returned from the route it wraps. The circuit breaker config object takes a list of
status codes that if returned will cause the the circuit breaker to be tripped. When setting the
status codes you want to trip the circuit breaker you can either use a integer with the status code
value or the String representation of the <code>HttpStatus</code> enumeration.</p>
</div>
<div class="exampleblock">
<div class="title">Example 32. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: circuitbreaker_route
        uri: lb://backing-service:8088
        predicates:
        - Path=/consumingServiceEndpoint
        filters:
        - name: CircuitBreaker
          args:
            name: myCircuitBreaker
            fallbackUri: forward:/inCaseOfFailureUseThis
            statusCodes:
              - 500
              - "NOT_FOUND"</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 33. Application.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> RouteLocator <span class="hljs-title">routes</span><span class="hljs-params">(RouteLocatorBuilder builder)</span> </span>{
    <span class="hljs-keyword">return</span> builder.routes()
        .route(<span class="hljs-string">"circuitbreaker_route"</span>, r -&gt; r.path(<span class="hljs-string">"/consumingServiceEndpoint"</span>)
            .filters(f -&gt; f.circuitBreaker(c -&gt; c.name(<span class="hljs-string">"myCircuitBreaker"</span>).fallbackUri(<span class="hljs-string">"forward:/inCaseOfFailureUseThis"</span>).addStatusCode(<span class="hljs-string">"INTERNAL_SERVER_ERROR"</span>))
                .rewritePath(<span class="hljs-string">"/consumingServiceEndpoint"</span>, <span class="hljs-string">"/backingServiceEndpoint"</span>)).uri(<span class="hljs-string">"lb://backing-service:8088"</span>)
        .build();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fallback-headers"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#fallback-headers"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#fallback-headers">74.7. The <code>FallbackHeaders</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>FallbackHeaders</code> factory lets you add Hystrix or Spring Cloud CircuitBreaker execution exception details in the headers of a request forwarded to a <code>fallbackUri</code> in an external application, as in the following scenario:</p>
</div>
<div class="exampleblock">
<div class="title">Example 34. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: ingredients
        uri: lb://ingredients
        predicates:
        - Path=//ingredients/**
        filters:
        - name: CircuitBreaker
          args:
            name: fetchIngredients
            fallbackUri: forward:/fallback
      - id: ingredients-fallback
        uri: http://localhost:9994
        predicates:
        - Path=/fallback
        filters:
        - name: FallbackHeaders
          args:
            executionExceptionTypeHeaderName: Test-Header</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, after an execution exception occurs while running the circuit breaker, the request is forwarded to the <code>fallback</code> endpoint or handler in an application running on <code>localhost:9994</code>.
The headers with the exception type, message and (if available) root cause exception type and message are added to that request by the <code>FallbackHeaders</code> filter.</p>
</div>
<div class="paragraph">
<p>You can overwrite the names of the headers in the configuration by setting the values of the following arguments (shown with their default values):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>executionExceptionTypeHeaderName</code> (<code>"Execution-Exception-Type"</code>)</p>
</li>
<li>
<p><code>executionExceptionMessageHeaderName</code> (<code>"Execution-Exception-Message"</code>)</p>
</li>
<li>
<p><code>rootCauseExceptionTypeHeaderName</code> (<code>"Root-Cause-Exception-Type"</code>)</p>
</li>
<li>
<p><code>rootCauseExceptionMessageHeaderName</code> (<code>"Root-Cause-Exception-Message"</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on circuit breakers and the gateway see the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix">Hystrix GatewayFilter Factory section</a> or <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-circuitbreaker-filter-factory">Spring Cloud CircuitBreaker Factory section</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-maprequestheader-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-maprequestheader-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-maprequestheader-gatewayfilter-factory">74.8. The <code>MapRequestHeader</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>MapRequestHeader</code> <code>GatewayFilter</code> factory takes <code>fromHeader</code> and <code>toHeader</code> parameters.
It creates a new named header (<code>toHeader</code>), and the value is extracted out of an existing named header (<code>fromHeader</code>) from the incoming http request.
If the input header does not exist, the filter has no impact.
If the new named header already exists, its values are augmented with the new values.
The following example configures a <code>MapRequestHeader</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 35. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: map_request_header_route
        uri: https://example.org
        filters:
        - MapRequestHeader=Blue, X-Request-Red</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This adds <code>X-Request-Red:&lt;values&gt;</code> header to the downstream request with updated values from the incoming HTTP request’s <code>Blue</code> header.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-prefixpath-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-prefixpath-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-prefixpath-gatewayfilter-factory">74.9. The <code>PrefixPath</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>PrefixPath</code> <code>GatewayFilter</code> factory takes a single <code>prefix</code> parameter.
The following example configures a <code>PrefixPath</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 36. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: prefixpath_route
        uri: https://example.org
        filters:
        - PrefixPath=/mypath</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will prefix <code>/mypath</code> to the path of all matching requests.
So a request to <code>/hello</code> would be sent to <code>/mypath/hello</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-preservehostheader-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-preservehostheader-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-preservehostheader-gatewayfilter-factory">74.10. The <code>PreserveHostHeader</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>PreserveHostHeader</code> <code>GatewayFilter</code> factory has no parameters.
This filter sets a request attribute that the routing filter inspects to determine if the original host header should be sent, rather than the host header determined by the HTTP client.
The following example configures a <code>PreserveHostHeader</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 37. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: preserve_host_route
        uri: https://example.org
        filters:
        - PreserveHostHeader</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-requestratelimiter-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-requestratelimiter-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-requestratelimiter-gatewayfilter-factory">74.11. The <code>RequestRateLimiter</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>RequestRateLimiter</code> <code>GatewayFilter</code> factory uses a <code>RateLimiter</code> implementation to determine if the current request is allowed to proceed. If it is not, a status of <code>HTTP 429 - Too Many Requests</code> (by default) is returned.</p>
</div>
<div class="paragraph">
<p>This filter takes an optional <code>keyResolver</code> parameter and parameters specific to the rate limiter (described later in this section).</p>
</div>
<div class="paragraph">
<p><code>keyResolver</code> is a bean that implements the <code>KeyResolver</code> interface.
In configuration, reference the bean by name using SpEL.
<code>#{@myKeyResolver}</code> is a SpEL expression that references a bean named <code>myKeyResolver</code>.
The following listing shows the <code>KeyResolver</code> interface:</p>
</div>
<div class="exampleblock">
<div class="title">Example 38. KeyResolver.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">KeyResolver</span> </span>{
    <span class="hljs-function">Mono&lt;String&gt; <span class="hljs-title">resolve</span><span class="hljs-params">(ServerWebExchange exchange)</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>KeyResolver</code> interface lets pluggable strategies derive the key for limiting requests.
In future milestone releases, there will be some <code>KeyResolver</code> implementations.</p>
</div>
<div class="paragraph">
<p>The default implementation of <code>KeyResolver</code> is the <code>PrincipalNameKeyResolver</code>, which retrieves the <code>Principal</code> from the <code>ServerWebExchange</code> and calls <code>Principal.getName()</code>.</p>
</div>
<div class="paragraph">
<p>By default, if the <code>KeyResolver</code> does not find a key, requests are denied.
You can adjust this behavior by setting the <code>spring.cloud.gateway.filter.request-rate-limiter.deny-empty-key</code> (<code>true</code> or <code>false</code>) and <code>spring.cloud.gateway.filter.request-rate-limiter.empty-key-status-code</code> properties.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>RequestRateLimiter</code> is not configurable with the "shortcut" notation. The following example below is <em>invalid</em>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 39. application.properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre># INVALID SHORTCUT CONFIGURATION
spring.cloud.gateway.routes[0].filters[0]=RequestRateLimiter=2, 2, #{@userkeyresolver}</pre>
</div>
</div>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="the-redis-ratelimiter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-redis-ratelimiter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-redis-ratelimiter">74.11.1. The Redis <code>RateLimiter</code></a></h4>
<div class="paragraph">
<p>The Redis implementation is based off of work done at <a href="https://stripe.com/blog/rate-limiters">Stripe</a>.
It requires the use of the <code>spring-boot-starter-data-redis-reactive</code> Spring Boot starter.</p>
</div>
<div class="paragraph">
<p>The algorithm used is the <a href="https://en.wikipedia.org/wiki/Token_bucket">Token Bucket Algorithm</a>.</p>
</div>
<div class="paragraph">
<p>The <code>redis-rate-limiter.replenishRate</code> property is how many requests per second you want a user to be allowed to do, without any dropped requests.
This is the rate at which the token bucket is filled.</p>
</div>
<div class="paragraph">
<p>The <code>redis-rate-limiter.burstCapacity</code> property is the maximum number of requests a user is allowed to do in a single second.
This is the number of tokens the token bucket can hold.
Setting this value to zero blocks all requests.</p>
</div>
<div class="paragraph">
<p>The <code>redis-rate-limiter.requestedTokens</code> property is how many tokens a request costs.
This is the number of tokens taken from the bucket for each request and defaults to <code>1</code>.</p>
</div>
<div class="paragraph">
<p>A steady rate is accomplished by setting the same value in <code>replenishRate</code> and <code>burstCapacity</code>.
Temporary bursts can be allowed by setting <code>burstCapacity</code> higher than <code>replenishRate</code>.
In this case, the rate limiter needs to be allowed some time between bursts (according to <code>replenishRate</code>), as two consecutive bursts will result in dropped requests (<code>HTTP 429 - Too Many Requests</code>).
The following listing configures a <code>redis-rate-limiter</code>:</p>
</div>
<div class="paragraph">
<p>Rate limits bellow <code>1 request/s</code> are accomplished by setting <code>replenishRate</code> to the wanted number of requests, <code>requestedTokens</code> to the timespan in seconds and <code>burstCapacity</code> to the product of <code>replenishRate</code> and <code>requestedTokens</code>, e.g. setting <code>replenishRate=1</code>, <code>requestedTokens=60</code> and <code>burstCapacity=60</code> will result in a limit of <code>1 request/min</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 40. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: requestratelimiter_route
        uri: https://example.org
        filters:
        - name: RequestRateLimiter
          args:
            redis-rate-limiter.replenishRate: 10
            redis-rate-limiter.burstCapacity: 20
            redis-rate-limiter.requestedTokens: 1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example configures a KeyResolver in Java:</p>
</div>
<div class="exampleblock">
<div class="title">Example 41. Config.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function">KeyResolver <span class="hljs-title">userKeyResolver</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> exchange -&gt; Mono.just(exchange.getRequest().getQueryParams().getFirst(<span class="hljs-string">"user"</span>));
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This defines a request rate limit of 10 per user. A burst of 20 is allowed, but, in the next second, only 10 requests are available.
The <code>KeyResolver</code> is a simple one that gets the <code>user</code> request parameter (note that this is not recommended for production).</p>
</div>
<div class="paragraph">
<p>You can also define a rate limiter as a bean that implements the <code>RateLimiter</code> interface.
In configuration, you can reference the bean by name using SpEL.
<code>#{@myRateLimiter}</code> is a SpEL expression that references a bean with named <code>myRateLimiter</code>.
The following listing defines a rate limiter that uses the <code>KeyResolver</code> defined in the previous listing:</p>
</div>
<div class="exampleblock">
<div class="title">Example 42. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: requestratelimiter_route
        uri: https://example.org
        filters:
        - name: RequestRateLimiter
          args:
            rate-limiter: "#{@myRateLimiter}"
            key-resolver: "#{@userKeyResolver}"</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-redirectto-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-redirectto-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-redirectto-gatewayfilter-factory">74.12. The <code>RedirectTo</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>RedirectTo</code> <code>GatewayFilter</code> factory takes two parameters, <code>status</code> and <code>url</code>.
The <code>status</code> parameter should be a 300 series redirect HTTP code, such as 301.
The <code>url</code> parameter should be a valid URL.
This is the value of the <code>Location</code> header.
For relative redirects, you should use <code>uri: no://op</code> as the uri of your route definition.
The following listing configures a <code>RedirectTo</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 43. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: prefixpath_route
        uri: https://example.org
        filters:
        - RedirectTo=302, https://acme.org</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will send a status 302 with a <code>Location:https://acme.org</code> header to perform a redirect.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-removerequestheader-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-removerequestheader-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-removerequestheader-gatewayfilter-factory">74.13. The <code>RemoveRequestHeader</code> GatewayFilter Factory</a></h3>
<div class="paragraph">
<p>The <code>RemoveRequestHeader</code> <code>GatewayFilter</code> factory takes a <code>name</code> parameter.
It is the name of the header to be removed.
The following listing configures a <code>RemoveRequestHeader</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 44. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: removerequestheader_route
        uri: https://example.org
        filters:
        - RemoveRequestHeader=X-Request-Foo</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This removes the <code>X-Request-Foo</code> header before it is sent downstream.</p>
</div>
</div>
<div class="sect2">
<h3 id="removeresponseheader-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#removeresponseheader-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#removeresponseheader-gatewayfilter-factory">74.14. <code>RemoveResponseHeader</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>RemoveResponseHeader</code> <code>GatewayFilter</code> factory takes a <code>name</code> parameter.
It is the name of the header to be removed.
The following listing configures a <code>RemoveResponseHeader</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 45. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: removeresponseheader_route
        uri: https://example.org
        filters:
        - RemoveResponseHeader=X-Response-Foo</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will remove the <code>X-Response-Foo</code> header from the response before it is returned to the gateway client.</p>
</div>
<div class="paragraph">
<p>To remove any kind of sensitive header, you should configure this filter for any routes for which you may want to do so.
In addition, you can configure this filter once by using <code>spring.cloud.gateway.default-filters</code> and have it applied to all routes.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-removerequestparameter-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-removerequestparameter-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-removerequestparameter-gatewayfilter-factory">74.15. The <code>RemoveRequestParameter</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>RemoveRequestParameter</code> <code>GatewayFilter</code> factory takes a <code>name</code> parameter.
It is the name of the query parameter to be removed.
The following example configures a <code>RemoveRequestParameter</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 46. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: removerequestparameter_route
        uri: https://example.org
        filters:
        - RemoveRequestParameter=red</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will remove the <code>red</code> parameter before it is sent downstream.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-rewritepath-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-rewritepath-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-rewritepath-gatewayfilter-factory">74.16. The <code>RewritePath</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>RewritePath</code> <code>GatewayFilter</code> factory takes a path <code>regexp</code> parameter and a <code>replacement</code> parameter.
This uses Java regular expressions for a flexible way to rewrite the request path.
The following listing configures a <code>RewritePath</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 47. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: rewritepath_route
        uri: https://example.org
        predicates:
        - Path=/red/**
        filters:
        - RewritePath=/red(?&lt;segment&gt;/?.*), $\{segment}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For a request path of <code>/red/blue</code>, this sets the path to <code>/blue</code> before making the downstream request. Note that the <code>$</code> should be replaced with <code>$\</code> because of the YAML specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="rewritelocationresponseheader-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rewritelocationresponseheader-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rewritelocationresponseheader-gatewayfilter-factory">74.17. <code>RewriteLocationResponseHeader</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>RewriteLocationResponseHeader</code> <code>GatewayFilter</code> factory modifies the value of the <code>Location</code> response header, usually to get rid of backend-specific details.
It takes <code>stripVersionMode</code>, <code>locationHeaderName</code>, <code>hostValue</code>, and <code>protocolsRegex</code> parameters.
The following listing configures a <code>RewriteLocationResponseHeader</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 48. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: rewritelocationresponseheader_route
        uri: http://example.org
        filters:
        - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For example, for a request of <code>POST <a href="https://api.example.com/some/object/name" class="bare">api.example.com/some/object/name</a></code>, the <code>Location</code> response header value of <code><a href="https://object-service.prod.example.net/v2/some/object/id" class="bare">object-service.prod.example.net/v2/some/object/id</a></code> is rewritten as <code><a href="https://api.example.com/some/object/id" class="bare">api.example.com/some/object/id</a></code>.</p>
</div>
<div class="paragraph">
<p>The <code>stripVersionMode</code> parameter has the following possible values: <code>NEVER_STRIP</code>, <code>AS_IN_REQUEST</code> (default), and <code>ALWAYS_STRIP</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NEVER_STRIP</code>: The version is not stripped, even if the original request path contains no version.</p>
</li>
<li>
<p><code>AS_IN_REQUEST</code> The version is stripped only if the original request path contains no version.</p>
</li>
<li>
<p><code>ALWAYS_STRIP</code> The version is always stripped, even if the original request path contains version.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>hostValue</code> parameter, if provided, is used to replace the <code>host:port</code> portion of the response <code>Location</code> header.
If it is not provided, the value of the <code>Host</code> request header is used.</p>
</div>
<div class="paragraph">
<p>The <code>protocolsRegex</code> parameter must be a valid regex <code>String</code>, against which the protocol name is matched.
If it is not matched, the filter does nothing.
The default is <code>http|https|ftp|ftps</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-rewriteresponseheader-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-rewriteresponseheader-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-rewriteresponseheader-gatewayfilter-factory">74.18. The <code>RewriteResponseHeader</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>RewriteResponseHeader</code> <code>GatewayFilter</code> factory takes <code>name</code>, <code>regexp</code>, and <code>replacement</code> parameters.
It uses Java regular expressions for a flexible way to rewrite the response header value.
The following example configures a <code>RewriteResponseHeader</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 49. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: rewriteresponseheader_route
        uri: https://example.org
        filters:
        - RewriteResponseHeader=X-Response-Red, , password=[^&amp;]+, password=***</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For a header value of <code>/42?user=ford&amp;password=omg!what&amp;flag=true</code>, it is set to <code>/42?user=ford&amp;password=***&amp;flag=true</code> after making the downstream request.
You must use <code>$\</code> to mean <code>$</code> because of the YAML specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-savesession-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-savesession-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-savesession-gatewayfilter-factory">74.19. The <code>SaveSession</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>SaveSession</code> <code>GatewayFilter</code> factory forces a <code>WebSession::save</code> operation <em>before</em> forwarding the call downstream.
This is of particular use when using something like <a href="https://projects.spring.io/spring-session/">Spring Session</a> with a lazy data store and you need to ensure the session state has been saved before making the forwarded call.
The following example configures a <code>SaveSession</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 50. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: save_session
        uri: https://example.org
        predicates:
        - Path=/foo/**
        filters:
        - SaveSession</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you integrate <a href="https://projects.spring.io/spring-security/">Spring Security</a> with Spring Session and want to ensure security details have been forwarded to the remote process, this is critical.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-secureheaders-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-secureheaders-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-secureheaders-gatewayfilter-factory">74.20. The <code>SecureHeaders</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>SecureHeaders</code> <code>GatewayFilter</code> factory adds a number of headers to the response, per the recommendation made in <a href="https://blog.appcanary.com/2017/http-security-headers.html">this blog post</a>.</p>
</div>
<div class="paragraph">
<p>The following headers (shown with their default values) are added:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>X-Xss-Protection:1 (mode=block</code>)</p>
</li>
<li>
<p><code>Strict-Transport-Security (max-age=631138519</code>)</p>
</li>
<li>
<p><code>X-Frame-Options (DENY)</code></p>
</li>
<li>
<p><code>X-Content-Type-Options (nosniff)</code></p>
</li>
<li>
<p><code>Referrer-Policy (no-referrer)</code></p>
</li>
<li>
<p><code>Content-Security-Policy (default-src 'self' https:; font-src 'self' https: data:; img-src 'self' https: data:; object-src 'none'; script-src https:; style-src 'self' https: 'unsafe-inline)'</code></p>
</li>
<li>
<p><code>X-Download-Options (noopen)</code></p>
</li>
<li>
<p><code>X-Permitted-Cross-Domain-Policies (none)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To change the default values, set the appropriate property in the <code>spring.cloud.gateway.filter.secure-headers</code> namespace.
The following properties are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>xss-protection-header</code></p>
</li>
<li>
<p><code>strict-transport-security</code></p>
</li>
<li>
<p><code>x-frame-options</code></p>
</li>
<li>
<p><code>x-content-type-options</code></p>
</li>
<li>
<p><code>referrer-policy</code></p>
</li>
<li>
<p><code>content-security-policy</code></p>
</li>
<li>
<p><code>x-download-options</code></p>
</li>
<li>
<p><code>x-permitted-cross-domain-policies</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To disable the default values set the <code>spring.cloud.gateway.filter.secure-headers.disable</code> property with comma-separated values.
The following example shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle">spring.cloud.gateway.filter.secure-headers.disable=x-frame-<span class="hljs-keyword">options</span>,strict-transport-security</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The lowercase full name of the secure header needs to be used to disable it..
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="the-setpath-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-setpath-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-setpath-gatewayfilter-factory">74.21. The <code>SetPath</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>SetPath</code> <code>GatewayFilter</code> factory takes a path <code>template</code> parameter.
It offers a simple way to manipulate the request path by allowing templated segments of the path.
This uses the URI templates from Spring Framework.
Multiple matching segments are allowed.
The following example configures a <code>SetPath</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 51. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: setpath_route
        uri: https://example.org
        predicates:
        - Path=/red/{segment}
        filters:
        - SetPath=/{segment}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For a request path of <code>/red/blue</code>, this sets the path to <code>/blue</code> before making the downstream request.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-setrequestheader-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-setrequestheader-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-setrequestheader-gatewayfilter-factory">74.22. The <code>SetRequestHeader</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>SetRequestHeader</code> <code>GatewayFilter</code> factory takes <code>name</code> and <code>value</code> parameters.
The following listing configures a <code>SetRequestHeader</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 52. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: setrequestheader_route
        uri: https://example.org
        filters:
        - SetRequestHeader=X-Request-Red, Blue</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This <code>GatewayFilter</code> replaces (rather than adding) all headers with the given name.
So, if the downstream server responded with a <code>X-Request-Red:1234</code>, this would be replaced with <code>X-Request-Red:Blue</code>, which is what the downstream service would receive.</p>
</div>
<div class="paragraph">
<p><code>SetRequestHeader</code> is aware of URI variables used to match a path or host.
URI variables may be used in the value and are expanded at runtime.
The following example configures an <code>SetRequestHeader</code> <code>GatewayFilter</code> that uses a variable:</p>
</div>
<div class="exampleblock">
<div class="title">Example 53. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: setrequestheader_route
        uri: https://example.org
        predicates:
        - Host: {segment}.myhost.org
        filters:
        - SetRequestHeader=foo, bar-{segment}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-setresponseheader-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-setresponseheader-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-setresponseheader-gatewayfilter-factory">74.23. The <code>SetResponseHeader</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>SetResponseHeader</code> <code>GatewayFilter</code> factory takes <code>name</code> and <code>value</code> parameters.
The following listing configures a <code>SetResponseHeader</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 54. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: setresponseheader_route
        uri: https://example.org
        filters:
        - SetResponseHeader=X-Response-Red, Blue</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This GatewayFilter replaces (rather than adding) all headers with the given name.
So, if the downstream server responded with a <code>X-Response-Red:1234</code>, this is replaced with <code>X-Response-Red:Blue</code>, which is what the gateway client would receive.</p>
</div>
<div class="paragraph">
<p><code>SetResponseHeader</code> is aware of URI variables used to match a path or host.
URI variables may be used in the value and will be expanded at runtime.
The following example configures an <code>SetResponseHeader</code> <code>GatewayFilter</code> that uses a variable:</p>
</div>
<div class="exampleblock">
<div class="title">Example 55. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: setresponseheader_route
        uri: https://example.org
        predicates:
        - Host: {segment}.myhost.org
        filters:
        - SetResponseHeader=foo, bar-{segment}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-setstatus-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-setstatus-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-setstatus-gatewayfilter-factory">74.24. The <code>SetStatus</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>SetStatus</code> <code>GatewayFilter</code> factory takes a single parameter, <code>status</code>.
It must be a valid Spring <code>HttpStatus</code>.
It may be the integer value <code>404</code> or the string representation of the enumeration: <code>NOT_FOUND</code>.
The following listing configures a <code>SetStatus</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 56. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: setstatusstring_route
        uri: https://example.org
        filters:
        - SetStatus=BAD_REQUEST
      - id: setstatusint_route
        uri: https://example.org
        filters:
        - SetStatus=401</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In either case, the HTTP status of the response is set to 401.</p>
</div>
<div class="paragraph">
<p>You can configure the <code>SetStatus</code> <code>GatewayFilter</code> to return the original HTTP status code from the proxied request in a header in the response.
The header is added to the response if configured with the following property:</p>
</div>
<div class="exampleblock">
<div class="title">Example 57. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      set-status:
        original-status-header-name: original-http-status</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-stripprefix-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-stripprefix-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-stripprefix-gatewayfilter-factory">74.25. The <code>StripPrefix</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>StripPrefix</code> <code>GatewayFilter</code> factory takes one parameter, <code>parts</code>.
The <code>parts</code> parameter indicates the number of parts in the path to strip from the request before sending it downstream.
The following listing configures a <code>StripPrefix</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 58. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: nameRoot
        uri: https://nameservice
        predicates:
        - Path=/name/**
        filters:
        - StripPrefix=2</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When a request is made through the gateway to <code>/name/blue/red</code>, the request made to <code>nameservice</code> looks like <code><a href="https://nameservice/red" class="bare">nameservice/red</a></code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-retry-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-retry-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-retry-gatewayfilter-factory">74.26. The Retry <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>The <code>Retry</code> <code>GatewayFilter</code> factory supports the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>retries</code>: The number of retries that should be attempted.</p>
</li>
<li>
<p><code>statuses</code>: The HTTP status codes that should be retried, represented by using <code>org.springframework.http.HttpStatus</code>.</p>
</li>
<li>
<p><code>methods</code>: The HTTP methods that should be retried, represented by using <code>org.springframework.http.HttpMethod</code>.</p>
</li>
<li>
<p><code>series</code>: The series of status codes to be retried, represented by using <code>org.springframework.http.HttpStatus.Series</code>.</p>
</li>
<li>
<p><code>exceptions</code>: A list of thrown exceptions that should be retried.</p>
</li>
<li>
<p><code>backoff</code>: The configured exponential backoff for the retries.
Retries are performed after a backoff interval of <code>firstBackoff * (factor ^ n)</code>, where <code>n</code> is the iteration.
If <code>maxBackoff</code> is configured, the maximum backoff applied is limited to <code>maxBackoff</code>.
If <code>basedOnPreviousValue</code> is true, the backoff is calculated byusing <code>prevBackoff * factor</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following defaults are configured for <code>Retry</code> filter, if enabled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>retries</code>: Three times</p>
</li>
<li>
<p><code>series</code>: 5XX series</p>
</li>
<li>
<p><code>methods</code>: GET method</p>
</li>
<li>
<p><code>exceptions</code>: <code>IOException</code> and <code>TimeoutException</code></p>
</li>
<li>
<p><code>backoff</code>: disabled</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following listing configures a Retry <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 59. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: retry_test
        uri: http://localhost:8080/flakey
        predicates:
        - Host=*.retry.com
        filters:
        - name: Retry
          args:
            retries: 3
            statuses: BAD_GATEWAY
            methods: GET,POST
            backoff:
              firstBackoff: 10ms
              maxBackoff: 50ms
              factor: 2
              basedOnPreviousValue: false</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using the retry filter with a <code>forward:</code> prefixed URL, the target endpoint should be written carefully so that, in case of an error, it does not do anything that could result in a response being sent to the client and committed.
For example, if the target endpoint is an annotated controller, the target controller method should not return <code>ResponseEntity</code> with an error status code.
Instead, it should throw an <code>Exception</code> or signal an error (for example, through a <code>Mono.error(ex)</code> return value), which the retry filter can be configured to handle by retrying.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
When using the retry filter with any HTTP method with a body, the body will be cached and the gateway will become memory constrained. The body is cached in a request attribute defined by <code>ServerWebExchangeUtils.CACHED_REQUEST_BODY_ATTR</code>. The type of the object is a <code>org.springframework.core.io.buffer.DataBuffer</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="the-requestsize-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-requestsize-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-requestsize-gatewayfilter-factory">74.27. The <code>RequestSize</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>When the request size is greater than the permissible limit, the <code>RequestSize</code> <code>GatewayFilter</code> factory can restrict a request from reaching the downstream service.
The filter takes a <code>maxSize</code> parameter.
The <code>maxSize is a `DataSize</code> type, so values can be defined as a number followed by an optional <code>DataUnit</code> suffix such as 'KB' or 'MB'. The default is 'B' for bytes.
It is the permissible size limit of the request defined in bytes.
The following listing configures a <code>RequestSize</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 60. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: request_size_route
        uri: http://localhost:8080/upload
        predicates:
        - Path=/upload
        filters:
        - name: RequestSize
          args:
            maxSize: 5000000</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>RequestSize</code> <code>GatewayFilter</code> factory sets the response status as <code>413 Payload Too Large</code> with an additional header <code>errorMessage</code> when the request is rejected due to size. The following example shows such an <code>errorMessage</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs kotlin">errorMessage` : `Request size <span class="hljs-keyword">is</span> larger than permissible limit. Request size <span class="hljs-keyword">is</span> <span class="hljs-number">6.0</span> MB <span class="hljs-keyword">where</span> permissible limit <span class="hljs-keyword">is</span> <span class="hljs-number">5.0</span> MB</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default request size is set to five MB if not provided as a filter argument in the route definition.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="the-setrequesthostheader-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-setrequesthostheader-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-setrequesthostheader-gatewayfilter-factory">74.28. The <code>SetRequestHostHeader</code> <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>There are certain situation when the host header may need to be overridden. In this situation, the <code>SetRequestHostHeader</code> <code>GatewayFilter</code> factory can replace the existing host header with a specified vaue.
The filter takes a <code>host</code> parameter.
The following listing configures a <code>SetRequestHostHeader</code> <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 61. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: set_request_host_header_route
        uri: http://localhost:8080/headers
        predicates:
        - Path=/headers
        filters:
        - name: SetRequestHostHeader
          args:
            host: example.org</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>SetRequestHostHeader</code> <code>GatewayFilter</code> factory replaces the value of the host header with <code>example.org</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="modify-a-request-body-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#modify-a-request-body-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#modify-a-request-body-gatewayfilter-factory">74.29. Modify a Request Body <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>You can use the <code>ModifyRequestBody</code> filter filter to modify the request body before it is sent downstream by the gateway.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This filter can be configured only by using the Java DSL.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following listing shows how to modify a request body <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> RouteLocator <span class="hljs-title">routes</span><span class="hljs-params">(RouteLocatorBuilder builder)</span> </span>{
    <span class="hljs-keyword">return</span> builder.routes()
        .route(<span class="hljs-string">"rewrite_request_obj"</span>, r -&gt; r.host(<span class="hljs-string">"*.rewriterequestobj.org"</span>)
            .filters(f -&gt; f.prefixPath(<span class="hljs-string">"/httpbin"</span>)
                .modifyRequestBody(String.class, Hello.class, MediaType.APPLICATION_JSON_VALUE,
                    (exchange, s) -&gt; <span class="hljs-keyword">return</span> Mono.just(<span class="hljs-keyword">new</span> Hello(s.toUpperCase())))).uri(uri))
        .build();
}

<span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hello</span> </span>{
    String message;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Hello</span><span class="hljs-params">()</span> </span>{ }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Hello</span><span class="hljs-params">(String message)</span> </span>{
        <span class="hljs-keyword">this</span>.message = message;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getMessage</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> message;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMessage</span><span class="hljs-params">(String message)</span> </span>{
        <span class="hljs-keyword">this</span>.message = message;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if the request has no body, the <code>RewriteFilter</code> will be passed <code>null</code>. <code>Mono.empty()</code> should be returned to assign a missing body in the request.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="modify-a-response-body-gatewayfilter-factory"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#modify-a-response-body-gatewayfilter-factory"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#modify-a-response-body-gatewayfilter-factory">74.30. Modify a Response Body <code>GatewayFilter</code> Factory</a></h3>
<div class="paragraph">
<p>You can use the <code>ModifyResponseBody</code> filter to modify the response body before it is sent back to the client.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This filter can be configured only by using the Java DSL.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following listing shows how to modify a response body <code>GatewayFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> RouteLocator <span class="hljs-title">routes</span><span class="hljs-params">(RouteLocatorBuilder builder)</span> </span>{
    <span class="hljs-keyword">return</span> builder.routes()
        .route(<span class="hljs-string">"rewrite_response_upper"</span>, r -&gt; r.host(<span class="hljs-string">"*.rewriteresponseupper.org"</span>)
            .filters(f -&gt; f.prefixPath(<span class="hljs-string">"/httpbin"</span>)
                .modifyResponseBody(String.class, String.class,
                    (exchange, s) -&gt; Mono.just(s.toUpperCase()))).uri(uri))
        .build();
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if the response has no body, the <code>RewriteFilter</code> will be passed <code>null</code>. <code>Mono.empty()</code> should be returned to assign a missing body in the response.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="default-filters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#default-filters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#default-filters">74.31. Default Filters</a></h3>
<div class="paragraph">
<p>To add a filter and apply it to all routes, you can use <code>spring.cloud.gateway.default-filters</code>.
This property takes a list of filters.
The following listing defines a set of default filters:</p>
</div>
<div class="exampleblock">
<div class="title">Example 62. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      default-filters:
      - AddResponseHeader=X-Response-Default-Red, Default-Blue
      - PrefixPath=/httpbin</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="global-filters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#global-filters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#global-filters">75. Global Filters</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>GlobalFilter</code> interface has the same signature as <code>GatewayFilter</code>.
These are special filters that are conditionally applied to all routes.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This interface and its usage are subject to change in future milestone releases.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="gateway-combined-global-filter-and-gatewayfilter-ordering"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-combined-global-filter-and-gatewayfilter-ordering"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-combined-global-filter-and-gatewayfilter-ordering">75.1. Combined Global Filter and <code>GatewayFilter</code> Ordering</a></h3>
<div class="paragraph">
<p>When a request matches a route, the filtering web handler adds all instances of <code>GlobalFilter</code> and all route-specific instances of <code>GatewayFilter</code> to a filter chain.
This combined filter chain is sorted by the <code>org.springframework.core.Ordered</code> interface, which you can set by implementing the <code>getOrder()</code> method.</p>
</div>
<div class="paragraph">
<p>As Spring Cloud Gateway distinguishes between “pre” and “post” phases for filter logic execution (see <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-how-it-works">How it Works</a>), the filter with the highest precedence is the first in the “pre”-phase and the last in the “post”-phase.</p>
</div>
<div class="paragraph">
<p>The following listing configures a filter chain:</p>
</div>
<div class="exampleblock">
<div class="title">Example 63. ExampleConfiguration.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> GlobalFilter <span class="hljs-title">customFilter</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CustomGlobalFilter();
}

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomGlobalFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">GlobalFilter</span>, <span class="hljs-title">Ordered</span> </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title">filter</span><span class="hljs-params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>{
        log.info(<span class="hljs-string">"custom global filter"</span>);
        <span class="hljs-keyword">return</span> chain.filter(exchange);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getOrder</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="forward-routing-filter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#forward-routing-filter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#forward-routing-filter">75.2. Forward Routing Filter</a></h3>
<div class="paragraph">
<p>The <code>ForwardRoutingFilter</code> looks for a URI in the exchange attribute <code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code>.
If the URL has a <code>forward</code> scheme (such as <code>forward:///localendpoint</code>), it uses the Spring <code>DispatcherHandler</code> to handle the request.
The path part of the request URL is overridden with the path in the forward URL.
The unmodified original URL is appended to the list in the <code>ServerWebExchangeUtils.GATEWAY_ORIGINAL_REQUEST_URL_ATTR</code> attribute.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-loadbalancerclient-filter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-loadbalancerclient-filter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-loadbalancerclient-filter">75.3. The <code>LoadBalancerClient</code> Filter</a></h3>
<div class="paragraph">
<p>The <code>LoadBalancerClientFilter</code> looks for a URI in the exchange attribute named <code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code>.
If the URL has a scheme of <code>lb</code> (such as <code>lb://myservice</code>), it uses the Spring Cloud <code>LoadBalancerClient</code> to resolve the name (<code>myservice</code> in this case) to an actual host and port and replaces the URI in the same attribute.
The unmodified original URL is appended to the list in the <code>ServerWebExchangeUtils.GATEWAY_ORIGINAL_REQUEST_URL_ATTR</code> attribute.
The filter also looks in the <code>ServerWebExchangeUtils.GATEWAY_SCHEME_PREFIX_ATTR</code> attribute to see if it equals <code>lb</code>.
If so, the same rules apply.
The following listing configures a <code>LoadBalancerClientFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 64. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: myRoute
        uri: lb://service
        predicates:
        - Path=/service/**</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, when a service instance cannot be found in the <code>LoadBalancer</code>, a <code>503</code> is returned.
You can configure the Gateway to return a <code>404</code> by setting <code>spring.cloud.gateway.loadbalancer.use404=true</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>isSecure</code> value of the <code>ServiceInstance</code> returned from the <code>LoadBalancer</code> overrides
the scheme specified in the request made to the Gateway.
For example, if the request comes into the Gateway over <code>HTTPS</code>
but the <code>ServiceInstance</code> indicates it is not secure, the downstream request is made over
<code>HTTP</code>.
The opposite situation can also apply.
However, if <code>GATEWAY_SCHEME_PREFIX_ATTR</code> is specified for the
route in the Gateway configuration, the prefix is stripped and the resulting scheme from the
route URL overrides the <code>ServiceInstance</code> configuration.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>LoadBalancerClientFilter</code> uses a blocking ribbon <code>LoadBalancerClient</code> under the hood.
We suggest you use <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-loadbalancer-client-filter"><code>ReactiveLoadBalancerClientFilter</code> instead</a>.
You can switch to it by setting the value of the <code>spring.cloud.loadbalancer.ribbon.enabled</code> to <code>false</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="reactive-loadbalancer-client-filter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-loadbalancer-client-filter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-loadbalancer-client-filter">75.4. The <code>ReactiveLoadBalancerClientFilter</code></a></h3>
<div class="paragraph">
<p>The <code>ReactiveLoadBalancerClientFilter</code> looks for a URI in the exchange attribute named <code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code>.
If the URL has a <code>lb</code> scheme (such as <code>lb://myservice</code>), it uses the Spring Cloud <code>ReactorLoadBalancer</code> to resolve the name (<code>myservice</code> in this example) to an actual host and port and replaces the URI in the same attribute.
The unmodified original URL is appended to the list in the <code>ServerWebExchangeUtils.GATEWAY_ORIGINAL_REQUEST_URL_ATTR</code> attribute.
The filter also looks in the <code>ServerWebExchangeUtils.GATEWAY_SCHEME_PREFIX_ATTR</code> attribute to see if it equals <code>lb</code>.
If so, the same rules apply.
The following listing configures a <code>ReactiveLoadBalancerClientFilter</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 65. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: myRoute
        uri: lb://service
        predicates:
        - Path=/service/**</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, when a service instance cannot be found by the <code>ReactorLoadBalancer</code>, a <code>503</code> is returned.
You can configure the gateway to return a <code>404</code> by setting <code>spring.cloud.gateway.loadbalancer.use404=true</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>isSecure</code> value of the <code>ServiceInstance</code> returned from the <code>ReactiveLoadBalancerClientFilter</code> overrides
the scheme specified in the request made to the Gateway.
For example, if the request comes into the Gateway over <code>HTTPS</code> but the <code>ServiceInstance</code> indicates it is not secure, the downstream request is made over <code>HTTP</code>.
The opposite situation can also apply.
However, if <code>GATEWAY_SCHEME_PREFIX_ATTR</code> is specified for the route in the Gateway configuration, the prefix is stripped and the resulting scheme from the route URL overrides the <code>ServiceInstance</code> configuration.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="the-netty-routing-filter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-netty-routing-filter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-netty-routing-filter">75.5. The Netty Routing Filter</a></h3>
<div class="paragraph">
<p>The Netty routing filter runs if the URL located in the <code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code> exchange attribute has a <code>http</code> or <code>https</code> scheme.
It uses the Netty <code>HttpClient</code> to make the downstream proxy request.
The response is put in the <code>ServerWebExchangeUtils.CLIENT_RESPONSE_ATTR</code> exchange attribute for use in a later filter.
(There is also an experimental <code>WebClientHttpRoutingFilter</code> that performs the same function but does not require Netty.)</p>
</div>
</div>
<div class="sect2">
<h3 id="the-netty-write-response-filter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-netty-write-response-filter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-netty-write-response-filter">75.6. The Netty Write Response Filter</a></h3>
<div class="paragraph">
<p>The <code>NettyWriteResponseFilter</code> runs if there is a Netty <code>HttpClientResponse</code> in the <code>ServerWebExchangeUtils.CLIENT_RESPONSE_ATTR</code> exchange attribute.
It runs after all other filters have completed and writes the proxy response back to the gateway client response.
(There is also an experimental <code>WebClientWriteResponseFilter</code> that performs the same function but does not require Netty.)</p>
</div>
</div>
<div class="sect2">
<h3 id="the-routetorequesturl-filter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-routetorequesturl-filter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-routetorequesturl-filter">75.7. The <code>RouteToRequestUrl</code> Filter</a></h3>
<div class="paragraph">
<p>If there is a <code>Route</code> object in the <code>ServerWebExchangeUtils.GATEWAY_ROUTE_ATTR</code> exchange attribute, the <code>RouteToRequestUrlFilter</code> runs.
It creates a new URI, based off of the request URI but updated with the URI attribute of the <code>Route</code> object.
The new URI is placed in the <code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code> exchange attribute`.</p>
</div>
<div class="paragraph">
<p>If the URI has a scheme prefix, such as <code>lb:ws://serviceid</code>, the <code>lb</code> scheme is stripped from the URI and placed in the <code>ServerWebExchangeUtils.GATEWAY_SCHEME_PREFIX_ATTR</code> for use later in the filter chain.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-websocket-routing-filter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-websocket-routing-filter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-websocket-routing-filter">75.8. The Websocket Routing Filter</a></h3>
<div class="paragraph">
<p>If the URL located in the <code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code> exchange attribute has a <code>ws</code> or <code>wss</code> scheme, the websocket routing filter runs. It uses the Spring WebSocket infrastructure to forward the websocket request downstream.</p>
</div>
<div class="paragraph">
<p>You can load-balance websockets by prefixing the URI with <code>lb</code>, such as <code>lb:ws://serviceid</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use <a href="https://github.com/sockjs">SockJS</a> as a fallback over normal HTTP, you should configure a normal HTTP route as well as the websocket Route.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following listing configures a websocket routing filter:</p>
</div>
<div class="exampleblock">
<div class="title">Example 66. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      # SockJS route
      - id: websocket_sockjs_route
        uri: http://localhost:3001
        predicates:
        - Path=/websocket/info/**
      # Normal Websocket route
      - id: websocket_route
        uri: ws://localhost:3001
        predicates:
        - Path=/websocket/**</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-gateway-metrics-filter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-gateway-metrics-filter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-gateway-metrics-filter">75.9. The Gateway Metrics Filter</a></h3>
<div class="paragraph">
<p>To enable gateway metrics, add spring-boot-starter-actuator as a project dependency. Then, by default, the gateway metrics filter runs as long as the property <code>spring.cloud.gateway.metrics.enabled</code> is not set to <code>false</code>. This filter adds a timer metric named <code>gateway.requests</code> with the following tags:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>routeId</code>: The route ID.</p>
</li>
<li>
<p><code>routeUri</code>: The URI to which the API is routed.</p>
</li>
<li>
<p><code>outcome</code>: The outcome, as classified by <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/http/HttpStatus.Series.html">HttpStatus.Series</a>.</p>
</li>
<li>
<p><code>status</code>: The HTTP status of the request returned to the client.</p>
</li>
<li>
<p><code>httpStatusCode</code>: The HTTP Status of the request returned to the client.</p>
</li>
<li>
<p><code>httpMethod</code>: The HTTP method used for the request.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These metrics are then available to be scraped from <code>/actuator/metrics/gateway.requests</code> and can be easily integrated with Prometheus to create a <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/images/gateway-grafana-dashboard.jpeg">Grafana</a> <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/gateway-grafana-dashboard.json">dashboard</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To enable the prometheus endpoint, add <code>micrometer-registry-prometheus</code> as a project dependency.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="marking-an-exchange-as-routed"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#marking-an-exchange-as-routed"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#marking-an-exchange-as-routed">75.10. Marking An Exchange As Routed</a></h3>
<div class="paragraph">
<p>After the gateway has routed a <code>ServerWebExchange</code>, it marks that exchange as “routed” by adding <code>gatewayAlreadyRouted</code>
to the exchange attributes. Once a request has been marked as routed, other routing filters will not route the request again,
essentially skipping the filter. There are convenience methods that you can use to mark an exchange as routed
or check if an exchange has already been routed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ServerWebExchangeUtils.isAlreadyRouted</code> takes a <code>ServerWebExchange</code> object and checks if it has been “routed”.</p>
</li>
<li>
<p><code>ServerWebExchangeUtils.setAlreadyRouted</code> takes a <code>ServerWebExchange</code> object and marks it as “routed”.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="httpheadersfilters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#httpheadersfilters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#httpheadersfilters">76. HttpHeadersFilters</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>HttpHeadersFilters are applied to requests before sending them downstream, such as in the <code>NettyRoutingFilter</code>.</p>
</div>
<div class="sect2">
<h3 id="forwarded-headers-filter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#forwarded-headers-filter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#forwarded-headers-filter">76.1. Forwarded Headers Filter</a></h3>
<div class="paragraph">
<p>The <code>Forwarded</code> Headers Filter creates a <code>Forwarded</code> header to send to the downstream service. It adds the <code>Host</code> header, scheme and port of the current request to any existing <code>Forwarded</code> header.</p>
</div>
</div>
<div class="sect2">
<h3 id="removehopbyhop-headers-filter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#removehopbyhop-headers-filter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#removehopbyhop-headers-filter">76.2. RemoveHopByHop Headers Filter</a></h3>
<div class="paragraph">
<p>The <code>RemoveHopByHop</code> Headers Filter removes headers from forwarded requests. The default list of headers that is removed comes from the <a href="https://tools.ietf.org/html/draft-ietf-httpbis-p1-messaging-14#section-7.1.3">IETF</a>.</p>
</div>
<div class="ulist">
<div class="title">The default removed headers are:</div>
<ul>
<li>
<p>Connection</p>
</li>
<li>
<p>Keep-Alive</p>
</li>
<li>
<p>Proxy-Authenticate</p>
</li>
<li>
<p>Proxy-Authorization</p>
</li>
<li>
<p>TE</p>
</li>
<li>
<p>Trailer</p>
</li>
<li>
<p>Transfer-Encoding</p>
</li>
<li>
<p>Upgrade</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To change this, set the <code>spring.cloud.gateway.filter.remove-hop-by-hop.headers</code> property to the list of header names to remove.</p>
</div>
</div>
<div class="sect2">
<h3 id="xforwarded-headers-filter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#xforwarded-headers-filter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#xforwarded-headers-filter">76.3. XForwarded Headers Filter</a></h3>
<div class="paragraph">
<p>The <code>XForwarded</code> Headers Filter creates various a <code>X-Forwarded-*</code> headers to send to the downstream service. It users the <code>Host</code> header, scheme, port and path of the current request to create the various headers.</p>
</div>
<div class="paragraph">
<p>Creating of individual headers can be controlled by the following boolean properties (defaults to true):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spring.cloud.gateway.x-forwarded.for-enabled</code></p>
</li>
<li>
<p><code>spring.cloud.gateway.x-forwarded.host-enabled</code></p>
</li>
<li>
<p><code>spring.cloud.gateway.x-forwarded.port-enabled</code></p>
</li>
<li>
<p><code>spring.cloud.gateway.x-forwarded.proto-enabled</code></p>
</li>
<li>
<p><code>spring.cloud.gateway.x-forwarded.prefix-enabled</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Appending multiple headers can be controlled by the following boolean properties (defaults to true):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spring.cloud.gateway.x-forwarded.for-append</code></p>
</li>
<li>
<p><code>spring.cloud.gateway.x-forwarded.host-append</code></p>
</li>
<li>
<p><code>spring.cloud.gateway.x-forwarded.port-append</code></p>
</li>
<li>
<p><code>spring.cloud.gateway.x-forwarded.proto-append</code></p>
</li>
<li>
<p><code>spring.cloud.gateway.x-forwarded.prefix-append</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tls-and-ssl"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tls-and-ssl"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tls-and-ssl">77. TLS and SSL</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The gateway can listen for requests on HTTPS by following the usual Spring server configuration.
The following example shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="title">Example 67. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">server:
  ssl:
    enabled: true
    key-alias: scg
    key-store-password: scg1234
    key-store: classpath:scg-keystore.p12
    key-store-type: PKCS12</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can route gateway routes to both HTTP and HTTPS backends.
If you are routing to an HTTPS backend, you can configure the gateway to trust all downstream certificates with the following configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 68. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      httpclient:
        ssl:
          useInsecureTrustManager: true</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using an insecure trust manager is not suitable for production.
For a production deployment, you can configure the gateway with a set of known certificates that it can trust with the following configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 69. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      httpclient:
        ssl:
          trustedX509Certificates:
          - cert1.pem
          - cert2.pem</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the Spring Cloud Gateway is not provisioned with trusted certificates, the default trust store is used (which you can override by setting the <code>javax.net.ssl.trustStore</code> system property).</p>
</div>
<div class="sect2">
<h3 id="tls-handshake"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tls-handshake"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tls-handshake">77.1. TLS Handshake</a></h3>
<div class="paragraph">
<p>The gateway maintains a client pool that it uses to route to backends.
When communicating over HTTPS, the client initiates a TLS handshake.
A number of timeouts are associated with this handshake.
You can configure these timeouts can be configured (defaults shown) as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 70. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      httpclient:
        ssl:
          handshake-timeout-millis: 10000
          close-notify-flush-timeout-millis: 3000
          close-notify-read-timeout-millis: 0</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-3">78. Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configuration for Spring Cloud Gateway is driven by a collection of <code>RouteDefinitionLocator</code> instances.
The following listing shows the definition of the <code>RouteDefinitionLocator</code> interface:</p>
</div>
<div class="exampleblock">
<div class="title">Example 71. RouteDefinitionLocator.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">RouteDefinitionLocator</span> </span>{
    <span class="hljs-function">Flux&lt;RouteDefinition&gt; <span class="hljs-title">getRouteDefinitions</span><span class="hljs-params">()</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, a <code>PropertiesRouteDefinitionLocator</code> loads properties by using Spring Boot’s <code>@ConfigurationProperties</code> mechanism.</p>
</div>
<div class="paragraph">
<p>The earlier configuration examples all use a shortcut notation that uses positional arguments rather than named ones.
The following two examples are equivalent:</p>
</div>
<div class="exampleblock">
<div class="title">Example 72. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: setstatus_route
        uri: https://example.org
        filters:
        - name: SetStatus
          args:
            status: 401
      - id: setstatusshortcut_route
        uri: https://example.org
        filters:
        - SetStatus=401</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For some usages of the gateway, properties are adequate, but some production use cases benefit from loading configuration from an external source, such as a database. Future milestone versions will have <code>RouteDefinitionLocator</code> implementations based off of Spring Data Repositories, such as Redis, MongoDB, and Cassandra.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="route-metadata-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#route-metadata-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#route-metadata-configuration">79. Route Metadata Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure additional parameters for each route by using metadata, as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 73. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: route_with_metadata
        uri: https://example.org
        metadata:
          optionName: "OptionValue"
          compositeObject:
            name: "value"
          iAmNumber: 1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You could acquire all metadata properties from an exchange, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs kotlin">Route route = exchange.getAttribute(GATEWAY_ROUTE_ATTR);
<span class="hljs-comment">// get all metadata properties</span>
route.getMetadata();
<span class="hljs-comment">// get a single metadata property</span>
route.getMetadata(someKey);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-timeouts-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-timeouts-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-timeouts-configuration">80. Http timeouts configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Http timeouts (response and connect) can be configured for all routes and overridden for each specific route.</p>
</div>
<div class="sect2">
<h3 id="global-timeouts"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#global-timeouts"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#global-timeouts">80.1. Global timeouts</a></h3>
<div class="paragraph">
<p>To configure Global http timeouts:<br>
<code>connect-timeout</code> must be specified in milliseconds.<br>
<code>response-timeout</code> must be specified as a java.time.Duration</p>
</div>
<div class="listingblock">
<div class="title">global http timeouts example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      httpclient:
        connect-timeout: 1000
        response-timeout: 5s</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="per-route-timeouts"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#per-route-timeouts"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#per-route-timeouts">80.2. Per-route timeouts</a></h3>
<div class="paragraph">
<p>To configure per-route timeouts:<br>
<code>connect-timeout</code> must be specified in milliseconds.<br>
<code>response-timeout</code> must be specified in milliseconds.</p>
</div>
<div class="listingblock">
<div class="title">per-route http timeouts configuration via configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">      - id: per_route_timeouts
        uri: https://example.org
        predicates:
          - name: Path
            args:
              pattern: /delay/{timeout}
        metadata:
          response-timeout: 200
          connect-timeout: 200</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">per-route timeouts configuration using Java DSL</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.springframework.cloud.gateway.support.RouteMetadataUtils.CONNECT_TIMEOUT_ATTR;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.springframework.cloud.gateway.support.RouteMetadataUtils.RESPONSE_TIMEOUT_ATTR;

      <span class="hljs-meta">@Bean</span>
      <span class="hljs-function"><span class="hljs-keyword">public</span> RouteLocator <span class="hljs-title">customRouteLocator</span><span class="hljs-params">(RouteLocatorBuilder routeBuilder)</span></span>{
         <span class="hljs-keyword">return</span> routeBuilder.routes()
               .route(<span class="hljs-string">"test1"</span>, r -&gt; {
                  <span class="hljs-keyword">return</span> r.host(<span class="hljs-string">"*.somehost.org"</span>).and().path(<span class="hljs-string">"/somepath"</span>)
                        .filters(f -&gt; f.addRequestHeader(<span class="hljs-string">"header1"</span>, <span class="hljs-string">"header-value-1"</span>))
                        .uri(<span class="hljs-string">"http://someuri"</span>)
                        .metadata(RESPONSE_TIMEOUT_ATTR, <span class="hljs-number">200</span>)
                        .metadata(CONNECT_TIMEOUT_ATTR, <span class="hljs-number">200</span>);
               })
               .build();
      }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fluent-java-routes-api"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#fluent-java-routes-api"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#fluent-java-routes-api">80.3. Fluent Java Routes API</a></h3>
<div class="paragraph">
<p>To allow for simple configuration in Java, the <code>RouteLocatorBuilder</code> bean includes a fluent API.
The following listing shows how it works:</p>
</div>
<div class="exampleblock">
<div class="title">Example 74. GatewaySampleApplication.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// static imports from GatewayFilters and RoutePredicates</span>
<span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> RouteLocator <span class="hljs-title">customRouteLocator</span><span class="hljs-params">(RouteLocatorBuilder builder, ThrottleGatewayFilterFactory throttle)</span> </span>{
    <span class="hljs-keyword">return</span> builder.routes()
            .route(r -&gt; r.host(<span class="hljs-string">"**.abc.org"</span>).and().path(<span class="hljs-string">"/image/png"</span>)
                .filters(f -&gt;
                        f.addResponseHeader(<span class="hljs-string">"X-TestHeader"</span>, <span class="hljs-string">"foobar"</span>))
                .uri(<span class="hljs-string">"http://httpbin.org:80"</span>)
            )
            .route(r -&gt; r.path(<span class="hljs-string">"/image/webp"</span>)
                .filters(f -&gt;
                        f.addResponseHeader(<span class="hljs-string">"X-AnotherHeader"</span>, <span class="hljs-string">"baz"</span>))
                .uri(<span class="hljs-string">"http://httpbin.org:80"</span>)
                .metadata(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>)
            )
            .route(r -&gt; r.order(-<span class="hljs-number">1</span>)
                .host(<span class="hljs-string">"**.throttle.org"</span>).and().path(<span class="hljs-string">"/get"</span>)
                .filters(f -&gt; f.filter(throttle.apply(<span class="hljs-number">1</span>,
                        <span class="hljs-number">1</span>,
                        <span class="hljs-number">10</span>,
                        TimeUnit.SECONDS)))
                .uri(<span class="hljs-string">"http://httpbin.org:80"</span>)
                .metadata(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>)
            )
            .build();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This style also allows for more custom predicate assertions.
The predicates defined by <code>RouteDefinitionLocator</code> beans are combined using logical <code>and</code>.
By using the fluent Java API, you can use the <code>and()</code>, <code>or()</code>, and <code>negate()</code> operators on the <code>Predicate</code> class.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-discoveryclient-route-definition-locator"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-discoveryclient-route-definition-locator"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-discoveryclient-route-definition-locator">80.4. The <code>DiscoveryClient</code> Route Definition Locator</a></h3>
<div class="paragraph">
<p>You can configure the gateway to create routes based on services registered with a <code>DiscoveryClient</code> compatible service registry.</p>
</div>
<div class="paragraph">
<p>To enable this, set <code>spring.cloud.gateway.discovery.locator.enabled=true</code> and make sure a <code>DiscoveryClient</code> implementation (such as Netflix Eureka, Consul, or Zookeeper) is on the classpath and enabled.</p>
</div>
<div class="sect3">
<h4 id="configuring-predicates-and-filters-for-discoveryclient-routes"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-predicates-and-filters-for-discoveryclient-routes"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-predicates-and-filters-for-discoveryclient-routes">80.4.1. Configuring Predicates and Filters For <code>DiscoveryClient</code> Routes</a></h4>
<div class="paragraph">
<p>By default, the gateway defines a single predicate and filter for routes created with a <code>DiscoveryClient</code>.</p>
</div>
<div class="paragraph">
<p>The default predicate is a path predicate defined with the pattern <code>/serviceId/**</code>, where <code>serviceId</code> is
the ID of the service from the <code>DiscoveryClient</code>.</p>
</div>
<div class="paragraph">
<p>The default filter is a rewrite path filter with the regex <code>/serviceId/(?&lt;remaining&gt;.*)</code> and the replacement <code>/${remaining}</code>.
This strips the service ID from the path before the request is sent downstream.</p>
</div>
<div class="paragraph">
<p>If you want to customize the predicates or filters used by the <code>DiscoveryClient</code> routes, set <code>spring.cloud.gateway.discovery.locator.predicates[x]</code> and <code>spring.cloud.gateway.discovery.locator.filters[y]</code>.
When doing so, you need to make sure to include the default predicate and filter shown earlier, if you want to retain that functionality.
The following example shows what this looks like:</p>
</div>
<div class="exampleblock">
<div class="title">Example 75. application.properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>spring.cloud.gateway.discovery.locator.predicates[0].name: Path
spring.cloud.gateway.discovery.locator.predicates[0].args[pattern]: "'/'+serviceId+'/**'"
spring.cloud.gateway.discovery.locator.predicates[1].name: Host
spring.cloud.gateway.discovery.locator.predicates[1].args[pattern]: "'**.foo.com'"
spring.cloud.gateway.discovery.locator.filters[0].name: Hystrix
spring.cloud.gateway.discovery.locator.filters[0].args[name]: serviceId
spring.cloud.gateway.discovery.locator.filters[1].name: RewritePath
spring.cloud.gateway.discovery.locator.filters[1].args[regexp]: "'/' + serviceId + '/(?&lt;remaining&gt;.*)'"
spring.cloud.gateway.discovery.locator.filters[1].args[replacement]: "'/${remaining}'"</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reactor-netty-access-logs"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactor-netty-access-logs"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactor-netty-access-logs">81. Reactor Netty Access Logs</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable Reactor Netty access logs, set <code>-Dreactor.netty.http.server.accessLogEnabled=true</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It must be a Java System Property, not a Spring Boot property.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can configure the logging system to have a separate access log file. The following example creates a Logback configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 76. logback.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"accessLog"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.FileAppender"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>access_log.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"async"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.AsyncAppender"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"accessLog"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"reactor.netty.http.server.AccessLog"</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"INFO"</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">"false"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"async"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">logger</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cors-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cors-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cors-configuration">82. CORS Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure the gateway to control CORS behavior. The “global” CORS configuration is a map of URL patterns to <a href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/cors/CorsConfiguration.html">Spring Framework <code>CorsConfiguration</code></a>.
The following example configures CORS:</p>
</div>
<div class="exampleblock">
<div class="title">Example 77. application.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins: "https://docs.spring.io"
            allowedMethods:
            - GET</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, CORS requests are allowed from requests that originate from <code>docs.spring.io</code> for all GET requested paths.</p>
</div>
<div class="paragraph">
<p>To provide the same CORS configuration to requests that are not handled by some gateway route predicate, set the <code>spring.cloud.gateway.globalcors.add-to-simple-url-handler-mapping</code> property to <code>true</code>.
This is useful when you try to support CORS preflight requests and your route predicate does not evalute to <code>true</code> because the HTTP method is <code>options</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actuator-api"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#actuator-api"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#actuator-api">83. Actuator API</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>/gateway</code> actuator endpoint lets you monitor and interact with a Spring Cloud Gateway application.
To be remotely accessible, the endpoint has to be <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html#production-ready-endpoints-enabling-endpoints">enabled</a> and <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html#production-ready-endpoints-exposing-endpoints">exposed over HTTP or JMX</a> in the application properties.
The following listing shows how to do so:</p>
</div>
<div class="exampleblock">
<div class="title">Example 78. application.properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"><span class="hljs-meta">management.endpoint.gateway.enabled</span>=<span class="hljs-string">true # default value</span>
<span class="hljs-meta">management.endpoints.web.exposure.include</span>=<span class="hljs-string">gateway</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verbose-actuator-format"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#verbose-actuator-format"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#verbose-actuator-format">83.1. Verbose Actuator Format</a></h3>
<div class="paragraph">
<p>A new, more verbose format has been added to Spring Cloud Gateway.
It adds more detail to each route, letting you view the predicates and filters associated with each route along with any configuration that is available.
The following example configures <code>/actuator/gateway/routes</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    <span class="hljs-attr">"predicate"</span>: <span class="hljs-string">"(Hosts: [**.addrequestheader.org] &amp;&amp; Paths: [/headers], match trailing slash: true)"</span>,
    <span class="hljs-attr">"route_id"</span>: <span class="hljs-string">"add_request_header_test"</span>,
    <span class="hljs-attr">"filters"</span>: [
      <span class="hljs-string">"[[AddResponseHeader X-Response-Default-Foo = 'Default-Bar'], order = 1]"</span>,
      <span class="hljs-string">"[[AddRequestHeader X-Request-Foo = 'Bar'], order = 1]"</span>,
      <span class="hljs-string">"[[PrefixPath prefix = '/httpbin'], order = 2]"</span>
    ],
    <span class="hljs-attr">"uri"</span>: <span class="hljs-string">"lb://testservice"</span>,
    <span class="hljs-attr">"order"</span>: <span class="hljs-number">0</span>
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This feature is enabled by default. To disable it, set the following property:</p>
</div>
<div class="exampleblock">
<div class="title">Example 79. application.properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"><span class="hljs-meta">spring.cloud.gateway.actuator.verbose.enabled</span>=<span class="hljs-string">false</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will default to <code>true</code> in a future release.</p>
</div>
</div>
<div class="sect2">
<h3 id="retrieving-route-filters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#retrieving-route-filters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#retrieving-route-filters">83.2. Retrieving Route Filters</a></h3>
<div class="paragraph">
<p>This section details how to retrieve route filters, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-global-filters">Global Filters</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-route-filters">[gateway-route-filters]</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="gateway-global-filters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-global-filters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-global-filters">83.2.1. Global Filters</a></h4>
<div class="paragraph">
<p>To retrieve the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#global-filters">global filters</a> applied to all routes, make a <code>GET</code> request to <code>/actuator/gateway/globalfilters</code>. The resulting response is similar to the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>{
  "org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@77856cc5": 10100,
  "org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@4f6fd101": 10000,
  "org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@32d22650": -1,
  "org.springframework.cloud.gateway.filter.ForwardRoutingFilter@106459d9": 2147483647,
  "org.springframework.cloud.gateway.filter.NettyRoutingFilter@1fbd5e0": 2147483647,
  "org.springframework.cloud.gateway.filter.ForwardPathFilter@33a71d23": 0,
  "org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@135064ea": 2147483637,
  "org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@23c05889": 2147483646
}</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The response contains the details of the global filters that are in place.
For each global filter, there is a string representation of the filter object (for example, <code>org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@77856cc5</code>) and the corresponding <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-combined-global-filter-and-gatewayfilter-ordering">order</a> in the filter chain.}</p>
</div>
</div>
<div class="sect3">
<h4 id="gateway-route-filters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-route-filters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-route-filters">83.2.2. Route Filters</a></h4>
<div class="paragraph">
<p>To retrieve the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gatewayfilter-factories"><code>GatewayFilter</code> factories</a> applied to routes, make a <code>GET</code> request to <code>/actuator/gateway/routefilters</code>.
The resulting response is similar to the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>{
  "[AddRequestHeaderGatewayFilterFactory@570ed9c configClass = AbstractNameValueGatewayFilterFactory.NameValueConfig]": null,
  "[SecureHeadersGatewayFilterFactory@fceab5d configClass = Object]": null,
  "[SaveSessionGatewayFilterFactory@4449b273 configClass = Object]": null
}</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The response contains the details of the <code>GatewayFilter</code> factories applied to any particular route.
For each factory there is a string representation of the corresponding object (for example, <code>[SecureHeadersGatewayFilterFactory@fceab5d configClass = Object]</code>).
Note that the <code>null</code> value is due to an incomplete implementation of the endpoint controller, because it tries to set the order of the object in the filter chain, which does not apply to a <code>GatewayFilter</code> factory object.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="refreshing-the-route-cache"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#refreshing-the-route-cache"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#refreshing-the-route-cache">83.3. Refreshing the Route Cache</a></h3>
<div class="paragraph">
<p>To clear the routes cache, make a <code>POST</code> request to <code>/actuator/gateway/refresh</code>.
The request returns a 200 without a response body.</p>
</div>
</div>
<div class="sect2">
<h3 id="retrieving-the-routes-defined-in-the-gateway"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#retrieving-the-routes-defined-in-the-gateway"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#retrieving-the-routes-defined-in-the-gateway">83.4. Retrieving the Routes Defined in the Gateway</a></h3>
<div class="paragraph">
<p>To retrieve the routes defined in the gateway, make a <code>GET</code> request to <code>/actuator/gateway/routes</code>.
The resulting response is similar to the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>[{
  "route_id": "first_route",
  "route_object": {
    "predicate": "org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory$$Lambda$432/1736826640@1e9d7e7d",
    "filters": [
      "OrderedGatewayFilter{delegate=org.springframework.cloud.gateway.filter.factory.PreserveHostHeaderGatewayFilterFactory$$Lambda$436/674480275@6631ef72, order=0}"
    ]
  },
  "order": 0
},
{
  "route_id": "second_route",
  "route_object": {
    "predicate": "org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory$$Lambda$432/1736826640@cd8d298",
    "filters": []
  },
  "order": 0
}]</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The response contains the details of all the routes defined in the gateway.
The following table describes the structure of each element (each is a route) of the response:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>route_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The route ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>route_object.predicate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The route predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>route_object.filters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gatewayfilter-factories"><code>GatewayFilter</code> factories</a> applied to the route.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>order</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The route order.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="gateway-retrieving-information-about-a-particular-route"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-retrieving-information-about-a-particular-route"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-retrieving-information-about-a-particular-route">83.5. Retrieving Information about a Particular Route</a></h3>
<div class="paragraph">
<p>To retrieve information about a single route, make a <code>GET</code> request to <code>/actuator/gateway/routes/{id}</code> (for example, <code>/actuator/gateway/routes/first_route</code>).
The resulting response is similar to the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>{
  "id": "first_route",
  "predicates": [{
    "name": "Path",
    "args": {"_genkey_0":"/first"}
  }],
  "filters": [],
  "uri": "https://www.uri-destination.org",
  "order": 0
}]</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following table describes the structure of the response:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The route ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>predicates</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The collection of route predicates. Each item defines the name and the arguments of a given predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>filters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The collection of filters applied to the route.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The destination URI of the route.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>order</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The route order.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="creating-and-deleting-a-particular-route"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-and-deleting-a-particular-route"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-and-deleting-a-particular-route">83.6. Creating and Deleting a Particular Route</a></h3>
<div class="paragraph">
<p>To create a route, make a <code>POST</code> request to <code>/gateway/routes/{id_route_to_create}</code> with a JSON body that specifies the fields of the route (see <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gateway-retrieving-information-about-a-particular-route">Retrieving Information about a Particular Route</a>).</p>
</div>
<div class="paragraph">
<p>To delete a route, make a <code>DELETE</code> request to <code>/gateway/routes/{id_route_to_delete}</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="recap-the-list-of-all-endpoints"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#recap-the-list-of-all-endpoints"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#recap-the-list-of-all-endpoints">83.7. Recap: The List of All endpoints</a></h3>
<div class="paragraph">
<p>The folloiwng table below summarizes the Spring Cloud Gateway actuator endpoints (note that each endpoint has <code>/actuator/gateway</code> as the base-path):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">HTTP Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>globalfilters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the list of global filters applied to the routes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routefilters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the list of <code>GatewayFilter</code> factories applied to a particular route.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>refresh</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clears the routes cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the list of routes defined in the gateway.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routes/{id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays information about a particular route.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routes/{id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a new route to the gateway.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routes/{id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes an existing route from the gateway.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="troubleshooting"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#troubleshooting"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#troubleshooting">84. Troubleshooting</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers common problems that may arise when you use Spring Cloud Gateway.</p>
</div>
<div class="sect2">
<h3 id="log-levels"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#log-levels"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#log-levels">84.1. Log Levels</a></h3>
<div class="paragraph">
<p>The following loggers may contain valuable troubleshooting information at the <code>DEBUG</code> and <code>TRACE</code> levels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.springframework.cloud.gateway</code></p>
</li>
<li>
<p><code>org.springframework.http.server.reactive</code></p>
</li>
<li>
<p><code>org.springframework.web.reactive</code></p>
</li>
<li>
<p><code>org.springframework.boot.autoconfigure.web</code></p>
</li>
<li>
<p><code>reactor.netty</code></p>
</li>
<li>
<p><code>redisratelimiter</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="wiretap"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#wiretap"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#wiretap">84.2. Wiretap</a></h3>
<div class="paragraph">
<p>The Reactor Netty <code>HttpClient</code> and <code>HttpServer</code> can have wiretap enabled.
When combined with setting the <code>reactor.netty</code> log level to <code>DEBUG</code> or <code>TRACE</code>, it enables the logging of information, such as headers and bodies sent and received across the wire.
To enable wiretap, set <code>spring.cloud.gateway.httpserver.wiretap=true</code> or <code>spring.cloud.gateway.httpclient.wiretap=true</code> for the <code>HttpServer</code> and <code>HttpClient</code>, respectively.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="developer-guide"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#developer-guide"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#developer-guide">85. Developer Guide</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>These are basic guides to writing some custom components of the gateway.</p>
</div>
<div class="sect2">
<h3 id="writing-custom-route-predicate-factories"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#writing-custom-route-predicate-factories"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#writing-custom-route-predicate-factories">85.1. Writing Custom Route Predicate Factories</a></h3>
<div class="paragraph">
<p>In order to write a Route Predicate you will need to implement <code>RoutePredicateFactory</code>. There is an abstract class called <code>AbstractRoutePredicateFactory</code> which you can extend.</p>
</div>
<div class="listingblock">
<div class="title">MyRoutePredicateFactory.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRoutePredicateFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractRoutePredicateFactory</span>&lt;<span class="hljs-title">HeaderRoutePredicateFactory</span>.<span class="hljs-title">Config</span>&gt; </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyRoutePredicateFactory</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>(Config.class);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Predicate&lt;ServerWebExchange&gt; <span class="hljs-title">apply</span><span class="hljs-params">(Config config)</span> </span>{
        <span class="hljs-comment">// grab configuration from Config object</span>
        <span class="hljs-keyword">return</span> exchange -&gt; {
            <span class="hljs-comment">//grab the request</span>
            ServerHttpRequest request = exchange.getRequest();
            <span class="hljs-comment">//take information from the request to see if it</span>
            <span class="hljs-comment">//matches configuration.</span>
            <span class="hljs-keyword">return</span> matches(config, request);
        };
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{
        <span class="hljs-comment">//Put the configuration properties for your filter here</span>
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="writing-custom-gatewayfilter-factories"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#writing-custom-gatewayfilter-factories"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#writing-custom-gatewayfilter-factories">85.2. Writing Custom GatewayFilter Factories</a></h3>
<div class="paragraph">
<p>To write a <code>GatewayFilter</code>, you must implement <code>GatewayFilterFactory</code>.
You can extend an abstract class called <code>AbstractGatewayFilterFactory</code>.
The following examples show how to do so:</p>
</div>
<div class="exampleblock">
<div class="title">Example 80. PreGatewayFilterFactory.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PreGatewayFilterFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGatewayFilterFactory</span>&lt;<span class="hljs-title">PreGatewayFilterFactory</span>.<span class="hljs-title">Config</span>&gt; </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PreGatewayFilterFactory</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>(Config.class);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> GatewayFilter <span class="hljs-title">apply</span><span class="hljs-params">(Config config)</span> </span>{
        <span class="hljs-comment">// grab configuration from Config object</span>
        <span class="hljs-keyword">return</span> (exchange, chain) -&gt; {
            <span class="hljs-comment">//If you want to build a "pre" filter you need to manipulate the</span>
            <span class="hljs-comment">//request before calling chain.filter</span>
            ServerHttpRequest.Builder builder = exchange.getRequest().mutate();
            <span class="hljs-comment">//use builder to manipulate the request</span>
            <span class="hljs-keyword">return</span> chain.filter(exchange.mutate().request(builder.build()).build());
        };
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{
        <span class="hljs-comment">//Put the configuration properties for your filter here</span>
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">PostGatewayFilterFactory.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostGatewayFilterFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractGatewayFilterFactory</span>&lt;<span class="hljs-title">PostGatewayFilterFactory</span>.<span class="hljs-title">Config</span>&gt; </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PostGatewayFilterFactory</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>(Config.class);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> GatewayFilter <span class="hljs-title">apply</span><span class="hljs-params">(Config config)</span> </span>{
        <span class="hljs-comment">// grab configuration from Config object</span>
        <span class="hljs-keyword">return</span> (exchange, chain) -&gt; {
            <span class="hljs-keyword">return</span> chain.filter(exchange).then(Mono.fromRunnable(() -&gt; {
                ServerHttpResponse response = exchange.getResponse();
                <span class="hljs-comment">//Manipulate the response in some way</span>
            }));
        };
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{
        <span class="hljs-comment">//Put the configuration properties for your filter here</span>
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="naming-custom-filters-and-references-in-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#naming-custom-filters-and-references-in-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#naming-custom-filters-and-references-in-configuration">85.2.1. Naming Custom Filters And References In Configuration</a></h4>
<div class="paragraph">
<p>Custom filters class names should end in <code>GatewayFilterFactory</code>.</p>
</div>
<div class="paragraph">
<p>For example, to reference a filter named <code>Something</code> in configuration files, the filter
must be in a class named <code>SomethingGatewayFilterFactory</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It is possible to create a gateway filter named without the
<code>GatewayFilterFactory</code> suffix, such as <code>class AnotherThing</code>. This filter could be
referenced as <code>AnotherThing</code> in configuration files. This is <strong>not</strong> a supported naming
convention and this syntax may be removed in future releases. Please update the filter
name to be compliant.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="writing-custom-global-filters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#writing-custom-global-filters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#writing-custom-global-filters">85.3. Writing Custom Global Filters</a></h3>
<div class="paragraph">
<p>To write a custom global filter, you must implement <code>GlobalFilter</code> interface.
This applies the filter to all requests.</p>
</div>
<div class="paragraph">
<p>The following examples show how to set up global pre and post filters, respectively:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> GlobalFilter <span class="hljs-title">customGlobalFilter</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> (exchange, chain) -&gt; exchange.getPrincipal()
        .map(Principal::getName)
        .defaultIfEmpty(<span class="hljs-string">"Default User"</span>)
        .map(userName -&gt; {
          <span class="hljs-comment">//adds header to proxied request</span>
          exchange.getRequest().mutate().header(<span class="hljs-string">"CUSTOM-REQUEST-HEADER"</span>, userName).build();
          <span class="hljs-keyword">return</span> exchange;
        })
        .flatMap(chain::filter);
}

<span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> GlobalFilter <span class="hljs-title">customGlobalPostFilter</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> (exchange, chain) -&gt; chain.filter(exchange)
        .then(Mono.just(exchange))
        .map(serverWebExchange -&gt; {
          <span class="hljs-comment">//adds header to response</span>
          serverWebExchange.getResponse().getHeaders().set(<span class="hljs-string">"CUSTOM-RESPONSE-HEADER"</span>,
              HttpStatus.OK.equals(serverWebExchange.getResponse().getStatusCode()) ? <span class="hljs-string">"It worked"</span>: <span class="hljs-string">"It did not work"</span>);
          <span class="hljs-keyword">return</span> serverWebExchange;
        })
        .then();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-a-simple-gateway-by-using-spring-mvc-or-webflux"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#building-a-simple-gateway-by-using-spring-mvc-or-webflux"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#building-a-simple-gateway-by-using-spring-mvc-or-webflux">86. Building a Simple Gateway by Using Spring MVC or Webflux</a></h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The following describes an alternative style gateway. None of the prior documentation applies to what follows.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Spring Cloud Gateway provides a utility object called <code>ProxyExchange</code>.
You can use it inside a regular Spring web handler as a method parameter.
It supports basic downstream HTTP exchanges through methods that mirror the HTTP verbs.
With MVC, it also supports forwarding to a local handler through the <code>forward()</code> method.
To use the <code>ProxyExchange</code>, include the right module in your classpath (either <code>spring-cloud-gateway-mvc</code> or <code>spring-cloud-gateway-webflux</code>).</p>
</div>
<div class="paragraph">
<p>The following MVC example proxies a request to <code>/test</code> downstream to a remote server:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GatewaySampleApplication</span> </span>{

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${remote.home}"</span>)
    <span class="hljs-keyword">private</span> URI home;

    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/test"</span>)
    <span class="hljs-keyword">public</span> ResponseEntity&lt;?&gt; proxy(ProxyExchange&lt;<span class="hljs-keyword">byte</span>[]&gt; proxy) <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> proxy.uri(home.toString() + <span class="hljs-string">"/image/png"</span>).get();
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example does the same thing with Webflux:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GatewaySampleApplication</span> </span>{

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${remote.home}"</span>)
    <span class="hljs-keyword">private</span> URI home;

    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/test"</span>)
    <span class="hljs-keyword">public</span> Mono&lt;ResponseEntity&lt;?&gt;&gt; proxy(ProxyExchange&lt;<span class="hljs-keyword">byte</span>[]&gt; proxy) <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> proxy.uri(home.toString() + <span class="hljs-string">"/image/png"</span>).get();
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Convenience methods on the <code>ProxyExchange</code> enable the handler method to discover and enhance the URI path of the incoming request.
For example, you might want to extract the trailing elements of a path to pass them downstream:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/proxy/path/**"</span>)
<span class="hljs-keyword">public</span> ResponseEntity&lt;?&gt; proxyPath(ProxyExchange&lt;<span class="hljs-keyword">byte</span>[]&gt; proxy) <span class="hljs-keyword">throws</span> Exception {
  String path = proxy.path(<span class="hljs-string">"/proxy/path/"</span>);
  <span class="hljs-keyword">return</span> proxy.uri(home.toString() + <span class="hljs-string">"/foos/"</span> + path).get();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>All the features of Spring MVC and Webflux are available to gateway handler methods.
As a result, you can inject request headers and query parameters, for instance, and you can constrain the incoming requests with declarations in the mapping annotation.
See the documentation for <code>@RequestMapping</code> in Spring MVC for more details of those features.</p>
</div>
<div class="paragraph">
<p>You can add headers to the downstream response by using the <code>header()</code> methods on <code>ProxyExchange</code>.</p>
</div>
<div class="paragraph">
<p>You can also manipulate response headers (and anything else you like in the response) by adding a mapper to the <code>get()</code> method (and other methods).
The mapper is a <code>Function</code> that takes the incoming <code>ResponseEntity</code> and converts it to an outgoing one.</p>
</div>
<div class="paragraph">
<p>First-class support is provided for “sensitive” headers (by default, <code>cookie</code> and <code>authorization</code>), which are not passed downstream, and for “proxy” (<code>x-forwarded-*</code>) headers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-properties-5"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-5"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-5">87. Configuration properties</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To see the list of all Spring Cloud Gateway related configuration properties, see <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/appendix.html">the appendix</a>.</p>
</div>
</div>
</div>
<h1 id="spring-cloud-gcp-reference" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-reference"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-reference">Spring Cloud GCP</a></h1>
<div class="openblock partintro">
<div class="content">
João André Martins; Jisha Abubaker; Ray Tsang; Mike Eltsufin; Artem Bilan; Andreas Berger; Balint Pato; Chengyuan Zhao; Dmitry Solomakha; Elena Felder; Daniel Zou, Eddú Meléndez
</div>
</div>
<div class="sect1">
<h2 id="introduction-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#introduction-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#introduction-3">88. Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Cloud GCP project makes the Spring Framework a first-class citizen of Google Cloud Platform (GCP).</p>
</div>
<div class="paragraph">
<p>Spring Cloud GCP lets you leverage the power and simplicity of the Spring Framework to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Publish and subscribe to Google Cloud Pub/Sub topics</p>
</li>
<li>
<p>Configure Spring JDBC with a few properties to use Google Cloud SQL</p>
</li>
<li>
<p>Map objects, relationships, and collections with Spring Data Cloud Spanner, Spring Data Cloud Datastore and Spring Data Reactive Repositories for Cloud Firestore</p>
</li>
<li>
<p>Write and read from Spring Resources backed up by Google Cloud Storage</p>
</li>
<li>
<p>Exchange messages with Spring Integration using Google Cloud Pub/Sub on the background</p>
</li>
<li>
<p>Trace the execution of your app with Spring Cloud Sleuth and Google Stackdriver Trace</p>
</li>
<li>
<p>Configure your app with Spring Cloud Config, backed up by the Google Runtime Configuration API</p>
</li>
<li>
<p>Consume and produce Google Cloud Storage data via Spring Integration GCS Channel Adapters</p>
</li>
<li>
<p>Use Spring Security via Google Cloud IAP</p>
</li>
<li>
<p>Analyze your images for text, objects, and other content with Google Cloud Vision</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-5"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-5"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-5">89. Getting Started</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes how to get up to speed with Spring Cloud GCP libraries.</p>
</div>
<div class="sect2">
<h3 id="setting-up-dependencies"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#setting-up-dependencies"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#setting-up-dependencies">89.1. Setting up Dependencies</a></h3>
<div class="paragraph">
<p>All Spring Cloud GCP artifacts are made available through Maven Central.
The following resources are provided to help you setup the libraries for your project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven Bill of Materials for dependency management</p>
</li>
<li>
<p>Starter Dependencies for depending on Spring Cloud GCP modules</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may also consult our <a href="https://github.com/spring-cloud/spring-cloud-gcp">Github project</a> to examine the code or build directly from source.</p>
</div>
<div class="sect3">
<h4 id="bill-of-materials"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bill-of-materials"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bill-of-materials">89.1.1. Bill of Materials</a></h4>
<div class="paragraph">
<p>The Spring Cloud GCP Bill of Materials (BOM) contains the versions of all the dependencies it uses.</p>
</div>
<div class="paragraph">
<p>If you’re a Maven user, adding the following to your pom.xml file will allow you omit any Spring Cloud GCP dependency version numbers from your configuration.
Instead, the version of the BOM you’re using determines the versions of the used dependencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#README.adoc">sections</a> in the README for selecting an available version and Maven repository.</p>
</div>
<div class="paragraph">
<p>In the following sections, it will be assumed you are using the Spring Cloud GCP BOM and the dependency snippets will not contain versions.</p>
</div>
<div class="paragraph">
<p>Gradle users can achieve the same kind of BOM experience using Spring’s <a href="https://github.com/spring-gradle-plugins/dependency-management-plugin">dependency-management-plugin</a> Gradle plugin.
For simplicity, the Gradle dependency snippets in the remainder of this document will also omit their versions.</p>
</div>
</div>
<div class="sect3">
<h4 id="starter-dependencies"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#starter-dependencies"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#starter-dependencies">89.1.2. Starter Dependencies</a></h4>
<div class="paragraph">
<p>Spring Cloud GCP offers <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-starters">starter dependencies</a> through Maven to easily depend on different modules of the library.
Each starter contains all the dependencies and transitive dependencies needed to begin using their corresponding Spring Cloud GCP module.</p>
</div>
<div class="paragraph">
<p>For example, if you wish to write a Spring application with Cloud Pub/Sub, you would include the <code>spring-cloud-gcp-starter-pubsub</code> dependency in your project.
You do <strong>not</strong> need to include the underlying <code>spring-cloud-gcp-pubsub</code> dependency, because the <code>starter</code> dependency includes it.</p>
</div>
<div class="paragraph">
<p>A summary of these artifacts are provided below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Spring Cloud GCP Starter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Maven Artifact Name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automatically configure authentication and Google project settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/core.html#spring-cloud-gcp-core">org.springframework.cloud:spring-cloud-gcp-starter</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Spanner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides integrations with Google Cloud Spanner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/spanner.html#_spring_data_cloud_spanner">org.springframework.cloud:spring-cloud-gcp-starter-data-spanner</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Datastore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides integrations with Google Cloud Datastore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/datastore.html#_spring_data_cloud_datastore">org.springframework.cloud:spring-cloud-gcp-starter-data-datastore</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Pub/Sub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides integrations with Google Cloud Pub/Sub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/pubsub.html#_google_cloud_pubsub">org.springframework.cloud:spring-cloud-gcp-starter-pubsub</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables Stackdriver Logging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/logging.html#_stackdriver_logging">org.springframework.cloud:spring-cloud-gcp-starter-logging</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL - MySQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud SQL integrations with MySQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/sql.html#_spring_jdbc">org.springframework.cloud:spring-cloud-gcp-starter-sql-mysql</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL - PostgreSQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud SQL integrations with PostgreSQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/sql.html#_spring_jdbc">org.springframework.cloud:spring-cloud-gcp-starter-sql-postgresql</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides integrations with Google Cloud Storage and Spring Resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/storage.html#_spring_resources">org.springframework.cloud:spring-cloud-gcp-starter-storage</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables usage of Google Runtime Configuration API as a Spring Cloud Config server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/config.html#_spring_cloud_config">org.springframework.cloud:spring-cloud-gcp-starter-config</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables instrumentation with Google Stackdriver Tracing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/trace.html#_spring_cloud_sleuth">org.springframework.cloud:spring-cloud-gcp-starter-trace</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides integrations with Google Cloud Vision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/vision.html#_google_cloud_vision">org.springframework.cloud:spring-cloud-gcp-starter-vision</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security - IAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides a security layer over applications deployed to Google Cloud</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/security-iap.html#_cloud_identity_aware_proxy_iap_authentication">org.springframework.cloud:spring-cloud-gcp-starter-security-iap</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="spring-initializr"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-initializr"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-initializr">89.1.3. Spring Initializr</a></h4>
<div class="paragraph">
<p><a href="https://start.spring.io/">Spring Initializr</a> is a tool which generates the scaffolding code for a new Spring Boot project.
It handles the work of generating the Maven or Gradle build file so you do not have to manually add the dependencies yourself.</p>
</div>
<div class="paragraph">
<p>Spring Initializr offers three modules from Spring Cloud GCP that you can use to generate your project.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>GCP Support</strong>: The GCP Support module contains auto-configuration support for every Spring Cloud GCP integration.
Most of the autoconfiguration code is only enabled if the required dependency is added to your project.</p>
</li>
<li>
<p><strong>GCP Messaging</strong>: Google Cloud Pub/Sub integrations work out of the box.</p>
</li>
<li>
<p><strong>GCP Storage</strong>: Google Cloud Storage integrations work out of the box.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="learning-spring-cloud-gcp"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#learning-spring-cloud-gcp"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#learning-spring-cloud-gcp">89.2. Learning Spring Cloud GCP</a></h3>
<div class="paragraph">
<p>There are a variety of resources to help you learn how to use Spring Cloud GCP libraries.</p>
</div>
<div class="sect3">
<h4 id="sample-applications"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-applications"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-applications">89.2.1. Sample Applications</a></h4>
<div class="paragraph">
<p>The easiest way to learn how to use Spring Cloud GCP is to consult the <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples">sample applications on Github</a>.
Spring Cloud GCP provides sample applications which demonstrate how to use every integration in the library.
The table below highlights several samples of the most commonly used integrations in Spring Cloud GCP.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">GCP Integration</th>
<th class="tableblock halign-left valign-top">Sample Application</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Pub/Sub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-pubsub-sample">spring-cloud-gcp-pubsub-sample</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Spanner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-data-spanner-sample">spring-cloud-gcp-data-spanner-sample</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datastore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-data-datastore-sample">spring-cloud-gcp-data-datastore-sample</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud SQL (w/ MySQL)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-sql-mysql-sample">spring-cloud-gcp-sql-mysql-sample</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-storage-resource-sample">spring-cloud-gcp-storage-resource-sample</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stackdriver Logging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-logging-sample">spring-cloud-gcp-logging-sample</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-trace-sample">spring-cloud-gcp-trace-sample</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Vision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-vision-api-sample">spring-cloud-gcp-vision-api-sample</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Security - IAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-security-iap-sample">spring-cloud-gcp-security-iap-sample</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each sample application demonstrates how to use Spring Cloud GCP libraries in context and how to setup the dependencies for the project.
The applications are fully functional and can be deployed to Google Cloud Platform as well.
If you are interested, you may consult guides for <a href="https://codelabs.developers.google.com/codelabs/cloud-app-engine-springboot/index.html">deploying an application to AppEngine</a> and <a href="https://codelabs.developers.google.com/codelabs/cloud-springboot-kubernetes/index.html">to Google Kubernetes Engine</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="codelabs"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#codelabs"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#codelabs">89.2.2. Codelabs</a></h4>
<div class="paragraph">
<p>For a more hands-on approach, there are several guides and codelabs to help you get up to speed.
These guides provide step-by-step instructions for building an application using Spring Cloud GCP.</p>
</div>
<div class="paragraph">
<p>Some examples include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://codelabs.developers.google.com/codelabs/cloud-app-engine-springboot/index.html">Deploy a Spring Boot app to App Engine</a></p>
</li>
<li>
<p><a href="https://codelabs.developers.google.com/codelabs/cloud-spring-cloud-gcp-kotlin/index.html">Build a Kotlin Spring Boot app with Cloud SQL and Cloud Pub/Sub</a></p>
</li>
<li>
<p><a href="https://codelabs.developers.google.com/codelabs/cloud-spring-datastore/index.html">Build a Spring Boot application with Datastore</a></p>
</li>
<li>
<p><a href="https://codelabs.developers.google.com/codelabs/cloud-spring-cloud-gcp-pubsub-integration/index.html">Messaging with Spring Integration and Cloud Pub/Sub</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The full collection of Spring codelabs can be found on the <a href="https://codelabs.developers.google.com/spring">Google Developer Codelabs page</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-gcp-core"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">90. Spring Cloud GCP Core</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each Spring Cloud GCP module uses <code>GcpProjectIdProvider</code> and <code>CredentialsProvider</code> to get the GCP project ID and access credentials.</p>
</div>
<div class="paragraph">
<p>Spring Cloud GCP provides a Spring Boot starter to auto-configure the core components.</p>
</div>
<div class="paragraph">
<p>Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter"</span>)
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="configuration-4"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-4"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-4">90.1. Configuration</a></h3>
<div class="paragraph">
<p>The following options may be configured with Spring Cloud core.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.core.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disables GCP core auto configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="project-id"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#project-id"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#project-id">90.2. Project ID</a></h3>
<div class="paragraph">
<p><code>GcpProjectIdProvider</code> is a functional interface that returns a GCP project ID string.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">GcpProjectIdProvider</span> </span>{
    <span class="hljs-function">String <span class="hljs-title">getProjectId</span><span class="hljs-params">()</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spring Cloud GCP starter auto-configures a <code>GcpProjectIdProvider</code>.
If a <code>spring.cloud.gcp.project-id</code> property is specified, the provided <code>GcpProjectIdProvider</code> returns that property value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">spring.cloud.gcp.project-id=my-gcp-project-id</code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise, the project ID is discovered based on an
<a href="https://googlecloudplatform.github.io/google-cloud-java/google-cloud-clients/apidocs/com/google/cloud/ServiceOptions.html#getDefaultProjectId--">ordered list of rules</a>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The project ID specified by the <code>GOOGLE_CLOUD_PROJECT</code> environment variable</p>
</li>
<li>
<p>The Google App Engine project ID</p>
</li>
<li>
<p>The project ID specified in the JSON credentials file pointed by the <code>GOOGLE_APPLICATION_CREDENTIALS</code> environment variable</p>
</li>
<li>
<p>The Google Cloud SDK project ID</p>
</li>
<li>
<p>The Google Compute Engine project ID, from the Google Compute Engine Metadata Server</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="credentials"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#credentials"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#credentials">90.3. Credentials</a></h3>
<div class="paragraph">
<p><code>CredentialsProvider</code> is a functional interface that returns the credentials to authenticate and authorize calls to Google Cloud Client Libraries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CredentialsProvider</span> </span>{
  <span class="hljs-function">Credentials <span class="hljs-title">getCredentials</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spring Cloud GCP starter auto-configures a <code>CredentialsProvider</code>.
It uses the <code>spring.cloud.gcp.credentials.location</code> property to locate the OAuth2 private key of a Google service account.
Keep in mind this property is a Spring Resource, so the credentials file can be obtained from a number of <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/html/resources.html#resources-implementations">different locations</a> such as the file system, classpath, URL, etc.
The next example specifies the credentials location property in the file system.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle">spring.cloud.gcp.credentials.location=<span class="hljs-keyword">file</span>:<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/key.json</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can set the credentials by directly specifying the <code>spring.cloud.gcp.credentials.encoded-key</code> property.
The value should be the base64-encoded account private key in JSON format.</p>
</div>
<div class="paragraph">
<p>If that credentials aren’t specified through properties, the starter tries to discover credentials from a <a href="https://github.com/GoogleCloudPlatform/google-cloud-java#authentication">number of places</a>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Credentials file pointed to by the <code>GOOGLE_APPLICATION_CREDENTIALS</code> environment variable</p>
</li>
<li>
<p>Credentials provided by the Google Cloud SDK <code>gcloud auth application-default login</code> command</p>
</li>
<li>
<p>Google App Engine built-in credentials</p>
</li>
<li>
<p>Google Cloud Shell built-in credentials</p>
</li>
<li>
<p>Google Compute Engine built-in credentials</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If your app is running on Google App Engine or Google Compute Engine, in most cases, you should omit the <code>spring.cloud.gcp.credentials.location</code> property and, instead, let the Spring Cloud GCP Starter get the correct credentials for those environments.
On App Engine Standard, the <a href="https://cloud.google.com/appengine/docs/standard/java/appidentity/">App Identity service account credentials</a> are used, on App Engine Flexible, the <a href="https://cloud.google.com/appengine/docs/flexible/java/service-account">Flexible service account credential</a> are used and on Google Compute Engine, the <a href="https://cloud.google.com/compute/docs/access/create-enable-service-accounts-for-instances#using_the_compute_engine_default_service_account">Compute Engine Default Service Account</a> is used.</p>
</div>
<div class="sect3">
<h4 id="scopes"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#scopes"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#scopes">90.3.1. Scopes</a></h4>
<div class="paragraph">
<p>By default, the credentials provided by the Spring Cloud GCP Starter contain scopes for every service supported by Spring Cloud GCP.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spanner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.googleapis.com/auth/spanner.admin" class="bare">www.googleapis.com/auth/spanner.admin</a>, <a href="https://www.googleapis.com/auth/spanner.data" class="bare">www.googleapis.com/auth/spanner.data</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datastore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.googleapis.com/auth/datastore" class="bare">www.googleapis.com/auth/datastore</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pub/Sub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.googleapis.com/auth/pubsub" class="bare">www.googleapis.com/auth/pubsub</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage (Read Only)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.googleapis.com/auth/devstorage.read_only" class="bare">www.googleapis.com/auth/devstorage.read_only</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage (Read/Write)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.googleapis.com/auth/devstorage.read_write" class="bare">www.googleapis.com/auth/devstorage.read_write</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Runtime Config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.googleapis.com/auth/cloudruntimeconfig" class="bare">www.googleapis.com/auth/cloudruntimeconfig</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trace (Append)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.googleapis.com/auth/trace.append" class="bare">www.googleapis.com/auth/trace.append</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Platform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.googleapis.com/auth/cloud-platform" class="bare">www.googleapis.com/auth/cloud-platform</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.googleapis.com/auth/cloud-vision" class="bare">www.googleapis.com/auth/cloud-vision</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The Spring Cloud GCP starter allows you to configure a custom scope list for the provided credentials.
To do that, specify a comma-delimited list of <a href="https://developers.google.com/identity/protocols/googlescopes">Google OAuth2 scopes</a> in the <code>spring.cloud.gcp.credentials.scopes</code> property.</p>
</div>
<div class="paragraph">
<p><code>spring.cloud.gcp.credentials.scopes</code> is a comma-delimited list of <a href="https://developers.google.com/identity/protocols/googlescopes">Google OAuth2 scopes</a> for Google Cloud Platform services that the credentials returned by the provided <code>CredentialsProvider</code> support.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs groovy">spring.cloud.gcp.credentials.scopes=<span class="hljs-string">https:</span><span class="hljs-comment">//www.googleapis.com/auth/pubsub,https://www.googleapis.com/auth/sqlservice.admin</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use <code>DEFAULT_SCOPES</code> placeholder as a scope to represent the starters default scopes, and append the additional scopes you need to add.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs groovy">spring.cloud.gcp.credentials.scopes=DEFAULT_SCOPES,<span class="hljs-string">https:</span><span class="hljs-comment">//www.googleapis.com/auth/cloud-vision</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="environment"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#environment"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#environment">90.4. Environment</a></h3>
<div class="paragraph">
<p><code>GcpEnvironmentProvider</code> is a functional interface, auto-configured by the Spring Cloud GCP starter, that returns a <code>GcpEnvironment</code> enum.
The provider can help determine programmatically in which GCP environment (App Engine Flexible, App Engine Standard, Kubernetes Engine or Compute Engine) the application is deployed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">GcpEnvironmentProvider</span> </span>{
    <span class="hljs-function">GcpEnvironment <span class="hljs-title">getCurrentEnvironment</span><span class="hljs-params">()</span></span>;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="customizing-bean-scope"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-bean-scope"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-bean-scope">90.5. Customizing bean scope</a></h3>
<div class="paragraph">
<p>Spring Cloud GCP starters autoconfigure all necessary beans in the default singleton scope.
If you need a particular bean or set of beans to be recreated dynamically (for example, to rotate credentials), there are two options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Annotate custom beans of the necessary types with <code>@RefreshScope</code>.
This makes the most sense if your application is already redefining those beans.</p>
</li>
<li>
<p>Override the scope for autoconfigured beans by listing them in the Spring Cloud property <code>spring.cloud.refresh.extra-refreshable</code>.</p>
<div class="paragraph">
<p>For example, the beans involved in Cloud Pub/Sub subscription could be marked as refreshable as follows:</p>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.cloud.refresh.extra-refreshable=org.springframework.cloud.gcp.pubsub.support.SubscriberFactory,\
  org.springframework.cloud.gcp.pubsub.core.subscriber.PubSubSubscriberTemplate</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>SmartLifecycle</code> beans, such as Spring Integration adapters, do not currently support <code>@RefreshScope</code>.
If your application refreshes any beans used by such <code>SmartLifecycle</code> objects, it may also have to restart the beans manually when <code>RefreshScopeRefreshedEvent</code> is detected, such as in the Cloud Pub/Sub example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> PubSubInboundChannelAdapter pubSubAdapter;

<span class="hljs-meta">@EventListener</span>(RefreshScopeRefreshedEvent.class)
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onRefreshScope</span><span class="hljs-params">(RefreshScopeRefreshedEvent event)</span> </span>{
  <span class="hljs-keyword">this</span>.pubSubAdapter.stop();
  <span class="hljs-keyword">this</span>.pubSubAdapter.start();
}</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="spring-initializr-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-initializr-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-initializr-2">90.6. Spring Initializr</a></h3>
<div class="paragraph">
<p>This starter is available from <a href="https://start.spring.io/">Spring Initializr</a> through the <code>GCP Support</code> entry.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cloud-storage"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-storage"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-storage">91. Cloud Storage</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://cloud.google.com/storage/docs">Google Cloud Storage</a> allows storing any types of files in single or multiple regions.
A Spring Boot starter is provided to auto-configure the various Storage components.</p>
</div>
<div class="paragraph">
<p>Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-storage<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-storage"</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This starter is also available from <a href="https://start.spring.io/">Spring Initializr</a> through the <code>GCP Storage</code> entry.</p>
</div>
<div class="sect2">
<h3 id="using-cloud-storage"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-cloud-storage"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-cloud-storage">91.1. Using Cloud Storage</a></h3>
<div class="paragraph">
<p>The starter automatically configures and registers a <code>Storage</code> bean in the Spring application context.
The <code>Storage</code> bean (<a href="https://googleapis.dev/java/google-cloud-storage/latest/com/google/cloud/storage/Storage.html">Javadoc</a>) can be used to list/create/update/delete buckets (a group of objects with similar permissions and resiliency requirements) and objects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> Storage storage;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createFile</span><span class="hljs-params">()</span> </span>{
    Bucket bucket = storage.create(BucketInfo.of(<span class="hljs-string">"my-app-storage-bucket"</span>));

    storage.create(
        BlobInfo.newBuilder(<span class="hljs-string">"my-app-storage-bucket"</span>, <span class="hljs-string">"subdirectory/my-file"</span>).build(),
            <span class="hljs-string">"file contents"</span>.getBytes()
    );
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cloud-storage-objects-as-spring-resources"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-storage-objects-as-spring-resources"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-storage-objects-as-spring-resources">91.2. Cloud Storage Objects As Spring Resources</a></h3>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/html/resources.html">Spring Resources</a> are an abstraction for a number of low-level resources, such as file system files, classpath files, servlet context-relative files, etc.
Spring Cloud GCP adds a new resource type: a Google Cloud Storage (GCS) object.</p>
</div>
<div class="paragraph">
<p>The Spring Resource Abstraction for Google Cloud Storage allows GCS objects to be accessed by their GCS URL using the <code>@Value</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Value</span>(<span class="hljs-string">"gs://[YOUR_GCS_BUCKET]/[GCS_FILE_NAME]"</span>)
<span class="hljs-keyword">private</span> Resource gcsResource;</code></pre>
</div>
</div>
<div class="paragraph">
<p>…​or the Spring application context</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">SpringApplication.run(...).getResource(<span class="hljs-string">"gs://[YOUR_GCS_BUCKET]/[GCS_FILE_NAME]"</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a <code>Resource</code> object that can be used to read the object, among <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/html/resources.html#resources-resource">other possible operations</a>.</p>
</div>
<div class="paragraph">
<p>It is also possible to write to a <code>Resource</code>, although a <code>WritableResource</code> is required.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Value</span>(<span class="hljs-string">"gs://[YOUR_GCS_BUCKET]/[GCS_FILE_NAME]"</span>)
<span class="hljs-keyword">private</span> Resource gcsResource;
...
<span class="hljs-keyword">try</span> (OutputStream os = ((WritableResource) gcsResource).getOutputStream()) {
  os.write(<span class="hljs-string">"foo"</span>.getBytes());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To work with the <code>Resource</code> as a Google Cloud Storage resource, cast it to <code>GoogleStorageResource</code>.</p>
</div>
<div class="paragraph">
<p>If the resource path refers to an object on Google Cloud Storage (as opposed to a bucket), then the <code>getBlob</code> method can be called to obtain a <a href="https://github.com/GoogleCloudPlatform/google-cloud-java/blob/master/google-cloud-storage/src/main/java/com/google/cloud/storage/Blob.java"><code>Blob</code></a>.
This type represents a GCS file, which has associated <a href="https://cloud.google.com/storage/docs/gsutil/addlhelp/WorkingWithObjectMetadata">metadata</a>, such as content-type, that can be set.
The <code>createSignedUrl</code> method can also be used to obtain <a href="https://cloud.google.com/storage/docs/access-control/signed-urls">signed URLs</a> for GCS objects.
However, creating signed URLs requires that the resource was created using service account credentials.</p>
</div>
<div class="paragraph">
<p>The Spring Boot Starter for Google Cloud Storage auto-configures the <code>Storage</code> bean required by the <code>spring-cloud-gcp-storage</code> module, based on the <code>CredentialsProvider</code> provided by the Spring Boot GCP starter.</p>
</div>
<div class="sect3">
<h4 id="setting-the-content-type"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#setting-the-content-type"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#setting-the-content-type">91.2.1. Setting the Content Type</a></h4>
<div class="paragraph">
<p>You can set the content-type of Google Cloud Storage files from their corresponding <code>Resource</code> objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">((GoogleStorageResource)gcsResource).getBlob().toBuilder().setContentType(<span class="hljs-string">"text/html"</span>).build().update();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-5"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-5"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-5">91.3. Configuration</a></h3>
<div class="paragraph">
<p>The Spring Boot Starter for Google Cloud Storage provides the following configuration options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.storage.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the GCP storage APIs.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.storage.auto-create-files</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates files and buckets on Google Cloud Storage when writes are made to non-existent files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.storage.credentials.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth2 credentials for authenticating with the Google Cloud Storage API, if different from the ones in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.storage.credentials.encoded-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base64-encoded contents of OAuth2 account private key for authenticating with the Google Cloud Storage API, if different from the ones in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.storage.credentials.scopes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developers.google.com/identity/protocols/googlescopes">OAuth2 scope</a> for Spring Cloud GCP Storage credentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.googleapis.com/auth/devstorage.read_write" class="bare">www.googleapis.com/auth/devstorage.read_write</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="sample"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample">91.4. Sample</a></h3>
<div class="paragraph">
<p>A <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-storage-resource-sample">sample application</a> and a <a href="https://codelabs.developers.google.com/codelabs/spring-cloud-gcp-gcs/index.html">codelab</a> are available.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cloud-sql"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-sql"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-sql">92. Cloud SQL</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud GCP adds integrations with
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/html/jdbc.html">Spring JDBC</a> so you can run your MySQL or PostgreSQL databases in <a href="https://cloud.google.com/sql">Google Cloud SQL</a> using Spring JDBC, or other libraries that depend on it like Spring Data JPA.</p>
</div>
<div class="paragraph">
<p>The Cloud SQL support is provided by Spring Cloud GCP in the form of two Spring Boot starters, one for MySQL and another one for PostgreSQL.
The role of the starters is to read configuration from properties and assume default settings so that user experience connecting to MySQL and PostgreSQL is as simple as possible.</p>
</div>
<div class="paragraph">
<p>Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-sql-mysql<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-sql-postgresql<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-sql-mysql"</span>)
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-sql-postgresql"</span>)
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="prerequisites"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#prerequisites"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#prerequisites">92.1. Prerequisites</a></h3>
<div class="paragraph">
<p>In order to use the Spring Boot Starters for Google Cloud SQL, the Google Cloud SQL API must be enabled in your GCP project.</p>
</div>
<div class="paragraph">
<p>To do that, go to the <a href="https://console.cloud.google.com/apis/library">API library page</a> of the Google Cloud Console, search for "Cloud SQL API", click the first result and enable the API.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There are several similar "Cloud SQL" results.
You must access the "Google Cloud SQL API" one and enable the API from there.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-starter-for-google-cloud-sql"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-starter-for-google-cloud-sql"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-starter-for-google-cloud-sql">92.2. Spring Boot Starter for Google Cloud SQL</a></h3>
<div class="paragraph">
<p>The Spring Boot Starters for Google Cloud SQL provide an auto-configured <a href="https://docs.oracle.com/javase/7/docs/api/javax/sql/DataSource.html"><code>DataSource</code></a> object.
Coupled with Spring JDBC, it provides a
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/html/jdbc.html#jdbc-JdbcTemplate"><code>JdbcTemplate</code></a> object bean that allows for operations such as querying and modifying a database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; listUsers() {
    <span class="hljs-keyword">return</span> jdbcTemplate.queryForList(<span class="hljs-string">"SELECT * FROM user;"</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can rely on
<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-sql.html#boot-features-connect-to-production-database">Spring Boot data source auto-configuration</a> to configure a <code>DataSource</code> bean.
In other words, properties like the SQL username, <code>spring.datasource.username</code>, and password, <code>spring.datasource.password</code> can be used.
There is also some configuration specific to Google Cloud SQL:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.sql.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disables Cloud SQL auto configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.sql.database-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the database to connect to.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.sql.instance-connection-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string containing a Google Cloud SQL instance’s project ID, region and name, each separated by a colon.
For example, <code>my-project-id:my-region:my-instance-name</code>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.sql.ip-types</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to specify a comma delimited list of preferred IP types for connecting to a Cloud SQL instance. Left unconfigured Cloud SQL Socket Factory will default it to <code>PUBLIC,PRIVATE</code>. See <a href="https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory#specifying-ip-types">Cloud SQL Socket Factory - Specifying IP Types</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PUBLIC,PRIVATE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.sql.credentials.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File system path to the Google OAuth2 credentials private key file.
Used to authenticate and authorize new connections to a Google Cloud SQL instance.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default credentials provided by the Spring GCP Boot starter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.sql.credentials.encoded-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base64-encoded contents of OAuth2 account private key in JSON format.
Used to authenticate and authorize new connections to a Google Cloud SQL instance.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default credentials provided by the Spring GCP Boot starter</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you provide your own <code>spring.datasource.url</code>, it will be ignored, unless you disable Cloud SQL auto configuration with <code>spring.cloud.gcp.sql.enabled=false</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="datasource-creation-flow"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#datasource-creation-flow"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#datasource-creation-flow">92.2.1. <code>DataSource</code> creation flow</a></h4>
<div class="paragraph">
<p>Based on the previous properties, the Spring Boot starter for Google Cloud SQL creates a <code>CloudSqlJdbcInfoProvider</code> object which is used to obtain an instance’s JDBC URL and driver class name.
If you provide your own <code>CloudSqlJdbcInfoProvider</code> bean, it is used instead and the properties related to building the JDBC URL or driver class are ignored.</p>
</div>
<div class="paragraph">
<p>The <code>DataSourceProperties</code> object provided by Spring Boot Autoconfigure is mutated in order to use the JDBC URL and driver class names provided by <code>CloudSqlJdbcInfoProvider</code>, unless those values were provided in the properties.
It is in the <code>DataSourceProperties</code> mutation step that the credentials factory is registered in a system property to be <code>SqlCredentialFactory</code>.</p>
</div>
<div class="paragraph">
<p><code>DataSource</code> creation is delegated to
<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-sql.html">Spring Boot</a>.
You can select the type of connection pool (e.g., Tomcat, HikariCP, etc.) by <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-sql.html#boot-features-connect-to-production-database">adding their dependency to the classpath</a>.</p>
</div>
<div class="paragraph">
<p>Using the created <code>DataSource</code> in conjunction with Spring JDBC provides you with a fully configured and operational <code>JdbcTemplate</code> object that you can use to interact with your SQL database.
You can connect to your database with as little as a database and instance names.</p>
</div>
</div>
<div class="sect3">
<h4 id="troubleshooting-tips"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#troubleshooting-tips"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#troubleshooting-tips">92.2.2. Troubleshooting tips</a></h4>
<div class="sect4">
<h5 id="connection-issues"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#connection-issues"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#connection-issues">Connection issues</a></h5>
<div class="paragraph">
<p>If you’re not able to connect to a database and see an endless loop of <code>Connecting to Cloud SQL instance […​] on IP […​]</code>, it’s likely that exceptions are being thrown and logged at a level lower than your logger’s level.
This may be the case with HikariCP, if your logger is set to INFO or higher level.</p>
</div>
<div class="paragraph">
<p>To see what’s going on in the background, you should add a <code>logback.xml</code> file to your application resources folder, that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"org/springframework/boot/logging/logback/base.xml"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.zaxxer.hikari.pool"</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"DEBUG"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="errors-like-c-g-cloud-sql-core-sslsocketfactory-re-throwing-cached-exception-due-to-attempt-to-refresh-instance-information-too-soon-after-error"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#errors-like-c-g-cloud-sql-core-sslsocketfactory-re-throwing-cached-exception-due-to-attempt-to-refresh-instance-information-too-soon-after-error"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#errors-like-c-g-cloud-sql-core-sslsocketfactory-re-throwing-cached-exception-due-to-attempt-to-refresh-instance-information-too-soon-after-error">Errors like <code>c.g.cloud.sql.core.SslSocketFactory : Re-throwing cached exception due to attempt to refresh instance information too soon after error</code></a></h5>
<div class="paragraph">
<p>If you see a lot of errors like this in a loop and can’t connect to your database, this is usually a symptom that something isn’t right with the permissions of your credentials or the Google Cloud SQL API is not enabled.
Verify that the Google Cloud SQL API is enabled in the Cloud Console and that your service account has the <a href="https://cloud.google.com/sql/docs/mysql/project-access-control#roles">necessary IAM roles</a>.</p>
</div>
<div class="paragraph">
<p>To find out what’s causing the issue, you can enable DEBUG logging level as mentioned <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#connection-issues">above</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="postgresql-java-net-socketexception-already-connected-issue"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#postgresql-java-net-socketexception-already-connected-issue"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#postgresql-java-net-socketexception-already-connected-issue">PostgreSQL: <code>java.net.SocketException: already connected</code> issue</a></h5>
<div class="paragraph">
<p>We found this exception to be common if your Maven project’s parent is <code>spring-boot</code> version <code>1.5.x</code>, or in any other circumstance that would cause the version of the <code>org.postgresql:postgresql</code> dependency to be an older one (e.g., <code>9.4.1212.jre7</code>).</p>
</div>
<div class="paragraph">
<p>To fix this, re-declare the dependency in its correct version.
For example, in Maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.postgresql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>postgresql<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>42.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="samples"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#samples"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#samples">92.3. Samples</a></h3>
<div class="paragraph">
<p>Available sample applications and codelabs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-sql-mysql-sample">Spring Cloud GCP MySQL</a></p>
</li>
<li>
<p><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-sql-postgres-sample">Spring Cloud GCP PostgreSQL</a></p>
</li>
<li>
<p><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-data-jpa-sample">Spring Data JPA with Spring Cloud GCP SQL</a></p>
</li>
<li>
<p>Codelab: <a href="https://codelabs.developers.google.com/codelabs/cloud-spring-petclinic-cloudsql/index.html">Spring Pet Clinic using Cloud SQL</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cloud-pubsub"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-pubsub"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-pubsub">93. Cloud Pub/Sub</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud GCP provides an abstraction layer to publish to and subscribe from Google Cloud Pub/Sub topics and to create, list or delete Google Cloud Pub/Sub topics and subscriptions.</p>
</div>
<div class="paragraph">
<p>A Spring Boot starter is provided to auto-configure the various required Pub/Sub components.</p>
</div>
<div class="paragraph">
<p>Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-pubsub<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-pubsub"</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This starter is also available from <a href="https://start.spring.io/">Spring Initializr</a> through the <code>GCP Messaging</code> entry.</p>
</div>
<div class="sect2">
<h3 id="pubsub-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pubsub-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pubsub-configuration">93.1. Configuration</a></h3>
<div class="paragraph">
<p>The Spring Boot starter for Google Cloud Pub/Sub provides the following configuration options.</p>
</div>
<div class="sect3">
<h4 id="spring-cloud-gcp-pubsub-api-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-pubsub-api-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-pubsub-api-configuration">93.1.1. Spring Cloud GCP Pub/Sub API Configuration</a></h4>
<div class="paragraph">
<p>This section describes options for enabling the integration, specifying the GCP project and credentials, and setting whether the APIs should connect to an emulator for local testing.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disables Pub/Sub auto-configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.project-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP project ID where the Google Cloud Pub/Sub API is hosted, if different from the one in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.credentials.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth2 credentials for authenticating with the
Google Cloud Pub/Sub API, if different from the ones in the
<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.emulator-host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host and port of the local running emulator.
If provided, this will setup the client to connect against a running <a href="https://cloud.google.com/pubsub/docs/emulator">Google Cloud Pub/Sub Emulator</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.credentials.encoded-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base64-encoded contents of OAuth2 account private key for authenticating with the
Google Cloud Pub/Sub API, if different from the ones in the
<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.credentials.scopes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developers.google.com/identity/protocols/googlescopes">OAuth2 scope</a> for Spring Cloud GCP
Pub/Sub credentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.googleapis.com/auth/pubsub" class="bare">www.googleapis.com/auth/pubsub</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="publishersubscriber-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#publishersubscriber-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#publishersubscriber-configuration">93.1.2. Publisher/Subscriber Configuration</a></h4>
<div class="paragraph">
<p>This section describes configuration options to customize the behavior of the application’s Pub/Sub publishers and subscribers.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.subscriber.parallel-pull-count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of pull workers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.subscriber.max-ack-extension-period</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum period a message ack deadline will be extended, in seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.subscriber.pull-endpoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint for synchronous pulling messages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pubsub.googleapis.com:443</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.[subscriber,publisher].executor-threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of threads used by <code>Subscriber</code> instances created by <code>SubscriberFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.[subscriber,publisher.batching].flow-control.max-outstanding-element-count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of outstanding elements to keep in memory before enforcing flow control.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unlimited</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.[subscriber,publisher.batching].flow-control.max-outstanding-request-bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of outstanding bytes to keep in memory before enforcing flow control.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unlimited</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.[subscriber,publisher.batching].flow-control.limit-exceeded-behavior</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The behavior when the specified limits are exceeded.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.publisher.batching.element-count-threshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The element count threshold to use for batching.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 (batching off)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.publisher.batching.request-byte-threshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The request byte threshold to use for batching.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte (batching off)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.publisher.batching.delay-threshold-seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The delay threshold to use for batching.
After this amount of time has elapsed (counting from the first element added), the elements will be wrapped up in a batch and sent.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 ms (batching off)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.publisher.batching.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables batching.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="grpc-connection-settings"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#grpc-connection-settings"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#grpc-connection-settings">93.1.3. GRPC Connection Settings</a></h4>
<div class="paragraph">
<p>The Pub/Sub API uses the <a href="https://cloud.google.com/pubsub/docs/reference/service_apis_overview#grpc_api">GRPC</a> protocol to send API requests to the Pub/Sub service.
This section describes configuration options for customizing the GRPC behavior.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The properties that refer to <code>retry</code> control the RPC retries for transient failures during the gRPC call to Cloud Pub/Sub server.
They do <strong>not</strong> control message redelivery; only message acknowledgement deadline can be used to extend or shorten the amount of time until Pub/Sub attempts redelivery.
</td>
</tr>
</tbody></table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.keepAliveIntervalMinutes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines frequency of keepalive gRPC ping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5 minutes</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.[subscriber,publisher].retry.total-timeout-seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TotalTimeout has ultimate control over how long the logic should keep trying the remote call until it gives up completely.
The higher the total timeout, the more retries can be attempted.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.[subscriber,publisher].retry.initial-retry-delay-second</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">InitialRetryDelay controls the delay before the first retry.
Subsequent retries will use this value adjusted according to the RetryDelayMultiplier.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.[subscriber,publisher].retry.retry-delay-multiplier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RetryDelayMultiplier controls the change in retry delay.
The retry delay of the previous call is multiplied by the RetryDelayMultiplier to calculate the retry delay for the next call.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.[subscriber,publisher].retry.max-retry-delay-seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MaxRetryDelay puts a limit on the value of the retry delay, so that the RetryDelayMultiplier
can’t increase the retry delay higher than this amount.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.[subscriber,publisher].retry.max-attempts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MaxAttempts defines the maximum number of attempts to perform.
If this value is greater than 0, and the number of attempts reaches this limit, the logic will give up retrying even if the total retry time is still lower than TotalTimeout.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.[subscriber,publisher].retry.jittered</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jitter determines if the delay time should be randomized.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.[subscriber,publisher].retry.initial-rpc-timeout-seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">InitialRpcTimeout controls the timeout for the initial RPC.
Subsequent calls will use this value adjusted according to the RpcTimeoutMultiplier.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.[subscriber,publisher].retry.rpc-timeout-multiplier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RpcTimeoutMultiplier controls the change in RPC timeout.
The timeout of the previous call is multiplied by the RpcTimeoutMultiplier to calculate the timeout for the next call.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.pubsub.[subscriber,publisher].retry.max-rpc-timeout-seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MaxRpcTimeout puts a limit on the value of the RPC timeout, so that the RpcTimeoutMultiplier
can’t increase the RPC timeout higher than this amount.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-actuator-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-actuator-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-actuator-support">93.2. Spring Boot Actuator Support</a></h3>
<div class="sect3">
<h4 id="cloud-pubsub-health-indicator"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-pubsub-health-indicator"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-pubsub-health-indicator">93.2.1. Cloud Pub/Sub Health Indicator</a></h4>
<div class="paragraph">
<p>If you are using Spring Boot Actuator, you can take advantage of the Cloud Pub/Sub health indicator called <code>pubsub</code>.
The health indicator will verify whether Cloud Pub/Sub is up and accessible by your application.
To enable it, all you need to do is add the <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#production-ready">Spring Boot Actuator</a> to your project.</p>
</div>
<div class="paragraph">
<p>The <code>pubsub</code> indicator will then roll up to the overall application status visible at <a href="http://localhost:8080/actuator/health" class="bare">localhost:8080/actuator/health</a> (use the <code>management.endpoint.health.show-details</code> property to view per-indicator details).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your application already has actuator and Cloud Pub/Sub starters, this health indicator is enabled by default.
To disable the Cloud Pub/Sub indicator, set <code>management.health.pubsub.enabled</code> to <code>false</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pubsub-operations-template"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pubsub-operations-template"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pubsub-operations-template">93.3. Pub/Sub Operations &amp; Template</a></h3>
<div class="paragraph">
<p><code>PubSubOperations</code> is an abstraction that allows Spring users to use Google Cloud Pub/Sub without depending on any Google Cloud Pub/Sub API semantics.
It provides the common set of operations needed to interact with Google Cloud Pub/Sub.
<code>PubSubTemplate</code> is the default implementation of <code>PubSubOperations</code> and it uses the <a href="https://github.com/GoogleCloudPlatform/google-cloud-java/tree/master/google-cloud-pubsub">Google Cloud Java Client for Pub/Sub</a> to interact with Google Cloud Pub/Sub.</p>
</div>
<div class="sect3">
<h4 id="publishing-to-a-topic"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#publishing-to-a-topic"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#publishing-to-a-topic">93.3.1. Publishing to a topic</a></h4>
<div class="paragraph">
<p><code>PubSubTemplate</code> provides asynchronous methods to publish messages to a Google Cloud Pub/Sub topic.
The <code>publish()</code> method takes in a topic name to post the message to, a payload of a generic type and, optionally, a map with the message headers.
The topic name could either be a canonical topic name within the current project, or the fully-qualified name referring to a topic in a different project using the <code>projects/&lt;project_name&gt;/topics/&lt;topic_name&gt;</code> format.</p>
</div>
<div class="paragraph">
<p>Here is an example of how to publish a message to a Google Cloud Pub/Sub topic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Map&lt;String, String&gt; headers = Collections.singletonMap(<span class="hljs-string">"key1"</span>, <span class="hljs-string">"val1"</span>);
pubSubTemplate.publish(topicName, <span class="hljs-string">"message"</span>, headers).get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the <code>SimplePubSubMessageConverter</code> is used to convert payloads of type <code>byte[]</code>, <code>ByteString</code>, <code>ByteBuffer</code>, and <code>String</code> to Pub/Sub messages.</p>
</div>
</div>
<div class="sect3">
<h4 id="subscribing-to-a-subscription"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#subscribing-to-a-subscription"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#subscribing-to-a-subscription">93.3.2. Subscribing to a subscription</a></h4>
<div class="paragraph">
<p>Google Cloud Pub/Sub allows many subscriptions to be associated to the same topic.
<code>PubSubTemplate</code> allows you to listen to subscriptions via the <code>subscribe()</code> method.
When listening to a subscription, messages will be pulled from Google Cloud Pub/Sub asynchronously and passed to a user provided message handler.
The subscription name could either be a canonical subscription name within the current project, or the fully-qualified name referring to a subscription in a different project using the <code>projects/&lt;project_name&gt;/subscriptions/&lt;subscription_name&gt;</code> format.</p>
</div>
<div class="sect4">
<h5 id="example"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#example"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#example">Example</a></h5>
<div class="paragraph">
<p>Subscribe to a subscription with a message handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Subscriber subscriber = pubSubTemplate.subscribe(subscriptionName, (message) -&gt; {
    logger.info(<span class="hljs-string">"Message received from "</span> + subscriptionName + <span class="hljs-string">" subscription: "</span>
            + message.getPubsubMessage().getData().toStringUtf8());
    message.ack();
});</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="subscribe-methods"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#subscribe-methods"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#subscribe-methods">Subscribe methods</a></h5>
<div class="paragraph">
<p><code>PubSubTemplate</code> provides the following subscribe methods:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">subscribe(String subscription, Consumer&lt;BasicAcknowledgeablePubsubMessage&gt; messageConsumer)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">asynchronously pulls messages and passes them to <code>messageConsumer</code></p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">subscribeAndConvert(String subscription,
Consumer&lt;ConvertedBasicAcknowledgeablePubsubMessage&lt;T&gt;&gt; messageConsumer,
Class&lt;T&gt; payloadType)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">same as <code>pull</code>, but converts message payload to <code>payloadType</code> using the converter configured in the template</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of version 1.2, subscribing by itself is not enough to keep an application running.
For a command-line application, you may want to provide your own <code>ThreadPoolTaskScheduler</code> bean named <code>pubsubSubscriberThreadPool</code>, which by default creates non-daemon threads that will keep an application from stopping.
This default behavior has been overridden in Spring Cloud GCP for consistency with Cloud Pub/Sub client library, and to avoid holding up command-line applications that would like to shut down once their work is done.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pulling-messages-from-a-subscription"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pulling-messages-from-a-subscription"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pulling-messages-from-a-subscription">93.3.3. Pulling messages from a subscription</a></h4>
<div class="paragraph">
<p>Google Cloud Pub/Sub supports synchronous pulling of messages from a subscription.
This is different from subscribing to a subscription, in the sense that subscribing is an asynchronous task.</p>
</div>
<div class="sect4">
<h5 id="example-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#example-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#example-2">Example</a></h5>
<div class="paragraph">
<p>Pull up to 10 messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">int</span> maxMessages = <span class="hljs-number">10</span>;
<span class="hljs-keyword">boolean</span> returnImmediately = <span class="hljs-keyword">false</span>;
List&lt;AcknowledgeablePubsubMessage&gt; messages = pubSubTemplate.pull(subscriptionName, maxMessages,
        returnImmediately);

<span class="hljs-comment">//acknowledge the messages</span>
pubSubTemplate.ack(messages);

messages.forEach(message -&gt; logger.info(message.getPubsubMessage().getData().toStringUtf8()));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="pull-methods"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pull-methods"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pull-methods">Pull methods</a></h5>
<div class="paragraph">
<p><code>PubsubTemplate</code> provides the following pull methods:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">pull(String subscription, Integer maxMessages,
Boolean returnImmediately)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pulls a number of messages from a subscription, allowing for the retry settings to be configured.
Any messages received by <code>pull()</code> are not automatically acknowledged. See <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#acknowledging-messages">Acknowledging messages</a>.</p>
<p class="tableblock"> The <code>maxMessages</code> parameter is the maximum limit of how many messages to pull from a subscription in a single call; this value <strong>must</strong> be greater than 0.
You may omit this parameter by passing in <code>null</code>; this means there will be no limit on the number of messages pulled (<code>maxMessages</code> will be <code>Integer.MAX_INTEGER</code>).</p>
<p class="tableblock"> If <code>returnImmediately</code> is <code>true</code>, the system will respond immediately even if it there are no messages available to return in the <code>Pull</code> response. Otherwise, the system may wait (for a bounded amount of time) until at least one message is available, rather than returning no messages.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">pullAndAck</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Works the same as the <code>pull</code> method and, additionally, acknowledges all received messages.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">pullNext</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows for a single message to be pulled and automatically acknowledged from a subscription.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">pullAndConvert</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Works the same as the <code>pull</code> method and, additionally, converts the Pub/Sub binary payload to an object of the desired type, using the converter configured in the template.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="acknowledging-messages"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#acknowledging-messages"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#acknowledging-messages">Acknowledging messages</a></h5>
<div class="paragraph">
<p>There are two ways to acknowledge messages.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To acknowledge multiple messages at once, you can use the <code>PubSubTemplate.ack()</code> method.
You can also use the <code>PubSubTemplate.nack()</code> for negatively acknowledging messages.
Using these methods for acknowledging messages in batches is more efficient than acknowledging messages individually, but they <strong>require</strong> the collection of messages to be from the same project.</p>
</li>
<li>
<p>To acknowledge messages individually you can use the <code>ack()</code> or <code>nack()</code> method on each of them (to acknowledge or negatively acknowledge, correspondingly).</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All <code>ack()</code>, <code>nack()</code>, and <code>modifyAckDeadline()</code> methods on messages, as well as <code>PubSubSubscriberTemplate</code>, are implemented asynchronously, returning a <code>ListenableFuture&lt;Void&gt;</code> to enable asynchronous processing.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="json-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#json-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#json-support">93.3.4. JSON support</a></h4>
<div class="paragraph">
<p>For serialization and deserialization of POJOs using Jackson JSON, configure a <code>PubSubMessageConverter</code> bean, and the Spring Boot starter for GCP Pub/Sub will automatically wire it into the <code>PubSubTemplate</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// Note: The ObjectMapper is used to convert Java POJOs to and from JSON.</span>
<span class="hljs-comment">// You will have to configure your own instance if you are unable to depend</span>
<span class="hljs-comment">// on the ObjectMapper provided by Spring Boot starters.</span>
<span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> PubSubMessageConverter <span class="hljs-title">pubSubMessageConverter</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> JacksonPubSubMessageConverter(<span class="hljs-keyword">new</span> ObjectMapper());
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Alternatively, you can set it directly by calling the <code>setMessageConverter()</code> method on the <code>PubSubTemplate</code>.
Other implementations of the <code>PubSubMessageConverter</code> can also be configured in the same manner.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Assuming you have the following class defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestUser</span> </span>{

    String username;

    String password;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.username;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setUsername</span><span class="hljs-params">(String username)</span> </span>{
        <span class="hljs-keyword">this</span>.username = username;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.password;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setPassword</span><span class="hljs-params">(String password)</span> </span>{
        <span class="hljs-keyword">this</span>.password = password;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can serialize objects to JSON on publish automatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">TestUser user = <span class="hljs-keyword">new</span> TestUser();
user.setUsername(<span class="hljs-string">"John"</span>);
user.setPassword(<span class="hljs-string">"password"</span>);
pubSubTemplate.publish(topicName, user);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And that’s how you convert messages to objects on pull:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">int</span> maxMessages = <span class="hljs-number">1</span>;
<span class="hljs-keyword">boolean</span> returnImmediately = <span class="hljs-keyword">false</span>;
List&lt;ConvertedAcknowledgeablePubsubMessage&lt;TestUser&gt;&gt; messages = pubSubTemplate.pullAndConvert(
        subscriptionName, maxMessages, returnImmediately, TestUser.class);

ConvertedAcknowledgeablePubsubMessage&lt;TestUser&gt; message = messages.get(<span class="hljs-number">0</span>);

<span class="hljs-comment">//acknowledge the message</span>
message.ack();

TestUser receivedTestUser = message.getPayload();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please refer to our <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-integration-pubsub-json-sample">Pub/Sub JSON Payload Sample App</a> as a reference for using this functionality.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reactive-stream-subscription"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-stream-subscription"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-stream-subscription">93.4. Reactive Stream Subscription</a></h3>
<div class="paragraph">
<p>It is also possible to acquire a reactive stream backed by a subscription.
To do so, a Project Reactor dependency (<code>io.projectreactor:reactor-core</code>) must be added to the project.
The combination of the Pub/Sub starter and the Project Reactor dependencies will then make a <code>PubSubReactiveFactory</code> bean available, which can then be used to get a <code>Publisher</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
PubSubReactiveFactory reactiveFactory;

<span class="hljs-comment">// ...</span>

Flux&lt;AcknowledgeablePubsubMessage&gt; flux
                = reactiveFactory.poll(<span class="hljs-string">"exampleSubscription"</span>, <span class="hljs-number">1000</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Flux</code> then represents an infinite stream of GCP Pub/Sub messages coming in through the specified subscription.
For unlimited demand, the Pub/Sub subscription will be polled regularly, at intervals determined by <code>pollingPeriodMs</code> parameter passed in when creating the <code>Flux</code>.
For bounded demand, the <code>pollingPeriodMs</code> parameter is unused.
Instead, as many messages as possible (up to the requested number) are delivered immediately, with the remaining messages delivered as they become available.</p>
</div>
<div class="paragraph">
<p>Any exceptions thrown by the underlying message retrieval logic will be passed as an error to the stream.
The error handling operators (<code>Flux#retry()</code>, <code>Flux#onErrorResume()</code> etc.) can be used to recover.</p>
</div>
<div class="paragraph">
<p>The full range of Project Reactor operations can be applied to the stream.
For example, if you only want to fetch 5 messages, you can use <code>limitRequest</code> operation to turn the infinite stream into a finite one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Flux&lt;AcknowledgeablePubsubMessage&gt; fiveMessageFlux = flux.limitRequest(<span class="hljs-number">5</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Messages flowing through the <code>Flux</code> should be manually acknowledged.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">flux.doOnNext(AcknowledgeablePubsubMessage::ack);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pubsub-management"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pubsub-management"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pubsub-management">93.5. Pub/Sub management</a></h3>
<div class="paragraph">
<p><code>PubSubAdmin</code> is the abstraction provided by Spring Cloud GCP to manage Google Cloud Pub/Sub resources.
It allows for the creation, deletion and listing of topics and subscriptions.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Generally when referring to topics and subscriptions, you can either use the short canonical name within the current project, or the fully-qualified name referring to a topic or subscription in a different project using the <code>projects/&lt;project_name&gt;/(topics|subscriptions)/&lt;name&gt;</code> format.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><code>PubSubAdmin</code> depends on <code>GcpProjectIdProvider</code> and either a <code>CredentialsProvider</code> or a <code>TopicAdminClient</code> and a <code>SubscriptionAdminClient</code>.
If given a <code>CredentialsProvider</code>, it creates a <code>TopicAdminClient</code> and a <code>SubscriptionAdminClient</code> with the Google Cloud Java Library for Pub/Sub default settings.
The Spring Boot starter for GCP Pub/Sub auto-configures a <code>PubSubAdmin</code> object using the <code>GcpProjectIdProvider</code> and the <code>CredentialsProvider</code> auto-configured by the Spring Boot GCP Core starter.</p>
</div>
<div class="sect3">
<h4 id="creating-a-topic"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-a-topic"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-a-topic">93.5.1. Creating a topic</a></h4>
<div class="paragraph">
<p><code>PubSubAdmin</code> implements a method to create topics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> Topic <span class="hljs-title">createTopic</span><span class="hljs-params">(String topicName)</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of how to create a Google Cloud Pub/Sub topic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">newTopic</span><span class="hljs-params">()</span> </span>{
    pubSubAdmin.createTopic(<span class="hljs-string">"topicName"</span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deleting-a-topic"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#deleting-a-topic"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#deleting-a-topic">93.5.2. Deleting a topic</a></h4>
<div class="paragraph">
<p><code>PubSubAdmin</code> implements a method to delete topics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteTopic</span><span class="hljs-params">(String topicName)</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of how to delete a Google Cloud Pub/Sub topic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteTopic</span><span class="hljs-params">()</span> </span>{
    pubSubAdmin.deleteTopic(<span class="hljs-string">"topicName"</span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listing-topics"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#listing-topics"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#listing-topics">93.5.3. Listing topics</a></h4>
<div class="paragraph">
<p><code>PubSubAdmin</code> implements a method to list topics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> List&lt;Topic&gt; listTopics</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of how to list every Google Cloud Pub/Sub topic name in a project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;String&gt; topics = pubSubAdmin
        .listTopics()
        .stream()
        .map(Topic::getName)
        .collect(Collectors.toList());</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-subscription"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-a-subscription"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-a-subscription">93.5.4. Creating a subscription</a></h4>
<div class="paragraph">
<p><code>PubSubAdmin</code> implements a method to create subscriptions to existing topics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> Subscription <span class="hljs-title">createSubscription</span><span class="hljs-params">(String subscriptionName, String topicName, Integer ackDeadline, String pushEndpoint)</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of how to create a Google Cloud Pub/Sub subscription:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">newSubscription</span><span class="hljs-params">()</span> </span>{
    pubSubAdmin.createSubscription(<span class="hljs-string">"subscriptionName"</span>, <span class="hljs-string">"topicName"</span>, <span class="hljs-number">10</span>, “https:<span class="hljs-comment">//my.endpoint/push”);</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternative methods with default settings are provided for ease of use.
The default value for <code>ackDeadline</code> is 10 seconds.
If <code>pushEndpoint</code> isn’t specified, the subscription uses message pulling, instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> Subscription <span class="hljs-title">createSubscription</span><span class="hljs-params">(String subscriptionName, String topicName)</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> Subscription <span class="hljs-title">createSubscription</span><span class="hljs-params">(String subscriptionName, String topicName, Integer ackDeadline)</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> Subscription <span class="hljs-title">createSubscription</span><span class="hljs-params">(String subscriptionName, String topicName, String pushEndpoint)</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deleting-a-subscription"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#deleting-a-subscription"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#deleting-a-subscription">93.5.5. Deleting a subscription</a></h4>
<div class="paragraph">
<p><code>PubSubAdmin</code> implements a method to delete subscriptions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteSubscription</span><span class="hljs-params">(String subscriptionName)</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of how to delete a Google Cloud Pub/Sub subscription:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteSubscription</span><span class="hljs-params">()</span> </span>{
    pubSubAdmin.deleteSubscription(<span class="hljs-string">"subscriptionName"</span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listing-subscriptions"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#listing-subscriptions"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#listing-subscriptions">93.5.6. Listing subscriptions</a></h4>
<div class="paragraph">
<p><code>PubSubAdmin</code> implements a method to list subscriptions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Subscription&gt; <span class="hljs-title">listSubscriptions</span><span class="hljs-params">()</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of how to list every subscription name in a project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;String&gt; subscriptions = pubSubAdmin
        .listSubscriptions()
        .stream()
        .map(Subscription::getName)
        .collect(Collectors.toList());</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sample-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-2">93.6. Sample</a></h3>
<div class="paragraph">
<p>Sample applications for <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-pubsub-sample">using the template</a> and <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-pubsub-reactive-sample">using a subscription-backed reactive stream</a> are available.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-integration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-integration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-integration">94. Spring Integration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud GCP provides Spring Integration adapters that allow your applications to use Enterprise Integration Patterns backed up by Google Cloud Platform services.</p>
</div>
<div class="sect2">
<h3 id="channel-adapters-for-cloud-pubsub"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#channel-adapters-for-cloud-pubsub"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#channel-adapters-for-cloud-pubsub">94.1. Channel Adapters for Cloud Pub/Sub</a></h3>
<div class="paragraph">
<p>The channel adapters for Google Cloud Pub/Sub connect your Spring <a href="https://docs.spring.io/spring-integration/reference/html/channel.html"><code>MessageChannels</code></a> to Google Cloud Pub/Sub topics and subscriptions.
This enables messaging between different processes, applications or micro-services backed up by Google Cloud Pub/Sub.</p>
</div>
<div class="paragraph">
<p>The Spring Integration Channel Adapters for Google Cloud Pub/Sub are included in the <code>spring-cloud-gcp-pubsub</code> module and can be autoconfigured by using the <code>spring-cloud-gcp-starter-pubsub</code> module in combination with a Spring Integration dependency.</p>
</div>
<div class="paragraph">
<p>Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-pubsub<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.integration<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-integration-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-pubsub"</span>)
    implementation(<span class="hljs-string">"org.springframework.integration:spring-integration-core"</span>)
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="inbound-channel-adapter-using-pubsub-streaming-pull"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#inbound-channel-adapter-using-pubsub-streaming-pull"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#inbound-channel-adapter-using-pubsub-streaming-pull">94.1.1. Inbound channel adapter (using Pub/Sub Streaming Pull)</a></h4>
<div class="paragraph">
<p><code>PubSubInboundChannelAdapter</code> is the inbound channel adapter for GCP Pub/Sub that listens to a GCP Pub/Sub subscription for new messages.
It converts new messages to an internal Spring <a href="https://docs.spring.io/spring-integration/reference/html/messaging-construction-chapter.html#message"><code>Message</code></a> and then sends it to the bound output channel.</p>
</div>
<div class="paragraph">
<p>Google Pub/Sub treats message payloads as byte arrays.
So, by default, the inbound channel adapter will construct the Spring <code>Message</code> with <code>byte[]</code> as the payload.
However, you can change the desired payload type by setting the <code>payloadType</code> property of the <code>PubSubInboundChannelAdapter</code>.
The <code>PubSubInboundChannelAdapter</code> delegates the conversion to the desired payload type to the <code>PubSubMessageConverter</code> configured in the <code>PubSubTemplate</code>.</p>
</div>
<div class="paragraph">
<p>To use the inbound channel adapter, a <code>PubSubInboundChannelAdapter</code> must be provided and configured on the user application side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> MessageChannel <span class="hljs-title">pubsubInputChannel</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PublishSubscribeChannel();
}

<span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> PubSubInboundChannelAdapter <span class="hljs-title">messageChannelAdapter</span><span class="hljs-params">(
    @Qualifier(<span class="hljs-string">"pubsubInputChannel"</span>)</span> MessageChannel inputChannel,
    PubSubSubscriberOperations subscriberOperations) </span>{
    PubSubInboundChannelAdapter adapter =
        <span class="hljs-keyword">new</span> PubSubInboundChannelAdapter(subscriberOperations, <span class="hljs-string">"subscriptionName"</span>);
    adapter.setOutputChannel(inputChannel);
    adapter.setAckMode(AckMode.MANUAL);

    <span class="hljs-keyword">return</span> adapter;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example, we first specify the <code>MessageChannel</code> where the adapter is going to write incoming messages to.
The <code>MessageChannel</code> implementation isn’t important here.
Depending on your use case, you might want to use a <code>MessageChannel</code> other than <code>PublishSubscribeChannel</code>.</p>
</div>
<div class="paragraph">
<p>Then, we declare a <code>PubSubInboundChannelAdapter</code> bean.
It requires the channel we just created and a <code>SubscriberFactory</code>, which creates <code>Subscriber</code> objects from the Google Cloud Java Client for Pub/Sub.
The Spring Boot starter for GCP Pub/Sub provides a configured <code>PubSubSubscriberOperations</code> object.</p>
</div>
<div class="sect4">
<h5 id="acknowledging-messages-and-handling-failures"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#acknowledging-messages-and-handling-failures"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#acknowledging-messages-and-handling-failures">Acknowledging messages and handling failures</a></h5>
<div class="paragraph">
<p>When working with Cloud Pub/Sub, it is important to understand the concept of <code>ackDeadline</code> — the amount of time Cloud Pub/Sub will wait until attempting redelivery of an outstanding message.
Each subscription has a default <code>ackDeadline</code> applied to all messages sent to it.
Additionally, the Cloud Pub/Sub client library can extend each streamed message’s <code>ackDeadline</code> until the message processing completes, fails or until the maximum extension period elapses.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the Pub/Sub client library, default maximum extension period is an hour. However, Spring Cloud GCP disables this auto-extension behavior.
Use the <code>spring.cloud.gcp.pubsub.subscriber.max-ack-extension-period</code> property to re-enable it.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Acknowledging (acking) a message removes it from Pub/Sub’s known outstanding messages. Nacking a message resets its acknowledgement deadline to 0, forcing immediate redelivery.
This could be useful in a load balanced architecture, where one of the subscribers is having issues but others are available to process messages.</p>
</div>
<div class="paragraph">
<p>The <code>PubSubInboundChannelAdapter</code> supports three acknowledgement modes: the default <code>AckMode.AUTO</code> (automatic acking on processing success and nacking on exception), as well as two modes for additional manual control: AckMode.AUTO_ACK (automatic acking on success but no action on exception) and AckMode.MANUAL (no automatic actions at all; both acking and nacking have to be done manually).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Acknowledgement mode behavior</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">AUTO</th>
<th class="tableblock halign-left valign-top">AUTO_ACK</th>
<th class="tableblock halign-left valign-top">MANUAL</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message processing completes successfully</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ack, no redelivery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ack, no redelivery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;no action&gt;*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message processing fails, but error handler completes successfully**</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ack, no redelivery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ack, no redelivery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;no action&gt;*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message processing fails; no error handler present</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nack, immediate redelivery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;no action&gt;*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;no action&gt;*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message processing fails, and error handler throws an exception</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nack, immediate redelivery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;no action&gt;*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;no action&gt;*</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>* &lt;no action&gt; means that the message will be neither acked nor nacked.
Cloud Pub/Sub will attempt redelivery according to subscription <code>ackDeadline</code> setting and the <code>max-ack-extension-period</code> client library setting.</p>
</div>
<div class="paragraph">
<p>** For the adapter, "success" means the Spring Integration flow processed without raising an exception, so successful message processing and the successful completion of an error handler both result in the same behavior (message will be acknowledged).
To trigger default error behavior (nacking in <code>AUTO</code> mode; neither acking nor nacking in <code>AUTO_ACK</code> mode), propagate the error back to the adapter by throwing an exception from the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#error-handling">Error Handling flow</a>.</p>
</div>
<div class="sect5">
<h6 id="manual-ackingnacking"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#manual-ackingnacking"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#manual-ackingnacking">Manual acking/nacking</a></h6>
<div class="paragraph">
<p>The adapter attaches a <code>BasicAcknowledgeablePubsubMessage</code> object to the <code>Message</code> headers.
Users can extract the <code>BasicAcknowledgeablePubsubMessage</code> using the <code>GcpPubSubHeaders.ORIGINAL_MESSAGE</code> key and use it to ack (or nack) a message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-meta">@ServiceActivator</span>(inputChannel = <span class="hljs-string">"pubsubInputChannel"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> MessageHandler <span class="hljs-title">messageReceiver</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> message -&gt; {
        LOGGER.info(<span class="hljs-string">"Message arrived! Payload: "</span> + <span class="hljs-keyword">new</span> String((<span class="hljs-keyword">byte</span>[]) message.getPayload()));
        BasicAcknowledgeablePubsubMessage originalMessage =
              message.getHeaders().get(GcpPubSubHeaders.ORIGINAL_MESSAGE, BasicAcknowledgeablePubsubMessage.class);
        originalMessage.ack();
    };
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="error-handling"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#error-handling"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#error-handling">Error Handling</a></h6>
<div class="paragraph">
<p>If you want to have more control over message processing in case of an error, you need to associate the <code>PubSubInboundChannelAdapter</code> with a Spring Integration error channel and specify the behavior to be invoked with <code>@ServiceActivator</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order to activate the default behavior (nacking in <code>AUTO</code> mode; neither acking nor nacking in <code>AUTO_ACK</code> mode), your error handler has to throw an exception.
Otherwise, the adapter will assume that processing completed successfully and will ack the message.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> MessageChannel <span class="hljs-title">pubsubInputChannel</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PublishSubscribeChannel();
}

<span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> PubSubInboundChannelAdapter <span class="hljs-title">messageChannelAdapter</span><span class="hljs-params">(
    @Qualifier(<span class="hljs-string">"pubsubInputChannel"</span>)</span> MessageChannel inputChannel,
    SubscriberFactory subscriberFactory) </span>{
    PubSubInboundChannelAdapter adapter =
        <span class="hljs-keyword">new</span> PubSubInboundChannelAdapter(subscriberFactory, <span class="hljs-string">"subscriptionName"</span>);
    adapter.setOutputChannel(inputChannel);
    adapter.setAckMode(AckMode.AUTO_ACK);
    adapter.setErrorChannelName(<span class="hljs-string">"pubsubErrors"</span>);

    <span class="hljs-keyword">return</span> adapter;
}

<span class="hljs-meta">@ServiceActivator</span>(inputChannel =  <span class="hljs-string">"pubsubErrors"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">pubsubErrorHandler</span><span class="hljs-params">(Message&lt;MessagingException&gt; message)</span> </span>{
    LOGGER.warn(<span class="hljs-string">"This message will be automatically acked because error handler completes successfully"</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you would prefer to manually ack or nack the message, you can do it by retrieving the header of the exception payload:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@ServiceActivator</span>(inputChannel =  <span class="hljs-string">"pubsubErrors"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">pubsubErrorHandler</span><span class="hljs-params">(Message&lt;MessagingException&gt; exceptionMessage)</span> </span>{

    BasicAcknowledgeablePubsubMessage originalMessage =
      (BasicAcknowledgeablePubsubMessage)exceptionMessage.getPayload().getFailedMessage()
        .getHeaders().get(GcpPubSubHeaders.ORIGINAL_MESSAGE);

    originalMessage.nack();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pollable-message-source-using-pubsub-synchronous-pull"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pollable-message-source-using-pubsub-synchronous-pull"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pollable-message-source-using-pubsub-synchronous-pull">94.1.2. Pollable Message Source (using Pub/Sub Synchronous Pull)</a></h4>
<div class="paragraph">
<p>While <code>PubSubInboundChannelAdapter</code>, through the underlying Asynchronous Pull Pub/Sub mechanism, provides the best performance for high-volume applications that receive a steady flow of messages, it can create load balancing anomalies due to message caching.
This behavior is most obvious when publishing a large batch of small messages that take a long time to process individually.
It manifests as one subscriber taking up most messages, even if multiple subscribers are available to take on the work.
For a more detailed explanation of this scenario, see <a href="https://cloud.google.com/pubsub/docs/pull#streamingpull_dealing_with_large_backlogs_of_small_messages">GCP Pub/Sub documentation</a>.</p>
</div>
<div class="paragraph">
<p>In such a scenario, a <code>PubSubMessageSource</code> can help spread the load between different subscribers more evenly.</p>
</div>
<div class="paragraph">
<p>As with the Inbound Channel Adapter, the message source has a configurable acknowledgement mode, payload type, and header mapping.</p>
</div>
<div class="paragraph">
<p>The default behavior is to return from the synchronous pull operation immediately if no messages are present.
This can be overridden by using <code>setBlockOnPull()</code> method to wait for at least one message to arrive.</p>
</div>
<div class="paragraph">
<p>By default, <code>PubSubMessageSource</code> pulls from the subscription one message at a time.
To pull a batch of messages on each request, use the <code>setMaxFetchSize()</code> method to set the batch size.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-meta">@InboundChannelAdapter</span>(channel = <span class="hljs-string">"pubsubInputChannel"</span>, poller = <span class="hljs-meta">@Poller</span>(fixedDelay = <span class="hljs-string">"100"</span>))
<span class="hljs-function"><span class="hljs-keyword">public</span> MessageSource&lt;Object&gt; <span class="hljs-title">pubsubAdapter</span><span class="hljs-params">(PubSubTemplate pubSubTemplate)</span> </span>{
    PubSubMessageSource messageSource = <span class="hljs-keyword">new</span> PubSubMessageSource(pubSubTemplate,  <span class="hljs-string">"exampleSubscription"</span>);
    messageSource.setAckMode(AckMode.MANUAL);
    messageSource.setPayloadType(String.class);
    messageSource.setBlockOnPull(<span class="hljs-keyword">true</span>);
    messageSource.setMaxFetchSize(<span class="hljs-number">100</span>);
    <span class="hljs-keyword">return</span> messageSource;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@InboundChannelAdapter</code> annotation above ensures that the configured <code>MessageSource</code> is polled for messages, which are then available for manipulation with any Spring Integration mechanism on the <code>pubsubInputChannel</code> message channel.
For example, messages can be retrieved in a method annotated with <code>@ServiceActivator</code>, as seen below.</p>
</div>
<div class="paragraph">
<p>For additional flexibility, <code>PubSubMessageSource</code> attaches an <code>AcknowledgeablePubSubMessage</code> object to the <code>GcpPubSubHeaders.ORIGINAL_MESSAGE</code> message header.
The object can be used for manually (n)acking the message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@ServiceActivator</span>(inputChannel = <span class="hljs-string">"pubsubInputChannel"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">messageReceiver</span><span class="hljs-params">(String payload,
        @Header(GcpPubSubHeaders.ORIGINAL_MESSAGE)</span> AcknowledgeablePubsubMessage message)
            <span class="hljs-keyword">throws</span> InterruptedException </span>{
    LOGGER.info(<span class="hljs-string">"Message arrived by Synchronous Pull! Payload: "</span> + payload);
    message.ack();
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>AcknowledgeablePubSubMessage</code> objects acquired by synchronous pull are aware of their own acknowledgement IDs.
Streaming pull does not expose this information due to limitations of the underlying API, and returns <code>BasicAcknowledgeablePubsubMessage</code> objects that allow acking/nacking individual messages, but not extracting acknowledgement IDs for future processing.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="outbound-channel-adapter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#outbound-channel-adapter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#outbound-channel-adapter">94.1.3. Outbound channel adapter</a></h4>
<div class="paragraph">
<p><code>PubSubMessageHandler</code> is the outbound channel adapter for GCP Pub/Sub that listens for new messages on a Spring <code>MessageChannel</code>.
It uses <code>PubSubTemplate</code> to post them to a GCP Pub/Sub topic.</p>
</div>
<div class="paragraph">
<p>To construct a Pub/Sub representation of the message, the outbound channel adapter needs to convert the Spring <code>Message</code> payload to a byte array representation expected by Pub/Sub.
It delegates this conversion to the <code>PubSubTemplate</code>.
To customize the conversion, you can specify a <code>PubSubMessageConverter</code> in the <code>PubSubTemplate</code> that should convert the <code>Object</code> payload and headers of the Spring <code>Message</code> to a <code>PubsubMessage</code>.</p>
</div>
<div class="paragraph">
<p>To use the outbound channel adapter, a <code>PubSubMessageHandler</code> bean must be provided and configured on the user application side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-meta">@ServiceActivator</span>(inputChannel = <span class="hljs-string">"pubsubOutputChannel"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> MessageHandler <span class="hljs-title">messageSender</span><span class="hljs-params">(PubSubTemplate pubsubTemplate)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PubSubMessageHandler(pubsubTemplate, <span class="hljs-string">"topicName"</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The provided <code>PubSubTemplate</code> contains all the necessary configuration to publish messages to a GCP Pub/Sub topic.</p>
</div>
<div class="paragraph">
<p><code>PubSubMessageHandler</code> publishes messages asynchronously by default.
A publish timeout can be configured for synchronous publishing.
If none is provided, the adapter waits indefinitely for a response.</p>
</div>
<div class="paragraph">
<p>It is possible to set user-defined callbacks for the <code>publish()</code> call in <code>PubSubMessageHandler</code> through the <code>setPublishFutureCallback()</code> method.
These are useful to process the message ID, in case of success, or the error if any was thrown.</p>
</div>
<div class="paragraph">
<p>To override the default topic you can use the <code>GcpPubSubHeaders.TOPIC</code> header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> MessageChannel pubsubOutputChannel;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleMessage</span><span class="hljs-params">(Message&lt;?&gt; msg)</span> <span class="hljs-keyword">throws</span> MessagingException </span>{
    <span class="hljs-keyword">final</span> Message&lt;?&gt; message = MessageBuilder
        .withPayload(msg.getPayload())
        .setHeader(GcpPubSubHeaders.TOPIC, <span class="hljs-string">"customTopic"</span>).build();
    pubsubOutputChannel.send(message);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to set an SpEL expression for the topic with the <code>setTopicExpression()</code> or <code>setTopicExpressionString()</code> methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="header-mapping"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#header-mapping"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#header-mapping">94.1.4. Header mapping</a></h4>
<div class="paragraph">
<p>These channel adapters contain header mappers that allow you to map, or filter out, headers from Spring to Google Cloud Pub/Sub messages, and vice-versa.
By default, the inbound channel adapter maps every header on the Google Cloud Pub/Sub messages to the Spring messages produced by the adapter.
The outbound channel adapter maps every header from Spring messages into Google Cloud Pub/Sub ones, except the ones added by Spring, like headers with key <code>"id"</code>, <code>"timestamp"</code> and <code>"gcp_pubsub_acknowledgement"</code>.
In the process, the outbound mapper also converts the value of the headers into string.</p>
</div>
<div class="paragraph">
<p>Each adapter declares a <code>setHeaderMapper()</code> method to let you further customize which headers you want to map from Spring to Google Cloud Pub/Sub, and vice-versa.</p>
</div>
<div class="paragraph">
<p>For example, to filter out headers <code>"foo"</code>, <code>"bar"</code> and all headers starting with the prefix "prefix_", you can use <code>setHeaderMapper()</code> along with the <code>PubSubHeaderMapper</code> implementation provided by this module.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">PubSubMessageHandler adapter = ...
...
PubSubHeaderMapper headerMapper = <span class="hljs-keyword">new</span> PubSubHeaderMapper();
headerMapper.setOutboundHeaderPatterns(<span class="hljs-string">"!foo"</span>, <span class="hljs-string">"!bar"</span>, <span class="hljs-string">"!prefix_*"</span>, <span class="hljs-string">"*"</span>);
adapter.setHeaderMapper(headerMapper);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The order in which the patterns are declared in <code>PubSubHeaderMapper.setOutboundHeaderPatterns()</code> and <code>PubSubHeaderMapper.setInboundHeaderPatterns()</code> matters.
The first patterns have precedence over the following ones.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In the previous example, the <code>"*"</code> pattern means every header is mapped.
However, because it comes last in the list, <a href="https://docs.spring.io/spring-integration/api/org/springframework/integration/util/PatternMatchUtils.html#smartMatch-java.lang.String-java.lang.String%E2%80%A6%E2%80%8B-">the previous patterns take precedence</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="samples-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#samples-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#samples-2">94.1.5. Samples</a></h4>
<div class="paragraph">
<p>Available examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-integration-pubsub-sample">Sending/Receiving Messages with Channel Adapters</a></p>
</li>
<li>
<p><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-integration-pubsub-json-sample">Pub/Sub Channel Adapters with JSON payloads</a></p>
</li>
<li>
<p><a href="https://codelabs.developers.google.com/codelabs/cloud-spring-cloud-gcp-pubsub-integration/index.html">Spring Integration and Pub/Sub Codelab</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="channel-adapters-for-google-cloud-storage"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#channel-adapters-for-google-cloud-storage"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#channel-adapters-for-google-cloud-storage">94.2. Channel Adapters for Google Cloud Storage</a></h3>
<div class="paragraph">
<p>The channel adapters for Google Cloud Storage allow you to read and write files to Google Cloud Storage through <code>MessageChannels</code>.</p>
</div>
<div class="paragraph">
<p>Spring Cloud GCP provides two inbound adapters, <code>GcsInboundFileSynchronizingMessageSource</code> and <code>GcsStreamingMessageSource</code>, and one outbound adapter, <code>GcsMessageHandler</code>.</p>
</div>
<div class="paragraph">
<p>The Spring Integration Channel Adapters for Google Cloud Storage are included in the <code>spring-cloud-gcp-storage</code> module.</p>
</div>
<div class="paragraph">
<p>To use the Storage portion of Spring Integration for Spring Cloud GCP, you must also provide the <code>spring-integration-file</code> dependency, since it isn’t pulled transitively.</p>
</div>
<div class="paragraph">
<p>Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-storage<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.integration<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-integration-file<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-storage"</span>)
    implementation(<span class="hljs-string">"org.springframework.integration:spring-integration-file"</span>)
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="inbound-channel-adapter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#inbound-channel-adapter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#inbound-channel-adapter">94.2.1. Inbound channel adapter</a></h4>
<div class="paragraph">
<p>The Google Cloud Storage inbound channel adapter polls a Google Cloud Storage bucket for new files and sends each of them in a <code>Message</code> payload to the <code>MessageChannel</code> specified in the <code>@InboundChannelAdapter</code> annotation.
The files are temporarily stored in a folder in the local file system.</p>
</div>
<div class="paragraph">
<p>Here is an example of how to configure a Google Cloud Storage inbound channel adapter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-meta">@InboundChannelAdapter</span>(channel = <span class="hljs-string">"new-file-channel"</span>, poller = <span class="hljs-meta">@Poller</span>(fixedDelay = <span class="hljs-string">"5000"</span>))
<span class="hljs-function"><span class="hljs-keyword">public</span> MessageSource&lt;File&gt; <span class="hljs-title">synchronizerAdapter</span><span class="hljs-params">(Storage gcs)</span> </span>{
  GcsInboundFileSynchronizer synchronizer = <span class="hljs-keyword">new</span> GcsInboundFileSynchronizer(gcs);
  synchronizer.setRemoteDirectory(<span class="hljs-string">"your-gcs-bucket"</span>);

  GcsInboundFileSynchronizingMessageSource synchAdapter =
          <span class="hljs-keyword">new</span> GcsInboundFileSynchronizingMessageSource(synchronizer);
  synchAdapter.setLocalDirectory(<span class="hljs-keyword">new</span> File(<span class="hljs-string">"local-directory"</span>));

  <span class="hljs-keyword">return</span> synchAdapter;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="inbound-streaming-channel-adapter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#inbound-streaming-channel-adapter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#inbound-streaming-channel-adapter">94.2.2. Inbound streaming channel adapter</a></h4>
<div class="paragraph">
<p>The inbound streaming channel adapter is similar to the normal inbound channel adapter, except it does not require files to be stored in the file system.</p>
</div>
<div class="paragraph">
<p>Here is an example of how to configure a Google Cloud Storage inbound streaming channel adapter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-meta">@InboundChannelAdapter</span>(channel = <span class="hljs-string">"streaming-channel"</span>, poller = <span class="hljs-meta">@Poller</span>(fixedDelay = <span class="hljs-string">"5000"</span>))
<span class="hljs-function"><span class="hljs-keyword">public</span> MessageSource&lt;InputStream&gt; <span class="hljs-title">streamingAdapter</span><span class="hljs-params">(Storage gcs)</span> </span>{
  GcsStreamingMessageSource adapter =
          <span class="hljs-keyword">new</span> GcsStreamingMessageSource(<span class="hljs-keyword">new</span> GcsRemoteFileTemplate(<span class="hljs-keyword">new</span> GcsSessionFactory(gcs)));
  adapter.setRemoteDirectory(<span class="hljs-string">"your-gcs-bucket"</span>);
  <span class="hljs-keyword">return</span> adapter;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you would like to process the files in your bucket in a specific order, you may pass in a <code>Comparator&lt;BlobInfo&gt;</code> to the constructor <code>GcsStreamingMessageSource</code> to sort the files being processed.</p>
</div>
</div>
<div class="sect3">
<h4 id="outbound-channel-adapter-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#outbound-channel-adapter-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#outbound-channel-adapter-2">94.2.3. Outbound channel adapter</a></h4>
<div class="paragraph">
<p>The outbound channel adapter allows files to be written to Google Cloud Storage.
When it receives a <code>Message</code> containing a payload of type <code>File</code>, it writes that file to the Google Cloud Storage bucket specified in the adapter.</p>
</div>
<div class="paragraph">
<p>Here is an example of how to configure a Google Cloud Storage outbound channel adapter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-meta">@ServiceActivator</span>(inputChannel = <span class="hljs-string">"writeFiles"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> MessageHandler <span class="hljs-title">outboundChannelAdapter</span><span class="hljs-params">(Storage gcs)</span> </span>{
  GcsMessageHandler outboundChannelAdapter = <span class="hljs-keyword">new</span> GcsMessageHandler(<span class="hljs-keyword">new</span> GcsSessionFactory(gcs));
  outboundChannelAdapter.setRemoteDirectoryExpression(<span class="hljs-keyword">new</span> ValueExpression&lt;&gt;(<span class="hljs-string">"your-gcs-bucket"</span>));

  <span class="hljs-keyword">return</span> outboundChannelAdapter;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sample-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-3">94.2.4. Sample</a></h4>
<div class="paragraph">
<p>See the <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-integration-storage-sample">Spring Integration with Google Cloud Storage Sample Code</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-stream"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-stream"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-stream">95. Spring Cloud Stream</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud GCP provides a <a href="https://cloud.spring.io/spring-cloud-stream/">Spring Cloud Stream</a> binder to Google Cloud Pub/Sub.</p>
</div>
<div class="paragraph">
<p>The provided binder relies on the <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-pubsub/src/main/java/org/springframework/cloud/gcp/pubsub/integration">Spring Integration Channel Adapters for Google Cloud Pub/Sub</a>.</p>
</div>
<div class="paragraph">
<p>Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-pubsub-stream-binder<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-pubsub-stream-binder"</span>)
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="overview"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#overview"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#overview">95.1. Overview</a></h3>
<div class="paragraph">
<p>This binder binds producers to Google Cloud Pub/Sub topics and consumers to subscriptions.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Partitioning is currently not supported by this binder.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="configuration-6"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-6"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-6">95.2. Configuration</a></h3>
<div class="paragraph">
<p>You can configure the Spring Cloud Stream Binder for Google Cloud Pub/Sub to automatically generate the underlying resources, like the Google Cloud Pub/Sub topics and subscriptions for producers and consumers.
For that, you can use the <code>spring.cloud.stream.gcp.pubsub.bindings.&lt;channelName&gt;.&lt;consumer|producer&gt;.auto-create-resources</code> property, which is turned ON by default.</p>
</div>
<div class="paragraph">
<p>Starting with version 1.1, these and other binder properties can be configured globally for all the bindings, e.g. <code>spring.cloud.stream.gcp.pubsub.default.consumer.auto-create-resources</code>.</p>
</div>
<div class="paragraph">
<p>If you are using Pub/Sub auto-configuration from the Spring Cloud GCP Pub/Sub Starter, you should refer to the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pubsub-configuration">configuration</a> section for other Pub/Sub parameters.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To use this binder with a <a href="https://cloud.google.com/pubsub/docs/emulator">running emulator</a>, configure its host and port via <code>spring.cloud.gcp.pubsub.emulator-host</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="producer-synchronous-sending-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#producer-synchronous-sending-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#producer-synchronous-sending-configuration">95.2.1. Producer Synchronous Sending Configuration</a></h4>
<div class="paragraph">
<p>By default, this binder will send messages to Cloud Pub/Sub asynchronously.
If synchronous sending is preferred (for example, to allow propagating errors back to the sender), set <code>spring.cloud.stream.gcp.pubsub.default.producer.sync</code> property to <code>true</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="producer-destination-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#producer-destination-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#producer-destination-configuration">95.2.2. Producer Destination Configuration</a></h4>
<div class="paragraph">
<p>If automatic resource creation is turned ON and the topic corresponding to the destination name does not exist, it will be created.</p>
</div>
<div class="paragraph">
<p>For example, for the following configuration, a topic called <code>myEvents</code> would be created.</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">spring.cloud.stream.bindings.events.destination=myEvents
spring.cloud.stream.gcp.pubsub.bindings.events.producer.auto-<span class="hljs-keyword">create</span>-resources=<span class="hljs-literal">true</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="consumer-destination-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#consumer-destination-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#consumer-destination-configuration">95.2.3. Consumer Destination Configuration</a></h4>
<div class="paragraph">
<p>A <code>PubSubInboundChannelAdapter</code> will be configured for your consumer endpoint.
You may adjust the ack mode of the consumer endpoint using the <code>ack-mode</code> property.
The ack mode controls how messages will be acknowledged when they are successfully received.
The three possible options are: <code>AUTO</code> (default), <code>AUTO_ACK</code>, and <code>MANUAL</code>.
These options are described in detail in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#inbound-channel-adapter-using-pubsub-streaming-pull">Pub/Sub channel adapter documentation</a>.</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-comment"># How to set the ACK mode of the consumer endpoint.</span>
spring.cloud.stream.gcp.pubsub.bindings.{CONSUMER_NAME}.consumer.ack-mode=AUTO_ACK</code></pre>
</div>
</div>
<div class="paragraph">
<p>If automatic resource creation is turned ON and the subscription and/or the topic do not exist for a consumer, a subscription and potentially a topic will be created.
The topic name will be the same as the destination name, and the subscription name will be the destination name followed by the consumer group name.</p>
</div>
<div class="paragraph">
<p>Regardless of the <code>auto-create-resources</code> setting, if the consumer group is not specified, an anonymous one will be created with the name <code>anonymous.&lt;destinationName&gt;.&lt;randomUUID&gt;</code>.
Then when the binder shuts down, all Pub/Sub subscriptions created for anonymous consumer groups will be automatically cleaned up.</p>
</div>
<div class="paragraph">
<p>For example, for the following configuration, a topic named <code>myEvents</code> and a subscription called <code>myEvents.consumerGroup1</code> would be created.
If the consumer group is not specified, a subscription called <code>anonymous.myEvents.a6d83782-c5a3-4861-ac38-e6e2af15a7be</code> would be created and later cleaned up.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you are manually creating Pub/Sub subscriptions for consumers, make sure that they follow the naming convention of <code>&lt;destinationName&gt;.&lt;consumerGroup&gt;</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle">spring.cloud.stream.bindings.events.destination=myEvents
spring.cloud.stream.gcp.pubsub.bindings.events.consumer.auto-create-resources=<span class="hljs-keyword">true</span>

# specify consumer <span class="hljs-keyword">group</span>, and avoid anonymous consumer <span class="hljs-keyword">group</span> generation
spring.cloud.stream.bindings.events.<span class="hljs-keyword">group</span>=consumerGroup1</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="binding-with-functions"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#binding-with-functions"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#binding-with-functions">95.3. Binding with Functions</a></h3>
<div class="paragraph">
<p>Since version 3.0, Spring Cloud Stream supports a functional programming model natively.
This means that the only requirement for turning your application into a sink is presence of a <code>java.util.function.Consumer</code> bean in the application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs kotlin"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Consumer&lt;UserMessage&gt; logUserMessage() {
  <span class="hljs-keyword">return</span> userMessage -&gt; {
    <span class="hljs-comment">// process message</span>
  }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>A source application is one where a <code>Supplier</code> bean is present.
It can return an object, in which case Spring Cloud Stream will invoke the supplier repeatedly.
Alternatively, the function can return a reactive stream, which will be used as is.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs kotlin"><span class="hljs-meta">@Bean</span>
Supplier&lt;Flux&lt;UserMessage&gt;&gt; generateUserMessages() {
  <span class="hljs-keyword">return</span> () -&gt; <span class="hljs-comment">/* flux creation logic */</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A processor application works similarly to a source application, except it is triggered by presence of a <code>Function</code> bean.</p>
</div>
</div>
<div class="sect2">
<h3 id="binding-with-annotations"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#binding-with-annotations"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#binding-with-annotations">95.4. Binding with Annotations</a></h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of version 3.0, annotation binding is considered legacy.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To set up a sink application in this style, you would associate a class with a binding interface, such as the built-in <code>Sink</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs kotlin"><span class="hljs-meta">@EnableBinding(Sink.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SinkExample</span> </span>{

    <span class="hljs-meta">@StreamListener(Sink.INPUT)</span>
    <span class="hljs-keyword">public</span> void handleMessage(UserMessage userMessage) {
        <span class="hljs-comment">// process message</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To set up a source application, you would similarly associate a class with a built-in <code>Source</code> interface, and inject an instance of it provided by Spring Cloud Stream.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle">@EnableBinding(<span class="hljs-keyword">Source</span>.<span class="hljs-keyword">class</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> SourceExample {

    @Autowired
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">Source</span> <span class="hljs-keyword">source</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> sendMessage() {
        <span class="hljs-keyword">this</span>.<span class="hljs-keyword">source</span>.output().send(<span class="hljs-keyword">new</span> GenericMessage&lt;&gt;(<span class="hljs-comment">/* your object here */</span>));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="streaming-vs-polled-input"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#streaming-vs-polled-input"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#streaming-vs-polled-input">95.5. Streaming vs. Polled Input</a></h3>
<div class="paragraph">
<p>Many Spring Cloud Stream applications will use the built-in <code>Sink</code> binding, which triggers the <em>streaming</em> input binder creation.
Messages can then be consumed with an input handler marked by <code>@StreamListener(Sink.INPUT)</code> annotation, at whatever rate Pub/Sub sends them.</p>
</div>
<div class="paragraph">
<p>For more control over the rate of message arrival, a polled input binder can be set up by defining a custom binding interface with an <code>@Input</code>-annotated method returning <code>PollableMessageSource</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PollableSink</span> </span>{

    <span class="hljs-meta">@Input</span>(<span class="hljs-string">"input"</span>)
    <span class="hljs-function">PollableMessageSource <span class="hljs-title">input</span><span class="hljs-params">()</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PollableMessageSource</code> can then be injected and queried, as needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@EnableBinding</span>(PollableSink.class)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SinkExample</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    PollableMessageSource destIn;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ApplicationRunner <span class="hljs-title">singlePollRunner</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> args -&gt; {
            <span class="hljs-comment">// This will poll only once.</span>
            <span class="hljs-comment">// Add a loop or a scheduler to get more messages.</span>
            destIn.poll((message) -&gt; System.out.println(<span class="hljs-string">"Message retrieved: "</span> + message));
        };
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sample-4"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-4"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-4">95.6. Sample</a></h3>
<div class="paragraph">
<p>Sample applications are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-pubsub-binder-sample">streaming input, annotation-based</a>.</p>
</li>
<li>
<p>For <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-pubsub-stream-binder-functional-sample">streaming input, functional style</a>.</p>
</li>
<li>
<p>For <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-pubsub-polling-binder-sample">polled input</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-bus-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-bus-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-bus-2">96. Spring Cloud Bus</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using <a href="https://cloud.google.com/pubsub/">Cloud Pub/Sub</a> as the <a href="https://spring.io/projects/spring-cloud-bus">Spring Cloud Bus</a> implementation is as simple as importing the <code>spring-cloud-gcp-starter-bus-pubsub</code> starter.</p>
</div>
<div class="paragraph">
<p>This starter brings in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/spring-stream.html#_spring_cloud_stream">Spring Cloud Stream binder for Cloud Pub/Sub</a>, which is used to both publish and subscribe to the bus.
If the bus topic (named <code>springCloudBus</code> by default) does not exist, the binder automatically creates it.
The binder also creates anonymous subscriptions for each project using the <code>spring-cloud-gcp-starter-bus-pubsub</code> starter.</p>
</div>
<div class="paragraph">
<p>Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-bus-pubsub<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-bus-pubsub"</span>)
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="configuration-management-with-spring-cloud-config-and-spring-cloud-bus"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-management-with-spring-cloud-config-and-spring-cloud-bus"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-management-with-spring-cloud-config-and-spring-cloud-bus">96.1. Configuration Management with Spring Cloud Config and Spring Cloud Bus</a></h3>
<div class="paragraph">
<p>Spring Cloud Bus can be used to push configuration changes from a Spring Cloud Config server to the clients listening on the same bus.</p>
</div>
<div class="paragraph">
<p>To use GCP Pub/Sub as the bus implementation, both the configuration server and the configuration client need the <code>spring-cloud-gcp-starter-bus-pubsub</code> dependency.</p>
</div>
<div class="paragraph">
<p>All other configuration is standard to <a href="https://spring.io/projects/spring-cloud-config">Spring Cloud Config</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/spring_cloud_bus_over_pubsub.png" alt="spring cloud bus over pubsub">
</div>
</div>
<div class="paragraph">
<p>Spring Cloud Config Server typically runs on port <code>8888</code>, and can read configuration from a <a href="https://cloud.spring.io/spring-cloud-config/spring-cloud-config.html#_environment_repository">variety of source control systems</a> such as GitHub, and even from the local filesystem.
When the server is notified that new configuration is available, it fetches the updated configuration and sends a notification (<code>RefreshRemoteApplicationEvent</code>) out via Spring Cloud Bus.</p>
</div>
<div class="paragraph">
<p>When configuration is stored locally, config server polls the parent directory for changes.
With configuration stored in source control repository, such as GitHub, the config server needs to be notified that a new version of configuration is available.
In a deployed server, this would be done automatically through a GitHub webhook, but in a local testing scenario, the <code>/monitor</code> HTTP endpoint needs to be invoked manually.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X POST http://localhost:8888/monitor -H "X-Github-Event: push" -H "Content-Type: application/json" -d '{"commits": [{"modified": ["application.properties"]}]}'</pre>
</div>
</div>
<div class="paragraph">
<p>By adding the <code>spring-cloud-gcp-starter-bus-pubsub</code> dependency, you instruct Spring Cloud Bus to use Cloud Pub/Sub to broadcast configuration changes.
Spring Cloud Bus will then create a topic named <code>springCloudBus</code>, as well as a subscription for each configuration client.</p>
</div>
<div class="paragraph">
<p>The configuration server happens to also be a configuration client, subscribing to the configuration changes that it sends out.
Thus, in a scenario with one configuration server and one configuration client, two anonymous subscriptions to the <code>springCloudBus</code> topic are created.
However, a config server disables configuration refresh by default (see <a href="https://static.javadoc.io/org.springframework.cloud/spring-cloud-config-server/2.1.0.RELEASE/index.html">ConfigServerBootstrapApplicationListener</a> for more details).</p>
</div>
<div class="paragraph">
<p>A <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-pubsub-bus-config-sample">demo application</a> showing configuration management and distribution over a Cloud Pub/Sub-powered bus is available.
The sample contains two examples of configuration management with Spring Cloud Bus: one monitoring a local file system, and the other retrieving configuration from a GitHub repository.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stackdriver-trace"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stackdriver-trace"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stackdriver-trace">97. Stackdriver Trace</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Google Cloud Platform provides a managed distributed tracing service called <a href="https://cloud.google.com/trace/">Stackdriver Trace</a>, and <a href="https://cloud.spring.io/spring-cloud-sleuth/">Spring Cloud Sleuth</a> can be used with it to easily instrument Spring Boot applications for observability.</p>
</div>
<div class="paragraph">
<p>Typically, Spring Cloud Sleuth captures trace information and forwards traces to services like Zipkin for storage and analysis.
However, on GCP, instead of running and maintaining your own Zipkin instance and storage, you can use Stackdriver Trace to store traces, view trace details, generate latency distributions graphs, and generate performance regression reports.</p>
</div>
<div class="paragraph">
<p>This Spring Cloud GCP starter can forward Spring Cloud Sleuth traces to Stackdriver Trace without an intermediary Zipkin server.</p>
</div>
<div class="paragraph">
<p>Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-trace<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-trace"</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You must enable Stackdriver Trace API from the Google Cloud Console in order to capture traces.
Navigate to the <a href="https://console.cloud.google.com/apis/api/cloudtrace.googleapis.com/overview">Stackdriver Trace API</a> for your project and make sure it’s enabled.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are already using a Zipkin server capturing trace information from multiple platform/frameworks, you can also use a <a href="https://cloud.google.com/trace/docs/zipkin">Stackdriver Zipkin proxy</a> to forward those traces to Stackdriver Trace without modifying existing applications.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="tracing"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tracing"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tracing">97.1. Tracing</a></h3>
<div class="paragraph">
<p>Spring Cloud Sleuth uses the <a href="https://github.com/openzipkin/brave">Brave tracer</a> to generate traces.
This integration enables Brave to use the <a href="https://github.com/openzipkin/zipkin-gcp/tree/master/propagation-stackdriver"><code>StackdriverTracePropagation</code></a> propagation.</p>
</div>
<div class="paragraph">
<p>A propagation is responsible for extracting trace context from an entity (e.g., an HTTP servlet request) and injecting trace context into an entity.
A canonical example of the propagation usage is a web server that receives an HTTP request, which triggers other HTTP requests from the server before returning an HTTP response to the original caller.
In the case of <code>StackdriverTracePropagation</code>, first it looks for trace context in the <code>x-cloud-trace-context</code> key (e.g., an HTTP request header).
The value of the <code>x-cloud-trace-context</code> key can be formatted in three different ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>x-cloud-trace-context: TRACE_ID</code></p>
</li>
<li>
<p><code>x-cloud-trace-context: TRACE_ID/SPAN_ID</code></p>
</li>
<li>
<p><code>x-cloud-trace-context: TRACE_ID/SPAN_ID;o=TRACE_TRUE</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>TRACE_ID</code> is a 32-character hexadecimal value that encodes a 128-bit number.</p>
</div>
<div class="paragraph">
<p><code>SPAN_ID</code> is an unsigned long.
Since Stackdriver Trace doesn’t support span joins, a new span ID is always generated, regardless of the one specified in <code>x-cloud-trace-context</code>.</p>
</div>
<div class="paragraph">
<p><code>TRACE_TRUE</code> can either be <code>0</code> if the entity should be untraced, or <code>1</code> if it should be traced.
This field forces the decision of whether or not to trace the request; if omitted then the decision is deferred to the sampler.</p>
</div>
<div class="paragraph">
<p>If a <code>x-cloud-trace-context</code> key isn’t found, <code>StackdriverTracePropagation</code> falls back to tracing with the <a href="https://github.com/openzipkin/b3-propagation">X-B3 headers</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-starter-for-stackdriver-trace"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-starter-for-stackdriver-trace"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-starter-for-stackdriver-trace">97.2. Spring Boot Starter for Stackdriver Trace</a></h3>
<div class="paragraph">
<p>Spring Boot Starter for Stackdriver Trace uses Spring Cloud Sleuth and auto-configures a <a href="https://github.com/openzipkin/zipkin-gcp/blob/master/sender-stackdriver/src/main/java/zipkin2/reporter/stackdriver/StackdriverSender.java">StackdriverSender</a> that sends the Sleuth’s trace information to Stackdriver Trace.</p>
</div>
<div class="paragraph">
<p>All configurations are optional:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.trace.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Spring Cloud Sleuth to send traces to Stackdriver Trace.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.trace.project-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the project ID from the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.trace.credentials.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the credentials location from the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.trace.credentials.encoded-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the credentials encoded key from the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.trace.credentials.scopes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the credentials scopes from the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.trace.num-executor-threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of threads used by the Trace executor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.trace.authority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP/2 authority the channel claims to be connecting to.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.trace.compression</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the compression to use in Trace calls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.trace.deadline-ms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Call deadline in milliseconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.trace.max-inbound-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum size for inbound messages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.trace.max-outbound-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum size for outbound messages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.trace.wait-for-ready</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/grpc/grpc/blob/master/doc/wait-for-ready.md">Waits for the channel to be ready</a> in case of a transient failure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.trace.messageTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout in seconds before pending spans will be sent in batches to GCP Stackdriver Trace. (previously <code>spring.zipkin.messageTimeout</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can use core Spring Cloud Sleuth properties to control Sleuth’s sampling rate, etc.
Read <a href="https://cloud.spring.io/spring-cloud-sleuth/">Sleuth documentation</a> for more information on Sleuth configurations.</p>
</div>
<div class="paragraph">
<p>For example, when you are testing to see the traces are going through, you can set the sampling rate to 100%.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">spring.sleuth.sampler.probability=1                     <span class="hljs-comment"># Send 100% of the request traces to Stackdriver.</span>
spring.sleuth.web.skipPattern=(^cleanup.*|.+favicon.*)  <span class="hljs-comment"># Ignore some URL paths.</span>
spring.sleuth.scheduled.enabled=<span class="hljs-literal">false</span>                   <span class="hljs-comment"># disable executor 'async' traces</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
By default, Spring Cloud Sleuth auto-configuration instruments executor beans, which may cause recurring traces with the name <code>async</code> to appear in Stackdriver Trace if your application or one of its dependencies introduces scheduler beans into Spring application context. To avoid this noise, please disable automatic instrumentation of executors via <code>spring.sleuth.scheduled.enabled=false</code> in your application configuration.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Spring Cloud GCP Trace does override some Sleuth configurations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Always uses 128-bit Trace IDs.
This is required by Stackdriver Trace.</p>
</li>
<li>
<p>Does not use Span joins.
Span joins will share the span ID between the client and server Spans.
Stackdriver requires that every Span ID within a Trace to be unique, so Span joins are not supported.</p>
</li>
<li>
<p>Uses <code>StackdriverHttpClientParser</code> and <code>StackdriverHttpServerParser</code> by default to populate Stackdriver related fields.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="overriding-the-auto-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#overriding-the-auto-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#overriding-the-auto-configuration">97.3. Overriding the auto-configuration</a></h3>
<div class="paragraph">
<p>Spring Cloud Sleuth supports sending traces to multiple tracing systems as of version 2.1.0.
In order to get this to work, every tracing system needs to have a <code>Reporter&lt;Span&gt;</code> and <code>Sender</code>.
If you want to override the provided beans you need to give them a specific name.
To do this you can use respectively <code>StackdriverTraceAutoConfiguration.REPORTER_BEAN_NAME</code> and <code>StackdriverTraceAutoConfiguration.SENDER_BEAN_NAME</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="customizing-spans"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-spans"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-spans">97.4. Customizing spans</a></h3>
<div class="paragraph">
<p>You can add additional tags and annotations to spans by using the <code>brave.SpanCustomizer</code>, which is available in the application context.</p>
</div>
<div class="paragraph">
<p>Here’s an example that uses <code>WebMvcConfigurer</code> to configure an MVC interceptor that adds two extra tags to all web controller spans.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        SpringApplication.run(Application.class, args);
    }

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> SpanCustomizer spanCustomizer;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> </span>{
        registry.addInterceptor(<span class="hljs-keyword">new</span> HandlerInterceptor() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception </span>{
                spanCustomizer.tag(<span class="hljs-string">"session-id"</span>, request.getSession().getId());
                spanCustomizer.tag(<span class="hljs-string">"environment"</span>, <span class="hljs-string">"QA"</span>);

                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
            }
        });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then search and filter traces based on these additional tags in the Stackdriver Trace service.</p>
</div>
</div>
<div class="sect2">
<h3 id="integration-with-logging"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#integration-with-logging"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#integration-with-logging">97.5. Integration with Logging</a></h3>
<div class="paragraph">
<p>Integration with Stackdriver Logging is available through the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/logging.adoc">Stackdriver Logging Support</a>.
If the Trace integration is used together with the Logging one, the request logs will be associated to the corresponding traces.
The trace logs can be viewed by going to the <a href="https://console.cloud.google.com/traces/traces">Google Cloud Console Trace List</a>, selecting a trace and pressing the <code>Logs → View</code> link in the <code>Details</code> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="sample-5"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-5"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-5">97.6. Sample</a></h3>
<div class="paragraph">
<p>A <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-trace-sample">sample application</a> and a <a href="https://codelabs.developers.google.com/codelabs/cloud-spring-cloud-gcp-trace/index.html">codelab</a> are available.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stackdriver-logging"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stackdriver-logging"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stackdriver-logging">98. Stackdriver Logging</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-logging"</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://cloud.google.com/logging/">Stackdriver Logging</a> is the managed logging service provided by Google Cloud Platform.</p>
</div>
<div class="paragraph">
<p>This module provides support for associating a web request trace ID with the corresponding log entries.
It does so by retrieving the <code>X-B3-TraceId</code> value from the <a href="https://logback.qos.ch/manual/mdc.html">Mapped Diagnostic Context (MDC)</a>, which is set by Spring Cloud Sleuth.
If Spring Cloud Sleuth isn’t used, the configured <code>TraceIdExtractor</code> extracts the desired header value and sets it as the log entry’s trace ID.
This allows grouping of log messages by request, for example, in the <a href="https://console.cloud.google.com/logs/viewer">Google Cloud Console Logs viewer</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Due to the way logging is set up, the GCP project ID and credentials defined in <code>application.properties</code> are ignored.
Instead, you should set the <code>GOOGLE_CLOUD_PROJECT</code> and <code>GOOGLE_APPLICATION_CREDENTIALS</code> environment variables to the project ID and credentials private key location, respectively.
You can do this easily if you’re using the <a href="https://cloud.google.com/sdk">Google Cloud SDK</a>, using the <code>gcloud config set project [YOUR_PROJECT_ID]</code> and <code>gcloud auth application-default login</code> commands, respectively.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="web-mvc-interceptor"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#web-mvc-interceptor"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#web-mvc-interceptor">98.1. Web MVC Interceptor</a></h3>
<div class="paragraph">
<p>For use in Web MVC-based applications, <code>TraceIdLoggingWebMvcInterceptor</code> is provided that extracts the request trace ID from an HTTP request using a <code>TraceIdExtractor</code> and stores it in a thread-local, which can then be used in a logging appender to add the trace ID metadata to log messages.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If Spring Cloud GCP Trace is enabled, the logging module disables itself and delegates log correlation to Spring Cloud Sleuth.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><code>LoggingWebMvcConfigurer</code> configuration class is also provided to help register the <code>TraceIdLoggingWebMvcInterceptor</code> in Spring MVC applications.</p>
</div>
<div class="paragraph">
<p>Applications hosted on the Google Cloud Platform include trace IDs under the <code>x-cloud-trace-context</code> header, which will be included in log entries.
However, if Sleuth is used the trace ID will be picked up from the MDC.</p>
</div>
</div>
<div class="sect2">
<h3 id="logback-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#logback-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#logback-support">98.2. Logback Support</a></h3>
<div class="paragraph">
<p>Currently, only Logback is supported and there are 2 possibilities to log to Stackdriver via this library with Logback: via direct API calls and through JSON-formatted console logs.</p>
</div>
<div class="sect3">
<h4 id="log-via-api"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#log-via-api"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#log-via-api">98.2.1. Log via API</a></h4>
<div class="paragraph">
<p>A Stackdriver appender is available using <code>org/springframework/cloud/gcp/logging/logback-appender.xml</code>.
This appender builds a Stackdriver Logging log entry from a JUL or Logback log entry, adds a trace ID to it and sends it to Stackdriver Logging.</p>
</div>
<div class="paragraph">
<p><code>STACKDRIVER_LOG_NAME</code> and <code>STACKDRIVER_LOG_FLUSH_LEVEL</code> environment variables can be used to customize the <code>STACKDRIVER</code> appender.</p>
</div>
<div class="paragraph">
<p>Your configuration may then look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"org/springframework/cloud/gcp/logging/logback-appender.xml"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"INFO"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"STACKDRIVER"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to have more control over the log output, you can further configure the appender.
The following properties are available:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Stackdriver Log name.
This can also be set via the <code>STACKDRIVER_LOG_NAME</code> environmental variable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>flushLevel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WARN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a log entry with this level is encountered, trigger a flush of locally buffered log to Stackdriver Logging.
This can also be set via the <code>STACKDRIVER_LOG_FLUSH_LEVEL</code> environmental variable.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="log-via-console"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#log-via-console"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#log-via-console">98.2.2. Log via Console</a></h4>
<div class="paragraph">
<p>For Logback, a <code>org/springframework/cloud/gcp/logging/logback-json-appender.xml</code> file is made available for import to make it easier to configure the JSON Logback appender.</p>
</div>
<div class="paragraph">
<p>Your configuration may then look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"org/springframework/cloud/gcp/logging/logback-json-appender.xml"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"INFO"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"CONSOLE_JSON"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If your application is running on Google Kubernetes Engine, Google Compute Engine or Google App Engine Flexible, your console logging is automatically saved to Google Stackdriver Logging.
Therefore, you can just include <code>org/springframework/cloud/gcp/logging/logback-json-appender.xml</code> in your logging configuration, which logs JSON entries to the console.
The trace id will be set correctly.</p>
</div>
<div class="paragraph">
<p>If you want to have more control over the log output, you can further configure the appender.
The following properties are available:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>projectId</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If not set, default value is determined in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>SPRING_CLOUD_GCP_LOGGING_PROJECT_ID</code> Environmental Variable.</p>
</li>
<li>
<p>Value of <code>DefaultGcpProjectIdProvider.getProjectId()</code></p>
</li>
</ol>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This is used to generate fully qualified Stackdriver Trace ID format: <code>projects/[PROJECT-ID]/traces/[TRACE-ID]</code>.</p>
</div>
<div class="paragraph">
<p>This format is required to correlate trace between Stackdriver Trace and Stackdriver Logging.</p>
</div>
<div class="paragraph">
<p>If <code>projectId</code> is not set and cannot be determined, then it’ll log <code>traceId</code> without the fully qualified format.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeTraceId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the <code>traceId</code> be included</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeSpanId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the <code>spanId</code> be included</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeLevel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the severity be included</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeThreadName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the thread name be included</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeMDC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should all MDC properties be included.
The MDC properties <code>X-B3-TraceId</code>, <code>X-B3-SpanId</code> and <code>X-Span-Export</code> provided by Spring Sleuth will get excluded as they get handled separately</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeLoggerName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the name of the logger be included</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeFormattedMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the formatted log message be included.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeExceptionInMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the stacktrace be appended to the formatted log message.
This setting is only evaluated if <code>includeFormattedMessage</code> is <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeContextName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the logging context be included</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the log message with blank placeholders be included</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the stacktrace be included as a own field</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>serviceContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the Stackdriver service context data (service and version). This allows filtering of error reports for service and version in the <a href="https://console.cloud.google.com/errors">Google Cloud Error Reporting View</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>customJson</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines custom json data. Data will be added to the json output.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This is an example of such an Logback configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span> &gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"projectId"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${projectId:-${GOOGLE_CLOUD_PROJECT}}"</span>/&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"CONSOLE_JSON"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.encoder.LayoutWrappingEncoder"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.cloud.gcp.logging.StackdriverJsonLayout"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">projectId</span>&gt;</span>${projectId}<span class="hljs-tag">&lt;/<span class="hljs-name">projectId</span>&gt;</span>

        <span class="hljs-comment">&lt;!--&lt;includeTraceId&gt;true&lt;/includeTraceId&gt;--&gt;</span>
        <span class="hljs-comment">&lt;!--&lt;includeSpanId&gt;true&lt;/includeSpanId&gt;--&gt;</span>
        <span class="hljs-comment">&lt;!--&lt;includeLevel&gt;true&lt;/includeLevel&gt;--&gt;</span>
        <span class="hljs-comment">&lt;!--&lt;includeThreadName&gt;true&lt;/includeThreadName&gt;--&gt;</span>
        <span class="hljs-comment">&lt;!--&lt;includeMDC&gt;true&lt;/includeMDC&gt;--&gt;</span>
        <span class="hljs-comment">&lt;!--&lt;includeLoggerName&gt;true&lt;/includeLoggerName&gt;--&gt;</span>
        <span class="hljs-comment">&lt;!--&lt;includeFormattedMessage&gt;true&lt;/includeFormattedMessage&gt;--&gt;</span>
        <span class="hljs-comment">&lt;!--&lt;includeExceptionInMessage&gt;true&lt;/includeExceptionInMessage&gt;--&gt;</span>
        <span class="hljs-comment">&lt;!--&lt;includeContextName&gt;true&lt;/includeContextName&gt;--&gt;</span>
        <span class="hljs-comment">&lt;!--&lt;includeMessage&gt;false&lt;/includeMessage&gt;--&gt;</span>
        <span class="hljs-comment">&lt;!--&lt;includeException&gt;false&lt;/includeException&gt;--&gt;</span>
        <span class="hljs-comment">&lt;!--&lt;serviceContext&gt;
              &lt;service&gt;service-name&lt;/service&gt;
              &lt;version&gt;service-version&lt;/version&gt;
            &lt;/serviceContext&gt;--&gt;</span>
        <span class="hljs-comment">&lt;!--&lt;customJson&gt;{"custom-key": "custom-value"}&lt;/customJson&gt;--&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sample-6"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-6"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-6">98.3. Sample</a></h3>
<div class="paragraph">
<p>A <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-logging-sample">Sample Spring Boot Application</a> is provided to show how to use the Cloud logging starter.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stackdriver-monitoring"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stackdriver-monitoring"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stackdriver-monitoring">99. Stackdriver Monitoring</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Google Cloud Platform provides a service called <a href="https://cloud.google.com/monitoring/">Stackdriver Monitoring</a>, and <a href="https://micrometer.io/docs/registry/stackdriver">Micrometer</a> can be used with it to easily instrument Spring Boot applications for observability.</p>
</div>
<div class="paragraph">
<p>Spring Boot already provides auto-configuration for Stackdriver.
This module enables auto-detection of the <code>project-id</code> and <code>credentials</code>.
Also, it can be customized.</p>
</div>
<div class="paragraph">
<p>Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-metrics<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-metrics"</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You must enable Stackdriver Monitoring API from the Google Cloud Console in order to capture metrics.
Navigate to the <a href="https://console.cloud.google.com/apis/api/monitoring.googleapis.com/overview">Stackdriver Monitoring API</a> for your project and make sure it’s enabled.</p>
</div>
<div class="paragraph">
<p>Spring Boot Starter for Stackdriver Monitoring uses Micrometer.</p>
</div>
<div class="sect2">
<h3 id="configuration-7"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-7"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-7">99.1. Configuration</a></h3>
<div class="paragraph">
<p>All configurations are optional:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.metrics.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Micrometer to send metrics to Stackdriver Monitoring.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.metrics.project-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the project ID from the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.metrics.credentials.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the credentials location from the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.metrics.credentials.encoded-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the credentials encoded key from the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.metrics.credentials.scopes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the credentials scopes from the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can use core Spring Boot Actuator properties to control reporting frequency, etc.
Read <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#production-ready-metrics-export-stackdriver">Spring Boot Actuator documentation</a> for more information on Stackdriver Actuator configurations.</p>
</div>
</div>
<div class="sect2">
<h3 id="sample-7"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-7"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-7">99.2. Sample</a></h3>
<div class="paragraph">
<p>A <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-metrics-sample">sample application</a> is available.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-data-cloud-spanner"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-data-cloud-spanner"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-data-cloud-spanner">100. Spring Data Cloud Spanner</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://projects.spring.io/spring-data/">Spring Data</a> is an abstraction for storing and retrieving POJOs in numerous storage technologies.
Spring Cloud GCP adds Spring Data support for <a href="https://cloud.google.com/spanner/">Google Cloud Spanner</a>.</p>
</div>
<div class="paragraph">
<p>Maven coordinates for this module only, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-data-spanner<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-data-spanner"</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We provide a <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/spring-cloud-gcp-starters/spring-cloud-gcp-starter-data-spanner">Spring Boot Starter for Spring Data Spanner</a>, with which you can leverage our recommended auto-configuration setup.
To use the starter, see the coordinates see below.</p>
</div>
<div class="paragraph">
<p>Maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-data-spanner<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-data-spanner"</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This setup takes care of bringing in the latest compatible version of Cloud Java Cloud Spanner libraries as well.</p>
</div>
<div class="sect2">
<h3 id="configuration-8"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-8"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-8">100.1. Configuration</a></h3>
<div class="paragraph">
<p>To setup Spring Data Cloud Spanner, you have to configure the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setup the connection details to Google Cloud Spanner.</p>
</li>
<li>
<p>Enable Spring Data Repositories (optional).</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="cloud-spanner-settings"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-spanner-settings"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-spanner-settings">100.1.1. Cloud Spanner settings</a></h4>
<div class="paragraph">
<p>You can the use <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/spring-cloud-gcp-starters/spring-cloud-gcp-starter-data-spanner">Spring Boot Starter for Spring Data Spanner</a> to autoconfigure Google Cloud Spanner in your Spring application.
It contains all the necessary setup that makes it easy to authenticate with your Google Cloud project.
The following configuration options are available:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.instance-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Spanner instance to use</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.database</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Spanner database to use</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.project-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP project ID where the Google Cloud Spanner API is hosted, if different from the one in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.credentials.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth2 credentials for authenticating with the
Google Cloud Spanner API, if different from the ones in the
<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.credentials.encoded-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base64-encoded OAuth2 credentials for authenticating with the
Google Cloud Spanner API, if different from the ones in the
<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.credentials.scopes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developers.google.com/identity/protocols/googlescopes">OAuth2 scope</a> for Spring Cloud GCP
Cloud Spanner credentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.googleapis.com/auth/spanner.data" class="bare">www.googleapis.com/auth/spanner.data</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.createInterleavedTableDdlOnDeleteCascade</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, then schema statements generated by <code>SpannerSchemaUtils</code> for tables with interleaved parent-child relationships will be "ON DELETE CASCADE".
The schema for the tables will be "ON DELETE NO ACTION" if <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.numRpcChannels</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of gRPC channels used to connect to Cloud Spanner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 - Determined by Cloud Spanner client library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.prefetchChunks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of chunks prefetched by Cloud Spanner for read and query</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 - Determined by Cloud Spanner client library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.minSessions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum number of sessions maintained in the session pool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 - Determined by Cloud Spanner client library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.maxSessions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of sessions session pool can have</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">400 - Determined by Cloud Spanner client library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.maxIdleSessions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of idle sessions session pool will maintain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 - Determined by Cloud Spanner client library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.writeSessionsFraction</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fraction of sessions to be kept prepared for write transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2 - Determined by Cloud Spanner client library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.keepAliveIntervalMinutes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How long to keep idle sessions alive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30 - Determined by Cloud Spanner client library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.failIfPoolExhausted</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If all sessions are in use, fail the request by throwing an exception. Otherwise, by default, block until a session becomes available.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.emulator.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the usage of an emulator. If this is set to true, then you should set the <code>spring.cloud.gcp.spanner.emulator-host</code> to the host:port of your locally running emulator instance.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.spanner.emulator-host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host and port of the Spanner emulator; can be overridden to specify connecting to an already-running <a href="https://cloud.google.com/spanner/docs/emulator#installing_and_running_the_emulator">Spanner emulator</a> instance.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localhost:9010</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="repository-settings"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#repository-settings"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#repository-settings">100.1.2. Repository settings</a></h4>
<div class="paragraph">
<p>Spring Data Repositories can be configured via the <code>@EnableSpannerRepositories</code> annotation on your main <code>@Configuration</code> class.
With our Spring Boot Starter for Spring Data Cloud Spanner, <code>@EnableSpannerRepositories</code> is automatically added.
It is not required to add it to any other class, unless there is a need to override finer grain configuration parameters provided by <a href="https://github.com/spring-cloud/spring-cloud-gcp/blob/master/spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/config/EnableSpannerRepositories.java"><code>@EnableSpannerRepositories</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="autoconfiguration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#autoconfiguration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#autoconfiguration">100.1.3. Autoconfiguration</a></h4>
<div class="paragraph">
<p>Our Spring Boot autoconfiguration creates the following beans available in the Spring application context:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <code>SpannerTemplate</code></p>
</li>
<li>
<p>an instance of <code>SpannerDatabaseAdminTemplate</code> for generating table schemas from object hierarchies and creating and deleting tables and databases</p>
</li>
<li>
<p>an instance of all user-defined repositories extending <code>SpannerRepository</code>, <code>CrudRepository</code>, <code>PagingAndSortingRepository</code>, when repositories are enabled</p>
</li>
<li>
<p>an instance of <code>DatabaseClient</code> from the Google Cloud Java Client for Spanner, for convenience and lower level API access</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="object-mapping"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#object-mapping"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#object-mapping">100.2. Object Mapping</a></h3>
<div class="paragraph">
<p>Spring Data Cloud Spanner allows you to map domain POJOs to Cloud Spanner tables via annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"traders"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Trader</span> </span>{

    <span class="hljs-meta">@PrimaryKey</span>
    <span class="hljs-meta">@Column</span>(name = <span class="hljs-string">"trader_id"</span>)
    String traderId;

    String firstName;

    String lastName;

    <span class="hljs-meta">@NotMapped</span>
    Double temporaryNumber;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Data Cloud Spanner will ignore any property annotated with <code>@NotMapped</code>.
These properties will not be written to or read from Spanner.</p>
</div>
<div class="sect3">
<h4 id="constructors"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#constructors"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#constructors">100.2.1. Constructors</a></h4>
<div class="paragraph">
<p>Simple constructors are supported on POJOs.
The constructor arguments can be a subset of the persistent properties.
Every constructor argument needs to have the same name and type as a persistent property on the entity and the constructor should set the property from the given argument.
Arguments that are not directly set to properties are not supported.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"traders"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Trader</span> </span>{
    <span class="hljs-meta">@PrimaryKey</span>
    <span class="hljs-meta">@Column</span>(name = <span class="hljs-string">"trader_id"</span>)
    String traderId;

    String firstName;

    String lastName;

    <span class="hljs-meta">@NotMapped</span>
    Double temporaryNumber;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Trader</span><span class="hljs-params">(String traderId, String firstName)</span> </span>{
        <span class="hljs-keyword">this</span>.traderId = traderId;
        <span class="hljs-keyword">this</span>.firstName = firstName;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="table"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#table"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#table">100.2.2. Table</a></h4>
<div class="paragraph">
<p>The <code>@Table</code> annotation can provide the name of the Cloud Spanner table that stores instances of the annotated class, one per row.
This annotation is optional, and if not given, the name of the table is inferred from the class name with the first character uncapitalized.</p>
</div>
<div class="sect4">
<h5 id="spel-expressions-for-table-names"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spel-expressions-for-table-names"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spel-expressions-for-table-names">SpEL expressions for table names</a></h5>
<div class="paragraph">
<p>In some cases, you might want the <code>@Table</code> table name to be determined dynamically.
To do that, you can use <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#expressions">Spring Expression Language</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"trades_#{tableNameSuffix}"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Trade</span> </span>{
    <span class="hljs-comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The table name will be resolved only if the <code>tableNameSuffix</code> value/bean in the Spring application context is defined.
For example, if <code>tableNameSuffix</code> has the value "123", the table name will resolve to <code>trades_123</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="primary-keys"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#primary-keys"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#primary-keys">100.2.3. Primary Keys</a></h4>
<div class="paragraph">
<p>For a simple table, you may only have a primary key consisting of a single column.
Even in that case, the <code>@PrimaryKey</code> annotation is required.
<code>@PrimaryKey</code> identifies the one or more ID properties corresponding to the primary key.</p>
</div>
<div class="paragraph">
<p>Spanner has first class support for composite primary keys of multiple columns.
You have to annotate all of your POJO’s fields that the primary key consists of with <code>@PrimaryKey</code> as below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"trades"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Trade</span> </span>{
    <span class="hljs-meta">@PrimaryKey</span>(keyOrder = <span class="hljs-number">2</span>)
    <span class="hljs-meta">@Column</span>(name = <span class="hljs-string">"trade_id"</span>)
    <span class="hljs-keyword">private</span> String tradeId;

    <span class="hljs-meta">@PrimaryKey</span>(keyOrder = <span class="hljs-number">1</span>)
    <span class="hljs-meta">@Column</span>(name = <span class="hljs-string">"trader_id"</span>)
    <span class="hljs-keyword">private</span> String traderId;

    <span class="hljs-keyword">private</span> String action;

    <span class="hljs-keyword">private</span> BigDecimal price;

    <span class="hljs-keyword">private</span> Double shares;

    <span class="hljs-keyword">private</span> String symbol;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>keyOrder</code> parameter of <code>@PrimaryKey</code> identifies the properties corresponding to the primary key columns in order, starting with 1 and increasing consecutively.
Order is important and must reflect the order defined in the Cloud Spanner schema.
In our example the DDL to create the table and its primary key is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> trades (
    trader_id <span class="hljs-keyword">STRING</span>(<span class="hljs-keyword">MAX</span>),
    trade_id <span class="hljs-keyword">STRING</span>(<span class="hljs-keyword">MAX</span>),
    <span class="hljs-keyword">action</span> <span class="hljs-keyword">STRING</span>(<span class="hljs-number">15</span>),
    symbol <span class="hljs-keyword">STRING</span>(<span class="hljs-number">10</span>),
    price <span class="hljs-built_in">NUMERIC</span>,
    shares FLOAT64
) PRIMARY <span class="hljs-keyword">KEY</span> (trader_id, trade_id)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spanner does not have automatic ID generation.
For most use-cases, sequential IDs should be used with caution to avoid creating data hotspots in the system.
Read <a href="https://cloud.google.com/spanner/docs/schema-and-data-model#primary_keys">Spanner Primary Keys documentation</a> for a better understanding of primary keys and recommended practices.</p>
</div>
</div>
<div class="sect3">
<h4 id="columns"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#columns"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#columns">100.2.4. Columns</a></h4>
<div class="paragraph">
<p>All accessible properties on POJOs are automatically recognized as a Cloud Spanner column.
Column naming is generated by the <code>PropertyNameFieldNamingStrategy</code> by default defined on the <code>SpannerMappingContext</code> bean.
The <code>@Column</code> annotation optionally provides a different column name than that of the property and some other settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> is the optional name of the column</p>
</li>
<li>
<p><code>spannerTypeMaxLength</code> specifies for <code>STRING</code> and <code>BYTES</code> columns the maximum length.
This setting is only used when generating DDL schema statements based on domain types.</p>
</li>
<li>
<p><code>nullable</code> specifies if the column is created as <code>NOT NULL</code>.
This setting is only used when generating DDL schema statements based on domain types.</p>
</li>
<li>
<p><code>spannerType</code> is the Cloud Spanner column type you can optionally specify.
If this is not specified then a compatible column type is inferred from the Java property type.</p>
</li>
<li>
<p><code>spannerCommitTimestamp</code> is a boolean specifying if this property corresponds to an auto-populated commit timestamp column.
Any value set in this property will be ignored when writing to Cloud Spanner.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="embedded-objects"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#embedded-objects"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#embedded-objects">100.2.5. Embedded Objects</a></h4>
<div class="paragraph">
<p>If an object of type <code>B</code> is embedded as a property of <code>A</code>, then the columns of <code>B</code> will be saved in the same Cloud Spanner table as those of <code>A</code>.</p>
</div>
<div class="paragraph">
<p>If <code>B</code> has primary key columns, those columns will be included in the primary key of <code>A</code>. <code>B</code> can also have embedded properties.
Embedding allows reuse of columns between multiple entities, and can be useful for implementing parent-child situations, because Cloud Spanner requires child tables to include the key columns of their parents.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">X</span> </span>{
  <span class="hljs-meta">@PrimaryKey</span>
  String grandParentId;

  <span class="hljs-keyword">long</span> age;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>{
  <span class="hljs-meta">@PrimaryKey</span>
  <span class="hljs-meta">@Embedded</span>
  X grandParent;

  <span class="hljs-meta">@PrimaryKey</span>(keyOrder = <span class="hljs-number">2</span>)
  String parentId;

  String value;
}

<span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"items"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>{
  <span class="hljs-meta">@PrimaryKey</span>
  <span class="hljs-meta">@Embedded</span>
  A parent;

  <span class="hljs-meta">@PrimaryKey</span>(keyOrder = <span class="hljs-number">2</span>)
  String id;

  <span class="hljs-meta">@Column</span>(name = <span class="hljs-string">"child_value"</span>)
  String value;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Entities of <code>B</code> can be stored in a table defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> items (
    grandParentId <span class="hljs-keyword">STRING</span>(<span class="hljs-keyword">MAX</span>),
    parentId <span class="hljs-keyword">STRING</span>(<span class="hljs-keyword">MAX</span>),
    <span class="hljs-keyword">id</span> <span class="hljs-keyword">STRING</span>(<span class="hljs-keyword">MAX</span>),
    <span class="hljs-keyword">value</span> <span class="hljs-keyword">STRING</span>(<span class="hljs-keyword">MAX</span>),
    child_value <span class="hljs-keyword">STRING</span>(<span class="hljs-keyword">MAX</span>),
    age INT64
) PRIMARY <span class="hljs-keyword">KEY</span> (grandParentId, parentId, <span class="hljs-keyword">id</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that embedded properties' column names must all be unique.</p>
</div>
</div>
<div class="sect3">
<h4 id="relationships"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#relationships"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#relationships">100.2.6. Relationships</a></h4>
<div class="paragraph">
<p>Spring Data Cloud Spanner supports parent-child relationships using the Cloud Spanner <a href="https://cloud.google.com/spanner/docs/schema-and-data-model#creating-interleaved-tables">parent-child interleaved table mechanism</a>.
Cloud Spanner interleaved tables enforce the one-to-many relationship and provide efficient queries and operations on entities of a single domain parent entity.
These relationships can be up to 7 levels deep.
Cloud Spanner also provides automatic cascading delete or enforces the deletion of child entities before parents.</p>
</div>
<div class="paragraph">
<p>While one-to-one and many-to-many relationships can be implemented in Cloud Spanner and Spring Data Cloud Spanner using constructs of interleaved parent-child tables, only the parent-child relationship is natively supported.
Cloud Spanner does not support the foreign key constraint, though the parent-child key constraint enforces a similar requirement when used with interleaved tables.</p>
</div>
<div class="paragraph">
<p>For example, the following Java entities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"Singers"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Singer</span> </span>{
  <span class="hljs-meta">@PrimaryKey</span>
  <span class="hljs-keyword">long</span> SingerId;

  String FirstName;

  String LastName;

  <span class="hljs-keyword">byte</span>[] SingerInfo;

  <span class="hljs-meta">@Interleaved</span>
  List&lt;Album&gt; albums;
}

<span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"Albums"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Album</span> </span>{
  <span class="hljs-meta">@PrimaryKey</span>
  <span class="hljs-keyword">long</span> SingerId;

  <span class="hljs-meta">@PrimaryKey</span>(keyOrder = <span class="hljs-number">2</span>)
  <span class="hljs-keyword">long</span> AlbumId;

  String AlbumTitle;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These classes can correspond to an existing pair of interleaved tables.
The <code>@Interleaved</code> annotation may be applied to <code>Collection</code> properties and the inner type is resolved as the child entity type.
The schema needed to create them can also be generated using the <code>SpannerSchemaUtils</code> and run by using the <code>SpannerDatabaseAdminTemplate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
SpannerSchemaUtils schemaUtils;

<span class="hljs-meta">@Autowired</span>
SpannerDatabaseAdminTemplate databaseAdmin;
...

<span class="hljs-comment">// Get the create statmenets for all tables in the table structure rooted at Singer</span>
List&lt;String&gt; createStrings = <span class="hljs-keyword">this</span>.schemaUtils.getCreateTableDdlStringsForInterleavedHierarchy(Singer.class);

<span class="hljs-comment">// Create the tables and also create the database if necessary</span>
<span class="hljs-keyword">this</span>.databaseAdmin.executeDdlStrings(createStrings, <span class="hljs-keyword">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>createStrings</code> list contains table schema statements using column names and types compatible with the provided Java type and any resolved child relationship types contained within based on the configured custom converters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Singers (
  SingerId   INT64 <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  FirstName  <span class="hljs-keyword">STRING</span>(<span class="hljs-number">1024</span>),
  LastName   <span class="hljs-keyword">STRING</span>(<span class="hljs-number">1024</span>),
  SingerInfo <span class="hljs-keyword">BYTES</span>(<span class="hljs-keyword">MAX</span>),
) PRIMARY <span class="hljs-keyword">KEY</span> (SingerId);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Albums (
  SingerId     INT64 <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  AlbumId      INT64 <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  AlbumTitle   <span class="hljs-keyword">STRING</span>(<span class="hljs-keyword">MAX</span>),
) PRIMARY <span class="hljs-keyword">KEY</span> (SingerId, AlbumId),
  INTERLEAVE <span class="hljs-keyword">IN</span> <span class="hljs-keyword">PARENT</span> Singers <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">CASCADE</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ON DELETE CASCADE</code> clause indicates that Cloud Spanner will delete all Albums of a singer if the Singer is deleted.
The alternative is <code>ON DELETE NO ACTION</code>, where a Singer cannot be deleted until all of its Albums have already been deleted.
When using <code>SpannerSchemaUtils</code> to generate the schema strings, the <code>spring.cloud.gcp.spanner.createInterleavedTableDdlOnDeleteCascade</code> boolean setting determines if these schema are generated as <code>ON DELETE CASCADE</code> for <code>true</code> and <code>ON DELETE NO ACTION</code> for <code>false</code>.</p>
</div>
<div class="paragraph">
<p>Cloud Spanner restricts these relationships to 7 child layers.
A table may have multiple child tables.</p>
</div>
<div class="paragraph">
<p>On updating or inserting an object to Cloud Spanner, all of its referenced children objects are also updated or inserted in the same request, respectively.
On read, all of the interleaved child rows are also all read.</p>
</div>
<div class="sect4">
<h5 id="lazy-fetch"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#lazy-fetch"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#lazy-fetch">Lazy Fetch</a></h5>
<div class="paragraph">
<p><code>@Interleaved</code> properties are retrieved eagerly by default, but can be fetched lazily for performance in both read and write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Interleaved</span>(lazy = <span class="hljs-keyword">true</span>)
List&lt;Album&gt; albums;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lazily-fetched interleaved properties are retrieved upon the first interaction with the property.
If a property marked for lazy fetching is never retrieved, then it is also skipped when saving the parent entity.</p>
</div>
<div class="paragraph">
<p>If used inside a transaction, subsequent operations on lazily-fetched properties use the same transaction context as that of the original parent entity.</p>
</div>
</div>
<div class="sect4">
<h5 id="declarative-filtering-with-where"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#declarative-filtering-with-where"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#declarative-filtering-with-where">Declarative Filtering with <code>@Where</code></a></h5>
<div class="paragraph">
<p>The <code>@Where</code> annotation could be applied to an entity class or to an interleaved property.
This annotation provides an SQL where clause that will be applied at the fetching of interleaved collections or the entity itself.</p>
</div>
<div class="paragraph">
<p>Let’s say we have an <code>Agreement</code> with a list of <code>Participants</code> which could be assigned to it.
We would like to fetch a list of currently active participants.
For security reasons, all records should remain in the database forever, even if participants become inactive.
That can be easily achieved with the <code>@Where</code> annotation, which is demonstrated by this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"participants"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Participant</span> </span>{
  <span class="hljs-comment">//...</span>
  <span class="hljs-keyword">boolean</span> active;
  <span class="hljs-comment">//...</span>
}

<span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"agreements"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Agreement</span> </span>{
  <span class="hljs-comment">//...</span>
  <span class="hljs-meta">@Interleaved</span>
  <span class="hljs-meta">@Where</span>(<span class="hljs-string">"active = true"</span>)
  List&lt;Participant&gt; participants;
  Person person;
  <span class="hljs-comment">//...</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="supported-types"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#supported-types"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#supported-types">100.2.7. Supported Types</a></h4>
<div class="paragraph">
<p>Spring Data Cloud Spanner natively supports the following types for regular fields but also utilizes custom converters (detailed in following sections) and dozens of pre-defined Spring Data custom converters to handle other common Java types.</p>
</div>
<div class="paragraph">
<p>Natively supported types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>com.google.cloud.ByteArray</code></p>
</li>
<li>
<p><code>com.google.cloud.Date</code></p>
</li>
<li>
<p><code>com.google.cloud.Timestamp</code></p>
</li>
<li>
<p><code>java.lang.Boolean</code>, <code>boolean</code></p>
</li>
<li>
<p><code>java.lang.Double</code>, <code>double</code></p>
</li>
<li>
<p><code>java.lang.Long</code>, <code>long</code></p>
</li>
<li>
<p><code>java.lang.Integer</code>, <code>int</code></p>
</li>
<li>
<p><code>java.lang.String</code></p>
</li>
<li>
<p><code>double[]</code></p>
</li>
<li>
<p><code>long[]</code></p>
</li>
<li>
<p><code>boolean[]</code></p>
</li>
<li>
<p><code>java.util.Date</code></p>
</li>
<li>
<p><code>java.time.Instant</code></p>
</li>
<li>
<p><code>java.sql.Date</code></p>
</li>
<li>
<p><code>java.time.LocalDate</code></p>
</li>
<li>
<p><code>java.time.LocalDateTime</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="lists"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#lists"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#lists">100.2.8. Lists</a></h4>
<div class="paragraph">
<p>Spanner supports <code>ARRAY</code> types for columns.
<code>ARRAY</code> columns are mapped to <code>List</code> fields in POJOS.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Double&gt; curve;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The types inside the lists can be any singular property type.</p>
</div>
</div>
<div class="sect3">
<h4 id="lists-of-structs"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#lists-of-structs"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#lists-of-structs">100.2.9. Lists of Structs</a></h4>
<div class="paragraph">
<p>Cloud Spanner queries can <a href="https://cloud.google.com/spanner/docs/query-syntax#using-structs-with-select">construct STRUCT values</a> that appear as columns in the result.
Cloud Spanner requires STRUCT values appear in ARRAYs at the root level: <code>SELECT ARRAY(SELECT STRUCT(1 as val1, 2 as val2)) as pair FROM Users</code>.</p>
</div>
<div class="paragraph">
<p>Spring Data Cloud Spanner will attempt to read the column STRUCT values into a property that is an <code>Iterable</code> of an entity type compatible with the schema of the column STRUCT value.</p>
</div>
<div class="paragraph">
<p>For the previous array-select example, the following property can be mapped with the constructed <code>ARRAY&lt;STRUCT&gt;</code> column: <code>List&lt;TwoInts&gt; pair;</code> where the <code>TwoInts</code> type is defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TwoInts</span> </span>{

  <span class="hljs-keyword">int</span> val1;

  <span class="hljs-keyword">int</span> val2;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="custom-types"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-types"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-types">100.2.10. Custom types</a></h4>
<div class="paragraph">
<p>Custom converters can be used to extend the type support for user defined types.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Converters need to implement the <code>org.springframework.core.convert.converter.Converter</code> interface in both directions.</p>
</li>
<li>
<p>The user defined type needs to be mapped to one of the basic types supported by Spanner:</p>
<div class="ulist">
<ul>
<li>
<p><code>com.google.cloud.ByteArray</code></p>
</li>
<li>
<p><code>com.google.cloud.Date</code></p>
</li>
<li>
<p><code>com.google.cloud.Timestamp</code></p>
</li>
<li>
<p><code>java.lang.Boolean</code>, <code>boolean</code></p>
</li>
<li>
<p><code>java.lang.Double</code>, <code>double</code></p>
</li>
<li>
<p><code>java.lang.Long</code>, <code>long</code></p>
</li>
<li>
<p><code>java.lang.String</code></p>
</li>
<li>
<p><code>double[]</code></p>
</li>
<li>
<p><code>long[]</code></p>
</li>
<li>
<p><code>boolean[]</code></p>
</li>
<li>
<p><code>enum</code> types</p>
</li>
</ul>
</div>
</li>
<li>
<p>An instance of both Converters needs to be passed to a <code>ConverterAwareMappingSpannerEntityProcessor</code>, which then has to be made available as a <code>@Bean</code> for <code>SpannerEntityProcessor</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p>We would like to have a field of type <code>Person</code> on our <code>Trade</code> POJO:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"trades"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Trade</span> </span>{
  <span class="hljs-comment">//...</span>
  Person person;
  <span class="hljs-comment">//...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where Person is a simple class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{

  <span class="hljs-keyword">public</span> String firstName;
  <span class="hljs-keyword">public</span> String lastName;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have to define the two converters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonWriteConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Converter</span>&lt;<span class="hljs-title">Person</span>, <span class="hljs-title">String</span>&gt; </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">convert</span><span class="hljs-params">(Person person)</span> </span>{
      <span class="hljs-keyword">return</span> person.firstName + <span class="hljs-string">" "</span> + person.lastName;
    }
  }

  <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonReadConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Converter</span>&lt;<span class="hljs-title">String</span>, <span class="hljs-title">Person</span>&gt; </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Person <span class="hljs-title">convert</span><span class="hljs-params">(String s)</span> </span>{
      Person person = <span class="hljs-keyword">new</span> Person();
      person.firstName = s.split(<span class="hljs-string">" "</span>)[<span class="hljs-number">0</span>];
      person.lastName = s.split(<span class="hljs-string">" "</span>)[<span class="hljs-number">1</span>];
      <span class="hljs-keyword">return</span> person;
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>That will be configured in our <code>@Configuration</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConverterConfiguration</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> SpannerEntityProcessor <span class="hljs-title">spannerEntityProcessor</span><span class="hljs-params">(SpannerMappingContext spannerMappingContext)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ConverterAwareMappingSpannerEntityProcessor(spannerMappingContext,
                Arrays.asList(<span class="hljs-keyword">new</span> PersonWriteConverter()),
                Arrays.asList(<span class="hljs-keyword">new</span> PersonReadConverter()));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="custom-converter-for-struct-array-columns"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-converter-for-struct-array-columns"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-converter-for-struct-array-columns">100.2.11. Custom Converter for Struct Array Columns</a></h4>
<div class="paragraph">
<p>If a <code>Converter&lt;Struct, A&gt;</code> is provided, then properties of type <code>List&lt;A&gt;</code> can be used in your entity types.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spanner-operations-template"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spanner-operations-template"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spanner-operations-template">100.3. Spanner Operations &amp; Template</a></h3>
<div class="paragraph">
<p><code>SpannerOperations</code> and its implementation, <code>SpannerTemplate</code>, provides the Template pattern familiar to Spring developers.
It provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resource management</p>
</li>
<li>
<p>One-stop-shop to Spanner operations with the Spring Data POJO mapping and conversion features</p>
</li>
<li>
<p>Exception conversion</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the <code>autoconfigure</code> provided by our Spring Boot Starter for Spanner, your Spring application context will contain a fully configured <code>SpannerTemplate</code> object that you can easily autowire in your application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpannerTemplateExample</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    SpannerTemplate spannerTemplate;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.spannerTemplate.delete(Trade.class, KeySet.all());
        <span class="hljs-comment">//...</span>
        Trade t = <span class="hljs-keyword">new</span> Trade();
        <span class="hljs-comment">//...</span>
        <span class="hljs-keyword">this</span>.spannerTemplate.insert(t);
        <span class="hljs-comment">//...</span>
        List&lt;Trade&gt; tradesByAction = spannerTemplate.findAll(Trade.class);
        <span class="hljs-comment">//...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Template API provides convenience methods for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://cloud.google.com/spanner/docs/reads">Reads</a>, and by providing SpannerReadOptions and
SpannerQueryOptions</p>
<div class="ulist">
<ul>
<li>
<p>Stale read</p>
</li>
<li>
<p>Read with secondary indices</p>
</li>
<li>
<p>Read with limits and offsets</p>
</li>
<li>
<p>Read with sorting</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://cloud.google.com/spanner/docs/reads#execute_a_query">Queries</a></p>
</li>
<li>
<p>DML operations (delete, insert, update, upsert)</p>
</li>
<li>
<p>Partial reads</p>
<div class="ulist">
<ul>
<li>
<p>You can define a set of columns to be read into your entity</p>
</li>
</ul>
</div>
</li>
<li>
<p>Partial writes</p>
<div class="ulist">
<ul>
<li>
<p>Persist only a few properties from your entity</p>
</li>
</ul>
</div>
</li>
<li>
<p>Read-only transactions</p>
</li>
<li>
<p>Locking read-write transactions</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="sql-query"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sql-query"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sql-query">100.3.1. SQL Query</a></h4>
<div class="paragraph">
<p>Cloud Spanner has SQL support for running read-only queries.
All the query related methods start with <code>query</code> on <code>SpannerTemplate</code>.
By using <code>SpannerTemplate</code>, you can run SQL queries that map to POJOs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Trade&gt; trades = <span class="hljs-keyword">this</span>.spannerTemplate.query(Trade.class, Statement.of(<span class="hljs-string">"SELECT * FROM trades"</span>));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="read"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#read"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#read">100.3.2. Read</a></h4>
<div class="paragraph">
<p>Spanner exposes a <a href="https://cloud.google.com/spanner/docs/reads">Read API</a> for reading single row or multiple rows in a table or in a secondary index.</p>
</div>
<div class="paragraph">
<p>Using <code>SpannerTemplate</code> you can run reads, as the following example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Trade&gt; trades = <span class="hljs-keyword">this</span>.spannerTemplate.readAll(Trade.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Main benefit of reads over queries is reading multiple rows of a certain pattern of keys is much easier using the features of the <a href="https://github.com/GoogleCloudPlatform/google-cloud-java/blob/master/google-cloud-spanner/src/main/java/com/google/cloud/spanner/KeySet.java"><code>KeySet</code></a> class.</p>
</div>
</div>
<div class="sect3">
<h4 id="advanced-reads"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#advanced-reads"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#advanced-reads">100.3.3. Advanced reads</a></h4>
<div class="sect4">
<h5 id="stale-read"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stale-read"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stale-read">Stale read</a></h5>
<div class="paragraph">
<p>All reads and queries are <strong>strong reads</strong> by default.
A <strong>strong read</strong> is a read at a current time and is guaranteed to see all data that has been committed up until the start of this read.
An <strong>exact staleness read</strong> is read at a timestamp in the past.
Cloud Spanner allows you to determine how current the data should be when you read data.
With <code>SpannerTemplate</code> you can specify the <code>Timestamp</code> by setting it on <code>SpannerQueryOptions</code> or <code>SpannerReadOptions</code> to the appropriate read or query methods:</p>
</div>
<div class="paragraph">
<p>Reads:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// a read with options:</span>
SpannerReadOptions spannerReadOptions = <span class="hljs-keyword">new</span> SpannerReadOptions().setTimestamp(myTimestamp);
List&lt;Trade&gt; trades = <span class="hljs-keyword">this</span>.spannerTemplate.readAll(Trade.class, spannerReadOptions);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// a query with options:</span>
SpannerQueryOptions spannerQueryOptions = <span class="hljs-keyword">new</span> SpannerQueryOptions().setTimestamp(myTimestamp);
List&lt;Trade&gt; trades = <span class="hljs-keyword">this</span>.spannerTemplate.query(Trade.class, Statement.of(<span class="hljs-string">"SELECT * FROM trades"</span>), spannerQueryOptions);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also read with <a href="https://cloud.google.com/spanner/docs/timestamp-bounds"><strong>bounded staleness</strong></a> by setting <code>.setTimestampBound(TimestampBound.ofMinReadTimestamp(myTimestamp))</code> on the query and read options objects.
Bounded staleness lets Cloud Spanner choose any point in time later than or equal to the given timestampBound, but it cannot be used inside transactions.</p>
</div>
</div>
<div class="sect4">
<h5 id="read-from-a-secondary-index"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#read-from-a-secondary-index"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#read-from-a-secondary-index">Read from a secondary index</a></h5>
<div class="paragraph">
<p>Using a <a href="https://cloud.google.com/spanner/docs/secondary-indexes">secondary index</a> is available for Reads via the Template API and it is also implicitly available via SQL for Queries.</p>
</div>
<div class="paragraph">
<p>The following shows how to read rows from a table using a <a href="https://cloud.google.com/spanner/docs/secondary-indexes">secondary index</a> simply by setting <code>index</code> on <code>SpannerReadOptions</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">SpannerReadOptions spannerReadOptions = <span class="hljs-keyword">new</span> SpannerReadOptions().setIndex(<span class="hljs-string">"TradesByTrader"</span>);
List&lt;Trade&gt; trades = <span class="hljs-keyword">this</span>.spannerTemplate.readAll(Trade.class, spannerReadOptions);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="read-with-offsets-and-limits"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#read-with-offsets-and-limits"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#read-with-offsets-and-limits">Read with offsets and limits</a></h5>
<div class="paragraph">
<p>Limits and offsets are only supported by Queries.
The following will get only the first two rows of the query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">SpannerQueryOptions spannerQueryOptions = <span class="hljs-keyword">new</span> SpannerQueryOptions().setLimit(<span class="hljs-number">2</span>).setOffset(<span class="hljs-number">3</span>);
List&lt;Trade&gt; trades = <span class="hljs-keyword">this</span>.spannerTemplate.query(Trade.class, Statement.of(<span class="hljs-string">"SELECT * FROM trades"</span>), spannerQueryOptions);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the above is equivalent of running <code>SELECT * FROM trades LIMIT 2 OFFSET 3</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sorting"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sorting"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sorting">Sorting</a></h5>
<div class="paragraph">
<p>Reads by keys do not support sorting.
However, queries on the Template API support sorting through standard SQL and also via Spring Data Sort API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Trade&gt; trades = <span class="hljs-keyword">this</span>.spannerTemplate.queryAll(Trade.class, Sort.by(<span class="hljs-string">"action"</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the provided sorted field name is that of a property of the domain type, then the column name corresponding to that property will be used in the query.
Otherwise, the given field name is assumed to be the name of the column in the Cloud Spanner table.
Sorting on columns of Cloud Spanner types STRING and BYTES can be done while ignoring case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Sort.by(Order.desc(<span class="hljs-string">"action"</span>).ignoreCase())</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="partial-read"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#partial-read"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#partial-read">Partial read</a></h5>
<div class="paragraph">
<p>Partial read is only possible when using Queries.
In case the rows returned by the query have fewer columns than the entity that it will be mapped to, Spring Data will map the returned columns only.
This setting also applies to nested structs and their corresponding nested POJO properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Trade&gt; trades = <span class="hljs-keyword">this</span>.spannerTemplate.query(Trade.class, Statement.of(<span class="hljs-string">"SELECT action, symbol FROM trades"</span>),
    <span class="hljs-keyword">new</span> SpannerQueryOptions().setAllowMissingResultSetColumns(<span class="hljs-keyword">true</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the setting is set to <code>false</code>, then an exception will be thrown if there are missing columns in the query result.</p>
</div>
</div>
<div class="sect4">
<h5 id="summary-of-options-for-query-vs-read"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#summary-of-options-for-query-vs-read"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#summary-of-options-for-query-vs-read">Summary of options for Query vs Read</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query supports it</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read supports it</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Partial read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Limits</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Offsets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secondary index</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read using index range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorting</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="write-update"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#write-update"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#write-update">100.3.4. Write / Update</a></h4>
<div class="paragraph">
<p>The write methods of <code>SpannerOperations</code> accept a POJO and writes all of its properties to Spanner.
The corresponding Spanner table and entity metadata is obtained from the given object’s actual type.</p>
</div>
<div class="paragraph">
<p>If a POJO was retrieved from Spanner and its primary key properties values were changed and then written or updated, the operation will occur as if against a row with the new primary key values.
The row with the original primary key values will not be affected.</p>
</div>
<div class="sect4">
<h5 id="insert"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#insert"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#insert">Insert</a></h5>
<div class="paragraph">
<p>The <code>insert</code> method of <code>SpannerOperations</code> accepts a POJO and writes all of its properties to Spanner, which means the operation will fail if a row with the POJO’s primary key already exists in the table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Trade t = <span class="hljs-keyword">new</span> Trade();
<span class="hljs-keyword">this</span>.spannerTemplate.insert(t);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="update"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#update"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#update">Update</a></h5>
<div class="paragraph">
<p>The <code>update</code> method of <code>SpannerOperations</code> accepts a POJO and writes all of its properties to Spanner, which means the operation will fail if the POJO’s primary key does not already exist in the table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// t was retrieved from a previous operation</span>
<span class="hljs-keyword">this</span>.spannerTemplate.update(t);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="upsert"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#upsert"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#upsert">Upsert</a></h5>
<div class="paragraph">
<p>The <code>upsert</code> method of <code>SpannerOperations</code> accepts a POJO and writes all of its properties to Spanner using update-or-insert.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// t was retrieved from a previous operation or it's new</span>
<span class="hljs-keyword">this</span>.spannerTemplate.upsert(t);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="partial-update"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#partial-update"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#partial-update">Partial Update</a></h5>
<div class="paragraph">
<p>The update methods of <code>SpannerOperations</code> operate by default on all properties within the given object, but also accept <code>String[]</code> and <code>Optional&lt;Set&lt;String&gt;&gt;</code> of column names.
If the <code>Optional</code> of set of column names is empty, then all columns are written to Spanner.
However, if the Optional is occupied by an empty set, then no columns will be written.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// t was retrieved from a previous operation or it's new</span>
<span class="hljs-keyword">this</span>.spannerTemplate.update(t, <span class="hljs-string">"symbol"</span>, <span class="hljs-string">"action"</span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dml"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dml"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dml">100.3.5. DML</a></h4>
<div class="paragraph">
<p>DML statements can be run by using <code>SpannerOperations.executeDmlStatement</code>.
Inserts, updates, and deletions can affect any number of rows and entities.</p>
</div>
<div class="paragraph">
<p>You can run <a href="https://cloud.google.com/spanner/docs/dml-partitioned">partitioned DML</a> updates by using the <code>executePartitionedDmlStatement</code> method.
Partitioned DML queries have performance benefits but also have restrictions and cannot be used inside transactions.</p>
</div>
</div>
<div class="sect3">
<h4 id="transactions"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#transactions"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#transactions">100.3.6. Transactions</a></h4>
<div class="paragraph">
<p><code>SpannerOperations</code> provides methods to run <code>java.util.Function</code> objects within a single transaction while making available the read and write methods from <code>SpannerOperations</code>.</p>
</div>
<div class="sect4">
<h5 id="readwrite-transaction"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#readwrite-transaction"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#readwrite-transaction">Read/Write Transaction</a></h5>
<div class="paragraph">
<p>Read and write transactions are provided by <code>SpannerOperations</code> via the <code>performReadWriteTransaction</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
SpannerOperations mySpannerOperations;

<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doWorkInsideTransaction</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> mySpannerOperations.performReadWriteTransaction(
    transActionSpannerOperations -&gt; {
      <span class="hljs-comment">// Work with transActionSpannerOperations here.</span>
      <span class="hljs-comment">// It is also a SpannerOperations object.</span>

      <span class="hljs-keyword">return</span> <span class="hljs-string">"transaction completed"</span>;
    }
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>performReadWriteTransaction</code> method accepts a <code>Function</code> that is provided an instance of a <code>SpannerOperations</code> object.
The final returned value and type of the function is determined by the user.
You can use this object just as you would a regular <code>SpannerOperations</code> with a few exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Its read functionality cannot perform stale reads, because all reads and writes happen at the single point in time of the transaction.</p>
</li>
<li>
<p>It cannot perform sub-transactions via <code>performReadWriteTransaction</code> or <code>performReadOnlyTransaction</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As these read-write transactions are locking, it is recommended that you use the <code>performReadOnlyTransaction</code> if your function does not perform any writes.</p>
</div>
</div>
<div class="sect4">
<h5 id="read-only-transaction"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#read-only-transaction"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#read-only-transaction">Read-only Transaction</a></h5>
<div class="paragraph">
<p>The <code>performReadOnlyTransaction</code> method is used to perform read-only transactions using a <code>SpannerOperations</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
SpannerOperations mySpannerOperations;

<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doWorkInsideTransaction</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> mySpannerOperations.performReadOnlyTransaction(
    transActionSpannerOperations -&gt; {
      <span class="hljs-comment">// Work with transActionSpannerOperations here.</span>
      <span class="hljs-comment">// It is also a SpannerOperations object.</span>

      <span class="hljs-keyword">return</span> <span class="hljs-string">"transaction completed"</span>;
    }
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>performReadOnlyTransaction</code> method accepts a <code>Function</code> that is provided an instance of a
<code>SpannerOperations</code> object.
This method also accepts a <code>ReadOptions</code> object, but the only attribute used is the timestamp used to determine the snapshot in time to perform the reads in the transaction.
If the timestamp is not set in the read options the transaction is run against the current state of the database.
The final returned value and type of the function is determined by the user.
You can use this object just as you would a regular <code>SpannerOperations</code> with
a few exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Its read functionality cannot perform stale reads (other than the staleness set on the entire transaction), because all reads happen at the single point in time of the transaction.</p>
</li>
<li>
<p>It cannot perform sub-transactions via <code>performReadWriteTransaction</code> or <code>performReadOnlyTransaction</code></p>
</li>
<li>
<p>It cannot perform any write operations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because read-only transactions are non-locking and can be performed on points in time in the past, these are recommended for functions that do not perform write operations.</p>
</div>
</div>
<div class="sect4">
<h5 id="declarative-transactions-with-transactional-annotation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#declarative-transactions-with-transactional-annotation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#declarative-transactions-with-transactional-annotation">Declarative Transactions with @Transactional Annotation</a></h5>
<div class="paragraph">
<p>This feature requires a bean of <code>SpannerTransactionManager</code>, which is provided when using <code>spring-cloud-gcp-starter-data-spanner</code>.</p>
</div>
<div class="paragraph">
<p><code>SpannerTemplate</code> and <code>SpannerRepository</code> support running methods with the <code>@Transactional</code> <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#transaction-declarative">annotation</a> as transactions.
If a method annotated with <code>@Transactional</code> calls another method also annotated, then both methods will work within the same transaction.
<code>performReadOnlyTransaction</code> and <code>performReadWriteTransaction</code> cannot be used in <code>@Transactional</code> annotated methods because Cloud Spanner does not support transactions within transactions.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dml-statements"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dml-statements"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dml-statements">100.3.7. DML Statements</a></h4>
<div class="paragraph">
<p><code>SpannerTemplate</code> supports <a href="https://cloud.google.com/spanner/docs/dml-tasks:">DML</a> <code>Statements</code>.
DML statements can also be run in transactions by using <code>performReadWriteTransaction</code> or by using the <code>@Transactional</code> annotation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#repositories"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#repositories">100.4. Repositories</a></h3>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring-data/data-commons/docs/current/reference/html/#repositories">Spring Data Repositories</a> are a powerful abstraction that can save you a lot of boilerplate code.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TraderRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpannerRepository</span>&lt;<span class="hljs-title">Trader</span>, <span class="hljs-title">String</span>&gt; </span>{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Data generates a working implementation of the specified interface, which can be conveniently autowired into an application.</p>
</div>
<div class="paragraph">
<p>The <code>Trader</code> type parameter to <code>SpannerRepository</code> refers to the underlying domain type.
The second type parameter, <code>String</code> in this case, refers to the type of the key of the domain type.</p>
</div>
<div class="paragraph">
<p>For POJOs with a composite primary key, this ID type parameter can be any descendant of <code>Object[]</code> compatible with all primary key properties, any descendant of <code>Iterable</code>, or <code>com.google.cloud.spanner.Key</code>.
If the domain POJO type only has a single primary key column, then the primary key property type can be used or the <code>Key</code> type.</p>
</div>
<div class="paragraph">
<p>For example in case of Trades, that belong to a Trader, <code>TradeRepository</code> would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TradeRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpannerRepository</span>&lt;<span class="hljs-title">Trade</span>, <span class="hljs-title">String</span>[]&gt; </span>{

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApplication</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    SpannerTemplate spannerTemplate;

    <span class="hljs-meta">@Autowired</span>
    StudentRepository studentRepository;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">demo</span><span class="hljs-params">()</span> </span>{

        <span class="hljs-keyword">this</span>.tradeRepository.deleteAll();
        String traderId = <span class="hljs-string">"demo_trader"</span>;
        Trade t = <span class="hljs-keyword">new</span> Trade();
        t.symbol = stock;
        t.action = action;
        t.traderId = traderId;
        t.price = <span class="hljs-keyword">new</span> BigDecimal(<span class="hljs-string">"100.0"</span>);
        t.shares = <span class="hljs-number">12345.6</span>;
        <span class="hljs-keyword">this</span>.spannerTemplate.insert(t);

        Iterable&lt;Trade&gt; allTrades = <span class="hljs-keyword">this</span>.tradeRepository.findAll();

        <span class="hljs-keyword">int</span> count = <span class="hljs-keyword">this</span>.tradeRepository.countByAction(<span class="hljs-string">"BUY"</span>);

    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="crud-repository"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#crud-repository"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#crud-repository">100.4.1. CRUD Repository</a></h4>
<div class="paragraph">
<p><code>CrudRepository</code> methods work as expected, with one thing Spanner specific: the <code>save</code> and <code>saveAll</code> methods work as update-or-insert.</p>
</div>
</div>
<div class="sect3">
<h4 id="paging-and-sorting-repository"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#paging-and-sorting-repository"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#paging-and-sorting-repository">100.4.2. Paging and Sorting Repository</a></h4>
<div class="paragraph">
<p>You can also use <code>PagingAndSortingRepository</code> with Spanner Spring Data.
The sorting and pageable <code>findAll</code> methods available from this interface operate on the current state of the Spanner database.
As a result, beware that the state of the database (and the results) might change when moving page to page.</p>
</div>
</div>
<div class="sect3">
<h4 id="spanner-repository"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spanner-repository"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spanner-repository">100.4.3. Spanner Repository</a></h4>
<div class="paragraph">
<p>The <code>SpannerRepository</code> extends the <code>PagingAndSortingRepository</code>, but adds the read-only and the read-write transaction functionality provided by Spanner.
These transactions work very similarly to those of <code>SpannerOperations</code>, but is specific to the repository’s domain type and provides repository functions instead of template functions.</p>
</div>
<div class="paragraph">
<p>For example, this is a read-only transaction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
SpannerRepository myRepo;

<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doWorkInsideTransaction</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> myRepo.performReadOnlyTransaction(
    transactionSpannerRepo -&gt; {
      <span class="hljs-comment">// Work with the single-transaction transactionSpannerRepo here.</span>
      <span class="hljs-comment">// This is a SpannerRepository object.</span>

      <span class="hljs-keyword">return</span> <span class="hljs-string">"transaction completed"</span>;
    }
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When creating custom repositories for your own domain types and query methods, you can extend <code>SpannerRepository</code> to access Cloud Spanner-specific features as well as all features from <code>PagingAndSortingRepository</code> and <code>CrudRepository</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="query-methods"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods">100.5. Query Methods</a></h3>
<div class="paragraph">
<p><code>SpannerRepository</code> supports Query Methods.
Described in the following sections, these are methods residing in your custom repository interfaces of which implementations are generated based on their names and annotations.
Query Methods can read, write, and delete entities in Cloud Spanner.
Parameters to these methods can be any Cloud Spanner data type supported directly or via custom configured converters.
Parameters can also be of type <code>Struct</code> or POJOs.
If a POJO is given as a parameter, it will be converted to a <code>Struct</code> with the same type-conversion logic as used to create write mutations.
Comparisons using Struct parameters are limited to <a href="https://cloud.google.com/spanner/docs/data-types#limited-comparisons-for-struct">what is available with Cloud Spanner</a>.</p>
</div>
<div class="sect3">
<h4 id="query-methods-by-convention"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods-by-convention"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods-by-convention">100.5.1. Query methods by convention</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TradeRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpannerRepository</span>&lt;<span class="hljs-title">Trade</span>, <span class="hljs-title">String</span>[]&gt; </span>{
    <span class="hljs-function">List&lt;Trade&gt; <span class="hljs-title">findByAction</span><span class="hljs-params">(String action)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">countByAction</span><span class="hljs-params">(String action)</span></span>;

    <span class="hljs-comment">// Named methods are powerful, but can get unwieldy</span>
    <span class="hljs-function">List&lt;Trade&gt; <span class="hljs-title">findTop3DistinctByActionAndSymbolIgnoreCaseOrTraderIdOrderBySymbolDesc</span><span class="hljs-params">(
            String action, String symbol, String traderId)</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the <a href="https://docs.spring.io/spring-data/data-commons/docs/current/reference/html/#repositories.query-methods">query methods</a> in <code>TradeRepository</code> are generated based on the name of the methods, using the <a href="https://docs.spring.io/spring-data/data-commons/docs/current/reference/html#repositories.query-methods.query-creation">Spring Data Query creation naming convention</a>.</p>
</div>
<div class="paragraph">
<p><code>List&lt;Trade&gt; findByAction(String action)</code> would translate to a <code>SELECT * FROM trades WHERE action = ?</code>.</p>
</div>
<div class="paragraph">
<p>The function <code>List&lt;Trade&gt; findTop3DistinctByActionAndSymbolIgnoreCaseOrTraderIdOrderBySymbolDesc(String action, String symbol, String traderId);</code> will be translated as the equivalent of this SQL query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> * <span class="hljs-keyword">FROM</span> trades
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">ACTION</span> = ? <span class="hljs-keyword">AND</span> <span class="hljs-keyword">LOWER</span>(SYMBOL) = <span class="hljs-keyword">LOWER</span>(?) <span class="hljs-keyword">AND</span> TRADER_ID = ?
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> SYMBOL <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following filter options are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Equality</p>
</li>
<li>
<p>Greater than or equals</p>
</li>
<li>
<p>Greater than</p>
</li>
<li>
<p>Less than or equals</p>
</li>
<li>
<p>Less than</p>
</li>
<li>
<p>Is null</p>
</li>
<li>
<p>Is not null</p>
</li>
<li>
<p>Is true</p>
</li>
<li>
<p>Is false</p>
</li>
<li>
<p>Like a string</p>
</li>
<li>
<p>Not like a string</p>
</li>
<li>
<p>Contains a string</p>
</li>
<li>
<p>Not contains a string</p>
</li>
<li>
<p>In</p>
</li>
<li>
<p>Not in</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the phrase <code>SymbolIgnoreCase</code> is translated to <code>LOWER(SYMBOL) = LOWER(?)</code> indicating a non-case-sensitive matching.
The <code>IgnoreCase</code> phrase may only be appended to fields that correspond to columns of type STRING or BYTES.
The Spring Data "AllIgnoreCase" phrase appended at the end of the method name is not supported.</p>
</div>
<div class="paragraph">
<p>The <code>Like</code> or <code>NotLike</code> naming conventions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function">List&lt;Trade&gt; <span class="hljs-title">findBySymbolLike</span><span class="hljs-params">(String symbolFragment)</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The param <code>symbolFragment</code> can contain <a href="https://cloud.google.com/spanner/docs/functions-and-operators#comparison-operators">wildcard characters</a> for string matching such as <code>_</code> and <code>%</code>.</p>
</div>
<div class="paragraph">
<p>The <code>Contains</code> and <code>NotContains</code> naming conventions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function">List&lt;Trade&gt; <span class="hljs-title">findBySymbolContains</span><span class="hljs-params">(String symbolFragment)</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The param <code>symbolFragment</code> is a <a href="https://cloud.google.com/spanner/docs/functions-and-operators#regexp_contains">regular expression</a> that is checked for occurrences.</p>
</div>
<div class="paragraph">
<p>The <code>In</code> and <code>NotIn</code> keywords must be used with <code>Iterable</code> corresponding parameters.</p>
</div>
<div class="paragraph">
<p>Delete queries are also supported.
For example, query methods such as <code>deleteByAction</code> or <code>removeByAction</code> delete entities found by <code>findByAction</code>.
The delete operation happens in a single transaction.</p>
</div>
<div class="paragraph">
<p>Delete queries can have the following return types:
* An integer type that is the number of entities deleted
* A collection of entities that were deleted
* <code>void</code></p>
</div>
</div>
<div class="sect3">
<h4 id="custom-sqldml-query-methods"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-sqldml-query-methods"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-sqldml-query-methods">100.5.2. Custom SQL/DML query methods</a></h4>
<div class="paragraph">
<p>The example above for <code>List&lt;Trade&gt; fetchByActionNamedQuery(String action)</code> does not match the <a href="https://docs.spring.io/spring-data/data-commons/docs/current/reference/html#repositories.query-methods.query-creation">Spring Data Query creation naming convention</a>, so we have to map a parametrized Spanner SQL query to it.</p>
</div>
<div class="paragraph">
<p>The SQL query for the method can be mapped to repository methods in one of two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>namedQueries</code> properties file</p>
</li>
<li>
<p>using the <code>@Query</code> annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The names of the tags of the SQL correspond to the <code>@Param</code> annotated names of the method parameters.</p>
</div>
<div class="paragraph">
<p>Interleaved properties are loaded eagerly, unless they are annotated with <code>@Interleaved(lazy = true)</code>.</p>
</div>
<div class="paragraph">
<p>Custom SQL query methods can accept a single <code>Sort</code> or <code>Pageable</code> parameter that is applied on top of the specified custom query.
It is the recommended way to control the sort order of the results, which is not guaranteed by the <code>ORDER BY</code> clause in the SQL query.
This is due to the fact that the user-provided query is used as a sub-query, and Cloud Spanner doesn’t preserve order in subquery results.</p>
</div>
<div class="paragraph">
<p>You might want to use <code>ORDER BY</code> with <code>LIMIT</code> to obtain the top records, according to a specified order.
However, to ensure the correct sort order of the final result set, sort options have to be passed in with a <code>Pageable</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT * FROM trades"</span>)
    <span class="hljs-function">List&lt;Trade&gt; <span class="hljs-title">fetchTrades</span><span class="hljs-params">(Pageable pageable)</span></span>;

    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT * FROM trades ORDER BY price DESC LIMIT 1"</span>)
    <span class="hljs-function">Trade <span class="hljs-title">topTrade</span><span class="hljs-params">(Pageable pageable)</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    List&lt;Trade&gt; customSortedTrades = tradeRepository.fetchTrades(PageRequest
                .of(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, org.springframework.data.domain.Sort.by(Order.asc(<span class="hljs-string">"id"</span>))));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The results would be sorted by "id" in ascending order.</p>
</div>
<div class="paragraph">
<p>Your query method can also return non-entity types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT COUNT(1) FROM trades WHERE action = @action"</span>)
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">countByActionQuery</span><span class="hljs-params">(String action)</span></span>;

    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT EXISTS(SELECT COUNT(1) FROM trades WHERE action = @action)"</span>)
    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">existsByActionQuery</span><span class="hljs-params">(String action)</span></span>;

    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT action FROM trades WHERE action = @action LIMIT 1"</span>)
    <span class="hljs-function">String <span class="hljs-title">getFirstString</span><span class="hljs-params">(@Param(<span class="hljs-string">"action"</span>)</span> String action)</span>;

    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT action FROM trades WHERE action = @action"</span>)
    <span class="hljs-function">List&lt;String&gt; <span class="hljs-title">getFirstStringList</span><span class="hljs-params">(@Param(<span class="hljs-string">"action"</span>)</span> String action)</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>DML statements can also be run by query methods, but the only possible return value is a <code>long</code> representing the number of affected rows.
The <code>dmlStatement</code> boolean setting must be set on <code>@Query</code> to indicate that the query method is run as a DML statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    <span class="hljs-meta">@Query</span>(value = <span class="hljs-string">"DELETE FROM trades WHERE action = @action"</span>, dmlStatement = <span class="hljs-keyword">true</span>)
    <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">deleteByActionQuery</span><span class="hljs-params">(String action)</span></span>;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="query-methods-with-named-queries-properties"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods-with-named-queries-properties"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods-with-named-queries-properties">Query methods with named queries properties</a></h5>
<div class="paragraph">
<p>By default, the <code>namedQueriesLocation</code> attribute on <code>@EnableSpannerRepositories</code> points to the <code>META-INF/spanner-named-queries.properties</code> file.
You can specify the query for a method in the properties file by providing the SQL as the value for the "interface.method" property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"><span class="hljs-meta">Trade.fetchByActionNamedQuery</span>=<span class="hljs-string">SELECT * FROM trades WHERE trades.action = @tag0</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TradeRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpannerRepository</span>&lt;<span class="hljs-title">Trade</span>, <span class="hljs-title">String</span>[]&gt; </span>{
    <span class="hljs-comment">// This method uses the query from the properties file instead of one generated based on name.</span>
    <span class="hljs-function">List&lt;Trade&gt; <span class="hljs-title">fetchByActionNamedQuery</span><span class="hljs-params">(@Param(<span class="hljs-string">"tag0"</span>)</span> String action)</span>;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="query-methods-with-annotation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods-with-annotation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods-with-annotation">Query methods with annotation</a></h5>
<div class="paragraph">
<p>Using the <code>@Query</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TradeRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpannerRepository</span>&lt;<span class="hljs-title">Trade</span>, <span class="hljs-title">String</span>[]&gt; </span>{
    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT * FROM trades WHERE trades.action = @tag0"</span>)
    <span class="hljs-function">List&lt;Trade&gt; <span class="hljs-title">fetchByActionNamedQuery</span><span class="hljs-params">(@Param(<span class="hljs-string">"tag0"</span>)</span> String action)</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Table names can be used directly.
For example, "trades" in the above example.
Alternatively, table names can be resolved from the <code>@Table</code> annotation on domain classes as well.
In this case, the query should refer to table names with fully qualified class names between <code>:</code>
characters: <code>:fully.qualified.ClassName:</code>.
A full example would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT * FROM :com.example.Trade: WHERE trades.action = @tag0"</span>)
<span class="hljs-function">List&lt;Trade&gt; <span class="hljs-title">fetchByActionNamedQuery</span><span class="hljs-params">(String action)</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows table names evaluated with SpEL to be used in custom queries.</p>
</div>
<div class="paragraph">
<p>SpEL can also be used to provide SQL parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT * FROM :com.example.Trade: WHERE trades.action = @tag0
  AND price &gt; #{#priceRadius * -1} AND price &lt; #{#priceRadius * 2}"</span>)
<span class="hljs-function">List&lt;Trade&gt; <span class="hljs-title">fetchByActionNamedQuery</span><span class="hljs-params">(String action, Double priceRadius)</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the <code>IN</code> SQL clause, remember to use <code>IN UNNEST(@iterableParam)</code> to specify a single <code>Iterable</code> parameter.
You can also use a fixed number of singular parameters such as <code>IN (@stringParam1, @stringParam2)</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="projections"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#projections"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#projections">100.5.3. Projections</a></h4>
<div class="paragraph">
<p>Spring Data Spanner supports <a href="https://docs.spring.io/spring-data/data-commons/docs/current/reference/html/#projections">projections</a>.
You can define projection interfaces based on domain types and add query methods that return them in your repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TradeProjection</span> </span>{

    <span class="hljs-function">String <span class="hljs-title">getAction</span><span class="hljs-params">()</span></span>;

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"#{target.symbol + ' ' + target.action}"</span>)
    <span class="hljs-function">String <span class="hljs-title">getSymbolAndAction</span><span class="hljs-params">()</span></span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TradeRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpannerRepository</span>&lt;<span class="hljs-title">Trade</span>, <span class="hljs-title">Key</span>&gt; </span>{

    <span class="hljs-function">List&lt;Trade&gt; <span class="hljs-title">findByTraderId</span><span class="hljs-params">(String traderId)</span></span>;

    <span class="hljs-function">List&lt;TradeProjection&gt; <span class="hljs-title">findByAction</span><span class="hljs-params">(String action)</span></span>;

    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT action, symbol FROM trades WHERE action = @action"</span>)
    <span class="hljs-function">List&lt;TradeProjection&gt; <span class="hljs-title">findByQuery</span><span class="hljs-params">(String action)</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Projections can be provided by name-convention-based query methods as well as by custom SQL queries.
If using custom SQL queries, you can further restrict the columns retrieved from Spanner to just those required by the projection to improve performance.</p>
</div>
<div class="paragraph">
<p>Properties of projection types defined using SpEL use the fixed name <code>target</code> for the underlying domain object.
As a result accessing underlying properties take the form <code>target.&lt;property-name&gt;</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="empty-result-handling-in-repository-methods"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#empty-result-handling-in-repository-methods"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#empty-result-handling-in-repository-methods">100.5.4. Empty result handling in repository methods</a></h4>
<div class="paragraph">
<p>Java <code>java.util.Optional</code> can be used to indicate the potential absence of a return value.</p>
</div>
<div class="paragraph">
<p>Alternatively, query methods can return the result without a wrapper.
In that case the absence of a query result is indicated by returning <code>null</code>.
Repository methods returning collections are guaranteed never to return <code>null</code> but rather the corresponding empty collection.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can enable nullability checks. For more details please see <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#null-safety">Spring Framework’s nullability docs</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="rest-repositories"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rest-repositories"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rest-repositories">100.5.5. REST Repositories</a></h4>
<div class="paragraph">
<p>When running with Spring Boot, repositories can be exposed as REST services by simply adding this dependency to your pom file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-rest<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer to configure parameters (such as path), you can use <code>@RepositoryRestResource</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@RepositoryRestResource</span>(collectionResourceRel = <span class="hljs-string">"trades"</span>, path = <span class="hljs-string">"trades"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TradeRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpannerRepository</span>&lt;<span class="hljs-title">Trade</span>, <span class="hljs-title">Key</span>&gt; </span>{
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For classes that have composite keys (multiple <code>@PrimaryKey</code> fields), only the <code>Key</code> type is supported for the repository ID type.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>For example, you can retrieve all <code>Trade</code> objects in the repository by using <code>curl http://&lt;server&gt;:&lt;port&gt;/trades</code>, or any specific trade via <code>curl http://&lt;server&gt;:&lt;port&gt;/trades/&lt;trader_id&gt;,&lt;trade_id&gt;</code>.</p>
</div>
<div class="paragraph">
<p>The separator between your primary key components, <code>id</code> and <code>trader_id</code> in this case, is a comma by default, but can be configured to any string not found in your key values by extending the <code>SpannerKeyIdConverter</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MySpecialIdConverter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpannerKeyIdConverter</span> </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> String <span class="hljs-title">getUrlIdSeparator</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">":"</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also write trades using <code>curl -XPOST -H"Content-Type: application/json" -<a href="mailto:d@test.json">d@test.json</a> http://&lt;server&gt;:&lt;port&gt;/trades/</code> where the file <code>test.json</code> holds the JSON representation of a <code>Trade</code> object.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="database-and-schema-admin"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#database-and-schema-admin"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#database-and-schema-admin">100.6. Database and Schema Admin</a></h3>
<div class="paragraph">
<p>Databases and tables inside Spanner instances can be created automatically from <code>SpannerPersistentEntity</code> objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> SpannerSchemaUtils spannerSchemaUtils;

<span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> SpannerDatabaseAdminTemplate spannerDatabaseAdminTemplate;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createTable</span><span class="hljs-params">(SpannerPersistentEntity entity)</span> </span>{
    <span class="hljs-keyword">if</span>(!spannerDatabaseAdminTemplate.tableExists(entity.tableName()){

      <span class="hljs-comment">// The boolean parameter indicates that the database will be created if it does not exist.</span>
      spannerDatabaseAdminTemplate.executeDdlStrings(Arrays.asList(
            spannerSchemaUtils.getCreateTableDDLString(entity.getType())), <span class="hljs-keyword">true</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Schemas can be generated for entire object hierarchies with interleaved relationships and composite keys.</p>
</div>
</div>
<div class="sect2">
<h3 id="events"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#events"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#events">100.7. Events</a></h3>
<div class="paragraph">
<p>Spring Data Cloud Spanner publishes events extending the Spring Framework’s <code>ApplicationEvent</code> to the context that can be received by <code>ApplicationListener</code> beans you register.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AfterReadEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published immediately after entities are read by key from Cloud Spanner by <code>SpannerTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entities loaded. The read options and key-set originally specified for the load operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AfterQueryEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published immediately after entities are read by query from Cloud Spanner by <code>SpannerTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entities loaded. The query options and query statement originally specified for the load operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BeforeExecuteDmlEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published immediately before DML statements are executed by <code>SpannerTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The DML statement to execute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AfterExecuteDmlEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published immediately after DML statements are executed by <code>SpannerTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The DML statement to execute and the number of rows affected by the operation as reported by Cloud Spanner.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BeforeSaveEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published immediately before upsert/update/insert operations are executed by <code>SpannerTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The mutations to be sent to Cloud Spanner, the entities to be saved, and optionally the properties in those entities to save.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AfterSaveEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published immediately after upsert/update/insert operations are executed by <code>SpannerTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The mutations sent to Cloud Spanner, the entities to be saved, and optionally the properties in those entities to save.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BeforeDeleteEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published immediately before delete operations are executed by <code>SpannerTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The mutations to be sent to Cloud Spanner. The target entities, keys, or entity type originally specified for the delete operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AfterDeleteEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published immediately after delete operations are executed by <code>SpannerTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The mutations sent to Cloud Spanner. The target entities, keys, or entity type originally specified for the delete operation.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="auditing"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#auditing"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#auditing">100.8. Auditing</a></h3>
<div class="paragraph">
<p>Spring Data Cloud Spanner supports the <code>@LastModifiedDate</code> and <code>@LastModifiedBy</code> auditing annotations for properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Table</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleEntity</span> </span>{
    <span class="hljs-meta">@PrimaryKey</span>
    String id;

    <span class="hljs-meta">@LastModifiedBy</span>
    String lastUser;

    <span class="hljs-meta">@LastModifiedDate</span>
    DateTime lastTouched;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Upon insert, update, or save, these properties will be set automatically by the framework before mutations are generated and saved to Cloud Spanner.</p>
</div>
<div class="paragraph">
<p>To take advantage of these features, add the <code>@EnableSpannerAuditing</code> annotation to your configuration class and provide a bean for an <code>AuditorAware&lt;A&gt;</code> implementation where the type <code>A</code> is the desired property type annotated by <code>@LastModifiedBy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableSpannerAuditing</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> AuditorAware&lt;String&gt; <span class="hljs-title">auditorProvider</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> () -&gt; Optional.of(<span class="hljs-string">"YOUR_USERNAME_HERE"</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>AuditorAware</code> interface contains a single method that supplies the value for fields annotated by <code>@LastModifiedBy</code> and can be of any type.
One alternative is to use Spring Security’s <code>User</code> type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringSecurityAuditorAware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AuditorAware</span>&lt;<span class="hljs-title">User</span>&gt; </span>{

  <span class="hljs-function"><span class="hljs-keyword">public</span> Optional&lt;User&gt; <span class="hljs-title">getCurrentAuditor</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">return</span> Optional.ofNullable(SecurityContextHolder.getContext())
              .map(SecurityContext::getAuthentication)
              .filter(Authentication::isAuthenticated)
              .map(Authentication::getPrincipal)
              .map(User.class::cast);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also set a custom provider for properties annotated <code>@LastModifiedDate</code> by providing a bean for <code>DateTimeProvider</code> and providing the bean name to <code>@EnableSpannerAuditing(dateTimeProviderRef = "customDateTimeProviderBean")</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="multi-instance-usage"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#multi-instance-usage"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#multi-instance-usage">100.9. Multi-Instance Usage</a></h3>
<div class="paragraph">
<p>Your application can be configured to use multiple Cloud Spanner instances or databases by providing a custom bean for <code>DatabaseIdProvider</code>.
The default bean uses the instance ID, database name, and project ID options you configured in <code>application.properties</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> DatabaseIdProvider <span class="hljs-title">databaseIdProvider</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// return custom connection options provider</span>
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>DatabaseId</code> given by this provider is used as the target database name and instance of each operation Spring Data Cloud Spanner executes.
By providing a custom implementation of this bean (for example, supplying a thread-local <code>DatabaseId</code>), you can direct your application to use multiple instances or databases.</p>
</div>
<div class="paragraph">
<p>Database administrative operations, such as creating tables using <code>SpannerDatabaseAdminTemplate</code>, will also utilize the provided <code>DatabaseId</code>.</p>
</div>
<div class="paragraph">
<p>If you would like to configure every aspect of each connection (such as pool size and retry settings), you can supply a bean for <code>Supplier&lt;DatabaseClient&gt;</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="cloud-spanner-emulator"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-spanner-emulator"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-spanner-emulator">100.10. Cloud Spanner Emulator</a></h3>
<div class="paragraph">
<p>The <a href="https://cloud.google.com/sdk">Cloud SDK</a> provides a local, in-memory emulator for Cloud Spanner, which you can use to develop and test your application. As the emulator stores data only in memory, it will not persist data across runs. It is intended to help you use Cloud Spanner for local development and testing, not for production deployments.</p>
</div>
<div class="paragraph">
<p>In order to set up and start the emulator, you can follow <a href="https://cloud.google.com/spanner/docs/emulator">these steps</a>.</p>
</div>
<div class="paragraph">
<p>This command can be used to create Cloud Spanner instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gcloud spanner instances create &lt;instance-name&gt; --config=emulator-config --description="&lt;description&gt;" --nodes=1</pre>
</div>
</div>
<div class="paragraph">
<p>Once the Spanner emulator is running, ensure that the following properties are set in your <code>application.properties</code> of your Spring application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.cloud.gcp.spanner.emulator.enabled=true
spring.cloud.gcp.spanner.emulator-host=${EMULATOR_HOSTPORT}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sample-8"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-8"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-8">100.11. Sample</a></h3>
<div class="paragraph">
<p>A <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-data-spanner-sample">sample application</a> is available.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-data-cloud-datastore"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-data-cloud-datastore"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-data-cloud-datastore">101. Spring Data Cloud Datastore</a></h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This integration is fully compatible with <a href="https://cloud.google.com/datastore/docs/">Firestore in Datastore Mode</a>, but not with Firestore in Native Mode.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><a href="https://projects.spring.io/spring-data/">Spring Data</a> is an abstraction for storing and retrieving POJOs in numerous storage technologies.
Spring Cloud GCP adds Spring Data support for <a href="https://cloud.google.com/firestore/">Google Cloud Firestore</a> in Datastore mode.</p>
</div>
<div class="paragraph">
<p>Maven coordinates for this module only, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-data-datastore<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-data-datastore"</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We provide a <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-starters/spring-cloud-gcp-starter-data-datastore">Spring Boot Starter for Spring Data Datastore</a>, with which you can use our recommended auto-configuration setup.
To use the starter, see the coordinates below.</p>
</div>
<div class="paragraph">
<p>Maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-data-datastore<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-data-datastore"</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This setup takes care of bringing in the latest compatible version of Cloud Java Cloud Datastore libraries as well.</p>
</div>
<div class="sect2">
<h3 id="configuration-9"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-9"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-9">101.1. Configuration</a></h3>
<div class="paragraph">
<p>To setup Spring Data Cloud Datastore, you have to configure the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setup the connection details to Google Cloud Datastore.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="cloud-datastore-settings"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-datastore-settings"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-datastore-settings">101.1.1. Cloud Datastore settings</a></h4>
<div class="paragraph">
<p>You can use the <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-starters/spring-cloud-gcp-starter-data-datastore">Spring Boot Starter for Spring Data Datastore</a> to autoconfigure Google Cloud Datastore in your Spring application.
It contains all the necessary setup that makes it easy to authenticate with your Google Cloud project.
The following configuration options are available:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.datastore.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the Cloud Datastore client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.datastore.project-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP project ID where the Google Cloud Datastore API is hosted, if different from the one in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.datastore.credentials.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth2 credentials for authenticating with the Google Cloud Datastore API, if different from the ones in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.datastore.credentials.encoded-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base64-encoded OAuth2 credentials for authenticating with the Google Cloud Datastore API, if different from the ones in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.datastore.credentials.scopes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developers.google.com/identity/protocols/googlescopes">OAuth2 scope</a> for Spring Cloud GCP Cloud Datastore credentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.googleapis.com/auth/datastore" class="bare">www.googleapis.com/auth/datastore</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.datastore.namespace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Cloud Datastore namespace to use</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the Default namespace of Cloud Datastore in your GCP project</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.datastore.host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>hostname:port</code> of the datastore service or emulator to connect to. Can be used to connect to a manually started <a href="https://cloud.google.com/datastore/docs/tools/datastore-emulator">Datastore Emulator</a>. If the autoconfigured emulator is enabled, this property will be ignored and <code>localhost:&lt;emulator_port&gt;</code> will be used.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.datastore.emulator.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To enable the auto configuration to start a local instance of the Datastore Emulator.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.datastore.emulator.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The local port to use for the Datastore Emulator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8081</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.datastore.emulator.consistency</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="https://cloud.google.com/sdk/gcloud/reference/beta/emulators/datastore/start?#--consistency">consistency</a> to use for the Datastore Emulator instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.9</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="repository-settings-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#repository-settings-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#repository-settings-2">101.1.2. Repository settings</a></h4>
<div class="paragraph">
<p>Spring Data Repositories can be configured via the <code>@EnableDatastoreRepositories</code> annotation on your main <code>@Configuration</code> class.
With our Spring Boot Starter for Spring Data Cloud Datastore, <code>@EnableDatastoreRepositories</code> is automatically added.
It is not required to add it to any other class, unless there is a need to override finer grain configuration parameters provided by <a href="https://github.com/spring-cloud/spring-cloud-gcp/blob/master/spring-cloud-gcp-data-datastore/src/main/java/org/springframework/cloud/gcp/data/datastore/repository/config/EnableDatastoreRepositories.java"><code>@EnableDatastoreRepositories</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="autoconfiguration-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#autoconfiguration-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#autoconfiguration-2">101.1.3. Autoconfiguration</a></h4>
<div class="paragraph">
<p>Our Spring Boot autoconfiguration creates the following beans available in the Spring application context:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <code>DatastoreTemplate</code></p>
</li>
<li>
<p>an instance of all user defined repositories extending <code>CrudRepository</code>, <code>PagingAndSortingRepository</code>, and <code>DatastoreRepository</code> (an extension of <code>PagingAndSortingRepository</code> with additional Cloud Datastore features) when repositories are enabled</p>
</li>
<li>
<p>an instance of <code>Datastore</code> from the Google Cloud Java Client for Datastore, for convenience and lower level API access</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="datastore-emulator-autoconfiguration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#datastore-emulator-autoconfiguration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#datastore-emulator-autoconfiguration">101.1.4. Datastore Emulator Autoconfiguration</a></h4>
<div class="paragraph">
<p>This Spring Boot autoconfiguration can also configure and start a local Datastore Emulator server if enabled by property.</p>
</div>
<div class="paragraph">
<p>It is useful for integration testing, but not for production.</p>
</div>
<div class="paragraph">
<p>When enabled, the <code>spring.cloud.gcp.datastore.host</code> property will be ignored and the Datastore autoconfiguration itself will be forced to connect to the autoconfigured local emulator instance.</p>
</div>
<div class="paragraph">
<p>It will create an instance of <code>LocalDatastoreHelper</code> as a bean that stores the <code>DatastoreOptions</code> to get the <code>Datastore</code> client connection to the emulator for convenience and lower level API for local access.
The emulator will be properly stopped after the Spring application context shutdown.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="object-mapping-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#object-mapping-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#object-mapping-2">101.2. Object Mapping</a></h3>
<div class="paragraph">
<p>Spring Data Cloud Datastore allows you to map domain POJOs to Cloud Datastore kinds and entities via annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Entity</span>(name = <span class="hljs-string">"traders"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Trader</span> </span>{

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@Field</span>(name = <span class="hljs-string">"trader_id"</span>)
    String traderId;

    String firstName;

    String lastName;

    <span class="hljs-meta">@Transient</span>
    Double temporaryNumber;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Data Cloud Datastore will ignore any property annotated with <code>@Transient</code>.
These properties will not be written to or read from Cloud Datastore.</p>
</div>
<div class="sect3">
<h4 id="constructors-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#constructors-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#constructors-2">101.2.1. Constructors</a></h4>
<div class="paragraph">
<p>Simple constructors are supported on POJOs.
The constructor arguments can be a subset of the persistent properties.
Every constructor argument needs to have the same name and type as a persistent property on the entity and the constructor should set the property from the given argument.
Arguments that are not directly set to properties are not supported.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Entity</span>(name = <span class="hljs-string">"traders"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Trader</span> </span>{

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@Field</span>(name = <span class="hljs-string">"trader_id"</span>)
    String traderId;

    String firstName;

    String lastName;

    <span class="hljs-meta">@Transient</span>
    Double temporaryNumber;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Trader</span><span class="hljs-params">(String traderId, String firstName)</span> </span>{
        <span class="hljs-keyword">this</span>.traderId = traderId;
        <span class="hljs-keyword">this</span>.firstName = firstName;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kind"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kind"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kind">101.2.2. Kind</a></h4>
<div class="paragraph">
<p>The <code>@Entity</code> annotation can provide the name of the Cloud Datastore kind that stores instances of the annotated class, one per row.</p>
</div>
</div>
<div class="sect3">
<h4 id="keys"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#keys"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#keys">101.2.3. Keys</a></h4>
<div class="paragraph">
<p><code>@Id</code> identifies the property corresponding to the ID value.</p>
</div>
<div class="paragraph">
<p>You must annotate one of your POJO’s fields as the ID value, because every entity in Cloud Datastore requires a single ID value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Entity</span>(name = <span class="hljs-string">"trades"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Trade</span> </span>{
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@Field</span>(name = <span class="hljs-string">"trade_id"</span>)
    String tradeId;

    <span class="hljs-meta">@Field</span>(name = <span class="hljs-string">"trader_id"</span>)
    String traderId;

    String action;

    Double price;

    Double shares;

    String symbol;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Datastore can automatically allocate integer ID values.
If a POJO instance with a <code>Long</code> ID property is written to Cloud Datastore with <code>null</code> as the ID value, then Spring Data Cloud Datastore will obtain a newly allocated ID value from Cloud Datastore and set that in the POJO for saving.
Because primitive <code>long</code> ID properties cannot be <code>null</code> and default to <code>0</code>, keys will not be allocated.</p>
</div>
</div>
<div class="sect3">
<h4 id="fields"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#fields"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#fields">101.2.4. Fields</a></h4>
<div class="paragraph">
<p>All accessible properties on POJOs are automatically recognized as a Cloud Datastore field.
Field naming is generated by the <code>PropertyNameFieldNamingStrategy</code> by default defined on the <code>DatastoreMappingContext</code> bean.
The <code>@Field</code> annotation optionally provides a different field name than that of the property.</p>
</div>
</div>
<div class="sect3">
<h4 id="supported-types-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#supported-types-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#supported-types-2">101.2.5. Supported Types</a></h4>
<div class="paragraph">
<p>Spring Data Cloud Datastore supports the following types for regular fields and elements of collections:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Stored as</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.google.cloud.Timestamp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.google.cloud.datastore.TimestampValue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.google.cloud.datastore.Blob</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.google.cloud.datastore.BlobValue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.google.cloud.datastore.LatLng</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.google.cloud.datastore.LatLngValue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Boolean</code>, <code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.google.cloud.datastore.BooleanValue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Double</code>, <code>double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.google.cloud.datastore.DoubleValue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Long</code>, <code>long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.google.cloud.datastore.LongValue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Integer</code>, <code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.google.cloud.datastore.LongValue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.google.cloud.datastore.StringValue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.google.cloud.datastore.Entity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.google.cloud.datastore.EntityValue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.google.cloud.datastore.Key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.google.cloud.datastore.KeyValue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.google.cloud.datastore.BlobValue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java <code>enum</code> values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.google.cloud.datastore.StringValue</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition, all types that can be converted to the ones listed in the table by
<code>org.springframework.core.convert.support.DefaultConversionService</code> are supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-types-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-types-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-types-2">101.2.6. Custom types</a></h4>
<div class="paragraph">
<p>Custom converters can be used extending the type support for user defined types.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Converters need to implement the <code>org.springframework.core.convert.converter.Converter</code> interface in both directions.</p>
</li>
<li>
<p>The user defined type needs to be mapped to one of the basic types supported by Cloud Datastore.</p>
</li>
<li>
<p>An instance of both Converters (read and write) needs to be passed to the <code>DatastoreCustomConversions</code> constructor, which then has to be made available as a <code>@Bean</code> for <code>DatastoreCustomConversions</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p>We would like to have a field of type <code>Album</code> on our <code>Singer</code> POJO and want it to be stored as a string property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Singer</span> </span>{

    <span class="hljs-meta">@Id</span>
    String singerId;

    String name;

    Album album;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where Album is a simple class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Album</span> </span>{
    String albumName;

    LocalDate date;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have to define the two converters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    <span class="hljs-comment">//Converter to write custom Album type</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Converter&lt;Album, String&gt; ALBUM_STRING_CONVERTER =
            <span class="hljs-keyword">new</span> Converter&lt;Album, String&gt;() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">convert</span><span class="hljs-params">(Album album)</span> </span>{
                    <span class="hljs-keyword">return</span> album.getAlbumName() + <span class="hljs-string">" "</span> + album.getDate().format(DateTimeFormatter.ISO_DATE);
                }
            };

    <span class="hljs-comment">//Converters to read custom Album type</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Converter&lt;String, Album&gt; STRING_ALBUM_CONVERTER =
            <span class="hljs-keyword">new</span> Converter&lt;String, Album&gt;() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-function"><span class="hljs-keyword">public</span> Album <span class="hljs-title">convert</span><span class="hljs-params">(String s)</span> </span>{
                    String[] parts = s.split(<span class="hljs-string">" "</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Album(parts[<span class="hljs-number">0</span>], LocalDate.parse(parts[parts.length - <span class="hljs-number">1</span>], DateTimeFormatter.ISO_DATE));
                }
            };</code></pre>
</div>
</div>
<div class="paragraph">
<p>That will be configured in our <code>@Configuration</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConverterConfiguration</span> </span>{
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> DatastoreCustomConversions <span class="hljs-title">datastoreCustomConversions</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DatastoreCustomConversions(
                Arrays.asList(
                        ALBUM_STRING_CONVERTER,
                        STRING_ALBUM_CONVERTER));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-and-arrays"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#collections-and-arrays"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#collections-and-arrays">101.2.7. Collections and arrays</a></h4>
<div class="paragraph">
<p>Arrays and collections (types that implement <code>java.util.Collection</code>) of supported types are supported.
They are stored as <code>com.google.cloud.datastore.ListValue</code>.
Elements are converted to Cloud Datastore supported types individually. <code>byte[]</code> is an exception, it is converted to
<code>com.google.cloud.datastore.Blob</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-converter-for-collections"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-converter-for-collections"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-converter-for-collections">101.2.8. Custom Converter for collections</a></h4>
<div class="paragraph">
<p>Users can provide converters from <code>List&lt;?&gt;</code> to the custom collection type.
Only read converter is necessary, the Collection API is used on the write side to convert a collection to the internal list type.</p>
</div>
<div class="paragraph">
<p>Collection converters need to implement the <code>org.springframework.core.convert.converter.Converter</code> interface.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>Let’s improve the Singer class from the previous example.
Instead of a field of type <code>Album</code>, we would like to have a field of type <code>Set&lt;Album&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Singer</span> </span>{

    <span class="hljs-meta">@Id</span>
    String singerId;

    String name;

    Set&lt;Album&gt; albums;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have to define a read converter only:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Converter&lt;List&lt;?&gt;, Set&lt;?&gt;&gt; LIST_SET_CONVERTER =
            <span class="hljs-keyword">new</span> Converter&lt;List&lt;?&gt;, Set&lt;?&gt;&gt;() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> Set&lt;?&gt; convert(List&lt;?&gt; source) {
                    <span class="hljs-keyword">return</span> Collections.unmodifiableSet(<span class="hljs-keyword">new</span> HashSet&lt;&gt;(source));
                }
            };</code></pre>
</div>
</div>
<div class="paragraph">
<p>And add it to the list of custom converters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConverterConfiguration</span> </span>{
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> DatastoreCustomConversions <span class="hljs-title">datastoreCustomConversions</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DatastoreCustomConversions(
                Arrays.asList(
                        LIST_SET_CONVERTER,
                        ALBUM_STRING_CONVERTER,
                        STRING_ALBUM_CONVERTER));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="inheritance-hierarchies"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#inheritance-hierarchies"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#inheritance-hierarchies">101.2.9. Inheritance Hierarchies</a></h4>
<div class="paragraph">
<p>Java entity types related by inheritance can be stored in the same Kind.
When reading and querying entities using <code>DatastoreRepository</code> or <code>DatastoreTemplate</code> with a superclass as the type parameter, you can receive instances of subclasses if you annotate the superclass and its subclasses with <code>DiscriminatorField</code> and <code>DiscriminatorValue</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Entity</span>(name = <span class="hljs-string">"pets"</span>)
<span class="hljs-meta">@DiscriminatorField</span>(field = <span class="hljs-string">"pet_type"</span>)
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pet</span> </span>{
    <span class="hljs-meta">@Id</span>
    Long id;

    <span class="hljs-function"><span class="hljs-keyword">abstract</span> String <span class="hljs-title">speak</span><span class="hljs-params">()</span></span>;
}

<span class="hljs-meta">@DiscriminatorValue</span>(<span class="hljs-string">"cat"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cat</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Pet</span> </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function">String <span class="hljs-title">speak</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"meow"</span>;
    }
}

<span class="hljs-meta">@DiscriminatorValue</span>(<span class="hljs-string">"dog"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Pet</span> </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function">String <span class="hljs-title">speak</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"woof"</span>;
    }
}

<span class="hljs-meta">@DiscriminatorValue</span>(<span class="hljs-string">"pug"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pug</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Dog</span> </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function">String <span class="hljs-title">speak</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"woof woof"</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instances of all 3 types are stored in the <code>pets</code> Kind.
Because a single Kind is used, all classes in the hierarchy must share the same ID property and no two instances of any type in the hierarchy can share the same ID value.</p>
</div>
<div class="paragraph">
<p>Entity rows in Cloud Datastore store their respective types' <code>DiscriminatorValue</code> in a field specified by the root superclass’s <code>DiscriminatorField</code> (<code>pet_type</code> in this case).
Reads and queries using a given type parameter will match each entity with its specific type.
For example, reading a <code>List&lt;Pet&gt;</code> will produce a list containing instances of all 3 types.
However, reading a <code>List&lt;Dog&gt;</code> will produce a list containing only <code>Dog</code> and <code>Pug</code> instances.
You can include the <code>pet_type</code> discrimination field in your Java entities, but its type must be convertible to a collection or array of <code>String</code>.
Any value set in the discrimination field will be overwritten upon write to Cloud Datastore.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="relationships-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#relationships-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#relationships-2">101.3. Relationships</a></h3>
<div class="paragraph">
<p>There are three ways to represent relationships between entities that are described in this section:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Embedded entities stored directly in the field of the containing entity</p>
</li>
<li>
<p><code>@Descendant</code> annotated properties for one-to-many relationships</p>
</li>
<li>
<p><code>@Reference</code> annotated properties for general relationships without hierarchy</p>
</li>
<li>
<p><code>@LazyReference</code> similar to <code>@Reference</code>, but the entities are lazy-loaded when the property is accessed.
(Note that the keys of the children are retrieved when the parent entity is loaded.)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="embedded-entities"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#embedded-entities"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#embedded-entities">101.3.1. Embedded Entities</a></h4>
<div class="paragraph">
<p>Fields whose types are also annotated with <code>@Entity</code> are converted to <code>EntityValue</code> and stored inside the parent entity.</p>
</div>
<div class="paragraph">
<p>Here is an example of Cloud Datastore entity containing an embedded entity in JSON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  <span class="hljs-attr">"name"</span> : <span class="hljs-string">"Alexander"</span>,
  <span class="hljs-attr">"age"</span> : <span class="hljs-number">47</span>,
  <span class="hljs-attr">"child"</span> : {<span class="hljs-attr">"name"</span> : <span class="hljs-string">"Philip"</span>  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This corresponds to a simple pair of Java entities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> org.springframework.cloud.gcp.data.datastore.core.mapping.Entity;
<span class="hljs-keyword">import</span> org.springframework.data.annotation.Id;

<span class="hljs-meta">@Entity</span>(<span class="hljs-string">"parents"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Parent</span> </span>{
  <span class="hljs-meta">@Id</span>
  String name;

  Child child;
}

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Child</span> </span>{
  String name;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Child</code> entities are not stored in their own kind.
They are stored in their entirety in the <code>child</code> field of the <code>parents</code> kind.</p>
</div>
<div class="paragraph">
<p>Multiple levels of embedded entities are supported.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Embedded entities don’t need to have <code>@Id</code> field, it is only required for top level entities.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>Entities can hold embedded entities that are their own type.
We can store trees in Cloud Datastore using this feature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> org.springframework.cloud.gcp.data.datastore.core.mapping.Embedded;
<span class="hljs-keyword">import</span> org.springframework.cloud.gcp.data.datastore.core.mapping.Entity;
<span class="hljs-keyword">import</span> org.springframework.data.annotation.Id;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmbeddableTreeNode</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-keyword">long</span> value;

  EmbeddableTreeNode left;

  EmbeddableTreeNode right;

  Map&lt;String, Long&gt; longValues;

  Map&lt;String, List&lt;Timestamp&gt;&gt; listTimestamps;

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">EmbeddableTreeNode</span><span class="hljs-params">(<span class="hljs-keyword">long</span> value, EmbeddableTreeNode left, EmbeddableTreeNode right)</span> </span>{
    <span class="hljs-keyword">this</span>.value = value;
    <span class="hljs-keyword">this</span>.left = left;
    <span class="hljs-keyword">this</span>.right = right;
  }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="maps"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#maps"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#maps">Maps</a></h5>
<div class="paragraph">
<p>Maps will be stored as embedded entities where the key values become the field names in the embedded entity.
The value types in these maps can be any regularly supported property type, and the key values will be converted to String using the configured converters.</p>
</div>
<div class="paragraph">
<p>Also, a collection of entities can be embedded; it will be converted to <code>ListValue</code> on write.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>Instead of a binary tree from the previous example, we would like to store a general tree
(each node can have an arbitrary number of children) in Cloud Datastore.
To do that, we need to create a field of type <code>List&lt;EmbeddableTreeNode&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> org.springframework.cloud.gcp.data.datastore.core.mapping.Embedded;
<span class="hljs-keyword">import</span> org.springframework.data.annotation.Id;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmbeddableTreeNode</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-keyword">long</span> value;

  List&lt;EmbeddableTreeNode&gt; children;

  Map&lt;String, EmbeddableTreeNode&gt; siblingNodes;

  Map&lt;String, Set&lt;EmbeddableTreeNode&gt;&gt; subNodeGroups;

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">EmbeddableTreeNode</span><span class="hljs-params">(List&lt;EmbeddableTreeNode&gt; children)</span> </span>{
    <span class="hljs-keyword">this</span>.children = children;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because Maps are stored as entities, they can further hold embedded entities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Singular embedded objects in the value can be stored in the values of embedded Maps.</p>
</li>
<li>
<p>Collections of embedded objects in the value can also be stored as the values of embedded Maps.</p>
</li>
<li>
<p>Maps in the value are further stored as embedded entities with the same rules applied recursively for their values.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ancestor-descendant-relationships"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ancestor-descendant-relationships"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ancestor-descendant-relationships">101.3.2. Ancestor-Descendant Relationships</a></h4>
<div class="paragraph">
<p>Parent-child relationships are supported via the <code>@Descendants</code> annotation.</p>
</div>
<div class="paragraph">
<p>Unlike embedded children, descendants are fully-formed entities residing in their own kinds.
The parent entity does not have an extra field to hold the descendant entities.
Instead, the relationship is captured in the descendants' keys, which refer to their parent entities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> org.springframework.cloud.gcp.data.datastore.core.mapping.Descendants;
<span class="hljs-keyword">import</span> org.springframework.cloud.gcp.data.datastore.core.mapping.Entity;
<span class="hljs-keyword">import</span> org.springframework.data.annotation.Id;

<span class="hljs-meta">@Entity</span>(<span class="hljs-string">"orders"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShoppingOrder</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-keyword">long</span> id;

  <span class="hljs-meta">@Descendants</span>
  List&lt;Item&gt; items;
}

<span class="hljs-meta">@Entity</span>(<span class="hljs-string">"purchased_item"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Item</span> </span>{
  <span class="hljs-meta">@Id</span>
  Key purchasedItemKey;

  String name;

  Timestamp timeAddedToOrder;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, an instance of a GQL key-literal representation for <code>Item</code> would also contain the parent <code>ShoppingOrder</code> ID value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Key(orders, '12345', purchased_item, 'eggs')</pre>
</div>
</div>
<div class="paragraph">
<p>The GQL key-literal representation for the parent <code>ShoppingOrder</code> would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Key(orders, '12345')</pre>
</div>
</div>
<div class="paragraph">
<p>The Cloud Datastore entities exist separately in their own kinds.</p>
</div>
<div class="paragraph">
<p>The <code>ShoppingOrder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "id" : 12345
}</pre>
</div>
</div>
<div class="paragraph">
<p>The two items inside that order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "purchasedItemKey" : Key(orders, '12345', purchased_item, 'eggs'),
  "name" : "eggs",
  "timeAddedToOrder" : "2014-09-27 12:30:00.45-8:00"
}

{
  "purchasedItemKey" : Key(orders, '12345', purchased_item, 'sausage'),
  "name" : "sausage",
  "timeAddedToOrder" : "2014-09-28 11:30:00.45-9:00"
}</pre>
</div>
</div>
<div class="paragraph">
<p>The parent-child relationship structure of objects is stored in Cloud Datastore using Datastore’s <a href="https://cloud.google.com/datastore/docs/concepts/entities#ancestor_paths">ancestor relationships</a>.
Because the relationships are defined by the Ancestor mechanism, there is no extra column needed in either the parent or child entity to store this relationship.
The relationship link is part of the descendant entity’s key value.
These relationships can be many levels deep.</p>
</div>
<div class="paragraph">
<p>Properties holding child entities must be collection-like, but they can be any of the supported inter-convertible collection-like types that are supported for regular properties such as <code>List</code>, arrays, <code>Set</code>, etc…​
Child items must have <code>Key</code> as their ID type because Cloud Datastore stores the ancestor relationship link inside the keys of the children.</p>
</div>
<div class="paragraph">
<p>Reading or saving an entity automatically causes all subsequent levels of children under that entity to be read or saved, respectively.
If a new child is created and added to a property annotated <code>@Descendants</code> and the key property is left null, then a new key will be allocated for that child.
The ordering of the retrieved children may not be the same as the ordering in the original property that was saved.</p>
</div>
<div class="paragraph">
<p>Child entities cannot be moved from the property of one parent to that of another unless the child’s key property is set to <code>null</code> or a value that contains the new parent as an ancestor.
Since Cloud Datastore entity keys can have multiple parents, it is possible that a child entity appears in the property of multiple parent entities.
Because entity keys are immutable in Cloud Datastore, to change the key of a child you must delete the existing one and re-save it with the new key.</p>
</div>
</div>
<div class="sect3">
<h4 id="key-reference-relationships"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#key-reference-relationships"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#key-reference-relationships">101.3.3. Key Reference Relationships</a></h4>
<div class="paragraph">
<p>General relationships can be stored using the <code>@Reference</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> org.springframework.data.annotation.Reference;
<span class="hljs-keyword">import</span> org.springframework.data.annotation.Id;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShoppingOrder</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-keyword">long</span> id;

  <span class="hljs-meta">@Reference</span>
  List&lt;Item&gt; items;

  <span class="hljs-meta">@Reference</span>
  Item specialSingleItem;
}

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Item</span> </span>{
  <span class="hljs-meta">@Id</span>
  Key purchasedItemKey;

  String name;

  Timestamp timeAddedToOrder;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Reference</code> relationships are between fully-formed entities residing in their own kinds.
The relationship between <code>ShoppingOrder</code> and <code>Item</code> entities are stored as a Key field inside <code>ShoppingOrder</code>, which are resolved to the underlying Java entity type by Spring Data Cloud Datastore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "id" : 12345,
  "specialSingleItem" : Key(item, "milk"),
  "items" : [ Key(item, "eggs"), Key(item, "sausage") ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Reference properties can either be singular or collection-like.
These properties correspond to actual columns in the entity and Cloud Datastore Kind that hold the key values of the referenced entities.
The referenced entities are full-fledged entities of other Kinds.</p>
</div>
<div class="paragraph">
<p>Similar to the <code>@Descendants</code> relationships, reading or writing an entity will recursively read or write all of the referenced entities at all levels.
If referenced entities have <code>null</code> ID values, then they will be saved as new entities and will have ID values allocated by Cloud Datastore.
There are no requirements for relationships between the key of an entity and the keys that entity holds as references.
The order of collection-like reference properties is not preserved when reading back from Cloud Datastore.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="datastore-operations-template"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#datastore-operations-template"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#datastore-operations-template">101.4. Datastore Operations &amp; Template</a></h3>
<div class="paragraph">
<p><code>DatastoreOperations</code> and its implementation, <code>DatastoreTemplate</code>, provides the Template pattern familiar to Spring developers.</p>
</div>
<div class="paragraph">
<p>Using the auto-configuration provided by Spring Boot Starter for Datastore, your Spring application context will contain a fully configured <code>DatastoreTemplate</code> object that you can autowire in your application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DatastoreTemplateExample</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    DatastoreTemplate datastoreTemplate;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.datastoreTemplate.deleteAll(Trader.class);
        <span class="hljs-comment">//...</span>
        Trader t = <span class="hljs-keyword">new</span> Trader();
        <span class="hljs-comment">//...</span>
        <span class="hljs-keyword">this</span>.datastoreTemplate.save(t);
        <span class="hljs-comment">//...</span>
        List&lt;Trader&gt; traders = datastoreTemplate.findAll(Trader.class);
        <span class="hljs-comment">//...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Template API provides convenience methods for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Write operations (saving and deleting)</p>
</li>
<li>
<p>Read-write transactions</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="gql-query"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gql-query"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#gql-query">101.4.1. GQL Query</a></h4>
<div class="paragraph">
<p>In addition to retrieving entities by their IDs, you can also submit queries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  &lt;T&gt; <span class="hljs-function">Iterable&lt;T&gt; <span class="hljs-title">query</span><span class="hljs-params">(Query&lt;? extends BaseEntity&gt; query, Class&lt;T&gt; entityClass)</span></span>;

  &lt;A, T&gt; <span class="hljs-function">Iterable&lt;T&gt; <span class="hljs-title">query</span><span class="hljs-params">(Query&lt;A&gt; query, Function&lt;A, T&gt; entityFunc)</span></span>;

  <span class="hljs-function">Iterable&lt;Key&gt; <span class="hljs-title">queryKeys</span><span class="hljs-params">(Query&lt;Key&gt; query)</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>These methods, respectively, allow querying for:
* entities mapped by a given entity class using all the same mapping and converting features
* arbitrary types produced by a given mapping function
* only the Cloud Datastore keys of the entities found by the query</p>
</div>
</div>
<div class="sect3">
<h4 id="find-by-ids"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#find-by-ids"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#find-by-ids">101.4.2. Find by ID(s)</a></h4>
<div class="paragraph">
<p>Using <code>DatastoreTemplate</code> you can find entities by id. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Trader trader = <span class="hljs-keyword">this</span>.datastoreTemplate.findById(<span class="hljs-string">"trader1"</span>, Trader.class);

List&lt;Trader&gt; traders = <span class="hljs-keyword">this</span>.datastoreTemplate.findAllById(Arrays.asList(<span class="hljs-string">"trader1"</span>, <span class="hljs-string">"trader2"</span>), Trader.class);

List&lt;Trader&gt; allTraders = <span class="hljs-keyword">this</span>.datastoreTemplate.findAll(Trader.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cloud Datastore uses key-based reads with strong consistency, but queries with eventual consistency.
In the example above the first two reads utilize keys, while the third is run by using a query based on the corresponding Kind of <code>Trader</code>.</p>
</div>
<div class="sect4">
<h5 id="indexes"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#indexes"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#indexes">Indexes</a></h5>
<div class="paragraph">
<p>By default, all fields are indexed.
To disable indexing on a particular field, <code>@Unindexed</code> annotation can be used.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> org.springframework.cloud.gcp.data.datastore.core.mapping.Unindexed;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExampleItem</span> </span>{
    <span class="hljs-keyword">long</span> indexedField;

    <span class="hljs-meta">@Unindexed</span>
    <span class="hljs-keyword">long</span> unindexedField;

    <span class="hljs-meta">@Unindexed</span>
    List&lt;String&gt; unindexedListField;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using queries directly or via Query Methods, Cloud Datastore requires <a href="https://cloud.google.com/datastore/docs/concepts/indexes">composite custom indexes</a> if the select statement is not <code>SELECT *</code> or if there is more than one filtering condition in the <code>WHERE</code> clause.</p>
</div>
</div>
<div class="sect4">
<h5 id="read-with-offsets-limits-and-sorting"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#read-with-offsets-limits-and-sorting"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#read-with-offsets-limits-and-sorting">Read with offsets, limits, and sorting</a></h5>
<div class="paragraph">
<p><code>DatastoreRepository</code> and custom-defined entity repositories implement the Spring Data <code>PagingAndSortingRepository</code>, which supports offsets and limits using page numbers and page sizes.
Paging and sorting options are also supported in <code>DatastoreTemplate</code> by supplying a <code>DatastoreQueryOptions</code> to <code>findAll</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="partial-read-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#partial-read-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#partial-read-2">Partial read</a></h5>
<div class="paragraph">
<p>This feature is not supported yet.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="write-update-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#write-update-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#write-update-2">101.4.3. Write / Update</a></h4>
<div class="paragraph">
<p>The write methods of <code>DatastoreOperations</code> accept a POJO and writes all of its properties to Datastore.
The required Datastore kind and entity metadata is obtained from the given object’s actual type.</p>
</div>
<div class="paragraph">
<p>If a POJO was retrieved from Datastore and its ID value was changed and then written or updated, the operation will occur as if against a row with the new ID value.
The entity with the original ID value will not be affected.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Trader t = <span class="hljs-keyword">new</span> Trader();
<span class="hljs-keyword">this</span>.datastoreTemplate.save(t);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>save</code> method behaves as update-or-insert.</p>
</div>
<div class="sect4">
<h5 id="partial-update-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#partial-update-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#partial-update-2">Partial Update</a></h5>
<div class="paragraph">
<p>This feature is not supported yet.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="transactions-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#transactions-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#transactions-2">101.4.4. Transactions</a></h4>
<div class="paragraph">
<p>Read and write transactions are provided by <code>DatastoreOperations</code> via the <code>performTransaction</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
DatastoreOperations myDatastoreOperations;

<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doWorkInsideTransaction</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> myDatastoreOperations.performTransaction(
    transactionDatastoreOperations -&gt; {
      <span class="hljs-comment">// Work with transactionDatastoreOperations here.</span>
      <span class="hljs-comment">// It is also a DatastoreOperations object.</span>

      <span class="hljs-keyword">return</span> <span class="hljs-string">"transaction completed"</span>;
    }
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>performTransaction</code> method accepts a <code>Function</code> that is provided an instance of a <code>DatastoreOperations</code> object.
The final returned value and type of the function is determined by the user.
You can use this object just as you would a regular <code>DatastoreOperations</code> with an exception:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It cannot perform sub-transactions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because of Cloud Datastore’s consistency guarantees, there are <a href="https://cloud.google.com/datastore/docs/concepts/transactions#what_can_be_done_in_a_transaction">limitations</a> to the operations and relationships among entities used inside transactions.</p>
</div>
<div class="sect4">
<h5 id="declarative-transactions-with-transactional-annotation-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#declarative-transactions-with-transactional-annotation-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#declarative-transactions-with-transactional-annotation-2">Declarative Transactions with @Transactional Annotation</a></h5>
<div class="paragraph">
<p>This feature requires a bean of <code>DatastoreTransactionManager</code>, which is provided when using <code>spring-cloud-gcp-starter-data-datastore</code>.</p>
</div>
<div class="paragraph">
<p><code>DatastoreTemplate</code> and <code>DatastoreRepository</code> support running methods with the <code>@Transactional</code> <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#transaction-declarative">annotation</a> as transactions.
If a method annotated with <code>@Transactional</code> calls another method also annotated, then both methods will work within the same transaction.
<code>performTransaction</code> cannot be used in <code>@Transactional</code> annotated methods because Cloud Datastore does not support transactions within transactions.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="read-write-support-for-maps"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#read-write-support-for-maps"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#read-write-support-for-maps">101.4.5. Read-Write Support for Maps</a></h4>
<div class="paragraph">
<p>You can work with Maps of type <code>Map&lt;String, ?&gt;</code> instead of with entity objects by directly reading and writing them to and from Cloud Datastore.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is a different situation than using entity objects that contain Map properties.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The map keys are used as field names for a Datastore entity and map values are converted to Datastore supported types.
Only simple types are supported (i.e. collections are not supported).
Converters for custom value types can be added (see <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-types">Custom types</a> section).</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Map&lt;String, Long&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
map.put(<span class="hljs-string">"field1"</span>, <span class="hljs-number">1L</span>);
map.put(<span class="hljs-string">"field2"</span>, <span class="hljs-number">2L</span>);
map.put(<span class="hljs-string">"field3"</span>, <span class="hljs-number">3L</span>);

keyForMap = datastoreTemplate.createKey(<span class="hljs-string">"kindName"</span>, <span class="hljs-string">"id"</span>);

<span class="hljs-comment">//write a map</span>
datastoreTemplate.writeMap(keyForMap, map);

<span class="hljs-comment">//read a map</span>
Map&lt;String, Long&gt; loadedMap = datastoreTemplate.findByIdAsMap(keyForMap, Long.class);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repositories-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#repositories-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#repositories-2">101.5. Repositories</a></h3>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring-data/data-commons/docs/current/reference/html/#repositories">Spring Data Repositories</a> are an abstraction that can reduce boilerplate code.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TraderRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DatastoreRepository</span>&lt;<span class="hljs-title">Trader</span>, <span class="hljs-title">String</span>&gt; </span>{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Data generates a working implementation of the specified interface, which can be autowired into an application.</p>
</div>
<div class="paragraph">
<p>The <code>Trader</code> type parameter to <code>DatastoreRepository</code> refers to the underlying domain type.
The second type parameter, <code>String</code> in this case, refers to the type of the key of the domain type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApplication</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    TraderRepository traderRepository;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">demo</span><span class="hljs-params">()</span> </span>{

        <span class="hljs-keyword">this</span>.traderRepository.deleteAll();
        String traderId = <span class="hljs-string">"demo_trader"</span>;
        Trader t = <span class="hljs-keyword">new</span> Trader();
        t.traderId = traderId;
        <span class="hljs-keyword">this</span>.tradeRepository.save(t);

        Iterable&lt;Trader&gt; allTraders = <span class="hljs-keyword">this</span>.traderRepository.findAll();

        <span class="hljs-keyword">int</span> count = <span class="hljs-keyword">this</span>.traderRepository.count();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Repositories allow you to define custom Query Methods (detailed in the following sections) for retrieving, counting, and deleting based on filtering and paging parameters.
Filtering parameters can be of types supported by your configured custom converters.</p>
</div>
<div class="sect3">
<h4 id="query-methods-by-convention-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods-by-convention-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods-by-convention-2">101.5.1. Query methods by convention</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TradeRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DatastoreRepository</span>&lt;<span class="hljs-title">Trade</span>, <span class="hljs-title">String</span>[]&gt; </span>{
  <span class="hljs-function">List&lt;Trader&gt; <span class="hljs-title">findByAction</span><span class="hljs-params">(String action)</span></span>;

  <span class="hljs-comment">//throws an exception if no results</span>
  <span class="hljs-function">Trader <span class="hljs-title">findOneByAction</span><span class="hljs-params">(String action)</span></span>;

  <span class="hljs-comment">//because of the annotation, returns null if no results</span>
  <span class="hljs-meta">@Nullable</span>
  <span class="hljs-function">Trader <span class="hljs-title">getByAction</span><span class="hljs-params">(String action)</span></span>;

  <span class="hljs-function">Optional&lt;Trader&gt; <span class="hljs-title">getOneByAction</span><span class="hljs-params">(String action)</span></span>;

  <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">countByAction</span><span class="hljs-params">(String action)</span></span>;

  <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">existsByAction</span><span class="hljs-params">(String action)</span></span>;

  <span class="hljs-function">List&lt;Trade&gt; <span class="hljs-title">findTop3ByActionAndSymbolAndPriceGreaterThanAndPriceLessThanOrEqualOrderBySymbolDesc</span><span class="hljs-params">(
            String action, String symbol, <span class="hljs-keyword">double</span> priceFloor, <span class="hljs-keyword">double</span> priceCeiling)</span></span>;

  <span class="hljs-function">Page&lt;TestEntity&gt; <span class="hljs-title">findByAction</span><span class="hljs-params">(String action, Pageable pageable)</span></span>;

  <span class="hljs-function">Slice&lt;TestEntity&gt; <span class="hljs-title">findBySymbol</span><span class="hljs-params">(String symbol, Pageable pageable)</span></span>;

  <span class="hljs-function">List&lt;TestEntity&gt; <span class="hljs-title">findBySymbol</span><span class="hljs-params">(String symbol, Sort sort)</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the <a href="https://docs.spring.io/spring-data/data-commons/docs/current/reference/html/#repositories.query-methods">query methods</a> in <code>TradeRepository</code> are generated based on the name of the methods using the <a href="https://docs.spring.io/spring-data/data-commons/docs/current/reference/html#repositories.query-methods.query-creation">Spring Data Query creation naming convention</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can refer to nested fields using <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-property-expressions">Spring Data JPA Property Expressions</a>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Cloud Datastore only supports filter components joined by AND, and the following operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>equals</code></p>
</li>
<li>
<p><code>greater than or equals</code></p>
</li>
<li>
<p><code>greater than</code></p>
</li>
<li>
<p><code>less than or equals</code></p>
</li>
<li>
<p><code>less than</code></p>
</li>
<li>
<p><code>is null</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After writing a custom repository interface specifying just the signatures of these methods, implementations are generated for you and can be used with an auto-wired instance of the repository.
Because of Cloud Datastore’s requirement that explicitly selected fields must all appear in a composite index together, <code>find</code> name-based query methods are run as <code>SELECT *</code>.</p>
</div>
<div class="paragraph">
<p>Delete queries are also supported.
For example, query methods such as <code>deleteByAction</code> or <code>removeByAction</code> delete entities found by <code>findByAction</code>.
Delete queries are run as separate read and delete operations instead of as a single transaction because Cloud Datastore cannot query in transactions unless ancestors for queries are specified.
As a result, <code>removeBy</code> and <code>deleteBy</code> name-convention query methods cannot be used inside transactions via either <code>performInTransaction</code> or <code>@Transactional</code> annotation.</p>
</div>
<div class="paragraph">
<p>Delete queries can have the following return types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An integer type that is the number of entities deleted</p>
</li>
<li>
<p>A collection of entities that were deleted</p>
</li>
<li>
<p>'void'</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Methods can have <code>org.springframework.data.domain.Pageable</code> parameter to control pagination and sorting, or <code>org.springframework.data.domain.Sort</code> parameter to control sorting only.
See <a href="https://docs.spring.io/spring-data/data-commons/docs/current/reference/html/#repositories.query-methods">Spring Data documentation</a> for details.</p>
</div>
<div class="paragraph">
<p>For returning multiple items in a repository method, we support Java collections as well as <code>org.springframework.data.domain.Page</code> and <code>org.springframework.data.domain.Slice</code>.
If a method’s return type is <code>org.springframework.data.domain.Page</code>, the returned object will include current page, total number of results and total number of pages.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Methods that return <code>Page</code> run an additional query to compute total number of pages.
Methods that return <code>Slice</code>, on the other hand, do not run any additional queries and, therefore, are much more efficient.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="empty-result-handling-in-repository-methods-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#empty-result-handling-in-repository-methods-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#empty-result-handling-in-repository-methods-2">101.5.2. Empty result handling in repository methods</a></h4>
<div class="paragraph">
<p>Java <code>java.util.Optional</code> can be used to indicate the potential absence of a return value.</p>
</div>
<div class="paragraph">
<p>Alternatively, query methods can return the result without a wrapper.
In that case the absence of a query result is indicated by returning <code>null</code>.
Repository methods returning collections are guaranteed never to return <code>null</code> but rather the corresponding empty collection.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can enable nullability checks. For more details please see <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#null-safety">Spring Framework’s nullability docs</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="query-by-example"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-by-example"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-by-example">101.5.3. Query by example</a></h4>
<div class="paragraph">
<p>Query by Example is an alternative querying technique.
It enables dynamic query generation based on a user-provided object. See <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example">Spring Data Documentation</a> for details.</p>
</div>
<div class="sect4">
<h5 id="unsupported-features"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#unsupported-features"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#unsupported-features">Unsupported features:</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Currently, only equality queries are supported (no ignore-case matching, regexp matching, etc.).</p>
</li>
<li>
<p>Per-field matchers are not supported.</p>
</li>
<li>
<p>Embedded entities matching is not supported.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, if you want to find all users with the last name "Smith", you would use the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">userRepository.findAll(
    Example.of(<span class="hljs-keyword">new</span> User(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-string">"Smith"</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>null</code> fields are not used in the filter by default. If you want to include them, you would use the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">userRepository.findAll(
    Example.of(<span class="hljs-keyword">new</span> User(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-string">"Smith"</span>), ExampleMatcher.matching().withIncludeNullValues())</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="custom-gql-query-methods"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-gql-query-methods"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-gql-query-methods">101.5.4. Custom GQL query methods</a></h4>
<div class="paragraph">
<p>Custom GQL queries can be mapped to repository methods in one of two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>namedQueries</code> properties file</p>
</li>
<li>
<p>using the <code>@Query</code> annotation</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="query-methods-with-annotation-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods-with-annotation-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods-with-annotation-2">Query methods with annotation</a></h5>
<div class="paragraph">
<p>Using the <code>@Query</code> annotation:</p>
</div>
<div class="paragraph">
<p>The names of the tags of the GQL correspond to the <code>@Param</code> annotated names of the method parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TraderRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DatastoreRepository</span>&lt;<span class="hljs-title">Trader</span>, <span class="hljs-title">String</span>&gt; </span>{

  <span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT * FROM traders WHERE name = @trader_name"</span>)
  <span class="hljs-function">List&lt;Trader&gt; <span class="hljs-title">tradersByName</span><span class="hljs-params">(@Param(<span class="hljs-string">"trader_name"</span>)</span> String traderName)</span>;

  <span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT * FROM  test_entities_ci WHERE name = @trader_name"</span>)
  <span class="hljs-function">TestEntity <span class="hljs-title">getOneTestEntity</span><span class="hljs-params">(@Param(<span class="hljs-string">"trader_name"</span>)</span> String traderName)</span>;

  <span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT * FROM traders WHERE name = @trader_name"</span>)
  <span class="hljs-function">List&lt;Trader&gt; <span class="hljs-title">tradersByNameSort</span><span class="hljs-params">(@Param(<span class="hljs-string">"trader_name"</span>)</span> String traderName, Sort sort)</span>;

  <span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT * FROM traders WHERE name = @trader_name"</span>)
  <span class="hljs-function">Slice&lt;Trader&gt; <span class="hljs-title">tradersByNameSlice</span><span class="hljs-params">(@Param(<span class="hljs-string">"trader_name"</span>)</span> String traderName, Pageable pageable)</span>;

  <span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT * FROM traders WHERE name = @trader_name"</span>)
  <span class="hljs-function">Page&lt;Trader&gt; <span class="hljs-title">tradersByNamePage</span><span class="hljs-params">(@Param(<span class="hljs-string">"trader_name"</span>)</span> String traderName, Pageable pageable)</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the return type is <code>Slice</code> or <code>Pageable</code>, the result set cursor that points to the position just after the page is preserved in the returned <code>Slice</code> or <code>Page</code> object. To take advantage of the cursor to query for the next page or slice, use <code>result.getPageable().next()</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>Page</code> requires the total count of entities produced by the query. Therefore, the first query will have to retrieve all of the records just to count them. Instead, we recommend using the <code>Slice</code> return type, because it does not require an additional count query.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> Slice&lt;Trader&gt; slice1 = tradersByNamePage(<span class="hljs-string">"Dave"</span>, PageRequest.of(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>));
 Slice&lt;Trader&gt; slice2 = tradersByNamePage(<span class="hljs-string">"Dave"</span>, slice1.getPageable().next());</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot use these Query Methods in repositories where the type parameter is a subclass of another class
annotated with <code>DiscriminatorField</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following parameter types are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>com.google.cloud.Timestamp</code></p>
</li>
<li>
<p><code>com.google.cloud.datastore.Blob</code></p>
</li>
<li>
<p><code>com.google.cloud.datastore.Key</code></p>
</li>
<li>
<p><code>com.google.cloud.datastore.Cursor</code></p>
</li>
<li>
<p><code>java.lang.Boolean</code></p>
</li>
<li>
<p><code>java.lang.Double</code></p>
</li>
<li>
<p><code>java.lang.Long</code></p>
</li>
<li>
<p><code>java.lang.String</code></p>
</li>
<li>
<p><code>enum</code> values.
These are queried as <code>String</code> values.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the exception of <code>Cursor</code>, array forms of each of the types are also supported.</p>
</div>
<div class="paragraph">
<p>If you would like to obtain the count of items of a query or if there are any items returned by the query, set the <code>count = true</code> or <code>exists = true</code> properties of the <code>@Query</code> annotation, respectively.
The return type of the query method in these cases should be an integer type or a boolean type.</p>
</div>
<div class="paragraph">
<p>Cloud Datastore provides provides the <code>SELECT __key__ FROM …​</code> special column for all kinds that retrieves the <code>Key</code> of each row.
Selecting this special <code>__key__</code> column is especially useful and efficient for <code>count</code> and <code>exists</code> queries.</p>
</div>
<div class="paragraph">
<p>You can also query for non-entity types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Query</span>(value = <span class="hljs-string">"SELECT __key__ from test_entities_ci"</span>)
<span class="hljs-function">List&lt;Key&gt; <span class="hljs-title">getKeys</span><span class="hljs-params">()</span></span>;

<span class="hljs-meta">@Query</span>(value = <span class="hljs-string">"SELECT __key__ from test_entities_ci limit 1"</span>)
<span class="hljs-function">Key <span class="hljs-title">getKey</span><span class="hljs-params">()</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to use <code>@Id</code> annotated fields in custom queries, use <code>__key__</code> keyword for the field name. The parameter type should be of <code>Key</code>, as in the following example.</p>
</div>
<div class="paragraph">
<p>Repository method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Query</span>(<span class="hljs-string">"select * from  test_entities_ci where size = @size and __key__ = @id"</span>)
<span class="hljs-function">LinkedList&lt;TestEntity&gt; <span class="hljs-title">findEntities</span><span class="hljs-params">(@Param(<span class="hljs-string">"size"</span>)</span> <span class="hljs-keyword">long</span> size, @<span class="hljs-title">Param</span><span class="hljs-params">(<span class="hljs-string">"id"</span>)</span> Key id)</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generate a key from id value using <code>DatastoreTemplate.createKey</code> method and use it as a parameter for the repository method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">this</span>.testEntityRepository.findEntities(<span class="hljs-number">1L</span>, datastoreTemplate.createKey(TestEntity.class, <span class="hljs-number">1L</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>SpEL can be used to provide GQL parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT * FROM |com.example.Trade| WHERE trades.action = @act
  AND price &gt; :#{#priceRadius * -1} AND price &lt; :#{#priceRadius * 2}"</span>)
<span class="hljs-function">List&lt;Trade&gt; <span class="hljs-title">fetchByActionNamedQuery</span><span class="hljs-params">(@Param(<span class="hljs-string">"act"</span>)</span> String action, @<span class="hljs-title">Param</span><span class="hljs-params">(<span class="hljs-string">"priceRadius"</span>)</span> Double r)</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kind names can be directly written in the GQL annotations.
Kind names can also be resolved from the <code>@Entity</code> annotation on domain classes.</p>
</div>
<div class="paragraph">
<p>In this case, the query should refer to table names with fully qualified class names surrounded by <code>|</code> characters: <code>|fully.qualified.ClassName|</code>.
This is useful when SpEL expressions appear in the kind name provided to the <code>@Entity</code> annotation.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT * FROM |com.example.Trade| WHERE trades.action = @act"</span>)
<span class="hljs-function">List&lt;Trade&gt; <span class="hljs-title">fetchByActionNamedQuery</span><span class="hljs-params">(@Param(<span class="hljs-string">"act"</span>)</span> String action)</span>;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="query-methods-with-named-queries-properties-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods-with-named-queries-properties-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods-with-named-queries-properties-2">Query methods with named queries properties</a></h5>
<div class="paragraph">
<p>You can also specify queries with Cloud Datastore parameter tags and SpEL expressions in properties files.</p>
</div>
<div class="paragraph">
<p>By default, the <code>namedQueriesLocation</code> attribute on <code>@EnableDatastoreRepositories</code> points to the <code>META-INF/datastore-named-queries.properties</code> file.
You can specify the query for a method in the properties file by providing the GQL as the value for the "interface.method" property:</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot use these Query Methods in repositories where the type parameter is a subclass of another class
annotated with <code>DiscriminatorField</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"><span class="hljs-meta">Trader.fetchByName</span>=<span class="hljs-string">SELECT * FROM traders WHERE name = @tag0</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TraderRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DatastoreRepository</span>&lt;<span class="hljs-title">Trader</span>, <span class="hljs-title">String</span>&gt; </span>{

    <span class="hljs-comment">// This method uses the query from the properties file instead of one generated based on name.</span>
    <span class="hljs-function">List&lt;Trader&gt; <span class="hljs-title">fetchByName</span><span class="hljs-params">(@Param(<span class="hljs-string">"tag0"</span>)</span> String traderName)</span>;

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="transactions-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#transactions-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#transactions-3">101.5.5. Transactions</a></h4>
<div class="paragraph">
<p>These transactions work very similarly to those of <code>DatastoreOperations</code>, but is specific to the repository’s domain type and provides repository functions instead of template functions.</p>
</div>
<div class="paragraph">
<p>For example, this is a read-write transaction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
DatastoreRepository myRepo;

<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doWorkInsideTransaction</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> myRepo.performTransaction(
    transactionDatastoreRepo -&gt; {
      <span class="hljs-comment">// Work with the single-transaction transactionDatastoreRepo here.</span>
      <span class="hljs-comment">// This is a DatastoreRepository object.</span>

      <span class="hljs-keyword">return</span> <span class="hljs-string">"transaction completed"</span>;
    }
  );
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="projections-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#projections-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#projections-2">101.5.6. Projections</a></h4>
<div class="paragraph">
<p>Spring Data Cloud Datastore supports <a href="https://docs.spring.io/spring-data/data-commons/docs/current/reference/html/#projections">projections</a>.
You can define projection interfaces based on domain types and add query methods that return them in your repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TradeProjection</span> </span>{

    <span class="hljs-function">String <span class="hljs-title">getAction</span><span class="hljs-params">()</span></span>;

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"#{target.symbol + ' ' + target.action}"</span>)
    <span class="hljs-function">String <span class="hljs-title">getSymbolAndAction</span><span class="hljs-params">()</span></span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TradeRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DatastoreRepository</span>&lt;<span class="hljs-title">Trade</span>, <span class="hljs-title">Key</span>&gt; </span>{

    <span class="hljs-function">List&lt;Trade&gt; <span class="hljs-title">findByTraderId</span><span class="hljs-params">(String traderId)</span></span>;

    <span class="hljs-function">List&lt;TradeProjection&gt; <span class="hljs-title">findByAction</span><span class="hljs-params">(String action)</span></span>;

    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT action, symbol FROM trades WHERE action = @action"</span>)
    <span class="hljs-function">List&lt;TradeProjection&gt; <span class="hljs-title">findByQuery</span><span class="hljs-params">(String action)</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Projections can be provided by name-convention-based query methods as well as by custom GQL queries.
If using custom GQL queries, you can further restrict the fields retrieved from Cloud Datastore to just those required by the projection.
However, custom select statements (those not using <code>SELECT *</code>) require composite indexes containing the selected fields.</p>
</div>
<div class="paragraph">
<p>Properties of projection types defined using SpEL use the fixed name <code>target</code> for the underlying domain object.
As a result, accessing underlying properties take the form <code>target.&lt;property-name&gt;</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="rest-repositories-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rest-repositories-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rest-repositories-2">101.5.7. REST Repositories</a></h4>
<div class="paragraph">
<p>When running with Spring Boot, repositories can be exposed as REST services by simply adding this dependency to your pom file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-rest<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer to configure parameters (such as path), you can use <code>@RepositoryRestResource</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@RepositoryRestResource</span>(collectionResourceRel = <span class="hljs-string">"trades"</span>, path = <span class="hljs-string">"trades"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TradeRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DatastoreRepository</span>&lt;<span class="hljs-title">Trade</span>, <span class="hljs-title">String</span>[]&gt; </span>{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, you can retrieve all <code>Trade</code> objects in the repository by using <code>curl http://&lt;server&gt;:&lt;port&gt;/trades</code>, or any specific trade via <code>curl http://&lt;server&gt;:&lt;port&gt;/trades/&lt;trader_id&gt;</code>.</p>
</div>
<div class="paragraph">
<p>You can also write trades using <code>curl -XPOST -H"Content-Type: application/json" -<a href="mailto:d@test.json">d@test.json</a> http://&lt;server&gt;:&lt;port&gt;/trades/</code> where the file <code>test.json</code> holds the JSON representation of a <code>Trade</code> object.</p>
</div>
<div class="paragraph">
<p>To delete trades, you can use <code>curl -XDELETE http://&lt;server&gt;:&lt;port&gt;/trades/&lt;trader_id&gt;</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="events-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#events-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#events-2">101.6. Events</a></h3>
<div class="paragraph">
<p>Spring Data Cloud Datastore publishes events extending the Spring Framework’s <code>ApplicationEvent</code> to the context that can be received by <code>ApplicationListener</code> beans you register.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AfterFindByKeyEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published immediately after read by-key operations are run by <code>DatastoreTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entities read from Cloud Datastore and the original keys in the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AfterQueryEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published immediately after read byquery operations are run by <code>DatastoreTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entities read from Cloud Datastore and the original query in the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BeforeSaveEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published immediately before save operations are run by <code>DatastoreTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entities to be sent to Cloud Datastore and the original Java objects being saved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AfterSaveEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published immediately after save operations are run by <code>DatastoreTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entities sent to Cloud Datastore and the original Java objects being saved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BeforeDeleteEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published immediately before delete operations are run by <code>DatastoreTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The keys to be sent to Cloud Datastore. The target entities, ID values, or entity type originally specified for the delete operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AfterDeleteEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published immediately after delete operations are run by <code>DatastoreTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The keys sent to Cloud Datastore. The target entities, ID values, or entity type originally specified for the delete operation.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="auditing-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#auditing-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#auditing-2">101.7. Auditing</a></h3>
<div class="paragraph">
<p>Spring Data Cloud Datastore supports the <code>@LastModifiedDate</code> and <code>@LastModifiedBy</code> auditing annotations for properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleEntity</span> </span>{
    <span class="hljs-meta">@Id</span>
    String id;

    <span class="hljs-meta">@LastModifiedBy</span>
    String lastUser;

    <span class="hljs-meta">@LastModifiedDate</span>
    DateTime lastTouched;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Upon insert, update, or save, these properties will be set automatically by the framework before Datastore entities are generated and saved to Cloud Datastore.</p>
</div>
<div class="paragraph">
<p>To take advantage of these features, add the <code>@EnableDatastoreAuditing</code> annotation to your configuration class and provide a bean for an <code>AuditorAware&lt;A&gt;</code> implementation where the type <code>A</code> is the desired property type annotated by <code>@LastModifiedBy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableDatastoreAuditing</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> AuditorAware&lt;String&gt; <span class="hljs-title">auditorProvider</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> () -&gt; Optional.of(<span class="hljs-string">"YOUR_USERNAME_HERE"</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>AuditorAware</code> interface contains a single method that supplies the value for fields annotated by <code>@LastModifiedBy</code> and can be of any type.
One alternative is to use Spring Security’s <code>User</code> type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringSecurityAuditorAware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AuditorAware</span>&lt;<span class="hljs-title">User</span>&gt; </span>{

  <span class="hljs-function"><span class="hljs-keyword">public</span> Optional&lt;User&gt; <span class="hljs-title">getCurrentAuditor</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">return</span> Optional.ofNullable(SecurityContextHolder.getContext())
              .map(SecurityContext::getAuthentication)
              .filter(Authentication::isAuthenticated)
              .map(Authentication::getPrincipal)
              .map(User.class::cast);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also set a custom provider for properties annotated <code>@LastModifiedDate</code> by providing a bean for <code>DateTimeProvider</code> and providing the bean name to <code>@EnableDatastoreAuditing(dateTimeProviderRef = "customDateTimeProviderBean")</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="partitioning-data-by-namespace"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#partitioning-data-by-namespace"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#partitioning-data-by-namespace">101.8. Partitioning Data by Namespace</a></h3>
<div class="paragraph">
<p>You can <a href="https://cloud.google.com/datastore/docs/concepts/multitenancy">partition your data by using more than one namespace</a>.
This is the recommended method for multi-tenancy in Cloud Datastore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> DatastoreNamespaceProvider <span class="hljs-title">namespaceProvider</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// return custom Supplier of a namespace string.</span>
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>DatastoreNamespaceProvider</code> is a synonym for <code>Supplier&lt;String&gt;</code>.
By providing a custom implementation of this bean (for example, supplying a thread-local namespace name), you can direct your application to use multiple namespaces.
Every read, write, query, and transaction you perform will utilize the namespace provided by this supplier.</p>
</div>
<div class="paragraph">
<p>Note that your provided namespace in <code>application.properties</code> will be ignored if you define a namespace provider bean.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-actuator-support-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-actuator-support-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-boot-actuator-support-2">101.9. Spring Boot Actuator Support</a></h3>
<div class="sect3">
<h4 id="cloud-datastore-health-indicator"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-datastore-health-indicator"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-datastore-health-indicator">101.9.1. Cloud Datastore Health Indicator</a></h4>
<div class="paragraph">
<p>If you are using Spring Boot Actuator, you can take advantage of the Cloud Datastore health indicator called <code>datastore</code>.
The health indicator will verify whether Cloud Datastore is up and accessible by your application.
To enable it, all you need to do is add the <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#production-ready">Spring Boot Actuator</a> to your project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sample-9"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-9"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-9">101.10. Sample</a></h3>
<div class="paragraph">
<p>A <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-data-datastore-basic-sample">Simple Spring Boot Application</a> and more advanced <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-data-datastore-sample">Sample Spring Boot Application</a> are provided to show how to use the Spring Data Cloud Datastore starter and template.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-data-cloud-firestore"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-data-cloud-firestore"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-data-cloud-firestore">102. Spring Data Cloud Firestore</a></h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently some features are not supported: query by example, projections, and auditing.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><a href="https://projects.spring.io/spring-data/">Spring Data</a> is an abstraction for storing and retrieving POJOs in numerous storage technologies.
Spring Cloud GCP adds Spring Data Reactive Repositories support for <a href="https://cloud.google.com/firestore/">Google Cloud Firestore</a> in native mode, providing reactive template and repositories support.
To begin using this library, add the <code>spring-cloud-gcp-data-firestore</code> artifact to your project.</p>
</div>
<div class="paragraph">
<p>Maven coordinates for this module only, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-data-firestore<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
  implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-data-firestore"</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We provide a Spring Boot Starter for Spring Data Firestore, with which you can use our recommended auto-configuration setup. To use the starter, see the coordinates below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-data-firestore<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
  implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-data-firestore"</span>)
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="configuration-10"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-10"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-10">102.1. Configuration</a></h3>
<div class="sect3">
<h4 id="properties"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#properties"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#properties">102.1.1. Properties</a></h4>
<div class="paragraph">
<p>The Spring Boot starter for Google Cloud Firestore provides the following configuration options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.firestore.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disables Firestore auto-configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.firestore.project-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP project ID where the Google Cloud Firestore API is hosted, if different from the one in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.firestore.emulator.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the usage of an emulator. If this is set to true, then you should set the <code>spring.cloud.gcp.firestore.host-port</code> to the host:port of your locally running emulator instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.firestore.host-port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host and port of the Firestore service; can be overridden to specify connecting to an already-running <a href="https://firebase.google.com/docs/emulator-suite/install_and_configure">Firestore emulator</a> instance.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firestore.googleapis.com:443</code> (the host/port of official Firestore service)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.firestore.credentials.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth2 credentials for authenticating with the Google Cloud Firestore API, if different from the ones in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.firestore.credentials.encoded-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base64-encoded OAuth2 credentials for authenticating with the Google Cloud Firestore API, if different from the ones in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.firestore.credentials.scopes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developers.google.com/identity/protocols/googlescopes">OAuth2 scope</a> for Spring Cloud GCP Cloud Firestore credentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.googleapis.com/auth/datastore" class="bare">www.googleapis.com/auth/datastore</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="supported-types-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#supported-types-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#supported-types-3">102.1.2. Supported types</a></h4>
<div class="paragraph">
<p>You may use the following field types when defining your persistent entities or when binding query parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Long</code></p>
</li>
<li>
<p><code>Integer</code></p>
</li>
<li>
<p><code>Double</code></p>
</li>
<li>
<p><code>Float</code></p>
</li>
<li>
<p><code>String</code></p>
</li>
<li>
<p><code>Boolean</code></p>
</li>
<li>
<p><code>Character</code></p>
</li>
<li>
<p><code>Date</code></p>
</li>
<li>
<p><code>Map</code></p>
</li>
<li>
<p><code>List</code></p>
</li>
<li>
<p><code>Enum</code></p>
</li>
<li>
<p><code>com.google.cloud.Timestamp</code></p>
</li>
<li>
<p><code>com.google.cloud.firestore.GeoPoint</code></p>
</li>
<li>
<p><code>com.google.cloud.firestore.Blob</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="reactive-repository-settings"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-repository-settings"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-repository-settings">102.1.3. Reactive Repository settings</a></h4>
<div class="paragraph">
<p>Spring Data Repositories can be configured via the <code>@EnableReactiveFirestoreRepositories</code> annotation on your main <code>@Configuration</code> class.
With our Spring Boot Starter for Spring Data Cloud Firestore, <code>@EnableReactiveFirestoreRepositories</code> is automatically added.
It is not required to add it to any other class, unless there is a need to override finer grain configuration parameters provided by <a href="https://github.com/spring-cloud/spring-cloud-gcp/blob/master/spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/repository/config/EnableReactiveFirestoreRepositories.java"><code>@EnableReactiveFirestoreRepositories</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="autoconfiguration-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#autoconfiguration-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#autoconfiguration-3">102.1.4. Autoconfiguration</a></h4>
<div class="paragraph">
<p>Our Spring Boot autoconfiguration creates the following beans available in the Spring application context:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <code>FirestoreTemplate</code></p>
</li>
<li>
<p>instances of all user defined repositories extending <code>FirestoreReactiveRepository</code> (an extension of <code>ReactiveCrudRepository</code> with additional Cloud Firestore features) when repositories are enabled</p>
</li>
<li>
<p>an instance of <a href="https://developers.google.com/resources/api-libraries/documentation/firestore/v1/java/latest/"><code>Firestore</code></a> from the Google Cloud Java Client for Firestore, for convenience and lower level API access</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="object-mapping-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#object-mapping-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#object-mapping-3">102.2. Object Mapping</a></h3>
<div class="paragraph">
<p>Spring Data Cloud Firestore allows you to map domain POJOs to <a href="https://firebase.google.com/docs/firestore/data-model#collections">Cloud Firestore collections</a> and documents via annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> com.google.cloud.firestore.annotation.DocumentId;
<span class="hljs-keyword">import</span> org.springframework.cloud.gcp.data.firestore.Document;

<span class="hljs-meta">@Document</span>(collectionName = <span class="hljs-string">"usersCollection"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
    <span class="hljs-comment">/**
     * Used to test <span class="hljs-doctag">@PropertyName</span> annotation on a field.
     */</span>
    <span class="hljs-meta">@PropertyName</span>(<span class="hljs-string">"drink"</span>)
    <span class="hljs-keyword">public</span> String favoriteDrink;

    <span class="hljs-meta">@DocumentId</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-keyword">private</span> Integer age;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">()</span> </span>{
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>{
        <span class="hljs-keyword">this</span>.name = name;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getAge</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.age;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAge</span><span class="hljs-params">(Integer age)</span> </span>{
        <span class="hljs-keyword">this</span>.age = age;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Document(collectionName = "usersCollection")</code> annotation configures the collection name for the documents of this type.
This annotation is optional, by default the collection name is derived from the class name.</p>
</div>
<div class="paragraph">
<p><code>@DocumentId</code> annotation marks a field to be used as document id.
This annotation is required and the annotated field can only be of <code>String</code> type.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the property annotated with <code>@DocumentId</code> is <code>null</code> the document id is generated automatically when the entity is saved.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Internally we use Firestore client library object mapping. See <a href="https://developers.google.com/android/reference/com/google/firebase/firestore/package-summary">the documentation</a> for supported annotations.
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="embedded-entities-and-lists"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#embedded-entities-and-lists"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#embedded-entities-and-lists">102.2.1. Embedded entities and lists</a></h4>
<div class="paragraph">
<p>Spring Data Cloud Firestore supports embedded properties of custom types and lists.
Given a custom POJO definition, you can have properties of this type or lists of this type in your entities.
They are stored as embedded documents (or arrays, correspondingly) in the Cloud Firestore.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Document</span>(collectionName = <span class="hljs-string">"usersCollection"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
    <span class="hljs-comment">/**
     * Used to test <span class="hljs-doctag">@PropertyName</span> annotation on a field.
     */</span>
    <span class="hljs-meta">@PropertyName</span>(<span class="hljs-string">"drink"</span>)
    <span class="hljs-keyword">public</span> String favoriteDrink;

    <span class="hljs-meta">@DocumentId</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-keyword">private</span> Integer age;

    <span class="hljs-keyword">private</span> List&lt;String&gt; pets;

    <span class="hljs-keyword">private</span> List&lt;Address&gt; addresses;

    <span class="hljs-keyword">private</span> Address homeAddress;

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">getPets</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.pets;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPets</span><span class="hljs-params">(List&lt;String&gt; pets)</span> </span>{
        <span class="hljs-keyword">this</span>.pets = pets;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Address&gt; <span class="hljs-title">getAddresses</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.addresses;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAddresses</span><span class="hljs-params">(List&lt;Address&gt; addresses)</span> </span>{
        <span class="hljs-keyword">this</span>.addresses = addresses;
    }

    <span class="hljs-meta">@PropertyName</span>(<span class="hljs-string">"address"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> Address <span class="hljs-title">getHomeAddress</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.homeAddress;
    }

    <span class="hljs-meta">@PropertyName</span>(<span class="hljs-string">"address"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setHomeAddress</span><span class="hljs-params">(Address homeAddress)</span> </span>{
        <span class="hljs-keyword">this</span>.homeAddress = homeAddress;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span> </span>{
        String streetAddress;
        String country;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Address</span><span class="hljs-params">()</span> </span>{
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reactive-repositories"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-repositories"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-repositories">102.3. Reactive Repositories</a></h3>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/reactive/ReactiveCrudRepository.html">Spring Data Repositories</a> is an abstraction that can reduce boilerplate code.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FirestoreReactiveRepository</span>&lt;<span class="hljs-title">User</span>&gt; </span>{
    <span class="hljs-function">Flux&lt;User&gt; <span class="hljs-title">findByAge</span><span class="hljs-params">(Integer age)</span></span>;

    <span class="hljs-function">Flux&lt;User&gt; <span class="hljs-title">findByAgeNot</span><span class="hljs-params">(Integer age)</span></span>;

    <span class="hljs-function">Flux&lt;User&gt; <span class="hljs-title">findByHomeAddressCountry</span><span class="hljs-params">(String country)</span></span>;

    <span class="hljs-function">Flux&lt;User&gt; <span class="hljs-title">findByFavoriteDrink</span><span class="hljs-params">(String drink)</span></span>;

    <span class="hljs-function">Flux&lt;User&gt; <span class="hljs-title">findByAgeGreaterThanAndAgeLessThan</span><span class="hljs-params">(Integer age1, Integer age2)</span></span>;

    <span class="hljs-function">Flux&lt;User&gt; <span class="hljs-title">findByAgeGreaterThan</span><span class="hljs-params">(Integer age)</span></span>;

    <span class="hljs-function">Flux&lt;User&gt; <span class="hljs-title">findByAgeGreaterThan</span><span class="hljs-params">(Integer age, Sort sort)</span></span>;

    <span class="hljs-function">Flux&lt;User&gt; <span class="hljs-title">findByAgeGreaterThan</span><span class="hljs-params">(Integer age, Pageable pageable)</span></span>;

    <span class="hljs-function">Flux&lt;User&gt; <span class="hljs-title">findByAgeIn</span><span class="hljs-params">(List&lt;Integer&gt; ages)</span></span>;

    <span class="hljs-function">Flux&lt;User&gt; <span class="hljs-title">findByAgeNotIn</span><span class="hljs-params">(List&lt;Integer&gt; ages)</span></span>;

    <span class="hljs-function">Flux&lt;User&gt; <span class="hljs-title">findByAgeAndPetsContains</span><span class="hljs-params">(Integer age, List&lt;String&gt; pets)</span></span>;

    <span class="hljs-function">Flux&lt;User&gt; <span class="hljs-title">findByPetsContains</span><span class="hljs-params">(List&lt;String&gt; pets)</span></span>;

    <span class="hljs-function">Flux&lt;User&gt; <span class="hljs-title">findByPetsContainsAndAgeIn</span><span class="hljs-params">(String pets, List&lt;Integer&gt; ages)</span></span>;

    <span class="hljs-function">Mono&lt;Long&gt; <span class="hljs-title">countByAgeIsGreaterThan</span><span class="hljs-params">(Integer age)</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Data generates a working implementation of the specified interface, which can be autowired into an application.</p>
</div>
<div class="paragraph">
<p>The <code>User</code> type parameter to <code>FirestoreReactiveRepository</code> refers to the underlying domain type.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can refer to nested fields using <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-property-expressions">Spring Data JPA Property Expressions</a>
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApplication</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    UserRepository userRepository;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeReadDeleteTest</span><span class="hljs-params">()</span> </span>{
        List&lt;User.Address&gt; addresses = Arrays.asList(<span class="hljs-keyword">new</span> User.Address(<span class="hljs-string">"123 Alice st"</span>, <span class="hljs-string">"US"</span>),
                <span class="hljs-keyword">new</span> User.Address(<span class="hljs-string">"1 Alice ave"</span>, <span class="hljs-string">"US"</span>));
        User.Address homeAddress = <span class="hljs-keyword">new</span> User.Address(<span class="hljs-string">"10 Alice blvd"</span>, <span class="hljs-string">"UK"</span>);
        User alice = <span class="hljs-keyword">new</span> User(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">29</span>, <span class="hljs-keyword">null</span>, addresses, homeAddress);
        User bob = <span class="hljs-keyword">new</span> User(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">60</span>);

        <span class="hljs-keyword">this</span>.userRepository.save(alice).block();
        <span class="hljs-keyword">this</span>.userRepository.save(bob).block();

        assertThat(<span class="hljs-keyword">this</span>.userRepository.count().block()).isEqualTo(<span class="hljs-number">2</span>);
        assertThat(<span class="hljs-keyword">this</span>.userRepository.findAll().map(User::getName).collectList().block())
                .containsExactlyInAnyOrder(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"Bob"</span>);

        User aliceLoaded = <span class="hljs-keyword">this</span>.userRepository.findById(<span class="hljs-string">"Alice"</span>).block();
        assertThat(aliceLoaded.getAddresses()).isEqualTo(addresses);
        assertThat(aliceLoaded.getHomeAddress()).isEqualTo(homeAddress);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Repositories allow you to define custom Query Methods (detailed in the following sections) for retrieving and counting based on filtering and paging parameters.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Custom queries with <code>@Query</code> annotation are not supported since there is no query language in Cloud Firestore
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="firestore-operations-template"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#firestore-operations-template"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#firestore-operations-template">102.4. Firestore Operations &amp; Template</a></h3>
<div class="paragraph">
<p><code>FirestoreOperations</code> and its implementation, <code>FirestoreTemplate</code>, provides the Template pattern familiar to Spring developers.</p>
</div>
<div class="paragraph">
<p>Using the auto-configuration provided by Spring Data Cloud Firestore, your Spring application context will contain a fully configured <code>FirestoreTemplate</code> object that you can autowire in your application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FirestoreTemplateExample</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    FirestoreOperations firestoreOperations;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title">createUsers</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.firestoreOperatons.save(<span class="hljs-keyword">new</span> User(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">29</span>))
            .then(<span class="hljs-keyword">this</span>.firestoreOperatons.save(<span class="hljs-keyword">new</span> User(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">60</span>)));
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Flux&lt;User&gt; <span class="hljs-title">findUsers</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.firestoreOperatons.findAll(User.class);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;Long&gt; <span class="hljs-title">removeAllUsers</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.firestoreOperatons.deleteAll(User.class);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Template API provides support for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Read and write operations</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#transactions">Transactions</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#subcollections">Subcollections</a> operations</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="query-methods-by-convention-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods-by-convention-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-methods-by-convention-3">102.5. Query methods by convention</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApplication</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">partTreeRepositoryMethodTest</span><span class="hljs-params">()</span> </span>{
        User u1 = <span class="hljs-keyword">new</span> User(<span class="hljs-string">"Cloud"</span>, <span class="hljs-number">22</span>, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">new</span> Address(<span class="hljs-string">"1 First st., NYC"</span>, <span class="hljs-string">"USA"</span>));
        u1.favoriteDrink = <span class="hljs-string">"tea"</span>;
        User u2 = <span class="hljs-keyword">new</span> User(<span class="hljs-string">"Squall"</span>, <span class="hljs-number">17</span>, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">new</span> Address(<span class="hljs-string">"2 Second st., London"</span>, <span class="hljs-string">"UK"</span>));
        u2.favoriteDrink = <span class="hljs-string">"wine"</span>;
        Flux&lt;User&gt; users = Flux.fromArray(<span class="hljs-keyword">new</span> User[] {u1, u2});

        <span class="hljs-keyword">this</span>.userRepository.saveAll(users).blockLast();

        assertThat(<span class="hljs-keyword">this</span>.userRepository.count().block()).isEqualTo(<span class="hljs-number">2</span>);
        assertThat(<span class="hljs-keyword">this</span>.userRepository.findByAge(<span class="hljs-number">22</span>).collectList().block()).containsExactly(u1);
        assertThat(<span class="hljs-keyword">this</span>.userRepository.findByAgeNot(<span class="hljs-number">22</span>).collectList().block()).containsExactly(u2);
        assertThat(<span class="hljs-keyword">this</span>.userRepository.findByHomeAddressCountry(<span class="hljs-string">"USA"</span>).collectList().block()).containsExactly(u1);
        assertThat(<span class="hljs-keyword">this</span>.userRepository.findByFavoriteDrink(<span class="hljs-string">"wine"</span>).collectList().block()).containsExactly(u2);
        assertThat(<span class="hljs-keyword">this</span>.userRepository.findByAgeGreaterThanAndAgeLessThan(<span class="hljs-number">20</span>, <span class="hljs-number">30</span>).collectList().block())
                .containsExactly(u1);
        assertThat(<span class="hljs-keyword">this</span>.userRepository.findByAgeGreaterThan(<span class="hljs-number">10</span>).collectList().block()).containsExactlyInAnyOrder(u1,
                u2);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the query method implementations in <code>UserRepository</code> are generated based on the name of the methods using the <a href="https://docs.spring.io/spring-data/data-commons/docs/current/reference/html#repositories.query-methods.query-creation">Spring Data Query creation naming convention</a>.</p>
</div>
<div class="paragraph">
<p>Cloud Firestore only supports filter components joined by AND, and the following operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>equals</code></p>
</li>
<li>
<p><code>is not equal</code></p>
</li>
<li>
<p><code>greater than or equals</code></p>
</li>
<li>
<p><code>greater than</code></p>
</li>
<li>
<p><code>less than or equals</code></p>
</li>
<li>
<p><code>less than</code></p>
</li>
<li>
<p><code>is null</code></p>
</li>
<li>
<p><code>contains</code> (accepts a <code>List</code> with up to 10 elements, or a singular value)</p>
</li>
<li>
<p><code>in</code> (accepts a <code>List</code> with up to 10 elements)</p>
</li>
<li>
<p><code>not in</code> (accepts a <code>List</code> with up to 10 elements)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <code>in</code> operation is used in combination with <code>contains</code> operation, the argument to <code>contains</code> operation has to be a singular value.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>After writing a custom repository interface specifying just the signatures of these methods, implementations are generated for you and can be used with an auto-wired instance of the repository.</p>
</div>
</div>
<div class="sect2">
<h3 id="transactions-4"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#transactions-4"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#transactions-4">102.6. Transactions</a></h3>
<div class="paragraph">
<p>Read-only and read-write transactions are provided by <code>TransactionalOperator</code> (see this <a href="https://spring.io/blog/2019/05/16/reactive-transactions-with-spring">blog post</a> on reactive transactions for details).
In order to use it, you would need to autowire <code>ReactiveFirestoreTransactionManager</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApplication</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    ReactiveFirestoreTransactionManager txManager;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that you will be able to use it to create an instance of <code>TransactionalOperator</code>.
Note that you can switch between read-only and read-write transactions using <code>TransactionDefinition</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DefaultTransactionDefinition transactionDefinition = <span class="hljs-keyword">new</span> DefaultTransactionDefinition();
transactionDefinition.setReadOnly(<span class="hljs-keyword">false</span>);
TransactionalOperator operator = TransactionalOperator.create(<span class="hljs-keyword">this</span>.txManager, transactionDefinition);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you have an instance of <code>TransactionalOperator</code>, you can invoke a sequence of Firestore operations in a transaction by using <code>operator::transactional</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">User alice = <span class="hljs-keyword">new</span> User(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">29</span>);
User bob = <span class="hljs-keyword">new</span> User(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">60</span>);

<span class="hljs-keyword">this</span>.userRepository.save(alice)
        .then(<span class="hljs-keyword">this</span>.userRepository.save(bob))
        .as(operator::transactional)
        .block();

<span class="hljs-keyword">this</span>.userRepository.findAll()
        .flatMap(a -&gt; {
            a.setAge(a.getAge() - <span class="hljs-number">1</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.userRepository.save(a);
        })
        .as(operator::transactional).collectList().block();

assertThat(<span class="hljs-keyword">this</span>.userRepository.findAll().map(User::getAge).collectList().block())
        .containsExactlyInAnyOrder(<span class="hljs-number">28</span>, <span class="hljs-number">59</span>);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Read operations in a transaction can only happen before write operations.
All write operations are applied atomically.
Read documents are locked until the transaction finishes with a commit or a rollback, which are handled by Spring Data.
If an <code>Exception</code> is thrown within a transaction, the rollback operation is performed.
Otherwise, the commit operation is performed.
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="declarative-transactions-with-transactional-annotation-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#declarative-transactions-with-transactional-annotation-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#declarative-transactions-with-transactional-annotation-3">102.6.1. Declarative Transactions with @Transactional Annotation</a></h4>
<div class="paragraph">
<p>This feature requires a bean of <code>SpannerTransactionManager</code>, which is provided when using <code>spring-cloud-gcp-starter-data-firestore</code>.</p>
</div>
<div class="paragraph">
<p><code>FirestoreTemplate</code> and <code>FirestoreReactiveRepository</code> support running methods with the <code>@Transactional</code> <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#transaction-declarative">annotation</a> as transactions.
If a method annotated with <code>@Transactional</code> calls another method also annotated, then both methods will work within the same transaction.</p>
</div>
<div class="paragraph">
<p>One way to use this feature is illustrated here. You would need to do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Annotate your configuration class with the <code>@EnableTransactionManagement</code> annotation.</p>
</li>
<li>
<p>Create a service class that has methods annotated with <code>@Transactional</code>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserRepository userRepository;

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title">updateUsers</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.userRepository.findAll()
                .flatMap(a -&gt; {
                    a.setAge(a.getAge() - <span class="hljs-number">1</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.userRepository.save(a);
                })
                .then();
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Make a Spring Bean provider that creates an instance of that class:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> UserService <span class="hljs-title">userService</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserService();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that, you can autowire your service like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApplication</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    UserService userService;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now when you call the methods annotated with <code>@Transactional</code> on your service object, a transaction will be automatically started.
If an error occurs during the execution of a method annotated with <code>@Transactional</code>, the transaction will be rolled back.
If no error occurs, the transaction will be committed.</p>
</div>
</div>
<div class="sect3">
<h4 id="subcollections"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#subcollections"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#subcollections">102.6.2. Subcollections</a></h4>
<div class="paragraph">
<p>A subcollection is a collection associated with a specific entity.
Documents in subcollections can contain subcollections as well, allowing you to further nest data. You can nest data up to 100 levels deep.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Deleting a document does not delete its subcollections!
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To use subcollections you will need to create a <code>FirestoreReactiveOperations</code> object with a parent entity using <code>FirestoreReactiveOperations.withParent</code> call.
You can use this object to save, query and remove entities associated with this parent.
The parent doesn’t have to exist in Firestore, but should have a non-empty id field.</p>
</div>
<div class="paragraph">
<p>Autowire <code>FirestoreReactiveOperations</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
FirestoreReactiveOperations firestoreTemplate;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can use this object to create a <code>FirestoreReactiveOperations</code> object with a custom parent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">FirestoreReactiveOperations bobTemplate = <span class="hljs-keyword">this</span>.firestoreTemplate.withParent(<span class="hljs-keyword">new</span> User(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">60</span>));

PhoneNumber phoneNumber = <span class="hljs-keyword">new</span> PhoneNumber(<span class="hljs-string">"111-222-333"</span>);
bobTemplate.save(phoneNumber).block();
assertThat(bobTemplate.findAll(PhoneNumber.class).collectList().block()).containsExactly(phoneNumber);
bobTemplate.deleteAll(PhoneNumber.class).block();
assertThat(bobTemplate.findAll(PhoneNumber.class).collectList().block()).isEmpty();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cloud-firestore-spring-boot-starter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-firestore-spring-boot-starter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-firestore-spring-boot-starter">102.7. Cloud Firestore Spring Boot Starter</a></h3>
<div class="paragraph">
<p>If you prefer using Firestore client only, Spring Cloud GCP provides a convenience starter which automatically configures authentication settings and client objects needed to begin using <a href="https://cloud.google.com/firestore/">Google Cloud Firestore</a> in native mode.</p>
</div>
<div class="paragraph">
<p>See <a href="https://cloud.google.com/firestore/docs/">documentation</a> to learn more about Cloud Firestore.</p>
</div>
<div class="paragraph">
<p>To begin using this library, add the <code>spring-cloud-gcp-starter-firestore</code> artifact to your project.</p>
</div>
<div class="paragraph">
<p>Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-firestore<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
  implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-firestore"</span>)
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="using-cloud-firestore"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-cloud-firestore"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-cloud-firestore">102.7.1. Using Cloud Firestore</a></h4>
<div class="paragraph">
<p>The starter automatically configures and registers a <code>Firestore</code> bean in the Spring application context. To start using it, simply use the <code>@Autowired</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
Firestore firestore;

   <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">writeDocumentFromObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException </span>{
       <span class="hljs-comment">// Add document data with id "joe" using a custom User class</span>
       User data = <span class="hljs-keyword">new</span> User(<span class="hljs-string">"Joe"</span>,
               Arrays.asList(
                       <span class="hljs-keyword">new</span> Phone(<span class="hljs-number">12345</span>, PhoneType.CELL),
                       <span class="hljs-keyword">new</span> Phone(<span class="hljs-number">54321</span>, PhoneType.WORK)));

       <span class="hljs-comment">// .get() blocks on response</span>
       WriteResult writeResult = <span class="hljs-keyword">this</span>.firestore.document(<span class="hljs-string">"users/joe"</span>).set(data).get();

       LOGGER.info(<span class="hljs-string">"Update time: "</span> + writeResult.getUpdateTime());
   }

   <span class="hljs-function">User <span class="hljs-title">readDocumentToObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException </span>{
           ApiFuture&lt;DocumentSnapshot&gt; documentFuture =
                   <span class="hljs-keyword">this</span>.firestore.document(<span class="hljs-string">"users/joe"</span>).get();

           User user = documentFuture.get().toObject(User.class);

           LOGGER.info(<span class="hljs-string">"read: "</span> + user);

           <span class="hljs-keyword">return</span> user;
   }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="emulator-usage"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#emulator-usage"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#emulator-usage">102.8. Emulator Usage</a></h3>
<div class="paragraph">
<p>The Google Cloud Firebase SDK provides a local, in-memory emulator for Cloud Firestore, which you can use to develop and test your application.</p>
</div>
<div class="paragraph">
<p>First follow <a href="https://firebase.google.com/docs/emulator-suite/install_and_configure">the Firebase emulator installation steps</a> to install, configure, and run the emulator.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, the emulator is configured to run on port 8080; you will need to ensure that the emulator does not run on the same port as your Spring application.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Once the Firestore emulator is running, ensure that the following properties are set in your <code>application.properties</code> of your Spring application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.cloud.gcp.firestore.emulator.enabled=true
spring.cloud.gcp.firestore.host-port=${EMULATOR_HOSTPORT}</pre>
</div>
</div>
<div class="paragraph">
<p>From this point onward, your application will connect to your locally running emulator instance instead of the real Firestore service.</p>
</div>
</div>
<div class="sect2">
<h3 id="samples-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#samples-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#samples-3">102.9. Samples</a></h3>
<div class="paragraph">
<p>Spring Cloud GCP provides Firestore sample applications to demonstrate API usage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-data-firestore-sample">Reactive Firestore Repository sample application</a>:</p>
</li>
<li>
<p><a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-firestore-sample">Firestore Client Library sample application</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cloud-memorystore-for-redis"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-memorystore-for-redis"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-memorystore-for-redis">103. Cloud Memorystore for Redis</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="spring-caching"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-caching"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-caching">103.1. Spring Caching</a></h3>
<div class="paragraph">
<p><a href="https://cloud.google.com/memorystore/">Cloud Memorystore for Redis</a> provides a fully managed in-memory data store service.
Cloud Memorystore is compatible with the Redis protocol, allowing easy integration with <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-caching.html">Spring Caching</a>.</p>
</div>
<div class="paragraph">
<p>All you have to do is create a Cloud Memorystore instance and use its IP address in <code>application.properties</code> file as <code>spring.redis.host</code> property value.
Everything else is exactly the same as setting up redis-backed Spring caching.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Memorystore instances and your application instances have to be located in the same region.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In short, the following dependencies are needed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And then you can use <code>org.springframework.cache.annotation.Cacheable</code> annotation for methods you’d like to be cached.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Cacheable</span>(<span class="hljs-string">"cache1"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">(@PathVariable String name)</span> </span>{
    ....
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are interested in a detailed how-to guide, please check <a href="https://codelabs.developers.google.com/codelabs/cloud-spring-cache-memorystore/">Spring Boot Caching using Cloud Memorystore codelab</a>.</p>
</div>
<div class="paragraph">
<p>Cloud Memorystore documentation can be found <a href="https://cloud.google.com/memorystore/docs/redis/">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bigquery"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bigquery"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bigquery">104. BigQuery</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://cloud.google.com/bigquery">Google Cloud BigQuery</a> is a fully managed, petabyte scale, low cost analytics data warehouse.</p>
</div>
<div class="paragraph">
<p>Spring Cloud GCP provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A convenience starter which provides autoconfiguration for the <a href="https://googleapis.dev/java/google-cloud-clients/latest/com/google/cloud/bigquery/BigQuery.html"><code>BigQuery</code></a> client objects with credentials needed to interface with BigQuery.</p>
</li>
<li>
<p>A Spring Integration message handler for loading data into BigQuery tables in your Spring integration pipelines.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-bigquery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-bigquery"</span>)
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="configuration-11"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-11"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-11">104.1. Configuration</a></h3>
<div class="paragraph">
<p>The following application properties may be configured with Spring Cloud GCP BigQuery libraries.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.bigquery.datasetName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The BigQuery dataset that the <code>BigQueryTemplate</code> and <code>BigQueryFileMessageHandler</code> is scoped to.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.bigquery.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disables Spring Cloud GCP BigQuery autoconfiguration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.bigquery.project-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP project ID of the project using BigQuery APIs, if different from the one in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project ID is typically inferred from <a href="https://cloud.google.com/sdk/gcloud/reference/config/set"><code>gcloud</code></a> configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.bigquery.credentials.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Credentials file location for authenticating with the Google Cloud BigQuery APIs, if different from the ones in the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inferred from <a href="https://cloud.google.com/docs/authentication/production">Application Default Credentials</a>, typically set by <a href="https://cloud.google.com/sdk/gcloud/reference/auth/application-default"><code>gcloud</code></a>.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="bigquery-client-object"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bigquery-client-object"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bigquery-client-object">104.1.1. BigQuery Client Object</a></h4>
<div class="paragraph">
<p>The <code>GcpBigQueryAutoConfiguration</code> class configures an instance of <a href="https://googleapis.dev/java/google-cloud-clients/latest/com/google/cloud/bigquery/BigQuery.html"><code>BigQuery</code></a> for you by inferring your credentials and Project ID from the machine’s environment.</p>
</div>
<div class="paragraph">
<p>Example usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// BigQuery client object provided by our autoconfiguration.</span>
<span class="hljs-meta">@Autowired</span>
BigQuery bigquery;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">runQuery</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
  String query = <span class="hljs-string">"SELECT column FROM table;"</span>;
  QueryJobConfiguration queryConfig =
      QueryJobConfiguration.newBuilder(query).build();

  <span class="hljs-comment">// Run the query using the BigQuery object</span>
  <span class="hljs-keyword">for</span> (FieldValueList row : bigquery.query(queryConfig).iterateAll()) {
    <span class="hljs-keyword">for</span> (FieldValue val : row) {
      System.out.println(val);
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This object is used to interface with all BigQuery services.
For more information, see the <a href="https://cloud.google.com/bigquery/docs/reference/libraries#using_the_client_library">BigQuery Client Library usage examples</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="bigquerytemplate"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bigquerytemplate"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bigquerytemplate">104.1.2. BigQueryTemplate</a></h4>
<div class="paragraph">
<p>The <code>BigQueryTemplate</code> class is a wrapper over the <code>BigQuery</code> client object and makes it easier to load data into BigQuery tables.
A <code>BigQueryTemplate</code> is scoped to a single dataset.
The autoconfigured <code>BigQueryTemplate</code> instance will use the dataset provided through the property <code>spring.cloud.gcp.bigquery.datasetName</code>.</p>
</div>
<div class="paragraph">
<p>Below is a code snippet of how to load a CSV data <code>InputStream</code> to a BigQuery table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// BigQuery client object provided by our autoconfiguration.</span>
<span class="hljs-meta">@Autowired</span>
BigQueryTemplate bigQueryTemplate;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">loadData</span><span class="hljs-params">(InputStream dataInputStream, String tableName)</span> </span>{
  ListenableFuture&lt;Job&gt; bigQueryJobFuture =
      bigQueryTemplate.writeDataToTable(
          tableName,
          dataFile.getInputStream(),
          FormatOptions.csv());

  <span class="hljs-comment">// After the future is complete, the data is successfully loaded.</span>
  Job job = bigQueryJobFuture.get();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-integration-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-integration-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-integration-2">104.2. Spring Integration</a></h3>
<div class="paragraph">
<p>Spring Cloud GCP BigQuery also provides a Spring Integration message handler <code>BigQueryFileMessageHandler</code>.
This is useful for incorporating BigQuery data loading operations in a Spring Integration pipeline.</p>
</div>
<div class="paragraph">
<p>Below is an example configuring a <code>ServiceActivator</code> bean using the <code>BigQueryFileMessageHandler</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> DirectChannel <span class="hljs-title">bigQueryWriteDataChannel</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DirectChannel();
}

<span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> DirectChannel <span class="hljs-title">bigQueryJobReplyChannel</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DirectChannel();
}

<span class="hljs-meta">@Bean</span>
<span class="hljs-meta">@ServiceActivator</span>(inputChannel = <span class="hljs-string">"bigQueryWriteDataChannel"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> MessageHandler <span class="hljs-title">messageSender</span><span class="hljs-params">(BigQueryTemplate bigQueryTemplate)</span> </span>{
  BigQueryFileMessageHandler messageHandler = <span class="hljs-keyword">new</span> BigQueryFileMessageHandler(bigQueryTemplate);
  messageHandler.setFormatOptions(FormatOptions.csv());
  messageHandler.setOutputChannel(bigQueryJobReplyChannel());
  <span class="hljs-keyword">return</span> messageHandler;
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="bigquery-message-handling"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bigquery-message-handling"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bigquery-message-handling">104.2.1. BigQuery Message Handling</a></h4>
<div class="paragraph">
<p>The <code>BigQueryFileMessageHandler</code> accepts the following message payload types for loading into BigQuery: <code>java.io.File</code>, <code>byte[]</code>, <code>org.springframework.core.io.Resource</code>, and <code>java.io.InputStream</code>.
The message payload will be streamed and written to the BigQuery table you specify.</p>
</div>
<div class="paragraph">
<p>By default, the <code>BigQueryFileMessageHandler</code> is configured to read the headers of the messages it receives to determine how to load the data.
The headers are specified by the class <code>BigQuerySpringMessageHeaders</code> and summarized below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BigQuerySpringMessageHeaders.TABLE_NAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the BigQuery table within your dataset to write to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BigQuerySpringMessageHeaders.FORMAT_OPTIONS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Describes the data format of your data to load (i.e. CSV, JSON, etc.).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Alternatively, you may omit these headers and explicitly set the table name or format options by calling <code>setTableName(…​)</code> and <code>setFormatOptions(…​)</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="bigquery-message-reply"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bigquery-message-reply"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#bigquery-message-reply">104.2.2. BigQuery Message Reply</a></h4>
<div class="paragraph">
<p>After the <code>BigQueryFileMessageHandler</code> processes a message to load data to your BigQuery table, it will respond with a <code>Job</code> on the reply channel.
The <a href="https://googleapis.dev/java/google-cloud-clients/latest/index.html?com/google/cloud/bigquery/package-summary.html">Job object</a> provides metadata and information about the load file operation.</p>
</div>
<div class="paragraph">
<p>By default, the <code>BigQueryFileMessageHandler</code> is run in asynchronous mode, with <code>setSync(false)</code>, and it will reply with a <code>ListenableFuture&lt;Job&gt;</code> on the reply channel.
The future is tied to the status of the data loading job and will complete when the job completes.</p>
</div>
<div class="paragraph">
<p>If the handler is run in synchronous mode with <code>setSync(true)</code>, then the handler will block on the completion of the loading job and block until it is complete.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you decide to use Spring Integration Gateways and you wish to receive <code>ListenableFuture&lt;Job&gt;</code> as a reply object in the Gateway, you will have to call <code>.setAsyncExecutor(null)</code> on your <code>GatewayProxyFactoryBean</code>.
This is needed to indicate that you wish to reply on the built-in async support rather than rely on async handling of the gateway.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sample-10"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-10"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-10">104.3. Sample</a></h3>
<div class="paragraph">
<p>A BigQuery <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-bigquery-sample">sample application</a> is available.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cloud-iap"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-iap"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-iap">105. Cloud IAP</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://cloud.google.com/iap/">Cloud Identity-Aware Proxy (IAP)</a> provides a security layer over applications deployed to Google Cloud.</p>
</div>
<div class="paragraph">
<p>The IAP starter uses <a href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#oauth2resourceserver">Spring Security OAuth 2.0 Resource Server</a> functionality to automatically extract user identity from the proxy-injected <code>x-goog-iap-jwt-assertion</code> HTTP header.</p>
</div>
<div class="paragraph">
<p>The following claims are validated automatically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Issue time</p>
</li>
<li>
<p>Expiration time</p>
</li>
<li>
<p>Issuer</p>
</li>
<li>
<p>Audience</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>audience</em> (<code>"aud"</code> claim) validation string is automatically determined when the application is running on App Engine Standard or App Engine Flexible.
This functionality relies on Cloud Resource Manager API to retrieve project details, so the following setup is needed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable Cloud Resource Manager API in <a href="https://console.developers.google.com/apis/api/cloudresourcemanager.googleapis.com">GCP Console</a>.</p>
</li>
<li>
<p>Make sure your application has <code>resourcemanager.projects.get</code> permission.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>App Engine automatic <em>audience</em> determination can be overridden by using <code>spring.cloud.gcp.security.iap.audience</code> property. It supports multiple allowable audiences by providing a comma-delimited list.</p>
</div>
<div class="paragraph">
<p>For Compute Engine or Kubernetes Engine <code>spring.cloud.gcp.security.iap.audience</code> property <strong>must</strong> be provided, as the <em>audience</em> string depends on the specific Backend Services setup and cannot be inferred automatically.
To determine the <em>audience</em> value, follow directions in IAP <a href="https://cloud.google.com/iap/docs/signed-headers-howto#verify_the_jwt_payload">Verify the JWT payload</a> guide.
If <code>spring.cloud.gcp.security.iap.audience</code> is not provided, the application will fail to start the following message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">No qualifying bean of <span class="hljs-built_in">type</span> <span class="hljs-string">'org.springframework.cloud.gcp.security.iap.AudienceProvider'</span> available.</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you create a custom <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/configuration/WebSecurityConfigurerAdapter.html"><code>WebSecurityConfigurerAdapter</code></a>, enable extracting user identity by adding <code>.oauth2ResourceServer().jwt()</code> configuration to the <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/builders/HttpSecurity.html"><code>HttpSecurity</code></a> object.
If no custom <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/configuration/WebSecurityConfigurerAdapter.html"><code>WebSecurityConfigurerAdapter</code></a> is present, nothing needs to be done because Spring Boot will add this customization by default.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Starter Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-security-iap<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Starter Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-security-iap"</span>)
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="configuration-12"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-12"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-12">105.1. Configuration</a></h3>
<div class="paragraph">
<p>The following properties are available.</p>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Modifying registry, algorithm, and header properties might be useful for testing, but the defaults should not be changed in production.
</td>
</tr>
</tbody></table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.security.iap.registry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link to JWK public key registry.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="https://www.gstatic.com/iap/verify/public_key-jwk" class="bare">www.gstatic.com/iap/verify/public_key-jwk</a></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.security.iap.algorithm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encryption algorithm used to sign the JWK token.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ES256</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.security.iap.header</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Header from which to extract the JWK key.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x-goog-iap-jwt-assertion</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.security.iap.issuer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWK issuer to verify.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="https://cloud.google.com/iap" class="bare">cloud.google.com/iap</a></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.security.iap.audience</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom JWK audience to verify.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false on App Engine; true on GCE/GKE</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="sample-11"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-11"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-11">105.2. Sample</a></h3>
<div class="paragraph">
<p>A <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-security-iap-sample">sample application</a> is available.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cloud-vision"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-vision"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-vision">106. Cloud Vision</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://cloud.google.com/vision/">Google Cloud Vision API</a> allows users to leverage machine learning algorithms for processing images and documents including: image classification, face detection, text extraction, optical character recognition, and others.</p>
</div>
<div class="paragraph">
<p>Spring Cloud GCP provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A convenience starter which automatically configures authentication settings and client objects needed to begin using the <a href="https://cloud.google.com/vision/">Google Cloud Vision API</a>.</p>
</li>
<li>
<p><code>CloudVisionTemplate</code> which simplifies interactions with the Cloud Vision API.</p>
<div class="ulist">
<ul>
<li>
<p>Allows you to easily send images to the API as Spring Resources.</p>
</li>
<li>
<p>Offers convenience methods for common operations, such as classifying content of an image.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>DocumentOcrTemplate</code> which offers convenient methods for running <a href="https://cloud.google.com/vision/docs/pdf">optical character recognition (OCR)</a> on PDF and TIFF documents.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="dependency-setup"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dependency-setup"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dependency-setup">106.1. Dependency Setup</a></h3>
<div class="paragraph">
<p>To begin using this library, add the <code>spring-cloud-gcp-starter-vision</code> artifact to your project.</p>
</div>
<div class="paragraph">
<p>Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-vision<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
  implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-vision"</span>)
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-13"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-13"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-13">106.2. Configuration</a></h3>
<div class="paragraph">
<p>The following options may be configured with Spring Cloud GCP Vision libraries.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.vision.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disables Cloud Vision autoconfiguration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.vision.executors-threads-count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of threads used during document OCR processing for waiting on long-running OCR operations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.vision.json-output-batch-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of document pages to include in each OCR output file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="cloud-vision-ocr-dependencies"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-vision-ocr-dependencies"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-vision-ocr-dependencies">106.2.1. Cloud Vision OCR Dependencies</a></h4>
<div class="paragraph">
<p>If you are interested in applying optical character recognition (OCR) on documents for your project, you’ll need to add both <code>spring-cloud-gcp-starter-vision</code> and <code>spring-cloud-gcp-starter-storage</code> to your dependencies.
The storage starter is necessary because the Cloud Vision API will process your documents and write OCR output files all within your Google Cloud Storage buckets.</p>
</div>
<div class="paragraph">
<p>Maven coordinates using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-vision<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-storage<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
  implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-vision"</span>)
  implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-storage"</span>)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="image-analysis"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#image-analysis"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#image-analysis">106.3. Image Analysis</a></h3>
<div class="paragraph">
<p>The <code>CloudVisionTemplate</code> allows you to easily analyze images; it provides the following method for interfacing with Cloud Vision:</p>
</div>
<div class="paragraph">
<p><code>public AnnotateImageResponse analyzeImage(Resource imageResource, Feature.Type…​ featureTypes)</code></p>
</div>
<div class="paragraph">
<p><strong>Parameters:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Resource imageResource</code> refers to the Spring Resource of the image object you wish to analyze.
The Google Cloud Vision documentation provides a <a href="https://cloud.google.com/vision/docs/supported-files">list of the image types that they support</a>.</p>
</li>
<li>
<p><code>Feature.Type…​ featureTypes</code> refers to a var-arg array of Cloud Vision Features to extract from the image.
A feature refers to a kind of image analysis one wishes to perform on an image, such as label detection, OCR recognition, facial detection, etc.
One may specify multiple features to analyze within one request.
A full list of Cloud Vision Features is provided in the <a href="https://cloud.google.com/vision/docs/features">Cloud Vision Feature docs</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Returns:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://cloud.google.com/vision/docs/reference/rpc/google.cloud.vision.v1#google.cloud.vision.v1.AnnotateImageResponse"><code>AnnotateImageResponse</code></a> contains the results of all the feature analyses that were specified in the request.
For each feature type that you provide in the request, <code>AnnotateImageResponse</code> provides a getter method to get the result of that feature analysis.
For example, if you analyzed an image using the <code>LABEL_DETECTION</code> feature, you would retrieve the results from the response using <code>annotateImageResponse.getLabelAnnotationsList()</code>.</p>
<div class="paragraph">
<p><code>AnnotateImageResponse</code> is provided by the Google Cloud Vision libraries; please consult the <a href="https://cloud.google.com/vision/docs/reference/rpc/google.cloud.vision.v1#google.cloud.vision.v1.AnnotateImageResponse">RPC reference</a> or <a href="https://googleapis.github.io/googleapis/java/all/latest/apidocs/com/google/cloud/vision/v1/AnnotateImageResponse.html">Javadoc</a> for more details.
Additionally, you may consult the <a href="https://cloud.google.com/vision/docs/">Cloud Vision docs</a> to familiarize yourself with the concepts and features of the API.</p>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="detect-image-labels-example"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#detect-image-labels-example"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#detect-image-labels-example">106.3.1. Detect Image Labels Example</a></h4>
<div class="paragraph">
<p><a href="https://cloud.google.com/vision/docs/detecting-labels">Image labeling</a> refers to producing labels that describe the contents of an image.
Below is a code sample of how this is done using the Cloud Vision Spring Template.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> ResourceLoader resourceLoader;

<span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> CloudVisionTemplate cloudVisionTemplate;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processImage</span><span class="hljs-params">()</span> </span>{
  Resource imageResource = <span class="hljs-keyword">this</span>.resourceLoader.getResource(<span class="hljs-string">"my_image.jpg"</span>);
  AnnotateImageResponse response = <span class="hljs-keyword">this</span>.cloudVisionTemplate.analyzeImage(
      imageResource, Type.LABEL_DETECTION);
  System.out.println(<span class="hljs-string">"Image Classification results: "</span> + response.getLabelAnnotationsList());
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="document-ocr-template"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#document-ocr-template"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#document-ocr-template">106.4. Document OCR Template</a></h3>
<div class="paragraph">
<p>The <code>DocumentOcrTemplate</code> allows you to easily run <a href="https://cloud.google.com/vision/docs/pdf">optical character recognition (OCR)</a> on your PDF and TIFF documents stored in your Google Storage bucket.</p>
</div>
<div class="paragraph">
<p>First, you will need to create a bucket in <a href="https://console.cloud.google.com/storage">Google Cloud Storage</a> and <a href="https://cloud.google.com/storage/docs/uploading-objects#storage-upload-object-java">upload the documents you wish to process into the bucket</a>.</p>
</div>
<div class="sect3">
<h4 id="running-ocr-on-a-document"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#running-ocr-on-a-document"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#running-ocr-on-a-document">106.4.1. Running OCR on a Document</a></h4>
<div class="paragraph">
<p>When OCR is run on a document, the Cloud Vision APIs will output a collection of OCR output files in JSON which describe the text content, bounding rectangles of words and letters, and other information about the document.</p>
</div>
<div class="paragraph">
<p>The <code>DocumentOcrTemplate</code> provides the following method for running OCR on a document saved in Google Cloud Storage:</p>
</div>
<div class="paragraph">
<p><code>ListenableFuture&lt;DocumentOcrResultSet&gt; runOcrForDocument(GoogleStorageLocation document, GoogleStorageLocation outputFilePathPrefix)</code></p>
</div>
<div class="paragraph">
<p>The method allows you to specify the location of the document and the output location for where all the JSON output files will be saved in Google Cloud Storage.
It returns a <code>ListenableFuture</code> containing <code>DocumentOcrResultSet</code> which contains the OCR content of the document.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Running OCR on a document is an operation that can take between several minutes to several hours depending on how large the document is.
It is recommended to register callbacks to the returned ListenableFuture or ignore it and process the JSON output files at a later point in time using <code>readOcrOutputFile</code> or <code>readOcrOutputFileSet</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="running-ocr-example"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#running-ocr-example"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#running-ocr-example">106.4.2. Running OCR Example</a></h4>
<div class="paragraph">
<p>Below is a code snippet of how to run OCR on a document stored in a Google Storage bucket and read the text in the first page of the document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@Autowired
private DocumentOcrTemplate documentOcrTemplate;

public void runOcrOnDocument() {
    GoogleStorageLocation document = GoogleStorageLocation.forFile(
            "your-bucket", "test.pdf");
    GoogleStorageLocation outputLocationPrefix = GoogleStorageLocation.forFolder(
            "your-bucket", "output_folder/test.pdf/");

    ListenableFuture&lt;DocumentOcrResultSet&gt; result =
        this.documentOcrTemplate.runOcrForDocument(
            document, outputLocationPrefix);

    DocumentOcrResultSet ocrPages = result.get(5, TimeUnit.MINUTES);

    String page1Text = ocrPages.getPage(1).getText();
    System.out.println(page1Text);
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reading-ocr-output-files"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reading-ocr-output-files"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reading-ocr-output-files">106.4.3. Reading OCR Output Files</a></h4>
<div class="paragraph">
<p>In some use-cases, you may need to directly read OCR output files stored in Google Cloud Storage.</p>
</div>
<div class="paragraph">
<p><code>DocumentOcrTemplate</code> offers the following methods for reading and processing OCR output files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>readOcrOutputFileSet(GoogleStorageLocation jsonOutputFilePathPrefix)</code>:
Reads a collection of OCR output files under a file path prefix and returns the parsed contents.
All of the files under the path should correspond to the same document.</p>
</li>
<li>
<p><code>readOcrOutputFile(GoogleStorageLocation jsonFile)</code>:
Reads a single OCR output file and returns the parsed contents.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="reading-ocr-output-files-example"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reading-ocr-output-files-example"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reading-ocr-output-files-example">106.4.4. Reading OCR Output Files Example</a></h4>
<div class="paragraph">
<p>The code snippet below describes how to read the OCR output files of a single document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@Autowired
private DocumentOcrTemplate documentOcrTemplate;

// Parses the OCR output files corresponding to a single document in a directory
public void parseOutputFileSet() {
  GoogleStorageLocation ocrOutputPrefix = GoogleStorageLocation.forFolder(
      "your-bucket", "json_output_set/");

  DocumentOcrResultSet result = this.documentOcrTemplate.readOcrOutputFileSet(ocrOutputPrefix);
  System.out.println("Page 2 text: " + result.getPage(2).getText());
}

// Parses a single OCR output file
public void parseSingleOutputFile() {
  GoogleStorageLocation ocrOutputFile = GoogleStorageLocation.forFile(
      "your-bucket", "json_output_set/test_output-2-to-2.json");

  DocumentOcrResultSet result = this.documentOcrTemplate.readOcrOutputFile(ocrOutputFile);
  System.out.println("Page 2 text: " + result.getPage(2).getText());
}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sample-12"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-12"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-12">106.5. Sample</a></h3>
<div class="paragraph">
<p>Samples are provided to show example usages of Spring Cloud GCP with Google Cloud Vision.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-vision-api-sample">Image Labeling Sample</a> shows you how to use image labelling in your Spring application.
The application generates labels describing the content inside the images you specify in the application.</p>
</li>
<li>
<p>The <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-vision-ocr-demo">Document OCR demo</a> shows how you can apply OCR processing on your PDF/TIFF documents in order to extract their text contents.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="secret-manager"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#secret-manager"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#secret-manager">107. Secret Manager</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://cloud.google.com/secret-manager">Google Cloud Secret Manager</a> is a secure and convenient method for storing API keys, passwords, certificates, and other sensitive data.
A detailed summary of its features can be found in the <a href="https://cloud.google.com/blog/products/identity-security/introducing-google-clouds-secret-manager">Secret Manager documentation</a>.</p>
</div>
<div class="paragraph">
<p>Spring Cloud GCP provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A property source which allows you to specify and load the secrets of your GCP project into your application context as a <a href="https://cloud.spring.io/spring-cloud-commons/multi/multi__spring_cloud_context_application_context_services.html#_the_bootstrap_application_context">Bootstrap Property Source</a>.</p>
</li>
<li>
<p>A <code>SecretManagerTemplate</code> which allows you to read, write, and update secrets in Secret Manager.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="dependency-setup-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dependency-setup-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dependency-setup-2">107.1. Dependency Setup</a></h3>
<div class="paragraph">
<p>To begin using this library, add the <code>spring-cloud-gcp-starter-secretmanager</code> artifact to your project.</p>
</div>
<div class="paragraph">
<p>Maven coordinates, using <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#_bill_of_materials">Spring Cloud GCP BOM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-secretmanager<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
  implementation(<span class="hljs-string">"org.springframework.cloud:spring-cloud-gcp-starter-secretmanager"</span>)
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="configuration-14"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-14"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-14">107.1.1. Configuration</a></h4>
<div class="paragraph">
<p>By default, Spring Cloud GCP Secret Manager will authenticate using Application Default Credentials.
This can be overridden using the authentication properties.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All of the below settings must be specified in a <a href="https://cloud.spring.io/spring-cloud-commons/multi/multi__spring_cloud_context_application_context_services.html#_the_bootstrap_application_context"><code>bootstrap.properties</code></a> (or <code>bootstrap.yaml</code>) file which is the properties file used to configure settings for bootstrap-phase Spring configuration.
</td>
</tr>
</tbody></table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.secretmanager.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the Secret Manager bootstrap property and template configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.secretmanager.credentials.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth2 credentials for authenticating to the Google Cloud Secret Manager API.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, infers credentials from <a href="https://cloud.google.com/docs/authentication/production">Application Default Credentials</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.secretmanager.credentials.encoded-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base64-encoded contents of OAuth2 account private key for authenticating to the Google Cloud Secret Manager API.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, infers credentials from <a href="https://cloud.google.com/docs/authentication/production">Application Default Credentials</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.secretmanager.project-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default GCP Project used to access Secret Manager API for the template and property source.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, infers the project from <a href="https://cloud.google.com/docs/authentication/production">Application Default Credentials</a>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="secret-manager-property-source"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#secret-manager-property-source"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#secret-manager-property-source">107.2. Secret Manager Property Source</a></h3>
<div class="paragraph">
<p>The Spring Cloud GCP integration for Google Cloud Secret Manager enables you to use Secret Manager as a bootstrap property source.</p>
</div>
<div class="paragraph">
<p>This allows you to specify and load secrets from Google Cloud Secret Manager as properties into the application context during the <a href="https://cloud.spring.io/spring-cloud-commons/reference/html/#the-bootstrap-application-context">Bootstrap Phase</a>, which refers to the initial phase when a Spring application is being loaded.</p>
</div>
<div class="paragraph">
<p>The Secret Manager property source uses the following syntax to specify secrets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"># <span class="hljs-number">1</span>. <span class="hljs-keyword">Long</span> form - specify the <span class="hljs-keyword">project</span> ID, secret ID, and version
sm:<span class="hljs-comment">//projects/&lt;project-id&gt;/secrets/&lt;secret-id&gt;/versions/&lt;version-id&gt;}</span>

# <span class="hljs-number">2</span>.  <span class="hljs-keyword">Long</span> form - specify <span class="hljs-keyword">project</span> ID, secret ID, and use latest version
sm:<span class="hljs-comment">//projects/&lt;project-id&gt;/secrets/&lt;secret-id&gt;</span>

# <span class="hljs-number">3</span>. <span class="hljs-keyword">Short</span> form - specify <span class="hljs-keyword">project</span> ID, secret ID, and version
sm:<span class="hljs-comment">//&lt;project-id&gt;/&lt;secret-id&gt;/&lt;version-id&gt;</span>

# <span class="hljs-number">4</span>. <span class="hljs-keyword">Short</span> form - <span class="hljs-keyword">default</span> <span class="hljs-keyword">project</span>; specify secret + version
#
# The <span class="hljs-keyword">project</span> is inferred <span class="hljs-keyword">from</span> the spring.cloud.gcp.secretmanager.<span class="hljs-keyword">project</span>-id setting
# in your bootstrap.properties (see Configuration) or <span class="hljs-keyword">from</span> application-<span class="hljs-keyword">default</span> credentials <span class="hljs-keyword">if</span>
# <span class="hljs-keyword">this</span> is not set.
sm:<span class="hljs-comment">//&lt;secret-id&gt;/&lt;version&gt;</span>

# <span class="hljs-number">5</span>. Shortest form - specify secret ID, use <span class="hljs-keyword">default</span> <span class="hljs-keyword">project</span> and latest version.
sm:<span class="hljs-comment">//&lt;secret-id&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use this syntax in the following places:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your <code>application.properties</code> or <code>bootstrap.properties</code> files:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-comment"># Example of the project-secret long-form syntax.</span>
spring.datasource.password=<span class="hljs-variable">${sm://projects/my-gcp-project/secrets/my-secret}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Access the value using the <code>@Value</code> annotation.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs kotlin"><span class="hljs-comment">// Example of using shortest form syntax.</span>
<span class="hljs-meta">@Value(<span class="hljs-meta-string">"<span class="hljs-subst">${sm://my-secret}</span>"</span>)</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="secret-manager-template"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#secret-manager-template"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#secret-manager-template">107.3. Secret Manager Template</a></h3>
<div class="paragraph">
<p>The <code>SecretManagerTemplate</code> class simplifies operations of creating, updating, and reading secrets.</p>
</div>
<div class="paragraph">
<p>To begin using this class, you may inject an instance of the class using <code>@Autowired</code> after adding the starter dependency to your project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> SecretManagerTemplate secretManagerTemplate;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please consult <a href="https://github.com/spring-cloud/spring-cloud-gcp/blob/master/spring-cloud-gcp-secretmanager/src/main/java/org/springframework/cloud/gcp/secretmanager/SecretManagerOperations.java"><code>SecretManagerOperations</code></a> for information on what operations are available for the Secret Manager template.</p>
</div>
</div>
<div class="sect2">
<h3 id="sample-13"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-13"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-13">107.4. Sample</a></h3>
<div class="paragraph">
<p>A <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-secretmanager-sample">Secret Manager Sample Application</a> is provided which demonstrates basic property source loading and usage of the template class.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cloud-runtime-configuration-api"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-runtime-configuration-api"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-runtime-configuration-api">108. Cloud Runtime Configuration API</a></h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The Google Cloud Runtime Configuration service is in <strong>Beta</strong> status, and is only available in snapshot and milestone versions of the project. It’s also not available in the Spring Cloud GCP BOM, unlike other modules.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Spring Cloud GCP makes it possible to use the <a href="https://cloud.google.com/deployment-manager/runtime-configurator/reference/rest/">Google Runtime Configuration API</a> as a <a href="https://cloud.spring.io/spring-cloud-config/">Spring Cloud Config</a> server to remotely store your application configuration data.</p>
</div>
<div class="paragraph">
<p>The Spring Cloud GCP Config support is provided via its own Spring Boot starter.
It enables the use of the Google Runtime Configuration API as a source for Spring Boot configuration properties.</p>
</div>
<div class="paragraph">
<p>Maven coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    <span class="hljs-keyword">compile</span> <span class="hljs-keyword">group</span>: <span class="hljs-string">'org.springframework.cloud'</span>,
    name: <span class="hljs-string">'spring-cloud-gcp-starter-config'</span>,
    version: <span class="hljs-string">'1.2.7.RELEASE'</span>
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="configuration-15"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-15"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-15">108.1. Configuration</a></h3>
<div class="paragraph">
<p>The following parameters are configurable in Spring Cloud GCP Config:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.config.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the Config client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.config.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of your application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of the <code>spring.application.name</code> property.
If none, <code>application</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.config.profile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active profile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of the <code>spring.profiles.active</code> property.
If more than a single profile, last one is chosen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.config.timeout-millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout in milliseconds for connecting to the Google Runtime Configuration API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>60000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.config.project-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP project ID where the Google Runtime Configuration API is hosted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.config.credentials.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth2 credentials for authenticating with the Google Runtime Configuration API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.config.credentials.encoded-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base64-encoded OAuth2 credentials for authenticating with the Google Runtime Configuration API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.gcp.config.credentials.scopes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developers.google.com/identity/protocols/googlescopes">OAuth2 scope</a> for Spring Cloud GCP Config credentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.googleapis.com/auth/cloudruntimeconfig" class="bare">www.googleapis.com/auth/cloudruntimeconfig</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These properties should be specified in a <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud.html#_the_bootstrap_application_context"><code>bootstrap.yml</code>/<code>bootstrap.properties</code></a> file, rather than the usual <code>applications.yml</code>/<code>application.properties</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Core properties, as described in <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-gcp-core">Spring Cloud GCP Core Module</a>, do not apply to Spring Cloud GCP Config.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="quick-start-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quick-start-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quick-start-3">108.2. Quick start</a></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a configuration in the Google Runtime Configuration API that is called <code>${spring.application.name}_${spring.profiles.active}</code>.
In other words, if <code>spring.application.name</code> is <code>myapp</code> and <code>spring.profiles.active</code> is <code>prod</code>, the configuration should be called <code>myapp_prod</code>.</p>
<div class="paragraph">
<p>In order to do that, you should have the <a href="https://cloud.google.com/sdk/">Google Cloud SDK</a> installed, own a Google Cloud Project and run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">gcloud init <span class="hljs-comment"># if this is your first Google Cloud SDK run.</span>
gcloud beta runtime-config configs <span class="hljs-keyword">create</span> myapp_prod
gcloud beta runtime-config configs <span class="hljs-keyword">variables</span> <span class="hljs-keyword">set</span> myapp.queue-<span class="hljs-keyword">size</span> <span class="hljs-number">25</span> <span class="hljs-comment">--config-name myapp_prod</span></code></pre>
</div>
</div>
</li>
<li>
<p>Configure your <code>bootstrap.properties</code> file with your application’s configuration data:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs">spring.application.name=myapp
spring.profiles.active=prod</code></pre>
</div>
</div>
</li>
<li>
<p>Add the <code>@ConfigurationProperties</code> annotation to a Spring-managed bean:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@ConfigurationProperties</span>(<span class="hljs-string">"myapp"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SampleConfig</span> </span>{

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> queueSize;

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getQueueSize</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.queueSize;
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setQueueSize</span><span class="hljs-params">(<span class="hljs-keyword">int</span> queueSize)</span> </span>{
    <span class="hljs-keyword">this</span>.queueSize = queueSize;
  }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>When your Spring application starts, the <code>queueSize</code> field value will be set to 25 for the above <code>SampleConfig</code> bean.</p>
</div>
</div>
<div class="sect2">
<h3 id="refreshing-the-configuration-at-runtime"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#refreshing-the-configuration-at-runtime"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#refreshing-the-configuration-at-runtime">108.3. Refreshing the configuration at runtime</a></h3>
<div class="paragraph">
<p><a href="https://cloud.spring.io/spring-cloud-static/docs/1.0.x/spring-cloud.html#_endpoints">Spring Cloud</a> provides support to have configuration parameters be reloadable with the POST request to <code>/actuator/refresh</code> endpoint.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the Spring Boot Actuator dependency:</p>
<div class="paragraph">
<p>Maven coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Gradle coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle"><span class="hljs-keyword">dependencies</span> {
    implementation(<span class="hljs-string">"org.springframework.boot:spring-boot-starter-actuator"</span>)
}</code></pre>
</div>
</div>
</li>
<li>
<p>Add <code>@RefreshScope</code> to your Spring configuration class to have parameters be reloadable at runtime.</p>
</li>
<li>
<p>Add <code>management.endpoints.web.exposure.include=refresh</code> to your <code>application.properties</code> to allow unrestricted access to <code>/actuator/refresh</code>.</p>
</li>
<li>
<p>Update a property with <code>gcloud</code>:</p>
<div class="literalblock">
<div class="content">
<pre>$ gcloud beta runtime-config configs variables set \
  myapp.queue_size 200 \
  --config-name myapp_prod</pre>
</div>
</div>
</li>
<li>
<p>Send a POST request to the refresh endpoint:</p>
<div class="literalblock">
<div class="content">
<pre>$ curl -XPOST https://myapp.host.com/actuator/refresh</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sample-14"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-14"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-14">108.4. Sample</a></h3>
<div class="paragraph">
<p>A <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-samples/spring-cloud-gcp-config-sample">sample application</a> and a <a href="https://codelabs.developers.google.com/codelabs/cloud-spring-runtime-config/index.html">codelab</a> are available.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cloud-foundry"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-foundry"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cloud-foundry">109. Cloud Foundry</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud GCP provides support for Cloud Foundry’s <a href="https://docs.pivotal.io/partners/gcp-sb/index.html">GCP Service Broker</a>.
Our Pub/Sub, Cloud Spanner, Storage, Stackdriver Trace and Cloud SQL MySQL and PostgreSQL starters are Cloud Foundry aware and retrieve properties like project ID, credentials, etc., that are used in auto configuration from the Cloud Foundry environment.</p>
</div>
<div class="paragraph">
<p>In order to take advantage of the Cloud Foundry support make sure the following dependency is added:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-gcp-starter-cloudfoundry<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In cases like Pub/Sub’s topic and subscription, or Storage’s bucket name, where those parameters are not used in auto configuration, you can fetch them using the VCAP mapping provided by Spring Boot.
For example, to retrieve the provisioned Pub/Sub topic, you can use the <code>vcap.services.mypubsub.credentials.topic_name</code> property from the application environment.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the same service is bound to the same application more than once, the auto configuration will not be able to choose among bindings and will not be activated for that service.
This includes both MySQL and PostgreSQL bindings to the same app.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In order for the Cloud SQL integration to work in Cloud Foundry, auto-reconfiguration must be disabled.
You can do so using the <code>cf set-env &lt;APP&gt; JBP_CONFIG_SPRING_AUTO_RECONFIGURATION '{enabled: false}'</code> command.
Otherwise, Cloud Foundry will produce a <code>DataSource</code> with an invalid JDBC URL (i.e., <code>jdbc:mysql://null/null</code>).
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="user-provided-services"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#user-provided-services"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#user-provided-services">109.1. User-Provided Services</a></h3>
<div class="paragraph">
<p><a href="https://docs.cloudfoundry.org/devguide/services/user-provided.html">User-provided services</a> enable developers to use services that are not available in the marketplace with their apps running on Cloud Foundry.
For example, you may want to use a user-provided service that points to a shared Google Service (like Cloud Spanner) used across your organization.</p>
</div>
<div class="paragraph">
<p>In order for Spring Cloud GCP to detect your user-provided service as a Google Cloud Service, you must add an <a href="https://docs.cloudfoundry.org/devguide/services/managing-services.html#instance-tags-create">instance tag</a> indicating the Google Cloud Service it uses.
The tag should simply be the Cloud Foundry name for the Google Service.</p>
</div>
<div class="paragraph">
<p>For example, if you create a user-provided service using Cloud Spanner, you might run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"><span class="hljs-meta">$</span><span class="bash"> cf create-user-provided-service user-spanner-service -t <span class="hljs-string">"google-spanner"</span> ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows Spring Cloud GCP to retrieve the correct service properties from Cloud Foundry and use them in the auto configuration for your application.</p>
</div>
<div class="paragraph">
<p>A mapping of Google service names to Cloud Foundry names are provided below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Cloud Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Foundry Name (add this as a tag)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://cloud.google.com/pubsub">Google Cloud Pub/Sub</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google-pubsub</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://cloud.google.com/storage">Google Cloud Storage</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google-storage</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://cloud.google.com/spanner">Google Cloud Spanner</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google-spanner</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://cloud.google.com/datastore">Datastore</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google-datastore</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://cloud.google.com/firestore">Firestore</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google-firestore</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://cloud.google.com/bigquery">BigQuery</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google-bigquery</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://cloud.google.com/products/operations">Stackdriver Trace</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google-stackdriver-trace</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://cloud.google.com/sql">Cloud Sql (MySQL)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google-cloudsql-mysql</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://cloud.google.com/sql">Cloud Sql (PostgreSQL)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google-cloudsql-postgres</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kotlin-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kotlin-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kotlin-support">110. Kotlin Support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The latest version of the Spring Framework provides first-class support for Kotlin.
For Kotlin users of Spring, the Spring Cloud GCP libraries work out-of-the-box and are fully interoperable with Kotlin applications.</p>
</div>
<div class="paragraph">
<p>For more information on building a Spring application in Kotlin, please consult the <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/languages.html#kotlin">Spring Kotlin documentation</a>.</p>
</div>
<div class="sect2">
<h3 id="prerequisites-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#prerequisites-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#prerequisites-2">110.1. Prerequisites</a></h3>
<div class="paragraph">
<p>Ensure that your Kotlin application is properly set up.
Based on your build system, you will need to include the correct Kotlin build plugin in your project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://kotlinlang.org/docs/reference/using-maven.html">Kotlin Maven Plugin</a></p>
</li>
<li>
<p><a href="https://kotlinlang.org/docs/reference/using-gradle.html">Kotlin Gradle Plugin</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Depending on your application’s needs, you may need to augment your build configuration with compiler plugins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://kotlinlang.org/docs/reference/compiler-plugins.html#spring-support">Kotlin Spring Plugin</a>: Makes your Spring configuration classes/members non-final for convenience.</p>
</li>
<li>
<p><a href="https://kotlinlang.org/docs/reference/compiler-plugins.html#jpa-support">Kotlin JPA Plugin</a>: Enables using JPA in Kotlin applications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once your Kotlin project is properly configured, the Spring Cloud GCP libraries will work within your application without any additional setup.</p>
</div>
</div>
<div class="sect2">
<h3 id="sample-15"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-15"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sample-15">110.2. Sample</a></h3>
<div class="paragraph">
<p>A <a href="https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-kotlin-samples/spring-cloud-gcp-kotlin-app-sample">Kotlin sample application</a> is provided to demonstrate a working Maven setup and various Spring Cloud GCP integrations from within Kotlin.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-properties-6"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-6"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-6">111. Configuration properties</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To see the list of all GCP related configuration properties please check <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/appendix.html">the Appendix page</a>.</p>
</div>
</div>
</div>
<h1 id="spring-cloud-kubernetes" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-kubernetes"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-kubernetes">Spring Cloud Kubernetes</a></h1>
<div class="openblock partintro">
<div class="content">
This reference guide covers how to use Spring Cloud Kubernetes.
</div>
</div>
<div class="sect1">
<h2 id="why-do-you-need-spring-cloud-kubernetes"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#why-do-you-need-spring-cloud-kubernetes"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#why-do-you-need-spring-cloud-kubernetes">112. Why do you need Spring Cloud Kubernetes?</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Kubernetes provides implementations of well known Spring Cloud interfaces allowing developers to build and run Spring Cloud applications on Kubernetes. While this project may be useful to you when building a cloud native application, it is also not a requirement in order to deploy a Spring Boot app on Kubernetes. If you are just getting started in your journey to running your Spring Boot app on Kubernetes you can accomplish a lot with nothing more than a basic Spring Boot app and Kubernetes itself. To learn more, you can get started by reading the <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#cloud-deployment-kubernetes">Spring Boot reference documentation for deploying to Kubernetes </a> and also working through the workshop material <a href="https://hackmd.io/@ryanjbaxter/spring-on-k8s-workshop">Spring and Kubernetes</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="starters-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#starters-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#starters-2">113. Starters</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Starters are convenient dependency descriptors you can include in your
application. Include a starter to get the dependencies and Spring Boot
auto-configuration for a feature set.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Starter</th>
<th class="tableblock halign-left valign-top">Features</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-kubernetes<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discoveryclient-for-kubernetes">Discovery Client</a> implementation that
resolves service names to Kubernetes Services.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-kubernetes-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load application properties from Kubernetes
<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ConfigMap%20PropertySource">ConfigMaps</a> and <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#secrets-propertysource">Secrets</a>.
<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#PropertySource%20Reload">Reload</a> application properties when a ConfigMap or
Secret changes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-kubernetes-ribbon<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#Ribbon%20discovery%20in%20Kubernetes">Ribbon</a> client-side load balancer with
server list obtained from Kubernetes Endpoints.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-kubernetes-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All Spring Cloud Kubernetes features.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="discoveryclient-for-kubernetes"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discoveryclient-for-kubernetes"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#discoveryclient-for-kubernetes">114. DiscoveryClient for Kubernetes</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This project provides an implementation of <a href="https://github.com/spring-cloud/spring-cloud-commons/blob/master/spring-cloud-commons/src/main/java/org/springframework/cloud/client/discovery/DiscoveryClient.java">Discovery Client</a>
for <a href="https://kubernetes.io/">Kubernetes</a>.
This client lets you query Kubernetes endpoints (see <a href="https://kubernetes.io/docs/user-guide/services/">services</a>) by name.
A service is typically exposed by the Kubernetes API server as a collection of endpoints that represent <code>http</code> and <code>https</code> addresses and that a client can
access from a Spring Boot application running as a pod. This discovery feature is also used by the Spring Cloud Kubernetes Ribbon project
to fetch the list of the endpoints defined for an application to be load balanced.</p>
</div>
<div class="paragraph">
<p>This is something that you get for free by adding the following dependency inside your project:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-kubernetes<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To enable loading of the <code>DiscoveryClient</code>, add <code>@EnableDiscoveryClient</code> to the according configuration or application class, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableDiscoveryClient</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
    SpringApplication.run(Application.class, args);
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then you can inject the client in your code simply by autowiring it, as the following example shows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> DiscoveryClient discoveryClient;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can choose to enable <code>DiscoveryClient</code> from all namespaces by setting the following property in <code>application.properties</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">spring.cloud.kubernetes.discovery.all-namespaces=<span class="hljs-literal">true</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If, for any reason, you need to disable the <code>DiscoveryClient</code>, you can set the following property in <code>application.properties</code>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">spring.cloud.kubernetes.discovery.enabled=<span class="hljs-literal">false</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Some Spring Cloud components use the <code>DiscoveryClient</code> in order to obtain information about the local service instance. For
this to work, you need to align the Kubernetes service name with the <code>spring.application.name</code> property.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>spring.application.name</code> has no effect as far as the name registered for the application within Kubernetes
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Spring Cloud Kubernetes can also watch the Kubernetes service catalog for changes and update the
<code>DiscoveryClient</code> implementation accordingly. In order to enable this functionality you need to add
<code>@EnableScheduling</code> on a configuration class in your application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kubernetes-native-service-discovery"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kubernetes-native-service-discovery"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kubernetes-native-service-discovery">115. Kubernetes native service discovery</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kubernetes itself is capable of (server side) service discovery (see: <a href="https://kubernetes.io/docs/concepts/services-networking/service/#discovering-services" class="bare">kubernetes.io/docs/concepts/services-networking/service/#discovering-services</a>).
Using native kubernetes service discovery ensures compatibility with additional tooling, such as Istio (<a href="https://istio.io/" class="bare">istio.io</a>), a service mesh that is capable of load balancing, ribbon, circuit breaker, failover, and much more.</p>
</div>
<div class="paragraph">
<p>The caller service then need only refer to names resolvable in a particular Kubernetes cluster. A simple implementation might use a spring <code>RestTemplate</code> that refers to a fully qualified domain name (FQDN), such as <code><a href="https://%7Bservice-name%7D.%7Bnamespace%7D.svc.%7Bcluster%7D.local:{service-port}/" class="bare">{service-name}.{namespace}.svc.{cluster}.local:{service-port}</a></code>.</p>
</div>
<div class="paragraph">
<p>Additionally, you can use Hystrix for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Circuit breaker implementation on the caller side, by annotating the spring boot application class with <code>@EnableCircuitBreaker</code></p>
</li>
<li>
<p>Fallback functionality, by annotating the respective method with <code>@HystrixCommand(fallbackMethod=</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kubernetes-propertysource-implementations"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kubernetes-propertysource-implementations"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kubernetes-propertysource-implementations">116. Kubernetes PropertySource implementations</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The most common approach to configuring your Spring Boot application is to create an <code>application.properties</code> or <code>application.yaml</code> or
an <code>application-profile.properties</code> or <code>application-profile.yaml</code> file that contains key-value pairs that provide customization values to your
application or Spring Boot starters. You can override these properties by specifying system properties or environment
variables.</p>
</div>
<div class="sect2">
<h3 id="configmap-propertysource"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configmap-propertysource"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configmap-propertysource">116.1. Using a <code>ConfigMap</code> <code>PropertySource</code></a></h3>
<div class="paragraph">
<p>Kubernetes provides a resource named <a href="https://kubernetes.io/docs/user-guide/configmap/"><code>ConfigMap</code></a> to externalize the
parameters to pass to your application in the form of key-value pairs or embedded <code>application.properties</code> or <code>application.yaml</code> files.
The <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/spring-cloud-kubernetes-config">Spring Cloud Kubernetes Config</a> project makes Kubernetes <code>ConfigMap</code> instances available
during application bootstrapping and triggers hot reloading of beans or Spring context when changes are detected on
observed <code>ConfigMap</code> instances.</p>
</div>
<div class="paragraph">
<p>The default behavior is to create a <code>ConfigMapPropertySource</code> based on a Kubernetes <code>ConfigMap</code> that has a <code>metadata.name</code> value of either the name of
your Spring application (as defined by its <code>spring.application.name</code> property) or a custom name defined within the
<code>bootstrap.properties</code> file under the following key: <code>spring.cloud.kubernetes.config.name</code>.</p>
</div>
<div class="paragraph">
<p>However, more advanced configuration is possible where you can use multiple <code>ConfigMap</code> instances.
The <code>spring.cloud.kubernetes.config.sources</code> list makes this possible.
For example, you could define the following <code>ConfigMap</code> instances:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  application:
    name: cloud-k8s-app
  cloud:
    kubernetes:
      config:
        name: default-name
        namespace: default-namespace
        sources:
         # Spring Cloud Kubernetes looks up a ConfigMap named c1 in namespace default-namespace
         - name: c1
         # Spring Cloud Kubernetes looks up a ConfigMap named default-name in whatever namespace n2
         - namespace: n2
         # Spring Cloud Kubernetes looks up a ConfigMap named c3 in namespace n3
         - namespace: n3
           name: c3</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, if <code>spring.cloud.kubernetes.config.namespace</code> had not been set,
the <code>ConfigMap</code> named <code>c1</code> would be looked up in the namespace that the application runs.</p>
</div>
<div class="paragraph">
<p>Any matching <code>ConfigMap</code> that is found is processed as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apply individual configuration properties.</p>
</li>
<li>
<p>Apply as <code>yaml</code> the content of any property named <code>application.yaml</code>.</p>
</li>
<li>
<p>Apply as a properties file the content of any property named <code>application.properties</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The single exception to the aforementioned flow is when the <code>ConfigMap</code> contains a <strong>single</strong> key that indicates
the file is a YAML or properties file. In that case, the name of the key does NOT have to be <code>application.yaml</code> or
<code>application.properties</code> (it can be anything) and the value of the property is treated correctly.
This features facilitates the use case where the <code>ConfigMap</code> was created by using something like the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle">kubectl create configmap game-config --<span class="hljs-keyword">from</span>-<span class="hljs-keyword">file</span>=<span class="hljs-regexp">/path/</span>to<span class="hljs-regexp">/app-config.yaml</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Assume that we have a Spring Boot application named <code>demo</code> that uses the following properties to read its thread pool
configuration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pool.size.core</code></p>
</li>
<li>
<p><code>pool.size.maximum</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This can be externalized to config map in <code>yaml</code> format as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: demo
data:
  pool.size.core: 1
  pool.size.max: 16</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Individual properties work fine for most cases. However, sometimes, embedded <code>yaml</code> is more convenient. In this case, we
use a single property named <code>application.yaml</code> to embed our <code>yaml</code>, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: demo
data:
  application.yaml: |-
    pool:
      size:
        core: 1
        max:16</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example also works:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: demo
data:
  custom-name.yaml: |-
    pool:
      size:
        core: 1
        max:16</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also configure Spring Boot applications differently depending on active profiles that are merged together
when the <code>ConfigMap</code> is read. You can provide different property values for different profiles by using an
<code>application.properties</code> or <code>application.yaml</code> property, specifying profile-specific values, each in their own document
(indicated by the <code>---</code> sequence), as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: demo
data:
  application.yml: |-
    greeting:
      message: Say Hello to the World
    farewell:
      message: Say Goodbye
    ---
    spring:
      profiles: development
    greeting:
      message: Say Hello to the Developers
    farewell:
      message: Say Goodbye to the Developers
    ---
    spring:
      profiles: production
    greeting:
      message: Say Hello to the Ops</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the preceding case, the configuration loaded into your Spring Application with the <code>development</code> profile is as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  greeting:
    message: Say Hello to the Developers
  farewell:
    message: Say Goodbye to the Developers</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, if the <code>production</code> profile is active, the configuration becomes:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  greeting:
    message: Say Hello to the Ops
  farewell:
    message: Say Goodbye</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If both profiles are active, the property that appears last within the <code>ConfigMap</code> overwrites any preceding values.</p>
</div>
<div class="paragraph">
<p>Another option is to create a different config map per profile and spring boot will automatically fetch it based
on active profiles</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: demo
data:
  application.yml: |-
    greeting:
      message: Say Hello to the World
    farewell:
      message: Say Goodbye</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: demo-development
data:
  application.yml: |-
    spring:
      profiles: development
    greeting:
      message: Say Hello to the Developers
    farewell:
      message: Say Goodbye to the Developers</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: demo-production
data:
  application.yml: |-
    spring:
      profiles: production
    greeting:
      message: Say Hello to the Ops
    farewell:
      message: Say Goodbye</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To tell Spring Boot which <code>profile</code> should be enabled at bootstrap, you can pass <code>SPRING_PROFILES_ACTIVE</code> environment variable.
To do so, you can launch your Spring Boot application with an environment variable that you can define it in the PodSpec at the container specification.
Deployment resource file, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: deployment-name
  labels:
    app: deployment-name
spec:
  replicas: 1
  selector:
    matchLabels:
      app: deployment-name
  template:
    metadata:
      labels:
        app: deployment-name
    spec:
        containers:
        - name: container-name
          image: your-image
          env:
          - name: SPRING_PROFILES_ACTIVE
            value: "development"</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You should check the security configuration section. To access config maps from inside a pod you need to have the correct
Kubernetes service accounts, roles and role bindings.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Another option for using <code>ConfigMap</code> instances is to mount them into the Pod by running the Spring Cloud Kubernetes application
and having Spring Cloud Kubernetes read them from the file system.
This behavior is controlled by the <code>spring.cloud.kubernetes.config.paths</code> property. You can use it in
addition to or instead of the mechanism described earlier.
You can specify multiple (exact) file paths in <code>spring.cloud.kubernetes.config.paths</code> by using the <code>,</code> delimiter.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You have to provide the full exact path to each property file, because directories are not being recursively parsed.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use <code>spring.cloud.kubernetes.config.paths</code> or <code>spring.cloud.kubernetes.secrets.path</code> the automatic reload
functionality will not work. You will need to make a <code>POST</code> request to the <code>/actuator/refresh</code> endpoint or
restart/redeploy the application.
</td>
</tr>
</tbody></table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Properties:</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.config.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable ConfigMaps <code>PropertySource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.config.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${spring.application.name}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the name of <code>ConfigMap</code> to look up</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.config.namespace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the Kubernetes namespace where to lookup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.config.paths</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the paths where <code>ConfigMap</code> instances are mounted</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.config.enableApi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable or disable consuming <code>ConfigMap</code> instances through APIs</p></td>
</tr>
</tfoot>
</table>
</div>
<div class="sect2">
<h3 id="secrets-propertysource"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#secrets-propertysource"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#secrets-propertysource">116.2. Secrets PropertySource</a></h3>
<div class="paragraph">
<p>Kubernetes has the notion of <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Secrets</a> for storing
sensitive data such as passwords, OAuth tokens, and so on. This project provides integration with <code>Secrets</code> to make secrets
accessible by Spring Boot applications. You can explicitly enable or disable This feature by setting the <code>spring.cloud.kubernetes.secrets.enabled</code> property.</p>
</div>
<div class="paragraph">
<p>When enabled, the <code>SecretsPropertySource</code> looks up Kubernetes for <code>Secrets</code> from the following sources:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Reading recursively from secrets mounts</p>
</li>
<li>
<p>Named after the application (as defined by <code>spring.application.name</code>)</p>
</li>
<li>
<p>Matching some labels</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Note:</strong></p>
</div>
<div class="paragraph">
<p>By default, consuming Secrets through the API (points 2 and 3 above) <strong>is not enabled</strong> for security reasons. The permission 'list' on secrets allows clients to inspect secrets values in the specified namespace.
Further, we recommend that containers share secrets through mounted volumes.</p>
</div>
<div class="paragraph">
<p>If you enable consuming Secrets through the API, we recommend that you limit access to Secrets by using an authorization policy, such as RBAC.
For more information about risks and best practices when consuming Secrets through the API refer to <a href="https://kubernetes.io/docs/concepts/configuration/secret/#best-practices">this doc</a>.</p>
</div>
<div class="paragraph">
<p>If the secrets are found, their data is made available to the application.</p>
</div>
<div class="paragraph">
<p>Assume that we have a spring boot application named <code>demo</code> that uses properties to read its database
configuration. We can create a Kubernetes secret by using the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs dockerfile">oc create secret generic db-secret --<span class="hljs-keyword">from</span>-literal=username=<span class="hljs-keyword">user</span> --<span class="hljs-keyword">from</span>-literal=password=p455w0rd</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The preceding command would create the following secret (which you can see by using <code>oc get secrets db-secret -o yaml</code>):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
data:
  password: cDQ1NXcwcmQ=
  username: dXNlcg==
kind: Secret
metadata:
  creationTimestamp: 2017-07-04T09:15:57Z
  name: db-secret
  namespace: default
  resourceVersion: "357496"
  selfLink: /api/v1/namespaces/default/secrets/db-secret
  uid: 63c89263-6099-11e7-b3da-76d6186905a8
type: Opaque</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that the data contains Base64-encoded versions of the literal provided by the <code>create</code> command.</p>
</div>
<div class="paragraph">
<p>Your application can then use this secret — for example, by exporting the secret’s value as environment variables:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Deployment
metadata:
  name: ${project.artifactId}
spec:
   template:
     spec:
       containers:
         - env:
            - name: DB_USERNAME
              valueFrom:
                 secretKeyRef:
                   name: db-secret
                   key: username
            - name: DB_PASSWORD
              valueFrom:
                 secretKeyRef:
                   name: db-secret
                   key: password</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can select the Secrets to consume in a number of ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By listing the directories where secrets are mapped:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">-Dspring.cloud.kubernetes.secrets.paths=/etc/secrets/db-secret,etc/secrets/postgresql</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you have all the secrets mapped to a common root, you can set them like:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">-Dspring.cloud.kubernetes.secrets.paths=/etc/secrets</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>By setting a named secret:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">-Dspring.cloud.kubernetes.secrets.name=db-secret</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>By defining a list of labels:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">-Dspring.cloud.kubernetes.secrets.labels.broker=activemq
-Dspring.cloud.kubernetes.secrets.labels.db=postgresql</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>As the case with <code>ConfigMap</code>, more advanced configuration is also possible where you can use multiple <code>Secret</code>
instances. The <code>spring.cloud.kubernetes.secrets.sources</code> list makes this possible.
For example, you could define the following <code>Secret</code> instances:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  application:
    name: cloud-k8s-app
  cloud:
    kubernetes:
      secrets:
        name: default-name
        namespace: default-namespace
        sources:
         # Spring Cloud Kubernetes looks up a Secret named s1 in namespace default-namespace
         - name: s1
         # Spring Cloud Kubernetes looks up a Secret named default-name in whatever namespace n2
         - namespace: n2
         # Spring Cloud Kubernetes looks up a Secret named s3 in namespace n3
         - namespace: n3
           name: s3</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, if <code>spring.cloud.kubernetes.secrets.namespace</code> had not been set,
the <code>Secret</code> named <code>s1</code> would be looked up in the namespace that the application runs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Properties:</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.secrets.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable Secrets <code>PropertySource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.secrets.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${spring.application.name}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the name of the secret to look up</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.secrets.namespace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the Kubernetes namespace where to look up</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.secrets.labels</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Map</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the labels used to lookup secrets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.secrets.paths</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the paths where secrets are mounted (example 1)</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.secrets.enableApi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disables consuming secrets through APIs (examples 2 and 3)</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>spring.cloud.kubernetes.secrets.labels</code> property behaves as defined by
<a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-Configuration-Binding#map-based-binding">Map-based binding</a>.</p>
</li>
<li>
<p>The <code>spring.cloud.kubernetes.secrets.paths</code> property behaves as defined by
<a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-Configuration-Binding#collection-based-binding">Collection-based binding</a>.</p>
</li>
<li>
<p>Access to secrets through the API may be restricted for security reasons. The preferred way is to mount secrets to the Pod.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find an example of an application that uses secrets (though it has not been updated to use the new <code>spring-cloud-kubernetes</code> project) at
<a href="https://github.com/fabric8-quickstarts/spring-boot-camel-config">spring-boot-camel-config</a></p>
</div>
</div>
<div class="sect2">
<h3 id="propertysource-reload"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#propertysource-reload"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#propertysource-reload">116.3. <code>PropertySource</code> Reload</a></h3>
<div class="paragraph">
<p>Some applications may need to detect changes on external property sources and update their internal status to reflect the new configuration.
The reload feature of Spring Cloud Kubernetes is able to trigger an application reload when a related <code>ConfigMap</code> or
<code>Secret</code> changes.</p>
</div>
<div class="paragraph">
<p>By default, this feature is disabled. You can enable it by using the <code>spring.cloud.kubernetes.reload.enabled=true</code> configuration property (for example, in the <code>application.properties</code> file).</p>
</div>
<div class="paragraph">
<p>The following levels of reload are supported (by setting the <code>spring.cloud.kubernetes.reload.strategy</code> property):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>refresh</code> (default): Only configuration beans annotated with <code>@ConfigurationProperties</code> or <code>@RefreshScope</code> are reloaded.
This reload level leverages the refresh feature of Spring Cloud Context.</p>
</li>
<li>
<p><code>restart_context</code>: the whole Spring <code>ApplicationContext</code> is gracefully restarted. Beans are recreated with the new configuration.
In order for the restart context functionality to work properly you must enable and expose the restart actuator endpoint</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>management:
  endpoint:
    restart:
      enabled: true
  endpoints:
    web:
      exposure:
        include: restart</pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>shutdown</code>: the Spring <code>ApplicationContext</code> is shut down to activate a restart of the container.
When you use this level, make sure that the lifecycle of all non-daemon threads is bound to the <code>ApplicationContext</code>
and that a replication controller or replica set is configured to restart the pod.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assuming that the reload feature is enabled with default settings (<code>refresh</code> mode), the following bean is refreshed when the config map changes:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>@Configuration
@ConfigurationProperties(prefix = "bean")
public class MyConfig {

    private String message = "a message that can be changed live";

    // getter and setters

}</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To see that changes effectively happen, you can create another bean that prints the message periodically, as follows</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBean</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> MyConfig config;

    <span class="hljs-meta">@Scheduled</span>(fixedDelay = <span class="hljs-number">5000</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>{
        System.out.println(<span class="hljs-string">"The message is: "</span> + config.getMessage());
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can change the message printed by the application by using a <code>ConfigMap</code>, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: reload-example
data:
  application.properties: |-
    bean.message=Hello World!</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Any change to the property named <code>bean.message</code> in the <code>ConfigMap</code> associated with the pod is reflected in the
output. More generally speaking, changes associated to properties prefixed with the value defined by the <code>prefix</code>
field of the <code>@ConfigurationProperties</code> annotation are detected and reflected in the application.
<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configmap-propertysource">Associating a <code>ConfigMap</code> with a pod</a> is explained earlier in this chapter.</p>
</div>
<div class="paragraph">
<p>The full example is available in <a href="https://github.com/fabric8io/spring-cloud-kubernetes/tree/master/spring-cloud-kubernetes-examples/kubernetes-reload-example"><code>spring-cloud-kubernetes-reload-example</code></a>.</p>
</div>
<div class="paragraph">
<p>The reload feature supports two operating modes:
* Event (default): Watches for changes in config maps or secrets by using the Kubernetes API (web socket).
Any event produces a re-check on the configuration and, in case of changes, a reload.
The <code>view</code> role on the service account is required in order to listen for config map changes. A higher level role (such as <code>edit</code>) is required for secrets
(by default, secrets are not monitored).
* Polling: Periodically re-creates the configuration from config maps and secrets to see if it has changed.
You can configure the polling period by using the <code>spring.cloud.kubernetes.reload.period</code> property and defaults to 15 seconds.
It requires the same role as the monitored property source.
This means, for example, that using polling on file-mounted secret sources does not require particular privileges.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Properties:</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.reload.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables monitoring of property sources and configuration reload</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.reload.monitoring-config-maps</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow monitoring changes in config maps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.reload.monitoring-secrets</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow monitoring changes in secrets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.reload.strategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Enum</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>refresh</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The strategy to use when firing a reload (<code>refresh</code>, <code>restart_context</code>, or <code>shutdown</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.reload.mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Enum</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>event</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies how to listen for changes in property sources (<code>event</code> or <code>polling</code>)</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.kubernetes.reload.period</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The period for verifying changes when using the <code>polling</code> strategy</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph">
<p>Notes:
* You should not use properties under <code>spring.cloud.kubernetes.reload</code> in config maps or secrets. Changing such properties at runtime may lead to unexpected results.
* Deleting a property or the whole config map does not restore the original state of the beans when you use the <code>refresh</code> level.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ribbon-discovery-in-kubernetes"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ribbon-discovery-in-kubernetes"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ribbon-discovery-in-kubernetes">117. Ribbon Discovery in Kubernetes</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud client applications that call a microservice should be interested on relying on a client load-balancing
feature in order to automatically discover at which endpoint(s) it can reach a given service. This mechanism has been
implemented within the <a href="https://github.com/spring-cloud/spring-cloud-kubernetes/tree/master/spring-cloud-kubernetes-ribbon">spring-cloud-kubernetes-ribbon</a> project, where a
Kubernetes client populates a <a href="https://github.com/Netflix/ribbon">Ribbon</a> <code>ServerList</code> that contains information
about such endpoints.</p>
</div>
<div class="paragraph">
<p>The implementation is part of the following starter that you can use by adding its dependency to your pom file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-kubernetes-ribbon<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${latest.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When the list of the endpoints is populated, the Kubernetes client searches the registered endpoints that live in
the current namespace or project by matching the service name defined in the Ribbon Client annotation, as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@RibbonClient</span>(name = <span class="hljs-string">"name-service"</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can configure Ribbon’s behavior by providing properties in your <code>application.properties</code> (through your application’s
dedicated <code>ConfigMap</code>) by using the following format: <code>&lt;name of your service&gt;.ribbon.&lt;Ribbon configuration key&gt;</code>, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;name of your service&gt;</code> corresponds to the service name you access over Ribbon, as configured by using the
<code>@RibbonClient</code> annotation (such as <code>name-service</code> in the preceding example).</p>
</li>
<li>
<p><code>&lt;Ribbon configuration key&gt;</code> is one of the Ribbon configuration keys defined by
<a href="https://github.com/Netflix/ribbon/blob/master/ribbon-core/src/main/java/com/netflix/client/config/CommonClientConfigKey.java">Ribbon’s <code>CommonClientConfigKey</code> class</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, the <code>spring-cloud-kubernetes-ribbon</code> project defines two additional configuration keys to further
control how Ribbon interacts with Kubernetes. In particular, if an endpoint defines multiple ports, the default
behavior is to use the first one found. To select more specifically which port to use in a multi-port service, you can use
the <code>PortName</code> key. If you want to specify in which Kubernetes namespace the target service should be looked up, you can use
the <code>KubernetesNamespace</code> key, remembering in both instances to prefix these keys with your service name and
<code>ribbon</code> prefix, as specified earlier.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Spring Cloud Kubernetes Ribbon Configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Key</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.ribbon.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.ribbon.mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KubernetesRibbonMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.ribbon.cluster-domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cluster.local</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p><code>spring.cloud.kubernetes.ribbon.mode</code> supports <code>POD</code> and <code>SERVICE</code> modes.</p>
<div class="ulist">
<ul>
<li>
<p>The POD mode is to achieve load balancing by obtaining the Pod IP address of Kubernetes and using Ribbon.
POD mode uses the load balancing of the Ribbon Does not support Kubernetes load balancing, The traffic policy of <code>Istio</code> is not supported.</p>
</li>
<li>
<p>the <code>SERVICE</code> mode is directly based on the <code>service name</code> of the Ribbon. Get
The Kubernetes service is concatenated into <code>service-name.{namespace}.svc.{cluster.domain}:{port}</code> such as: <code>demo1.default.svc.cluster.local:8080</code>.
the <code>SERVICE</code> mode uses load balancing of the Kubernetes service to support Istio’s traffic policy.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>spring.cloud.kubernetes.ribbon.cluster-domain</code> Set the custom Kubernetes cluster domain suffix. The default value is: 'cluster.local'</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following examples use this module for ribbon discovery:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/spring-cloud-kubernetes-examples/kubernetes-circuitbreaker-ribbon-example">Spring Cloud Circuitbreaker and Ribbon</a></p>
</li>
<li>
<p><a href="https://github.com/fabric8-quickstarts/spring-boot-ribbon">fabric8-quickstarts - Spring Boot - Ribbon</a></p>
</li>
<li>
<p><a href="https://github.com/fabric8io/kubeflix/tree/master/examples/loanbroker/bank">Kubeflix - LoanBroker - Bank</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can disable the Ribbon discovery client by setting the <code>spring.cloud.kubernetes.ribbon.enabled=false</code> key within the application properties file.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kubernetes-ecosystem-awareness"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kubernetes-ecosystem-awareness"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kubernetes-ecosystem-awareness">118. Kubernetes Ecosystem Awareness</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>All of the features described earlier in this guide work equally well, regardless of whether your application is running inside
Kubernetes. This is really helpful for development and troubleshooting.
From a development point of view, this lets you start your Spring Boot application and debug one
of the modules that is part of this project. You need not deploy it in Kubernetes,
as the code of the project relies on the
<a href="https://github.com/fabric8io/kubernetes-client">Fabric8 Kubernetes Java client</a>, which is a fluent DSL that can
communicate by using <code>http</code> protocol to the REST API of the Kubernetes Server.</p>
</div>
<div class="paragraph">
<p>To disable the integration with Kubernetes you can set <code>spring.cloud.kubernetes.enabled</code> to <code>false</code>. Please be aware that when <code>spring-cloud-kubernetes-config</code> is on the classpath,
<code>spring.cloud.kubernetes.enabled</code> should be set in <code>bootstrap.{properties|yml}</code> (or the profile specific one) otherwise it should be in <code>application.{properties|yml}</code> (or the profile specific one).
Also note that these properties: <code>spring.cloud.kubernetes.config.enabled</code> and <code>spring.cloud.kubernetes.secrets.enabled</code> only take effect when set in <code>bootstrap.{properties|yml}</code></p>
</div>
<div class="sect2">
<h3 id="kubernetes-profile-autoconfiguration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kubernetes-profile-autoconfiguration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#kubernetes-profile-autoconfiguration">118.1. Kubernetes Profile Autoconfiguration</a></h3>
<div class="paragraph">
<p>When the application runs as a pod inside Kubernetes, a Spring profile named <code>kubernetes</code> automatically gets activated.
This lets you customize the configuration, to define beans that are applied when the Spring Boot application is deployed
within the Kubernetes platform (for example, different development and production configuration).</p>
</div>
</div>
<div class="sect2">
<h3 id="istio-awareness"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#istio-awareness"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#istio-awareness">118.2. Istio Awareness</a></h3>
<div class="paragraph">
<p>When you include the <code>spring-cloud-kubernetes-istio</code> module in the application classpath, a new profile is added to the application,
provided the application is running inside a Kubernetes Cluster with <a href="https://istio.io/">Istio</a> installed. You can then use
spring <code>@Profile("istio")</code> annotations in your Beans and <code>@Configuration</code> classes.</p>
</div>
<div class="paragraph">
<p>The Istio awareness module uses <code>me.snowdrop:istio-client</code> to interact with Istio APIs, letting us discover traffic rules, circuit breakers, and so on,
making it easy for our Spring Boot applications to consume this data to dynamically configure themselves according to the environment.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pod-health-indicator"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pod-health-indicator"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#pod-health-indicator">119. Pod Health Indicator</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Boot uses <a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthEndpoint.java"><code>HealthIndicator</code></a> to expose info about the health of an application.
That makes it really useful for exposing health-related information to the user and makes it a good fit for use as <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/">readiness probes</a>.</p>
</div>
<div class="paragraph">
<p>The Kubernetes health indicator (which is part of the core module) exposes the following info:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod name, IP address, namespace, service account, node name, and its IP address</p>
</li>
<li>
<p>A flag that indicates whether the Spring Boot application is internal or external to Kubernetes</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="info-contributor"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#info-contributor"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#info-contributor">120. Info Contributor</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Kubernetes includes an <code>InfoContributor</code> which adds Pod information to
Spring Boot’s <code>/info</code> Acturator endpoint.</p>
</div>
<div class="paragraph">
<p>You can disable this <code>InfoContributor</code> by setting <code>management.info.kubernetes.enabled</code>
to <code>false</code> in <code>bootstrap.[properties | yaml]</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="leader-election"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#leader-election"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#leader-election">121. Leader Election</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>&lt;TBD&gt;</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="loadbalancer-for-kubernetes"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#loadbalancer-for-kubernetes"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#loadbalancer-for-kubernetes">122. LoadBalancer for Kubernetes</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This project includes Spring Cloud Load Balancer for load balancing based on Kubernetes Endpoints and provides implementation of load balancer based on Kubernetes Service.
To include it to your project add the following dependency.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-kubernetes-loadbalancer<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To enable load balancing based on Kubernetes Service name use the following property. Then load balancer would try to call application using address, for example <code>service-a.default.svc.cluster.local</code></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs">spring.cloud.kubernetes.loadbalancer.mode=SERVICE</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To enabled load balancing across all namespaces use the following property. Property from <code>spring-cloud-kubernetes-discovery</code> module is respected.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">spring.cloud.kubernetes.discovery.all-namespaces=<span class="hljs-literal">true</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-configurations-inside-kubernetes"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#security-configurations-inside-kubernetes"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#security-configurations-inside-kubernetes">123. Security Configurations Inside Kubernetes</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="namespace"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#namespace"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#namespace">123.1. Namespace</a></h3>
<div class="paragraph">
<p>Most of the components provided in this project need to know the namespace. For Kubernetes (1.3+), the namespace is made available to the pod as part of the service account secret and is automatically detected by the client.
For earlier versions, it needs to be specified as an environment variable to the pod. A quick way to do this is as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs properties">      <span class="hljs-attr">env</span>:<span class="hljs-string"></span>
      <span class="hljs-meta">-</span> <span class="hljs-string">name: "KUBERNETES_NAMESPACE"</span>
        <span class="hljs-attr">valueFrom</span>:<span class="hljs-string"></span>
          <span class="hljs-attr">fieldRef</span>:<span class="hljs-string"></span>
            <span class="hljs-attr">fieldPath</span>: <span class="hljs-string">"metadata.namespace"</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="service-account"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-account"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-account">123.2. Service Account</a></h3>
<div class="paragraph">
<p>For distributions of Kubernetes that support more fine-grained role-based access within the cluster, you need to make sure a pod that runs with <code>spring-cloud-kubernetes</code> has access to the Kubernetes API.
For any service accounts you assign to a deployment or pod, you need to make sure they have the correct roles.</p>
</div>
<div class="paragraph">
<p>Depending on the requirements, you’ll need <code>get</code>, <code>list</code> and <code>watch</code> permission on the following resources:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Kubernetes Resource Permissions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Resources</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-starter-kubernetes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pods, services, endpoints</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-starter-kubernetes-config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">configmaps, secrets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-starter-kubernetes-ribbon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pods, services, endpoints</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For development purposes, you can add <code>cluster-reader</code> permissions to your <code>default</code> service account. On a production system you’ll likely want to provide more granular permissions.</p>
</div>
<div class="paragraph">
<p>The following Role and RoleBinding are an example for namespaced permissions for the <code>default</code> account:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  namespace: YOUR-NAME-SPACE
  name: namespace-reader
rules:
  - apiGroups: ["", "extensions", "apps"]
    resources: ["configmaps", "pods", "services", "endpoints", "secrets"]
    verbs: ["get", "list", "watch"]

---

kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: namespace-reader-binding
  namespace: YOUR-NAME-SPACE
subjects:
- kind: ServiceAccount
  name: default
  apiGroup: ""
roleRef:
  kind: Role
  name: namespace-reader
  apiGroup: ""</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="service-registry-implementation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-registry-implementation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-registry-implementation">124. Service Registry Implementation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Kubernetes service registration is controlled by the platform, the application itself does not control
registration as it may do in other platforms. For this reason using <code>spring.cloud.service-registry.auto-registration.enabled</code>
or setting <code>@EnableDiscoveryClient(autoRegister=false)</code> will have no effect in Spring Cloud Kubernetes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#examples"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#examples">125. Examples</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Kubernetes tries to make it transparent for your applications to consume Kubernetes Native Services by
following the Spring Cloud interfaces.</p>
</div>
<div class="paragraph">
<p>In your applications, you need to add the <code>spring-cloud-kubernetes-discovery</code> dependency to your classpath and remove any other dependency that contains a <code>DiscoveryClient</code> implementation (that is, a Eureka discovery client).
The same applies for <code>PropertySourceLocator</code>, where you need to add to the classpath the <code>spring-cloud-kubernetes-config</code> and remove any other dependency that contains a <code>PropertySourceLocator</code> implementation (that is, a configuration server client).</p>
</div>
<div class="paragraph">
<p>The following projects highlight the usage of these dependencies and demonstrate how you can use these libraries from any Spring Boot application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/spring-cloud/spring-cloud-kubernetes/tree/master/spring-cloud-kubernetes-examples">Spring Cloud Kubernetes Examples</a>: the ones located inside this repository.</p>
</li>
<li>
<p>Spring Cloud Kubernetes Full Example: Minions and Boss</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/salaboy/spring-cloud-k8s-minion">Minion</a></p>
</li>
<li>
<p><a href="https://github.com/salaboy/spring-cloud-k8s-boss">Boss</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Spring Cloud Kubernetes Full Example: <a href="https://github.com/salaboy/s1p_docs">SpringOne Platform Tickets Service</a></p>
</li>
<li>
<p><a href="https://github.com/salaboy/s1p_gateway">Spring Cloud Gateway with Spring Cloud Kubernetes Discovery and Config</a></p>
</li>
<li>
<p><a href="https://github.com/salaboy/showcase-admin-tool">Spring Boot Admin with Spring Cloud Kubernetes Discovery and Config</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="other-resources"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#other-resources"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#other-resources">126. Other Resources</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section lists other resources, such as presentations (slides) and videos about Spring Cloud Kubernetes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://salaboy.com/2018/09/27/the-s1p-experience/">S1P Spring Cloud on PKS</a></p>
</li>
<li>
<p><a href="https://salaboy.com/2018/07/18/ljc-july-18-spring-cloud-docker-k8s/">Spring Cloud, Docker, Kubernetes → London Java Community July 2018</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please feel free to submit other resources through pull requests to <a href="https://github.com/spring-cloud/spring-cloud-kubernetes">this repository</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-properties-7"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-7"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-7">127. Configuration properties</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To see the list of all Sleuth related configuration properties please check <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/appendix.html">the Appendix page</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#building-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#building-2">128. Building</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="basic-compile-and-test-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#basic-compile-and-test-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#basic-compile-and-test-2">128.1. Basic Compile and Test</a></h3>
<div class="paragraph">
<p>To build the source you will need to install JDK 1.8.</p>
</div>
<div class="paragraph">
<p>Spring Cloud uses Maven for most build-related activities, and you
should be able to get off the ground quite quickly by cloning the
project you are interested in and typing</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./mvnw install</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also install Maven (&gt;=3.3.3) yourself and run the <code>mvn</code> command
in place of <code>./mvnw</code> in the examples below. If you do that you also
might need to add <code>-P spring</code> if your local Maven settings do not
contain repository declarations for spring pre-release artifacts.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Be aware that you might need to increase the amount of memory
available to Maven by setting a <code>MAVEN_OPTS</code> environment variable with
a value like <code>-Xmx512m -XX:MaxPermSize=128m</code>. We try to cover this in
the <code>.mvn</code> configuration, so if you find you have to do it to make a
build succeed, please raise a ticket to get the settings added to
source control.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>For hints on how to build the project look in <code>.travis.yml</code> if there
is one. There should be a "script" and maybe "install" command. Also
look at the "services" section to see if any services need to be
running locally (e.g. mongo or rabbit). Ignore the git-related bits
that you might find in "before_install" since they’re related to setting git
credentials and you already have those.</p>
</div>
<div class="paragraph">
<p>The projects that require middleware generally include a
<code>docker-compose.yml</code>, so consider using
<a href="https://docs.docker.com/compose/">Docker Compose</a> to run the middeware servers
in Docker containers. See the README in the
<a href="https://github.com/spring-cloud-samples/scripts">scripts demo
repository</a> for specific instructions about the common cases of mongo,
rabbit and redis.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If all else fails, build with the command from <code>.travis.yml</code> (usually
<code>./mvnw install</code>).
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="documentation-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#documentation-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#documentation-2">128.2. Documentation</a></h3>
<div class="paragraph">
<p>The spring-cloud-build module has a "docs" profile, and if you switch
that on it will try to build asciidoc sources from
<code>src/main/asciidoc</code>. As part of that process it will look for a
<code>README.adoc</code> and process it by loading all the includes, but not
parsing or rendering it, just copying it to <code>${main.basedir}</code>
(defaults to <code>$/tmp/releaser-1613056757628-0/spring-cloud-release/train-docs/target/unpacked-docs</code>, i.e. the root of the project). If there are
any changes in the README it will then show up after a Maven build as
a modified file in the correct place. Just commit it and push the change.</p>
</div>
</div>
<div class="sect2">
<h3 id="working-with-the-code-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#working-with-the-code-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#working-with-the-code-2">128.3. Working with the code</a></h3>
<div class="paragraph">
<p>If you don’t have an IDE preference we would recommend that you use
<a href="https://www.springsource.com/developer/sts">Spring Tools Suite</a> or
<a href="https://eclipse.org/">Eclipse</a> when working with the code. We use the
<a href="https://eclipse.org/m2e/">m2eclipse</a> eclipse plugin for maven support. Other IDEs and tools
should also work without issue as long as they use Maven 3.3.3 or better.</p>
</div>
<div class="sect3">
<h4 id="activate-the-spring-maven-profile-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#activate-the-spring-maven-profile-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#activate-the-spring-maven-profile-2">128.3.1. Activate the Spring Maven profile</a></h4>
<div class="paragraph">
<p>Spring Cloud projects require the 'spring' Maven profile to be activated to resolve
the spring milestone and snapshot repositories. Use your preferred IDE to set this
profile to be active, or you may experience build errors.</p>
</div>
</div>
<div class="sect3">
<h4 id="importing-into-eclipse-with-m2eclipse-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#importing-into-eclipse-with-m2eclipse-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#importing-into-eclipse-with-m2eclipse-2">128.3.2. Importing into eclipse with m2eclipse</a></h4>
<div class="paragraph">
<p>We recommend the <a href="https://eclipse.org/m2e/">m2eclipse</a> eclipse plugin when working with
eclipse. If you don’t already have m2eclipse installed it is available from the "eclipse
marketplace".</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Older versions of m2e do not support Maven 3.3, so once the
projects are imported into Eclipse you will also need to tell
m2eclipse to use the right profile for the projects. If you
see many different errors related to the POMs in the projects, check
that you have an up to date installation. If you can’t upgrade m2e,
add the "spring" profile to your <code>settings.xml</code>. Alternatively you can
copy the repository settings from the "spring" profile of the parent
pom into your <code>settings.xml</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="importing-into-eclipse-without-m2eclipse-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#importing-into-eclipse-without-m2eclipse-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#importing-into-eclipse-without-m2eclipse-2">128.3.3. Importing into eclipse without m2eclipse</a></h4>
<div class="paragraph">
<p>If you prefer not to use m2eclipse you can generate eclipse project metadata using the
following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./mvnw eclipse:eclipse</pre>
</div>
</div>
<div class="paragraph">
<p>The generated eclipse projects can be imported by selecting <code>import existing projects</code>
from the <code>file</code> menu.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="contributing-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#contributing-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#contributing-3">129. Contributing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud is released under the non-restrictive Apache 2.0 license,
and follows a very standard Github development process, using Github
tracker for issues and merging pull requests into master. If you want
to contribute even something trivial please do not hesitate, but
follow the guidelines below.</p>
</div>
<div class="sect2">
<h3 id="sign-the-contributor-license-agreement-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sign-the-contributor-license-agreement-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sign-the-contributor-license-agreement-3">129.1. Sign the Contributor License Agreement</a></h3>
<div class="paragraph">
<p>Before we accept a non-trivial patch or pull request we will need you to sign the
<a href="https://cla.pivotal.io/sign/spring">Contributor License Agreement</a>.
Signing the contributor’s agreement does not grant anyone commit rights to the main
repository, but it does mean that we can accept your contributions, and you will get an
author credit if we do. Active contributors might be asked to join the core team, and
given the ability to merge pull requests.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-of-conduct-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-of-conduct-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-of-conduct-3">129.2. Code of Conduct</a></h3>
<div class="paragraph">
<p>This project adheres to the Contributor Covenant <a href="https://github.com/spring-cloud/spring-cloud-build/blob/master/docs/src/main/asciidoc/code-of-conduct.adoc">code of
conduct</a>. By participating, you are expected to uphold this code. Please report
unacceptable behavior to <a href="mailto:spring-code-of-conduct@pivotal.io">spring-code-of-conduct@pivotal.io</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="code-conventions-and-housekeeping-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-conventions-and-housekeeping-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#code-conventions-and-housekeeping-3">129.3. Code Conventions and Housekeeping</a></h3>
<div class="paragraph">
<p>None of these is essential for a pull request, but they will all help. They can also be
added after the original pull request but before a merge.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the Spring Framework code format conventions. If you use Eclipse
you can import formatter settings using the
<code>eclipse-code-formatter.xml</code> file from the
<a href="https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-dependencies-parent/eclipse-code-formatter.xml">Spring
Cloud Build</a> project. If using IntelliJ, you can use the
<a href="https://plugins.jetbrains.com/plugin/6546">Eclipse Code Formatter
Plugin</a> to import the same file.</p>
</li>
<li>
<p>Make sure all new <code>.java</code> files to have a simple Javadoc class comment with at least an
<code>@author</code> tag identifying you, and preferably at least a paragraph on what the class is
for.</p>
</li>
<li>
<p>Add the ASF license header comment to all new <code>.java</code> files (copy from existing files
in the project)</p>
</li>
<li>
<p>Add yourself as an <code>@author</code> to the .java files that you modify substantially (more
than cosmetic changes).</p>
</li>
<li>
<p>Add some Javadocs and, if you change the namespace, some XSD doc elements.</p>
</li>
<li>
<p>A few unit tests would help a lot as well — someone has to do it.</p>
</li>
<li>
<p>If no-one else is using your branch, please rebase it against the current master (or
other target branch in the main project).</p>
</li>
<li>
<p>When writing a commit message please follow <a href="https://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html">these conventions</a>,
if you are fixing an existing issue please add <code>Fixes gh-XXXX</code> at the end of the commit
message (where XXXX is the issue number).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="checkstyle-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#checkstyle-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#checkstyle-3">129.4. Checkstyle</a></h3>
<div class="paragraph">
<p>Spring Cloud Build comes with a set of checkstyle rules. You can find them in the <code>spring-cloud-build-tools</code> module. The most notable files under the module are:</p>
</div>
<div class="listingblock">
<div class="title">spring-cloud-build-tools/</div>
<div class="content">
<pre>└── src
 &nbsp;&nbsp; ├── checkstyle
 &nbsp;&nbsp; │&nbsp;&nbsp; └── checkstyle-suppressions.xml <i class="conum" data-value="3"></i><b>(3)</b>
 &nbsp;&nbsp; └── main
 &nbsp;&nbsp;     └── resources
 &nbsp;&nbsp;         ├── checkstyle-header.txt <i class="conum" data-value="2"></i><b>(2)</b>
 &nbsp;&nbsp;         └── checkstyle.xml <i class="conum" data-value="1"></i><b>(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Default Checkstyle rules</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>File header setup</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Default suppression rules</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="checkstyle-configuration-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#checkstyle-configuration-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#checkstyle-configuration-3">129.4.1. Checkstyle configuration</a></h4>
<div class="paragraph">
<p>Checkstyle rules are <strong>disabled by default</strong>. To add checkstyle to your project just define the following properties and plugins.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre>&lt;properties&gt;
&lt;maven-checkstyle-plugin.failsOnError&gt;true&lt;/maven-checkstyle-plugin.failsOnError&gt; <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;maven-checkstyle-plugin.failsOnViolation&gt;true
        &lt;/maven-checkstyle-plugin.failsOnViolation&gt; <i class="conum" data-value="2"></i><b>(2)</b>
        &lt;maven-checkstyle-plugin.includeTestSourceDirectory&gt;true
        &lt;/maven-checkstyle-plugin.includeTestSourceDirectory&gt; <i class="conum" data-value="3"></i><b>(3)</b>
&lt;/properties&gt;

&lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt; <i class="conum" data-value="4"></i><b>(4)</b>
                &lt;groupId&gt;io.spring.javaformat&lt;/groupId&gt;
                &lt;artifactId&gt;spring-javaformat-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt; <i class="conum" data-value="5"></i><b>(5)</b>
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;

    &lt;reporting&gt;
        &lt;plugins&gt;
            &lt;plugin&gt; <i class="conum" data-value="5"></i><b>(5)</b>
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/reporting&gt;
&lt;/build&gt;</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Fails the build upon Checkstyle errors</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Fails the build upon Checkstyle violations</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Checkstyle analyzes also the test sources</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Add the Spring Java Format plugin that will reformat your code to pass most of the Checkstyle formatting rules</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Add checkstyle plugin to your build and reporting phases</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you need to suppress some rules (e.g. line length needs to be longer), then it’s enough for you to define a file under <code>${project.root}/src/checkstyle/checkstyle-suppressions.xml</code> with your suppressions. Example:</p>
</div>
<div class="listingblock">
<div class="title">projectRoot/src/checkstyle/checkstyle-suppresions.xml</div>
<div class="content">
<pre>&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE suppressions PUBLIC
        "-//Puppy Crawl//DTD Suppressions 1.1//EN"
        "https://www.puppycrawl.com/dtds/suppressions_1_1.dtd"&gt;
&lt;suppressions&gt;
    &lt;suppress files=".*ConfigServerApplication\.java" checks="HideUtilityClassConstructor"/&gt;
    &lt;suppress files=".*ConfigClientWatch\.java" checks="LineLengthCheck"/&gt;
&lt;/suppressions&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>It’s advisable to copy the <code>${spring-cloud-build.rootFolder}/.editorconfig</code> and <code>${spring-cloud-build.rootFolder}/.springformat</code> to your project. That way, some default formatting rules will be applied. You can do so by running this script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/.editorconfig -o .editorconfig
$ touch .springformat</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ide-setup-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ide-setup-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ide-setup-3">129.5. IDE setup</a></h3>
<div class="sect3">
<h4 id="intellij-idea-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#intellij-idea-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#intellij-idea-3">129.5.1. Intellij IDEA</a></h4>
<div class="paragraph">
<p>In order to setup Intellij you should import our coding conventions, inspection profiles and set up the checkstyle plugin.
The following files can be found in the <a href="https://github.com/spring-cloud/spring-cloud-build/tree/master/spring-cloud-build-tools">Spring Cloud Build</a> project.</p>
</div>
<div class="listingblock">
<div class="title">spring-cloud-build-tools/</div>
<div class="content">
<pre>└── src
 &nbsp;&nbsp; ├── checkstyle
 &nbsp;&nbsp; │&nbsp;&nbsp; └── checkstyle-suppressions.xml <i class="conum" data-value="3"></i><b>(3)</b>
 &nbsp;&nbsp; └── main
 &nbsp;&nbsp;     └── resources
 &nbsp;&nbsp;         ├── checkstyle-header.txt <i class="conum" data-value="2"></i><b>(2)</b>
 &nbsp;&nbsp;         ├── checkstyle.xml <i class="conum" data-value="1"></i><b>(1)</b>
 &nbsp;&nbsp;         └── intellij
 &nbsp;&nbsp;          &nbsp;&nbsp; ├── Intellij_Project_Defaults.xml <i class="conum" data-value="4"></i><b>(4)</b>
 &nbsp;&nbsp;          &nbsp;&nbsp; └── Intellij_Spring_Boot_Java_Conventions.xml <i class="conum" data-value="5"></i><b>(5)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Default Checkstyle rules</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>File header setup</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Default suppression rules</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Project defaults for Intellij that apply most of Checkstyle rules</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Project style conventions for Intellij that apply most of Checkstyle rules</td>
</tr>
</tbody></table>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/docs/src/main/asciidoc/images/intellij-code-style.png" alt="Code style">
</div>
<div class="title">Figure 5. Code style</div>
</div>
<div class="paragraph">
<p>Go to <code>File</code> → <code>Settings</code> → <code>Editor</code> → <code>Code style</code>. There click on the icon next to the <code>Scheme</code> section. There, click on the <code>Import Scheme</code> value and pick the <code>Intellij IDEA code style XML</code> option. Import the <code>spring-cloud-build-tools/src/main/resources/intellij/Intellij_Spring_Boot_Java_Conventions.xml</code> file.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/intellij-inspections.png" alt="Code style">
</div>
<div class="title">Figure 6. Inspection profiles</div>
</div>
<div class="paragraph">
<p>Go to <code>File</code> → <code>Settings</code> → <code>Editor</code> → <code>Inspections</code>. There click on the icon next to the <code>Profile</code> section. There, click on the <code>Import Profile</code> and import the <code>spring-cloud-build-tools/src/main/resources/intellij/Intellij_Project_Defaults.xml</code> file.</p>
</div>
<div class="paragraph">
<div class="title">Checkstyle</div>
<p>To have Intellij work with Checkstyle, you have to install the <code>Checkstyle</code> plugin. It’s advisable to also install the <code>Assertions2Assertj</code> to automatically convert the JUnit assertions</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/intellij-checkstyle.png" alt="Checkstyle">
</div>
</div>
<div class="paragraph">
<p>Go to <code>File</code> → <code>Settings</code> → <code>Other settings</code> → <code>Checkstyle</code>. There click on the <code>+</code> icon in the <code>Configuration file</code> section. There, you’ll have to define where the checkstyle rules should be picked from. In the image above, we’ve picked the rules from the cloned Spring Cloud Build repository. However, you can point to the Spring Cloud Build’s GitHub repository (e.g. for the <code>checkstyle.xml</code> : <code><a href="https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/main/resources/checkstyle.xml" class="bare">raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/main/resources/checkstyle.xml</a></code>). We need to provide the following variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>checkstyle.header.file</code> - please point it to the Spring Cloud Build’s, <code>spring-cloud-build-tools/src/main/resources/checkstyle-header.txt</code> file either in your cloned repo or via the <code><a href="https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/main/resources/checkstyle-header.txt" class="bare">raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/main/resources/checkstyle-header.txt</a></code> URL.</p>
</li>
<li>
<p><code>checkstyle.suppressions.file</code> - default suppressions. Please point it to the Spring Cloud Build’s, <code>spring-cloud-build-tools/src/checkstyle/checkstyle-suppressions.xml</code> file either in your cloned repo or via the <code><a href="https://raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/checkstyle/checkstyle-suppressions.xml" class="bare">raw.githubusercontent.com/spring-cloud/spring-cloud-build/master/spring-cloud-build-tools/src/checkstyle/checkstyle-suppressions.xml</a></code> URL.</p>
</li>
<li>
<p><code>checkstyle.additional.suppressions.file</code> - this variable corresponds to suppressions in your local project. E.g. you’re working on <code>spring-cloud-contract</code>. Then point to the <code>project-root/src/checkstyle/checkstyle-suppressions.xml</code> folder. Example for <code>spring-cloud-contract</code> would be: <code>/home/username/spring-cloud-contract/src/checkstyle/checkstyle-suppressions.xml</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Remember to set the <code>Scan Scope</code> to <code>All sources</code> since we apply checkstyle rules for production and test sources.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<h1 id="spring-cloud-netflix" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-netflix"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-netflix">Spring Cloud Netflix</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><strong>Hoxton.SR10</strong></p>
</div>
<div class="paragraph">
<p>This project provides Netflix OSS integrations for Spring Boot apps through autoconfiguration
and binding to the Spring Environment and other Spring programming model idioms. With a few
simple annotations you can quickly enable and configure the common patterns inside your
application and build large distributed systems with battle-tested Netflix components. The
patterns provided include Service Discovery (Eureka), Circuit Breaker (Hystrix),
Intelligent Routing (Zuul) and Client Side Load Balancing (Ribbon).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="service-discovery-eureka-clients"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-discovery-eureka-clients"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-discovery-eureka-clients">130. Service Discovery: Eureka Clients</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Service Discovery is one of the key tenets of a microservice-based architecture.
Trying to hand-configure each client or some form of convention can be difficult to do and can be brittle.
Eureka is the Netflix Service Discovery Server and Client.
The server can be configured and deployed to be highly available, with each server replicating state about the registered services to the others.</p>
</div>
<div class="sect2">
<h3 id="netflix-eureka-client-starter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-eureka-client-starter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-eureka-client-starter">130.1. How to Include Eureka Client</a></h3>
<div class="paragraph">
<p>To include the Eureka Client in your project, use the starter with a group ID of <code>org.springframework.cloud</code> and an artifact ID of <code>spring-cloud-starter-netflix-eureka-client</code>.
See the <a href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a> for details on setting up your build system with the current Spring Cloud Release Train.</p>
</div>
</div>
<div class="sect2">
<h3 id="registering-with-eureka"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-with-eureka"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-with-eureka">130.2. Registering with Eureka</a></h3>
<div class="paragraph">
<p>When a client registers with Eureka, it provides meta-data about itself — such as host, port, health indicator URL, home page, and other details.
Eureka receives heartbeat messages from each instance belonging to a service.
If the heartbeat fails over a configurable timetable, the instance is normally removed from the registry.</p>
</div>
<div class="paragraph">
<p>The following example shows a minimal Eureka client application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{

    <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">home</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello world"</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        <span class="hljs-keyword">new</span> SpringApplicationBuilder(Application.class).web(<span class="hljs-keyword">true</span>).run(args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the preceding example shows a normal <a href="https://projects.spring.io/spring-boot/">Spring Boot</a> application.
By having <code>spring-cloud-starter-netflix-eureka-client</code> on the classpath, your application automatically registers with the Eureka Server. Configuration is required to locate the Eureka server, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>eureka:
  client:
    serviceUrl:
      defaultZone: http://localhost:8761/eureka/</pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, <code>defaultZone</code> is a magic string fallback value that provides the service URL for any client that does not express a preference (in other words, it is a useful default).</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The <code>defaultZone</code> property is case sensitive and requires camel case because the <code>serviceUrl</code> property is a <code>Map&lt;String, String&gt;</code>. Therefore, the <code>defaultZone</code> property does not follow the normal Spring Boot snake-case convention of <code>default-zone</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The default application name (that is, the service ID), virtual host, and non-secure port (taken from the <code>Environment</code>) are <code>${spring.application.name}</code>, <code>${spring.application.name}</code> and <code>${server.port}</code>, respectively.</p>
</div>
<div class="paragraph">
<p>Having <code>spring-cloud-starter-netflix-eureka-client</code> on the classpath makes the app into both a Eureka “instance” (that is, it registers itself) and a “client” (it can query the registry to locate other services).
The instance behaviour is driven by <code>eureka.instance.*</code> configuration keys, but the defaults are fine if you ensure that your application has a value for <code>spring.application.name</code> (this is the default for the Eureka service ID or VIP).</p>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/spring-cloud/spring-cloud-netflix/tree/master/spring-cloud-netflix-eureka-client/src/main/java/org/springframework/cloud/netflix/eureka/EurekaInstanceConfigBean.java">EurekaInstanceConfigBean</a> and <a href="https://github.com/spring-cloud/spring-cloud-netflix/tree/master/spring-cloud-netflix-eureka-client/src/main/java/org/springframework/cloud/netflix/eureka/EurekaClientConfigBean.java">EurekaClientConfigBean</a> for more details on the configurable options.</p>
</div>
<div class="paragraph">
<p>To disable the Eureka Discovery Client, you can set <code>eureka.client.enabled</code> to <code>false</code>. Eureka Discovery Client will also be disabled when <code>spring.cloud.discovery.enabled</code> is set to <code>false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="authenticating-with-the-eureka-server"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#authenticating-with-the-eureka-server"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#authenticating-with-the-eureka-server">130.3. Authenticating with the Eureka Server</a></h3>
<div class="paragraph">
<p>HTTP basic authentication is automatically added to your eureka client if one of the <code>eureka.client.serviceUrl.defaultZone</code> URLs has credentials embedded in it (curl style, as follows: <code><a href="https://user:password@localhost:8761/eureka" class="bare">user:password@localhost:8761/eureka</a></code>).
For more complex needs, you can create a <code>@Bean</code> of type <code>DiscoveryClientOptionalArgs</code> and inject <code>ClientFilter</code> instances into it, all of which is applied to the calls from the client to the server.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because of a limitation in Eureka, it is not possible to support per-server basic auth credentials, so only the first set that are found is used.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>When Eureka server requires client side certificate for authentication, the client side certificate and trust store can be configured via properties, as shown in following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">eureka:
  client:
    tls:
      enabled: true
      key-store: &lt;path-of-key-store&gt;
      key-store-type: PKCS12
      key-store-password: &lt;key-store-password&gt;
      key-password: &lt;key-password&gt;
      trust-store: &lt;path-of-trust-store&gt;
      trust-store-type: PKCS12
      trust-store-password: &lt;trust-store-password&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>eureka.client.tls.enabled</code> needs to be true to enable Eureka client side TLS. When <code>eureka.client.tls.trust-store</code> is omitted, a JVM default trust store is used. The default value for <code>eureka.client.tls.key-store-type</code> and <code>eureka.client.tls.trust-store-type</code> is PKCS12. When password properties are omitted, empty password is assumed.</p>
</div>
</div>
<div class="sect2">
<h3 id="status-page-and-health-indicator"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#status-page-and-health-indicator"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#status-page-and-health-indicator">130.4. Status Page and Health Indicator</a></h3>
<div class="paragraph">
<p>The status page and health indicators for a Eureka instance default to <code>/info</code> and <code>/health</code> respectively, which are the default locations of useful endpoints in a Spring Boot Actuator application.
You need to change these, even for an Actuator application if you use a non-default context path or servlet path (such as <code>server.servletPath=/custom</code>). The following example shows the default values for the two settings:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>eureka:
  instance:
    statusPageUrlPath: ${server.servletPath}/info
    healthCheckUrlPath: ${server.servletPath}/health</pre>
</div>
</div>
<div class="paragraph">
<p>These links show up in the metadata that is consumed by clients and are used in some scenarios to decide whether to send requests to your application, so it is helpful if they are accurate.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In Dalston it was also required to set the status and health check URLs when changing
that management context path. This requirement was removed beginning in Edgware.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="registering-a-secure-application"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-a-secure-application"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-a-secure-application">130.5. Registering a Secure Application</a></h3>
<div class="paragraph">
<p>If your app wants to be contacted over HTTPS, you can set two flags in the <code>EurekaInstanceConfig</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>eureka.instance.[nonSecurePortEnabled]=[false]</code></p>
</li>
<li>
<p><code>eureka.instance.[securePortEnabled]=[true]</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Doing so makes Eureka publish instance information that shows an explicit preference for secure communication.
The Spring Cloud <code>DiscoveryClient</code> always returns a URI starting with <code>https</code> for a service configured this way.
Similarly, when a service is configured this way, the Eureka (native) instance information has a secure health check URL.</p>
</div>
<div class="paragraph">
<p>Because of the way Eureka works internally, it still publishes a non-secure URL for the status and home pages unless you also override those explicitly.
You can use placeholders to configure the eureka instance URLs, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>eureka:
  instance:
    statusPageUrl: https://${eureka.hostname}/info
    healthCheckUrl: https://${eureka.hostname}/health
    homePageUrl: https://${eureka.hostname}/</pre>
</div>
</div>
<div class="paragraph">
<p>(Note that <code>${eureka.hostname}</code> is a native placeholder only available
in later versions of Eureka. You could achieve the same thing with
Spring placeholders as well — for example, by using <code>${eureka.instance.hostName}</code>.)</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your application runs behind a proxy, and the SSL termination is in the proxy (for example, if you run in Cloud Foundry or other platforms as a service), then you need to ensure that the proxy “forwarded” headers are intercepted and handled by the application.
If the Tomcat container embedded in a Spring Boot application has explicit configuration for the 'X-Forwarded-\*` headers, this happens automatically.
The links rendered by your app to itself being wrong (the wrong host, port, or protocol) is a sign that you got this configuration wrong.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="eurekas-health-checks"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#eurekas-health-checks"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#eurekas-health-checks">130.6. Eureka’s Health Checks</a></h3>
<div class="paragraph">
<p>By default, Eureka uses the client heartbeat to determine if a client is up.
Unless specified otherwise, the Discovery Client does not propagate the current health check status of the application, per the Spring Boot Actuator.
Consequently, after successful registration, Eureka always announces that the application is in 'UP' state. This behavior can be altered by enabling Eureka health checks, which results in propagating application status to Eureka.
As a consequence, every other application does not send traffic to applications in states other then 'UP'.
The following example shows how to enable health checks for the client:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>eureka:
  client:
    healthcheck:
      enabled: true</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>eureka.client.healthcheck.enabled=true</code> should only be set in <code>application.yml</code>. Setting the value in <code>bootstrap.yml</code> causes undesirable side effects, such as registering in Eureka with an <code>UNKNOWN</code> status.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you require more control over the health checks, consider implementing your own <code>com.netflix.appinfo.HealthCheckHandler</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="eureka-metadata-for-instances-and-clients"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#eureka-metadata-for-instances-and-clients"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#eureka-metadata-for-instances-and-clients">130.7. Eureka Metadata for Instances and Clients</a></h3>
<div class="paragraph">
<p>It is worth spending a bit of time understanding how the Eureka metadata works, so you can use it in a way that makes sense in your platform.
There is standard metadata for information such as hostname, IP address, port numbers, the status page, and health check.
These are published in the service registry and used by clients to contact the services in a straightforward way.
Additional metadata can be added to the instance registration in the <code>eureka.instance.metadataMap</code>, and this metadata is accessible in the remote clients.
In general, additional metadata does not change the behavior of the client, unless the client is made aware of the meaning of the metadata.
There are a couple of special cases, described later in this document, where Spring Cloud already assigns meaning to the metadata map.</p>
</div>
<div class="sect3">
<h4 id="using-eureka-on-cloud-foundry"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-eureka-on-cloud-foundry"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-eureka-on-cloud-foundry">130.7.1. Using Eureka on Cloud Foundry</a></h4>
<div class="paragraph">
<p>Cloud Foundry has a global router so that all instances of the same app have the same hostname (other PaaS solutions with a similar architecture have the same arrangement).
This is not necessarily a barrier to using Eureka.
However, if you use the router (recommended or even mandatory, depending on the way your platform was set up), you need to explicitly set the hostname and port numbers (secure or non-secure) so that they use the router.
You might also want to use instance metadata so that you can distinguish between the instances on the client (for example, in a custom load balancer).
By default, the <code>eureka.instance.instanceId</code> is <code>vcap.application.instance_id</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>eureka:
  instance:
    hostname: ${vcap.application.uris[0]}
    nonSecurePort: 80</pre>
</div>
</div>
<div class="paragraph">
<p>Depending on the way the security rules are set up in your Cloud Foundry instance, you might be able to register and use the IP address of the host VM for direct service-to-service calls.
This feature is not yet available on Pivotal Web Services (<a href="https://run.pivotal.io/">PWS</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="using-eureka-on-aws"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-eureka-on-aws"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-eureka-on-aws">130.7.2. Using Eureka on AWS</a></h4>
<div class="paragraph">
<p>If the application is planned to be deployed to an AWS cloud, the Eureka instance must be configured to be AWS-aware. You can do so by customizing the <a href="https://github.com/spring-cloud/spring-cloud-netflix/tree/master/spring-cloud-netflix-eureka-client/src/main/java/org/springframework/cloud/netflix/eureka/EurekaInstanceConfigBean.java">EurekaInstanceConfigBean</a> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-meta">@Profile</span>(<span class="hljs-string">"!default"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> EurekaInstanceConfigBean <span class="hljs-title">eurekaInstanceConfig</span><span class="hljs-params">(InetUtils inetUtils)</span> </span>{
  EurekaInstanceConfigBean b = <span class="hljs-keyword">new</span> EurekaInstanceConfigBean(inetUtils);
  AmazonInfo info = AmazonInfo.Builder.newBuilder().autoBuild(<span class="hljs-string">"eureka"</span>);
  b.setDataCenterInfo(info);
  <span class="hljs-keyword">return</span> b;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changing-the-eureka-instance-id"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#changing-the-eureka-instance-id"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#changing-the-eureka-instance-id">130.7.3. Changing the Eureka Instance ID</a></h4>
<div class="paragraph">
<p>A vanilla Netflix Eureka instance is registered with an ID that is equal to its host name (that is, there is only one service per host).
Spring Cloud Eureka provides a sensible default, which is defined as follows:</p>
</div>
<div class="paragraph">
<p><code>${spring.cloud.client.hostname}:${spring.application.name}:${spring.application.instance_id:${server.port}}}</code></p>
</div>
<div class="paragraph">
<p>An example is <code>myhost:myappname:8080</code>.</p>
</div>
<div class="paragraph">
<p>By using Spring Cloud, you can override this value by providing a unique identifier in <code>eureka.instance.instanceId</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>eureka:
  instance:
    instanceId: ${spring.application.name}:${vcap.application.instance_id:${spring.application.instance_id:${random.value}}}</pre>
</div>
</div>
<div class="paragraph">
<p>With the metadata shown in the preceding example and multiple service instances deployed on localhost, the random value is inserted there to make the instance unique.
In Cloud Foundry, the <code>vcap.application.instance_id</code> is populated automatically in a Spring Boot application, so the random value is not needed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-eurekaclient"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-the-eurekaclient"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-the-eurekaclient">130.8. Using the EurekaClient</a></h3>
<div class="paragraph">
<p>Once you have an application that is a discovery client, you can use it to discover service instances from the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server">Eureka Server</a>.
One way to do so is to use the native <code>com.netflix.discovery.EurekaClient</code> (as opposed to the Spring Cloud <code>DiscoveryClient</code>), as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@Autowired
private EurekaClient discoveryClient;

public String serviceUrl() {
    InstanceInfo instance = discoveryClient.getNextServerFromEureka("STORES", false);
    return instance.getHomePageUrl();
}</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use the <code>EurekaClient</code> in a <code>@PostConstruct</code> method or in a <code>@Scheduled</code> method (or anywhere where the <code>ApplicationContext</code> might not be started yet).
It is initialized in a <code>SmartLifecycle</code> (with <code>phase=0</code>), so the earliest you can rely on it being available is in another <code>SmartLifecycle</code> with a higher phase.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="eurekaclient-without-jersey"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#eurekaclient-without-jersey"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#eurekaclient-without-jersey">130.8.1. EurekaClient without Jersey</a></h4>
<div class="paragraph">
<p>By default, EurekaClient uses Jersey for HTTP communication.
If you wish to avoid dependencies from Jersey, you can exclude it from your dependencies.
Spring Cloud auto-configures a transport client based on Spring <code>RestTemplate</code>.
The following example shows Jersey being excluded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
            &lt;artifactId&gt;jersey-client&lt;/artifactId&gt;
        &lt;/exclusion&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
            &lt;artifactId&gt;jersey-core&lt;/artifactId&gt;
        &lt;/exclusion&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;com.sun.jersey.contribs&lt;/groupId&gt;
            &lt;artifactId&gt;jersey-apache-client4&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="alternatives-to-the-native-netflix-eurekaclient"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#alternatives-to-the-native-netflix-eurekaclient"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#alternatives-to-the-native-netflix-eurekaclient">130.9. Alternatives to the Native Netflix EurekaClient</a></h3>
<div class="paragraph">
<p>You need not use the raw Netflix <code>EurekaClient</code>.
Also, it is usually more convenient to use it behind a wrapper of some sort.
Spring Cloud has support for <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign">Feign</a> (a REST client builder) and <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-ribbon">Spring <code>RestTemplate</code></a> through the logical Eureka service identifiers (VIPs) instead of physical URLs.
To configure Ribbon with a fixed list of physical servers, you can set <code>&lt;client&gt;.ribbon.listOfServers</code> to a comma-separated list of physical addresses (or hostnames), where <code>&lt;client&gt;</code> is the ID of the client.</p>
</div>
<div class="paragraph">
<p>You can also use the <code>org.springframework.cloud.client.discovery.DiscoveryClient</code>, which provides a simple API (not specific to Netflix) for discovery clients, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@Autowired
private DiscoveryClient discoveryClient;

public String serviceUrl() {
    List&lt;ServiceInstance&gt; list = discoveryClient.getInstances("STORES");
    if (list != null &amp;&amp; list.size() &gt; 0 ) {
        return list.get(0).getUri();
    }
    return null;
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="why-is-it-so-slow-to-register-a-service"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#why-is-it-so-slow-to-register-a-service"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#why-is-it-so-slow-to-register-a-service">130.10. Why Is It so Slow to Register a Service?</a></h3>
<div class="paragraph">
<p>Being an instance also involves a periodic heartbeat to the registry
(through the client’s <code>serviceUrl</code>) with a default duration of 30 seconds.
A service is not available for discovery by clients until the instance, the server, and the client all have the same metadata in their local
cache (so it could take 3 heartbeats).
You can change the period by setting <code>eureka.instance.leaseRenewalIntervalInSeconds</code>.
Setting it to a value of less than 30 speeds up the process of getting clients connected to other services.
In production, it is probably better to stick with the default, because of internal computations in the server that make assumptions about the lease renewal period.</p>
</div>
</div>
<div class="sect2">
<h3 id="zones"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zones"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zones">130.11. Zones</a></h3>
<div class="paragraph">
<p>If you have deployed Eureka clients to multiple zones, you may prefer that those clients use services within the same zone before trying services in another zone.
To set that up, you need to configure your Eureka clients correctly.</p>
</div>
<div class="paragraph">
<p>First, you need to make sure you have Eureka servers deployed to each zone and that
they are peers of each other.
See the section on <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server-zones-and-regions">zones and regions</a>
for more information.</p>
</div>
<div class="paragraph">
<p>Next, you need to tell Eureka which zone your service is in.
You can do so by using the <code>metadataMap</code> property.
For example, if <code>service 1</code> is deployed to both <code>zone 1</code> and <code>zone 2</code>, you need to set the following Eureka properties in <code>service 1</code>:</p>
</div>
<div class="paragraph">
<p><strong>Service 1 in Zone 1</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">eureka.instance.metadataMap.zone = zone1
eureka.client.preferSameZoneEureka = <span class="hljs-literal">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Service 1 in Zone 2</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">eureka.instance.metadataMap.zone = zone2
eureka.client.preferSameZoneEureka = <span class="hljs-literal">true</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="refreshing-eureka-clients"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#refreshing-eureka-clients"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#refreshing-eureka-clients">130.12. Refreshing Eureka Clients</a></h3>
<div class="paragraph">
<p>By default, the <code>EurekaClient</code> bean is refreshable, meaning the Eureka client properties can be changed and refreshed.
When a refresh occurs clients will be unregistered from the Eureka server and there might be a brief moment of time
where all instance of a given service are not available. One way to eliminate this from happening is to disable
the ability to refresh Eureka clients. To do this set <code>eureka.client.refresh.enable=false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-eureka-with-spring-cloud-loadbalancer"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-eureka-with-spring-cloud-loadbalancer"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-eureka-with-spring-cloud-loadbalancer">130.13. Using Eureka with Spring Cloud LoadBalancer</a></h3>
<div class="paragraph">
<p>We offer support for the Spring Cloud LoadBalancer <code>ZonePreferenceServiceInstanceListSupplier</code>.
The <code>zone</code> value from the Eureka instance metadata (<code>eureka.instance.metadataMap.zone</code>) is used for setting the
value of <code>spring-clod-loadbalancer-zone</code> property that is used to filter service instances by zone.</p>
</div>
<div class="paragraph">
<p>If that is missing and if the <code>spring.cloud.loadbalancer.eureka.approximateZoneFromHostname</code> flag is set to <code>true</code>,
it can use the domain name from the server hostname as a proxy for the zone.</p>
</div>
<div class="paragraph">
<p>If there is no other source of zone data, then a guess is made, based on the client configuration (as opposed to the instance configuration).
We take <code>eureka.client.availabilityZones</code>, which is a map from region name to a list of zones, and pull out the first zone for the instance’s own region (that is, the <code>eureka.client.region</code>, which defaults to "us-east-1", for compatibility with native Netflix).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-eureka-server"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server">131. Service Discovery: Eureka Server</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes how to set up a Eureka server.</p>
</div>
<div class="sect2">
<h3 id="netflix-eureka-server-starter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-eureka-server-starter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-eureka-server-starter">131.1. How to Include Eureka Server</a></h3>
<div class="paragraph">
<p>To include Eureka Server in your project, use the starter with a group ID of <code>org.springframework.cloud</code> and an artifact ID of <code>spring-cloud-starter-netflix-eureka-server</code>.
See the <a href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a> for details on setting up your build system with the current Spring Cloud Release Train.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your project already uses Thymeleaf as its template engine, the Freemarker templates of the Eureka server may not be loaded correctly. In this case it is necessary to configure the template loader manually:
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>spring:
  freemarker:
    template-loader-path: classpath:/templates/
    prefer-file-system-access: false</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-running-eureka-server"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-running-eureka-server"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-running-eureka-server">131.2. How to Run a Eureka Server</a></h3>
<div class="paragraph">
<p>The following example shows a minimal Eureka server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableEurekaServer</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        <span class="hljs-keyword">new</span> SpringApplicationBuilder(Application.class).web(<span class="hljs-keyword">true</span>).run(args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server has a home page with a UI and HTTP API endpoints for the normal Eureka functionality under <code>/eureka/*</code>.</p>
</div>
<div class="paragraph">
<p>The following links have some Eureka background reading: <a href="https://github.com/cfregly/fluxcapacitor/wiki/NetflixOSS-FAQ#eureka-service-discovery-load-balancer">flux capacitor</a> and <a href="https://groups.google.com/forum/?fromgroups#!topic/eureka_netflix/g3p2r7gHnN0">google group discussion</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Due to Gradle’s dependency resolution rules and the lack of a parent bom feature, depending on <code>spring-cloud-starter-netflix-eureka-server</code> can cause failures on application startup.
To remedy this issue, add the Spring Boot Gradle plugin and import the Spring cloud starter parent bom as follows:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">buildscript {
  dependencies {
    classpath(<span class="hljs-string">"org.springframework.boot:spring-boot-gradle-plugin:{spring-boot-docs-version}"</span>)
  }
}

apply plugin: <span class="hljs-string">"spring-boot"</span>

dependencyManagement {
  imports {
    mavenBom <span class="hljs-string">"org.springframework.cloud:spring-cloud-dependencies:{spring-cloud-version}"</span>
  }
}</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-eureka-server-zones-and-regions"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server-zones-and-regions"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server-zones-and-regions">131.3. High Availability, Zones and Regions</a></h3>
<div class="paragraph">
<p>The Eureka server does not have a back end store, but the service instances in the registry all have to send heartbeats to keep their registrations up to date (so this can be done in memory).
Clients also have an in-memory cache of Eureka registrations (so they do not have to go to the registry for every request to a service).</p>
</div>
<div class="paragraph">
<p>By default, every Eureka server is also a Eureka client and requires (at least one) service URL to locate a peer.
If you do not provide it, the service runs and works, but it fills your logs with a lot of noise about not being able to register with the peer.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-ribbon">below for details of Ribbon support</a> on the client side for Zones and Regions.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-eureka-server-standalone-mode"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server-standalone-mode"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server-standalone-mode">131.4. Standalone Mode</a></h3>
<div class="paragraph">
<p>The combination of the two caches (client and server) and the heartbeats make a standalone Eureka server fairly resilient to failure, as long as there is some sort of monitor or elastic runtime (such as Cloud Foundry) keeping it alive.
In standalone mode, you might prefer to switch off the client side behavior so that it does not keep trying and failing to reach its peers.
The following example shows how to switch off the client-side behavior:</p>
</div>
<div class="listingblock">
<div class="title">application.yml (Standalone Eureka Server)</div>
<div class="content">
<pre>server:
  port: 8761

eureka:
  instance:
    hostname: localhost
  client:
    registerWithEureka: false
    fetchRegistry: false
    serviceUrl:
      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/</pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the <code>serviceUrl</code> is pointing to the same host as the local instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-eureka-server-peer-awareness"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server-peer-awareness"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server-peer-awareness">131.5. Peer Awareness</a></h3>
<div class="paragraph">
<p>Eureka can be made even more resilient and available by running multiple instances and asking them to register with each other.
In fact, this is the default behavior, so all you need to do to make it work is add a valid <code>serviceUrl</code> to a peer, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml (Two Peer Aware Eureka Servers)</div>
<div class="content">
<pre>---
spring:
  profiles: peer1
eureka:
  instance:
    hostname: peer1
  client:
    serviceUrl:
      defaultZone: https://peer2/eureka/

---
spring:
  profiles: peer2
eureka:
  instance:
    hostname: peer2
  client:
    serviceUrl:
      defaultZone: https://peer1/eureka/</pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, we have a YAML file that can be used to run the same server on two hosts (<code>peer1</code> and <code>peer2</code>) by running it in different Spring profiles.
You could use this configuration to test the peer awareness on a single host (there is not much value in doing that in production) by manipulating <code>/etc/hosts</code> to resolve the host names.
In fact, the <code>eureka.instance.hostname</code> is not needed if you are running on a machine that knows its own hostname (by default, it is looked up by using <code>java.net.InetAddress</code>).</p>
</div>
<div class="paragraph">
<p>You can add multiple peers to a system, and, as long as they are all connected to each other by at least one edge, they synchronize
the registrations amongst themselves.
If the peers are physically separated (inside a data center or between multiple data centers), then the system can, in principle, survive “split-brain” type failures.
You can add multiple peers to a system, and as long as they are all
directly connected to each other, they will synchronize
the registrations amongst themselves.</p>
</div>
<div class="listingblock">
<div class="title">application.yml (Three Peer Aware Eureka Servers)</div>
<div class="content">
<pre>eureka:
  client:
    serviceUrl:
      defaultZone: https://peer1/eureka/,http://peer2/eureka/,http://peer3/eureka/

---
spring:
  profiles: peer1
eureka:
  instance:
    hostname: peer1

---
spring:
  profiles: peer2
eureka:
  instance:
    hostname: peer2

---
spring:
  profiles: peer3
eureka:
  instance:
    hostname: peer3</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-eureka-server-prefer-ip-address"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server-prefer-ip-address"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-eureka-server-prefer-ip-address">131.6. When to Prefer IP Address</a></h3>
<div class="paragraph">
<p>In some cases, it is preferable for Eureka to advertise the IP addresses of services rather than the hostname.
Set <code>eureka.instance.preferIpAddress</code> to <code>true</code> and, when the application registers with eureka, it uses its IP address rather than its hostname.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the hostname cannot be determined by Java, then the IP address is sent to Eureka.
Only explict way of setting the hostname is by setting <code>eureka.instance.hostname</code> property.
You can set your hostname at the run-time by using an environment variable — for example, <code>eureka.instance.hostname=${HOST_NAME}</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="securing-the-eureka-server"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#securing-the-eureka-server"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#securing-the-eureka-server">131.7. Securing The Eureka Server</a></h3>
<div class="paragraph">
<p>You can secure your Eureka server simply by adding Spring Security to your
server’s classpath via <code>spring-boot-starter-security</code>. By default when Spring Security is on the classpath it will require that
a valid CSRF token be sent with every request to the app. Eureka clients will not generally possess a valid
cross site request forgery (CSRF) token you will need to disable this requirement for the <code>/eureka/**</code> endpoints.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        http.csrf().ignoringAntMatchers(<span class="hljs-string">"/eureka/**"</span>);
        <span class="hljs-keyword">super</span>.configure(http);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on CSRF see the <a href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#csrf">Spring Security documentation</a>.</p>
</div>
<div class="paragraph">
<p>A demo Eureka Server can be found in the Spring Cloud Samples <a href="https://github.com/spring-cloud-samples/eureka/tree/Eureka-With-Security">repo</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="disabling-ribbon-with-eureka-server-and-client-starters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#disabling-ribbon-with-eureka-server-and-client-starters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#disabling-ribbon-with-eureka-server-and-client-starters">131.8. Disabling Ribbon with Eureka Server and Client starters</a></h3>
<div class="paragraph">
<p><code>spring-cloud-starter-netflix-eureka-server</code> and <code>spring-cloud-starter-netflix-eureka-client</code> come along with
a <code>spring-cloud-starter-netflix-ribbon</code>. Since Ribbon load-balancer is now in maintenance mode,
we suggest switching to using the Spring Cloud LoadBalancer, also included in Eureka starters, instead.</p>
</div>
<div class="paragraph">
<p>In order to that, you can set the value of <code>spring.cloud.loadbalancer.ribbon.enabled</code> property to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>You can then also exclude ribbon-related dependencies from Eureka starters in your build files, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-ribbon<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.netflix.ribbon<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ribbon-eureka<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jdk-11-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#jdk-11-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#jdk-11-support">131.9. JDK 11 Support</a></h3>
<div class="paragraph">
<p>The JAXB modules which the Eureka server depends upon were removed in JDK 11. If you intend to use JDK 11
when running a Eureka server you must include these dependencies in your POM or Gradle file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.glassfish.jaxb<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jaxb-runtime<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="circuit-breaker-spring-cloud-circuit-breaker-with-hystrix"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#circuit-breaker-spring-cloud-circuit-breaker-with-hystrix"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#circuit-breaker-spring-cloud-circuit-breaker-with-hystrix">132. Circuit Breaker: Spring Cloud Circuit Breaker With Hystrix</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="disabling-spring-cloud-circuit-breaker-hystrix"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#disabling-spring-cloud-circuit-breaker-hystrix"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#disabling-spring-cloud-circuit-breaker-hystrix">132.1. Disabling Spring Cloud Circuit Breaker Hystrix</a></h3>
<div class="paragraph">
<p>You can disable the auto-configuration by setting <code>spring.cloud.circuitbreaker.hystrix.enabled</code>
to <code>false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-hystrix-circuit-breakers"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-hystrix-circuit-breakers"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-hystrix-circuit-breakers">132.2. Configuring Hystrix Circuit Breakers</a></h3>
<div class="sect3">
<h4 id="default-configuration-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#default-configuration-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#default-configuration-3">132.2.1. Default Configuration</a></h4>
<div class="paragraph">
<p>To provide a default configuration for all of your circuit breakers create a <code>Customize</code> bean that is passed a
<code>HystrixCircuitBreakerFactory</code> or <code>ReactiveHystrixCircuitBreakerFactory</code>.
The <code>configureDefault</code> method can be used to provide a default configuration.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Customizer&lt;HystrixCircuitBreakerFactory&gt; <span class="hljs-title">defaultConfig</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> factory -&gt; factory.configureDefault(id -&gt; HystrixCommand.Setter
            .withGroupKey(HystrixCommandGroupKey.Factory.asKey(id))
            .andCommandPropertiesDefaults(HystrixCommandProperties.Setter()
            .withExecutionTimeoutInMilliseconds(<span class="hljs-number">4000</span>)));
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reactive-example-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-example-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-example-3">Reactive Example</a></h5>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Customizer&lt;ReactiveHystrixCircuitBreakerFactory&gt; <span class="hljs-title">defaultConfig</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> factory -&gt; factory.configureDefault(id -&gt; HystrixObservableCommand.Setter
            .withGroupKey(HystrixCommandGroupKey.Factory.asKey(id))
            .andCommandPropertiesDefaults(HystrixCommandProperties.Setter()
                    .withExecutionTimeoutInMilliseconds(<span class="hljs-number">4000</span>)));
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="specific-circuit-breaker-configuration-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#specific-circuit-breaker-configuration-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#specific-circuit-breaker-configuration-3">132.2.2. Specific Circuit Breaker Configuration</a></h4>
<div class="paragraph">
<p>Similarly to providing a default configuration, you can create a <code>Customize</code> bean this is passed a
<code>HystrixCircuitBreakerFactory</code></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Customizer&lt;HystrixCircuitBreakerFactory&gt; <span class="hljs-title">customizer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> factory -&gt; factory.configure(builder -&gt; builder.commandProperties(
                    HystrixCommandProperties.Setter().withExecutionTimeoutInMilliseconds(<span class="hljs-number">2000</span>)), <span class="hljs-string">"foo"</span>, <span class="hljs-string">"bar"</span>);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reactive-example-4"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-example-4"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-example-4">Reactive Example</a></h5>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Customizer&lt;ReactiveHystrixCircuitBreakerFactory&gt; <span class="hljs-title">customizer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> factory -&gt; factory.configure(builder -&gt; builder.commandProperties(
                    HystrixCommandProperties.Setter().withExecutionTimeoutInMilliseconds(<span class="hljs-number">2000</span>)), <span class="hljs-string">"foo"</span>, <span class="hljs-string">"bar"</span>);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="circuit-breaker-hystrix-clients"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#circuit-breaker-hystrix-clients"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#circuit-breaker-hystrix-clients">133. Circuit Breaker: Hystrix Clients</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Netflix has created a library called <a href="https://github.com/Netflix/Hystrix">Hystrix</a> that implements the <a href="https://martinfowler.com/bliki/CircuitBreaker.html">circuit breaker pattern</a>.
In a microservice architecture, it is common to have multiple layers of service calls, as shown in the following example:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/Hystrix.png" alt="Hystrix">
</div>
<div class="title">Figure 7. Microservice Graph</div>
</div>
<div class="paragraph">
<p>A service failure in the lower level of services can cause cascading failure all the way up to the user.
When calls to a particular service exceed <code>circuitBreaker.requestVolumeThreshold</code> (default: 20 requests) and the failure percentage is greater than <code>circuitBreaker.errorThresholdPercentage</code> (default: &gt;50%) in a rolling window defined by <code>metrics.rollingStats.timeInMilliseconds</code> (default: 10 seconds), the circuit opens and the call is not made.
In cases of error and an open circuit, a fallback can be provided by the developer.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/HystrixFallback.png" alt="HystrixFallback">
</div>
<div class="title">Figure 8. Hystrix fallback prevents cascading failures</div>
</div>
<div class="paragraph">
<p>Having an open circuit stops cascading failures and allows overwhelmed or failing services time to recover.
The fallback can be another Hystrix protected call, static data, or a sensible empty value.
Fallbacks may be chained so that the first fallback makes some other business call, which in turn falls back to static data.</p>
</div>
<div class="sect2">
<h3 id="how-to-include-hystrix"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-include-hystrix"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-include-hystrix">133.1. How to Include Hystrix</a></h3>
<div class="paragraph">
<p>To include Hystrix in your project, use the starter with a group ID of <code>org.springframework.cloud</code>
and a artifact ID of <code>spring-cloud-starter-netflix-hystrix</code>.
See the <a href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a> for details on setting up your build system with the current Spring Cloud Release Train.</p>
</div>
<div class="paragraph">
<p>The following example shows a minimal Eureka server with a Hystrix circuit breaker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@SpringBootApplication
@EnableCircuitBreaker
public class Application {

    public static void main(String[] args) {
        new SpringApplicationBuilder(Application.class).web(true).run(args);
    }

}

@Component
public class StoreIntegration {

    @HystrixCommand(fallbackMethod = "defaultStores")
    public Object getStores(Map&lt;String, Object&gt; parameters) {
        //do stuff that might fail
    }

    public Object defaultStores(Map&lt;String, Object&gt; parameters) {
        return /* something useful */;
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@HystrixCommand</code> is provided by a Netflix contrib library called <a href="https://github.com/Netflix/Hystrix/tree/master/hystrix-contrib/hystrix-javanica">“javanica”</a>.
Spring Cloud automatically wraps Spring beans with that annotation in a proxy that is connected to the Hystrix circuit breaker.
The circuit breaker calculates when to open and close the circuit and what to do in case of a failure.</p>
</div>
<div class="paragraph">
<p>To configure the <code>@HystrixCommand</code> you can use the <code>commandProperties</code>
attribute with a list of <code>@HystrixProperty</code> annotations. See
<a href="https://github.com/Netflix/Hystrix/tree/master/hystrix-contrib/hystrix-javanica#configuration">here</a>
for more details. See the <a href="https://github.com/Netflix/Hystrix/wiki/Configuration">Hystrix wiki</a>
for details on the properties available.</p>
</div>
</div>
<div class="sect2">
<h3 id="netflix-hystrix-starter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-hystrix-starter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-hystrix-starter">133.2. Propagating the Security Context or Using Spring Scopes</a></h3>
<div class="paragraph">
<p>If you want some thread local context to propagate into a <code>@HystrixCommand</code>, the default declaration does not work, because it executes the command in a thread pool (in case of timeouts).
You can switch Hystrix to use the same thread as the caller through configuration or directly in the annotation, by asking it to use a different “Isolation Strategy”.
The following example demonstrates setting the thread in the annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@HystrixCommand</span>(fallbackMethod = <span class="hljs-string">"stubMyService"</span>,
    commandProperties = {
      <span class="hljs-meta">@HystrixProperty</span>(name=<span class="hljs-string">"execution.isolation.strategy"</span>, value=<span class="hljs-string">"SEMAPHORE"</span>)
    }
)
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same thing applies if you are using <code>@SessionScope</code> or <code>@RequestScope</code>.
If you encounter a runtime exception that says it cannot find the scoped context, you need to use the same thread.</p>
</div>
<div class="paragraph">
<p>You also have the option to set the <code>hystrix.shareSecurityContext</code> property to <code>true</code>.
Doing so auto-configures a Hystrix concurrency strategy plugin hook to transfer the <code>SecurityContext</code> from your main thread to the one used by the Hystrix command.
Hystrix does not let multiple Hystrix concurrency strategy be registered so an extension mechanism is available by declaring your own <code>HystrixConcurrencyStrategy</code> as a Spring bean.
Spring Cloud looks for your implementation within the Spring context and wrap it inside its own plugin.</p>
</div>
</div>
<div class="sect2">
<h3 id="health-indicator-4"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#health-indicator-4"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#health-indicator-4">133.3. Health Indicator</a></h3>
<div class="paragraph">
<p>The state of the connected circuit breakers are also exposed in the <code>/health</code> endpoint of the calling application, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    <span class="hljs-attr">"hystrix"</span>: {
        <span class="hljs-attr">"openCircuitBreakers"</span>: [
            <span class="hljs-string">"StoreIntegration::getStoresByLocationLink"</span>
        ],
        <span class="hljs-attr">"status"</span>: <span class="hljs-string">"CIRCUIT_OPEN"</span>
    },
    <span class="hljs-attr">"status"</span>: <span class="hljs-string">"UP"</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hystrix-metrics-stream"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix-metrics-stream"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix-metrics-stream">133.4. Hystrix Metrics Stream</a></h3>
<div class="paragraph">
<p>To enable the Hystrix metrics stream, include a dependency on <code>spring-boot-starter-actuator</code> and set
<code>management.endpoints.web.exposure.include: hystrix.stream</code>.
Doing so exposes the <code>/actuator/hystrix.stream</code> as a management endpoint, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="circuit-breaker-hystrix-dashboard"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#circuit-breaker-hystrix-dashboard"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#circuit-breaker-hystrix-dashboard">134. Circuit Breaker: Hystrix Dashboard</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the main benefits of Hystrix is the set of metrics it gathers about each HystrixCommand.
The Hystrix Dashboard displays the health of each circuit breaker in an efficient manner.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/Hystrix.png" alt="Hystrix">
</div>
<div class="title">Figure 9. Hystrix Dashboard</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hystrix-timeouts-and-ribbon-clients"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix-timeouts-and-ribbon-clients"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix-timeouts-and-ribbon-clients">135. Hystrix Timeouts And Ribbon Clients</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>When using Hystrix commands that wrap Ribbon clients you want to make sure your Hystrix timeout
is configured to be longer than the configured Ribbon timeout, including any potential
retries that might be made. For example, if your Ribbon connection timeout is one second and
the Ribbon client might retry the request three times, than your Hystrix timeout should
be slightly more than three seconds.</p>
</div>
<div class="sect2">
<h3 id="netflix-hystrix-dashboard-starter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-hystrix-dashboard-starter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-hystrix-dashboard-starter">135.1. How to Include the Hystrix Dashboard</a></h3>
<div class="paragraph">
<p>To include the Hystrix Dashboard in your project, use the starter with a group ID of <code>org.springframework.cloud</code> and an artifact ID of <code>spring-cloud-starter-netflix-hystrix-dashboard</code>.
See the <a href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a> for details on setting up your build system with the current Spring Cloud Release Train.</p>
</div>
<div class="paragraph">
<p>To run the Hystrix Dashboard, annotate your Spring Boot main class with <code>@EnableHystrixDashboard</code>.
Then visit <code>/hystrix</code> and point the dashboard to an individual instance’s <code>/hystrix.stream</code> endpoint in a Hystrix client application.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When connecting to a <code>/hystrix.stream</code> endpoint that uses HTTPS, the certificate used by the server must be trusted by the JVM.
If the certificate is not trusted, you must import the certificate into the JVM in order for the Hystrix Dashboard to make a successful connection to the stream endpoint.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order to use the <code>/proxy.stream</code> endpoint you must configure a list of hosts to allow connections to. To set the
list of allowed hosts use <code>hystrix.dashboard.proxyStreamAllowList</code>. You can use an Ant-style pattern in the host name to
match against a wider range of host names.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="turbine"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#turbine"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#turbine">135.2. Turbine</a></h3>
<div class="paragraph">
<p>Looking at an individual instance’s Hystrix data is not very useful in terms of the overall health of the system. <a href="https://github.com/Netflix/Turbine">Turbine</a> is an application that aggregates all of the relevant <code>/hystrix.stream</code> endpoints into a combined <code>/turbine.stream</code> for use in the Hystrix Dashboard.
Individual instances are located through Eureka.
Running Turbine requires annotating your main class with the <code>@EnableTurbine</code> annotation (for example, by using spring-cloud-starter-netflix-turbine to set up the classpath).
All of the documented configuration properties from <a href="https://github.com/Netflix/Turbine/wiki/Configuration-(1.x)">the Turbine 1 wiki</a> apply.
The only difference is that the <code>turbine.instanceUrlSuffix</code> does not need the port prepended, as this is handled automatically unless <code>turbine.instanceInsertPort=false</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, Turbine looks for the <code>/hystrix.stream</code> endpoint on a registered instance by looking up its <code>hostName</code> and <code>port</code> entries in Eureka and then appending <code>/hystrix.stream</code> to it.
If the instance’s metadata contains <code>management.port</code>, it is used instead of the <code>port</code> value for the <code>/hystrix.stream</code> endpoint.
By default, the metadata entry called <code>management.port</code> is equal to the <code>management.port</code> configuration property.
It can be overridden though with following configuration:
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre>eureka:
  instance:
    metadata-map:
      management.port: ${management.port:8081}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>turbine.appConfig</code> configuration key is a list of Eureka serviceIds that turbine uses to lookup instances.
The turbine stream is then used in the Hystrix dashboard with a URL similar to the following:</p>
</div>
<div class="paragraph">
<p><code><a href="https://my.turbine.server:8080/turbine.stream?cluster=CLUSTERNAME" class="bare">my.turbine.server:8080/turbine.stream?cluster=CLUSTERNAME</a></code></p>
</div>
<div class="paragraph">
<p>The cluster parameter can be omitted if the name is <code>default</code>.
The <code>cluster</code> parameter must match an entry in <code>turbine.aggregator.clusterConfig</code>.
Values returned from Eureka are upper-case. Consequently, the following example works if there is an application called <code>customers</code> registered with Eureka:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>turbine:
  aggregator:
    clusterConfig: CUSTOMERS
  appConfig: customers</pre>
</div>
</div>
<div class="paragraph">
<p>If you need to customize which cluster names should be used by Turbine (because you do not want to store cluster names in
<code>turbine.aggregator.clusterConfig</code> configuration), provide a bean of type <code>TurbineClustersProvider</code>.</p>
</div>
<div class="paragraph">
<p>The <code>clusterName</code> can be customized by a SPEL expression in <code>turbine.clusterNameExpression</code> with root as an instance of <code>InstanceInfo</code>.
The default value is <code>appName</code>, which means that the Eureka <code>serviceId</code> becomes the cluster key (that is, the <code>InstanceInfo</code> for customers has an <code>appName</code> of <code>CUSTOMERS</code>).
A different example is <code>turbine.clusterNameExpression=aSGName</code>, which gets the cluster name from the AWS ASG name.
The following listing shows another example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>turbine:
  aggregator:
    clusterConfig: SYSTEM,USER
  appConfig: customers,stores,ui,admin
  clusterNameExpression: metadata['cluster']</pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the cluster name from four services is pulled from their metadata map and is expected to have values that include <code>SYSTEM</code> and <code>USER</code>.</p>
</div>
<div class="paragraph">
<p>To use the “default” cluster for all apps, you need a string literal expression (with single quotes and escaped with double quotes if it is in YAML as well):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>turbine:
  appConfig: customers,stores
  clusterNameExpression: "'default'"</pre>
</div>
</div>
<div class="paragraph">
<p>Spring Cloud provides a <code>spring-cloud-starter-netflix-turbine</code> that has all the dependencies you need to get a Turbine server running. To add Turbine, create a Spring Boot application and annotate it with <code>@EnableTurbine</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, Spring Cloud lets Turbine use the host and port to allow multiple processes per host, per cluster.
If you want the native Netflix behavior built into Turbine to <em>not</em> allow multiple processes per host, per cluster (the key to the instance ID is the hostname), set <code>turbine.combineHostPort=false</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="clusters-endpoint"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#clusters-endpoint"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#clusters-endpoint">135.2.1. Clusters Endpoint</a></h4>
<div class="paragraph">
<p>In some situations it might be useful for other applications to know what custers have been configured
in Turbine. To support this you can use the <code>/clusters</code> endpoint which will return a JSON array of
all the configured clusters.</p>
</div>
<div class="listingblock">
<div class="title">GET /clusters</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"RACES"</span>,
    <span class="hljs-attr">"link"</span>: <span class="hljs-string">"http://localhost:8383/turbine.stream?cluster=RACES"</span>
  },
  {
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"WEB"</span>,
    <span class="hljs-attr">"link"</span>: <span class="hljs-string">"http://localhost:8383/turbine.stream?cluster=WEB"</span>
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This endpoint can be disabled by setting <code>turbine.endpoints.clusters.enabled</code> to <code>false</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="turbine-stream"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#turbine-stream"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#turbine-stream">135.3. Turbine Stream</a></h3>
<div class="paragraph">
<p>In some environments (such as in a PaaS setting), the classic Turbine model of pulling metrics from all the distributed Hystrix commands does not work.
In that case, you might want to have your Hystrix commands push metrics to Turbine. Spring Cloud enables that with messaging.
To do so on the client, add a dependency to <code>spring-cloud-netflix-hystrix-stream</code> and the <code>spring-cloud-starter-stream-*</code> of your choice.
See the <a href="https://docs.spring.io/spring-cloud-stream/docs/current/reference/htmlsingle/">Spring Cloud Stream documentation</a> for details on the brokers and how to configure the client credentials. It should work out of the box for a local broker.</p>
</div>
<div class="paragraph">
<p>On the server side, create a Spring Boot application and annotate it with <code>@EnableTurbineStream</code>.
The Turbine Stream server requires the use of Spring Webflux, therefore <code>spring-boot-starter-webflux</code> needs to be included in your project.
By default <code>spring-boot-starter-webflux</code> is included when adding <code>spring-cloud-starter-netflix-turbine-stream</code> to your application.</p>
</div>
<div class="paragraph">
<p>You can then point the Hystrix Dashboard to the Turbine Stream Server instead of individual Hystrix streams.
If Turbine Stream is running on port 8989 on myhost, then put <code><a href="https://myhost:8989/" class="bare">myhost:8989</a></code> in the stream input field in the Hystrix Dashboard.
Circuits are prefixed by their respective <code>serviceId</code>, followed by a dot (<code>.</code>), and then the circuit name.</p>
</div>
<div class="paragraph">
<p>Spring Cloud provides a <code>spring-cloud-starter-netflix-turbine-stream</code> that has all the dependencies you need to get a Turbine Stream server running.
You can then add the Stream binder of your choice — such as <code>spring-cloud-starter-stream-rabbit</code>.</p>
</div>
<div class="paragraph">
<p>Turbine Stream server also supports the <code>cluster</code> parameter.
Unlike Turbine server, Turbine Stream uses eureka serviceIds as cluster names and these are not configurable.</p>
</div>
<div class="paragraph">
<p>If Turbine Stream server is running on port 8989 on <code>my.turbine.server</code> and you have two eureka serviceIds <code>customers</code> and <code>products</code> in your environment, the following URLs will be available on your Turbine Stream server. <code>default</code> and empty cluster name will provide all metrics that Turbine Stream server receives.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>https://my.turbine.sever:8989/turbine.stream?cluster=customers
https://my.turbine.sever:8989/turbine.stream?cluster=products
https://my.turbine.sever:8989/turbine.stream?cluster=default
https://my.turbine.sever:8989/turbine.stream</pre>
</div>
</div>
<div class="paragraph">
<p>So, you can use eureka serviceIds as cluster names for your Turbine dashboard (or any compatible dashboard).
You don’t need to configure any properties like <code>turbine.appConfig</code>, <code>turbine.clusterNameExpression</code> and <code>turbine.aggregator.clusterConfig</code> for your Turbine Stream server.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Turbine Stream server gathers all metrics from the configured input channel with Spring Cloud Stream. It means that it doesn’t gather Hystrix metrics actively from each instance. It just can provide metrics that were already gathered into the input channel by each instance.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-ribbon"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-ribbon"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-ribbon">136. Client Side Load Balancer: Ribbon</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ribbon is a client-side load balancer that gives you a lot of control over the behavior of HTTP and TCP clients.
Feign already uses Ribbon, so, if you use <code>@FeignClient</code>, this section also applies.</p>
</div>
<div class="paragraph">
<p>A central concept in Ribbon is that of the named client.
Each load balancer is part of an ensemble of components that work together to contact a remote server on demand, and the ensemble has a name that you give it as an application developer (for example, by using the <code>@FeignClient</code> annotation).
On demand, Spring Cloud creates a new ensemble as an <code>ApplicationContext</code> for each named client by using
<code>RibbonClientConfiguration</code>.
This contains (amongst other things) an <code>ILoadBalancer</code>, a <code>RestClient</code>, and a <code>ServerListFilter</code>.</p>
</div>
<div class="sect2">
<h3 id="netflix-ribbon-starter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-ribbon-starter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-ribbon-starter">136.1. How to Include Ribbon</a></h3>
<div class="paragraph">
<p>To include Ribbon in your project, use the starter with a group ID of <code>org.springframework.cloud</code> and an artifact ID of <code>spring-cloud-starter-netflix-ribbon</code>.
See the <a href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a> for details on setting up your build system with the current Spring Cloud Release Train.</p>
</div>
</div>
<div class="sect2">
<h3 id="customizing-the-ribbon-client"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-the-ribbon-client"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-the-ribbon-client">136.2. Customizing the Ribbon Client</a></h3>
<div class="paragraph">
<p>You can configure some bits of a Ribbon client by using external properties in <code>&lt;client&gt;.ribbon.*</code>, which is similar to using the Netflix APIs natively, except that you can use Spring Boot configuration files.
The native options can be inspected as static fields in <a href="https://github.com/Netflix/ribbon/blob/master/ribbon-core/src/main/java/com/netflix/client/config/CommonClientConfigKey.java"><code>CommonClientConfigKey</code></a> (part of ribbon-core).</p>
</div>
<div class="paragraph">
<p>Spring Cloud also lets you take full control of the client by declaring additional configuration (on top of the <code>RibbonClientConfiguration</code>) using <code>@RibbonClient</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@RibbonClient</span>(name = <span class="hljs-string">"custom"</span>, configuration = CustomConfiguration.class)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestConfiguration</span> </span>{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the client is composed from the components already in <code>RibbonClientConfiguration</code>, together with any in <code>CustomConfiguration</code> (where the latter generally overrides the former).</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The <code>CustomConfiguration</code> class must be a <code>@Configuration</code> class, but take care that it is not in a <code>@ComponentScan</code> for the main application context.
Otherwise, it is shared by all the <code>@RibbonClients</code>. If you use <code>@ComponentScan</code> (or <code>@SpringBootApplication</code>), you need to take steps to avoid it being included (for instance, you can put it in a separate, non-overlapping package or specify the packages to scan explicitly in the <code>@ComponentScan</code>).
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following table shows the beans that Spring Cloud Netflix provides by default for Ribbon:</p>
</div>
<table class="tableblock frame-topbot grid-all" style="width: 60%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bean Type</th>
<th class="tableblock halign-center valign-top">Bean Name</th>
<th class="tableblock halign-center valign-top">Class Name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IClientConfig</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ribbonClientConfig</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DefaultClientConfigImpl</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IRule</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ribbonRule</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ZoneAvoidanceRule</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IPing</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ribbonPing</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DummyPing</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServerList&lt;Server&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ribbonServerList</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ConfigurationBasedServerList</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServerListFilter&lt;Server&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ribbonServerListFilter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ZonePreferenceServerListFilter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ILoadBalancer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ribbonLoadBalancer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ZoneAwareLoadBalancer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServerListUpdater</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ribbonServerListUpdater</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PollingServerListUpdater</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Creating a bean of one of those type and placing it in a <code>@RibbonClient</code> configuration (such as <code>FooConfiguration</code> above) lets you override each one of the beans described, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>(proxyBeanMethods = <span class="hljs-keyword">false</span>)
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooConfiguration</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ZonePreferenceServerListFilter <span class="hljs-title">serverListFilter</span><span class="hljs-params">()</span> </span>{
        ZonePreferenceServerListFilter filter = <span class="hljs-keyword">new</span> ZonePreferenceServerListFilter();
        filter.setZone(<span class="hljs-string">"myTestZone"</span>);
        <span class="hljs-keyword">return</span> filter;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IPing <span class="hljs-title">ribbonPing</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PingUrl();
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The include statement in the preceding example replaces <code>NoOpPing</code> with <code>PingUrl</code> and provides a custom <code>serverListFilter</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="customizing-the-default-for-all-ribbon-clients"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-the-default-for-all-ribbon-clients"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-the-default-for-all-ribbon-clients">136.3. Customizing the Default for All Ribbon Clients</a></h3>
<div class="paragraph">
<p>A default configuration can be provided for all Ribbon Clients by using the <code>@RibbonClients</code> annotation and registering a default configuration, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@RibbonClients</span>(defaultConfiguration = DefaultRibbonConfig.class)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RibbonClientDefaultConfigurationTestsConfig</span> </span>{

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BazServiceList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConfigurationBasedServerList</span> </span>{

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BazServiceList</span><span class="hljs-params">(IClientConfig config)</span> </span>{
            <span class="hljs-keyword">super</span>.initWithNiwsConfig(config);
        }

    }

}

<span class="hljs-meta">@Configuration</span>(proxyBeanMethods = <span class="hljs-keyword">false</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DefaultRibbonConfig</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IRule <span class="hljs-title">ribbonRule</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BestAvailableRule();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IPing <span class="hljs-title">ribbonPing</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PingUrl();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ServerList&lt;Server&gt; <span class="hljs-title">ribbonServerList</span><span class="hljs-params">(IClientConfig config)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RibbonClientDefaultConfigurationTestsConfig.BazServiceList(config);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ServerListSubsetFilter <span class="hljs-title">serverListFilter</span><span class="hljs-params">()</span> </span>{
        ServerListSubsetFilter filter = <span class="hljs-keyword">new</span> ServerListSubsetFilter();
        <span class="hljs-keyword">return</span> filter;
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="customizing-the-ribbon-client-by-setting-properties"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-the-ribbon-client-by-setting-properties"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-the-ribbon-client-by-setting-properties">136.4. Customizing the Ribbon Client by Setting Properties</a></h3>
<div class="paragraph">
<p>Starting with version 1.2.0, Spring Cloud Netflix now supports customizing Ribbon clients by setting properties to be compatible with the <a href="https://github.com/Netflix/ribbon/wiki/Working-with-load-balancers#components-of-load-balancer">Ribbon documentation</a>.</p>
</div>
<div class="paragraph">
<p>This lets you change behavior at start up time in different environments.</p>
</div>
<div class="paragraph">
<p>The following list shows the supported properties&gt;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;clientName&gt;.ribbon.NFLoadBalancerClassName</code>: Should implement <code>ILoadBalancer</code></p>
</li>
<li>
<p><code>&lt;clientName&gt;.ribbon.NFLoadBalancerRuleClassName</code>: Should implement <code>IRule</code></p>
</li>
<li>
<p><code>&lt;clientName&gt;.ribbon.NFLoadBalancerPingClassName</code>: Should implement <code>IPing</code></p>
</li>
<li>
<p><code>&lt;clientName&gt;.ribbon.NIWSServerListClassName</code>: Should implement <code>ServerList</code></p>
</li>
<li>
<p><code>&lt;clientName&gt;.ribbon.NIWSServerListFilterClassName</code>: Should implement <code>ServerListFilter</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Classes defined in these properties have precedence over beans defined by using <code>@RibbonClient(configuration=MyRibbonConfig.class)</code> and the defaults provided by Spring Cloud Netflix.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To set the <code>IRule</code> for a service name called <code>users</code>, you could set the following properties:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>users:
  ribbon:
    NIWSServerListClassName: com.netflix.loadbalancer.ConfigurationBasedServerList
    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.WeightedResponseTimeRule</pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://github.com/Netflix/ribbon/wiki/Working-with-load-balancers">Ribbon documentation</a> for implementations provided by Ribbon.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-ribbon-with-eureka"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-ribbon-with-eureka"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-ribbon-with-eureka">136.5. Using Ribbon with Eureka</a></h3>
<div class="paragraph">
<p>When Eureka is used in conjunction with Ribbon (that is, both are on the classpath), the <code>ribbonServerList</code> is overridden with an extension of <code>DiscoveryEnabledNIWSServerList</code>, which populates the list of servers from Eureka.
It also replaces the <code>IPing</code> interface with <code>NIWSDiscoveryPing</code>, which delegates to Eureka to determine if a server is up.
The <code>ServerList</code> that is installed by default is a <code>DomainExtractingServerList</code>. Its purpose is to make metadata available to the load balancer without using AWS AMI metadata (which is what Netflix relies on).
By default, the server list is constructed with “zone” information, as provided in the instance metadata (so, on the remote clients, set <code>eureka.instance.metadataMap.zone</code>).
If that is missing and if the <code>approximateZoneFromHostname</code> flag is set, it can use the domain name from the server hostname as a proxy for the zone.
Once the zone information is available, it can be used in a <code>ServerListFilter</code>.
By default, it is used to locate a server in the same zone as the client, because the default is a <code>ZonePreferenceServerListFilter</code>.
By default, the zone of the client is determined in the same way as the remote instances (that is, through <code>eureka.instance.metadataMap.zone</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The orthodox “archaius” way to set the client zone is through a configuration property called "@zone".
If it is available, Spring Cloud uses that in preference to all other settings (note that the key must be quoted in YAML configuration).
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If there is no other source of zone data, then a guess is made, based on the client configuration (as opposed to the instance configuration).
We take <code>eureka.client.availabilityZones</code>, which is a map from region name to a list of zones, and pull out the first zone for the instance’s own region (that is, the <code>eureka.client.region</code>, which defaults to "us-east-1", for compatibility with native Netflix).
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-ribbon-without-eureka"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-ribbon-without-eureka"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-ribbon-without-eureka">136.6. Example: How to Use Ribbon Without Eureka</a></h3>
<div class="paragraph">
<p>Eureka is a convenient way to abstract the discovery of remote servers so that you do not have to hard code their URLs in clients.
However, if you prefer not to use Eureka, Ribbon and Feign also work.
Suppose you have declared a <code>@RibbonClient</code> for "stores", and Eureka is not in use (and not even on the classpath).
The Ribbon client defaults to a configured server list.
You can supply the configuration as follows:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>stores:
  ribbon:
    listOfServers: example.com,google.com</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="example-disable-eureka-use-in-ribbon"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#example-disable-eureka-use-in-ribbon"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#example-disable-eureka-use-in-ribbon">136.7. Example: Disable Eureka Use in Ribbon</a></h3>
<div class="paragraph">
<p>Setting the <code>ribbon.eureka.enabled</code> property to <code>false</code> explicitly disables the use of Eureka in Ribbon, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>ribbon:
  eureka:
   enabled: false</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-ribbon-api-directly"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-the-ribbon-api-directly"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-the-ribbon-api-directly">136.8. Using the Ribbon API Directly</a></h3>
<div class="paragraph">
<p>You can also use the <code>LoadBalancerClient</code> directly, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LoadBalancerClient loadBalancer;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doStuff</span><span class="hljs-params">()</span> </span>{
        ServiceInstance instance = loadBalancer.choose(<span class="hljs-string">"stores"</span>);
        URI storesUri = URI.create(String.format(<span class="hljs-string">"https://%s:%s"</span>, instance.getHost(), instance.getPort()));
        <span class="hljs-comment">// ... do something with the URI</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ribbon-child-context-eager-load"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ribbon-child-context-eager-load"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ribbon-child-context-eager-load">136.9. Caching of Ribbon Configuration</a></h3>
<div class="paragraph">
<p>Each Ribbon named client has a corresponding child application Context that Spring Cloud maintains.
This application context is lazily loaded on the first request to the named client.
This lazy loading behavior can be changed to instead eagerly load these child application contexts at startup, by specifying the names of the Ribbon clients, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>ribbon:
  eager-load:
    enabled: true
    clients: client1, client2, client3</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="how-to-configure-hystrix-thread-pools"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-configure-hystrix-thread-pools"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-configure-hystrix-thread-pools">136.10. How to Configure Hystrix Thread Pools</a></h3>
<div class="paragraph">
<p>If you change <code>zuul.ribbonIsolationStrategy</code> to <code>THREAD</code>, the thread isolation strategy for Hystrix is used for all routes.
In that case, the <code>HystrixThreadPoolKey</code> is set to <code>RibbonCommand</code> as the default.
It means that HystrixCommands for all routes are executed in the same Hystrix thread pool.
This behavior can be changed with the following configuration:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>zuul:
  threadPool:
    useSeparateThreadPools: true</pre>
</div>
</div>
<div class="paragraph">
<p>The preceding example results in HystrixCommands being executed in the Hystrix thread pool for each route.</p>
</div>
<div class="paragraph">
<p>In this case, the default <code>HystrixThreadPoolKey</code> is the same as the service ID for each route.
To add a prefix to <code>HystrixThreadPoolKey</code>, set <code>zuul.threadPool.threadPoolKeyPrefix</code> to the value that you want to add, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>zuul:
  threadPool:
    useSeparateThreadPools: true
    threadPoolKeyPrefix: zuulgw</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="how-to-provdie-a-key-to-ribbon"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-provdie-a-key-to-ribbon"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-to-provdie-a-key-to-ribbon">136.11. How to Provide a Key to Ribbon’s <code>IRule</code></a></h3>
<div class="paragraph">
<p>If you need to provide your own <code>IRule</code> implementation to handle a special routing requirement like a “canary” test, pass some information to the <code>choose</code> method of <code>IRule</code>.</p>
</div>
<div class="listingblock">
<div class="title">com.netflix.loadbalancer.IRule.java</div>
<div class="content">
<pre>public interface IRule{
    public Server choose(Object key);
         :</pre>
</div>
</div>
<div class="paragraph">
<p>You can provide some information that is used by your <code>IRule</code> implementation to choose a target server, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>RequestContext.getCurrentContext()
              .set(FilterConstants.LOAD_BALANCER_KEY, "canary-test");</pre>
</div>
</div>
<div class="paragraph">
<p>If you put any object into the <code>RequestContext</code> with a key of <code>FilterConstants.LOAD_BALANCER_KEY</code>, it is passed to the <code>choose</code> method of the <code>IRule</code> implementation.
The code shown in the preceding example must be executed before <code>RibbonRoutingFilter</code> is executed.
Zuul’s pre filter is the best place to do that.
You can access HTTP headers and query parameters through the <code>RequestContext</code> in pre filter, so it can be used to determine the <code>LOAD_BALANCER_KEY</code> that is passed to Ribbon.
If you do not put any value with <code>LOAD_BALANCER_KEY</code> in <code>RequestContext</code>, null is passed as a parameter of the <code>choose</code> method.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="external-configuration-archaius"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#external-configuration-archaius"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#external-configuration-archaius">137. External Configuration: Archaius</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/Netflix/archaius">Archaius</a> is the Netflix client-side configuration library.
It is the library used by all of the Netflix OSS components for configuration.
Archaius is an extension of the <a href="https://commons.apache.org/proper/commons-configuration">Apache Commons Configuration</a> project.
It allows updates to configuration by either polling a source for changes or by letting a source push changes to the client.
Archaius uses Dynamic&lt;Type&gt;Property classes as handles to properties, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Archaius Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArchaiusTest</span> </span>{
    DynamicStringProperty myprop = DynamicPropertyFactory
            .getInstance()
            .getStringProperty(<span class="hljs-string">"my.prop"</span>);

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span> </span>{
        OtherClass.someMethod(myprop.get());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Archaius has its own set of configuration files and loading priorities.
Spring applications should generally not use Archaius directly, but the need to configure the Netflix tools natively remains.
Spring Cloud has a Spring Environment Bridge so that Archaius can read properties from the Spring Environment.
This bridge allows Spring Boot projects to use the normal configuration toolchain while letting them configure the Netflix tools as documented (for the most part).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="router-and-filter-zuul"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#router-and-filter-zuul"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#router-and-filter-zuul">138. Router and Filter: Zuul</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Routing is an integral part of a microservice architecture.
For example, <code>/</code> may be mapped to your web application, <code>/api/users</code> is mapped to the user service and <code>/api/shop</code> is mapped to the shop service.
<a href="https://github.com/Netflix/zuul">Zuul</a> is a JVM-based router and server-side load balancer from Netflix.</p>
</div>
<div class="paragraph">
<p><a href="https://www.slideshare.net/MikeyCohen1/edge-architecture-ieee-international-conference-on-cloud-engineering-32240146/27">Netflix uses Zuul</a> for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authentication</p>
</li>
<li>
<p>Insights</p>
</li>
<li>
<p>Stress Testing</p>
</li>
<li>
<p>Canary Testing</p>
</li>
<li>
<p>Dynamic Routing</p>
</li>
<li>
<p>Service Migration</p>
</li>
<li>
<p>Load Shedding</p>
</li>
<li>
<p>Security</p>
</li>
<li>
<p>Static Response handling</p>
</li>
<li>
<p>Active/Active traffic management</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Zuul’s rule engine lets rules and filters be written in essentially any JVM language, with built-in support for Java and Groovy.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The configuration property <code>zuul.max.host.connections</code> has been replaced by two new properties, <code>zuul.host.maxTotalConnections</code> and <code>zuul.host.maxPerRouteConnections</code>, which default to 200 and 20 respectively.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default Hystrix isolation pattern (<code>ExecutionIsolationStrategy</code>) for all routes is <code>SEMAPHORE</code>.
<code>zuul.ribbonIsolationStrategy</code> can be changed to <code>THREAD</code> if that isolation pattern is preferred.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="netflix-zuul-starter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-zuul-starter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-zuul-starter">138.1. How to Include Zuul</a></h3>
<div class="paragraph">
<p>To include Zuul in your project, use the starter with a group ID of <code>org.springframework.cloud</code> and a artifact ID of <code>spring-cloud-starter-netflix-zuul</code>.
See the <a href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a> for details on setting up your build system with the current Spring Cloud Release Train.</p>
</div>
</div>
<div class="sect2">
<h3 id="netflix-zuul-reverse-proxy"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-zuul-reverse-proxy"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-zuul-reverse-proxy">138.2. Embedded Zuul Reverse Proxy</a></h3>
<div class="paragraph">
<p>Spring Cloud has created an embedded Zuul proxy to ease the development of a common use case where a UI application wants to make proxy calls to one or more back end services.
This feature is useful for a user interface to proxy to the back end services it requires, avoiding the need to manage CORS and authentication concerns independently for all the back ends.</p>
</div>
<div class="paragraph">
<p>To enable it, annotate a Spring Boot main class with <code>@EnableZuulProxy</code>. Doing so causes local calls to be forwarded to the appropriate service.
By convention, a service with an ID of <code>users</code> receives requests from the proxy located at <code>/users</code> (with the prefix stripped).
The proxy uses Ribbon to locate an instance to which to forward through discovery.
All requests are executed in a <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix-fallbacks-for-routes">hystrix command</a>, so failures appear in Hystrix metrics.
Once the circuit is open, the proxy does not try to contact the service.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the Zuul starter does not include a discovery client, so, for routes based on service IDs, you need to provide one of those on the classpath as well (Eureka is one choice).
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To skip having a service automatically added, set <code>zuul.ignored-services</code> to a list of service ID patterns.
If a service matches a pattern that is ignored but is also included in the explicitly configured routes map, it is unignored, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> zuul:
  ignoredServices: '*'
  routes:
    users: /myusers/**</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, all services are ignored, <strong>except</strong> for <code>users</code>.</p>
</div>
<div class="paragraph">
<p>To augment or change the proxy routes, you can add external configuration, as follows:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> zuul:
  routes:
    users: /myusers/**</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding example means that HTTP calls to <code>/myusers</code> get forwarded to the <code>users</code> service (for example <code>/myusers/101</code> is forwarded to <code>/101</code>).</p>
</div>
<div class="paragraph">
<p>To get more fine-grained control over a route, you can specify the path and the serviceId independently, as follows:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> zuul:
  routes:
    users:
      path: /myusers/**
      serviceId: users_service</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding example means that HTTP calls to <code>/myusers</code> get forwarded to the <code>users_service</code> service.
The route must have a <code>path</code> that can be specified as an ant-style pattern, so <code>/myusers/*</code> only matches one level, but <code>/myusers/**</code> matches hierarchically.</p>
</div>
<div class="paragraph">
<p>The location of the back end can be specified as either a <code>serviceId</code> (for a service from discovery) or a <code>url</code> (for a physical location), as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> zuul:
  routes:
    users:
      path: /myusers/**
      url: https://example.com/users_service</code></pre>
</div>
</div>
<div class="paragraph">
<p>These simple url-routes do not get executed as a <code>HystrixCommand</code>, nor do they load-balance multiple URLs with Ribbon.
To achieve those goals, you can specify a <code>serviceId</code> with a static list of servers, as follows:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">zuul:
  routes:
    echo:
      path: /myusers/**
      serviceId: myusers-service
      stripPrefix: true

hystrix:
  command:
    myusers-service:
      execution:
        isolation:
          thread:
            timeoutInMilliseconds: ...

myusers-service:
  ribbon:
    NIWSServerListClassName: com.netflix.loadbalancer.ConfigurationBasedServerList
    listOfServers: https://example1.com,http://example2.com
    ConnectTimeout: 1000
    ReadTimeout: 3000
    MaxTotalHttpConnections: 500
    MaxConnectionsPerHost: 100</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another method is specifiying a service-route and configuring a Ribbon client for the <code>serviceId</code> (doing so requires disabling Eureka support in Ribbon — see <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-ribbon-without-eureka">above for more information</a>), as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">zuul:
  routes:
    users:
      path: /myusers/**
      serviceId: users

ribbon:
  eureka:
    enabled: false

users:
  ribbon:
    listOfServers: example.com,google.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can provide a convention between <code>serviceId</code> and routes by using <code>regexmapper</code>.
It uses regular-expression named groups to extract variables from <code>serviceId</code> and inject them into a route pattern, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">ApplicationConfiguration.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> PatternServiceRouteMapper <span class="hljs-title">serviceRouteMapper</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PatternServiceRouteMapper(
        <span class="hljs-string">"(?&lt;name&gt;^.+)-(?&lt;version&gt;v.+$)"</span>,
        <span class="hljs-string">"${version}/${name}"</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding example means that a <code>serviceId</code> of <code>myusers-v1</code> is mapped to route <code>/v1/myusers/**</code>.
Any regular expression is accepted, but all named groups must be present in both <code>servicePattern</code> and <code>routePattern</code>.
If <code>servicePattern</code> does not match a <code>serviceId</code>, the default behavior is used.
In the preceding example, a <code>serviceId</code> of <code>myusers</code> is mapped to the "/myusers/**" route (with no version detected).
This feature is disabled by default and only applies to discovered services.</p>
</div>
<div class="paragraph">
<p>To add a prefix to all mappings, set <code>zuul.prefix</code> to a value, such as <code>/api</code>.
By default, the proxy prefix is stripped from the request before the request is forwarded by (you can switch this behavior off with <code>zuul.stripPrefix=false</code>).
You can also switch off the stripping of the service-specific prefix from individual routes, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> zuul:
  routes:
    users:
      path: /myusers/**
      stripPrefix: false</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>zuul.stripPrefix</code> only applies to the prefix set in <code>zuul.prefix</code>.
It does not have any effect on prefixes defined within a given route’s <code>path</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In the preceding example, requests to <code>/myusers/101</code> are forwarded to <code>/myusers/101</code> on the <code>users</code> service.</p>
</div>
<div class="paragraph">
<p>The <code>zuul.routes</code> entries actually bind to an object of type <code>ZuulProperties</code>.
If you look at the properties of that object, you can see that it also has a <code>retryable</code> flag.
Set that flag to <code>true</code> to have the Ribbon client automatically retry failed requests.
You can also set that flag to <code>true</code> when you need to modify the parameters of the retry operations that use the Ribbon client configuration.</p>
</div>
<div class="paragraph">
<p>By default, the <code>X-Forwarded-Host</code> header is added to the forwarded requests.
To turn it off, set <code>zuul.addProxyHeaders = false</code>.
By default, the prefix path is stripped, and the request to the back end picks up a <code>X-Forwarded-Prefix</code> header (<code>/myusers</code> in the examples shown earlier).</p>
</div>
<div class="paragraph">
<p>If you set a default route (<code>/</code>), an application with <code>@EnableZuulProxy</code> could act as a standalone server. For example, <code>zuul.route.home: /</code> would route all traffic ("/**") to the "home" service.</p>
</div>
<div class="paragraph">
<p>If more fine-grained ignoring is needed, you can specify specific patterns to ignore.
These patterns are evaluated at the start of the route location process, which means prefixes should be included in the pattern to warrant a match.
Ignored patterns span all services and supersede any other route specification.
The following example shows how to create ignored patterns:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> zuul:
  ignoredPatterns: /**/admin/**
  routes:
    users: /myusers/**</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding example means that all calls (such as <code>/myusers/101</code>) are forwarded to <code>/101</code> on the <code>users</code> service.
However, calls including <code>/admin/</code> do not resolve.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you need your routes to have their order preserved, you need to use a YAML file, as the ordering is lost when using a properties file.
The following example shows such a YAML file:
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> zuul:
  routes:
    users:
      path: /myusers/**
    legacy:
      path: /**</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you were to use a properties file, the <code>legacy</code> path might end up in front of the <code>users</code>
path, rendering the <code>users</code> path unreachable.</p>
</div>
</div>
<div class="sect2">
<h3 id="zuul-http-client"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-http-client"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-http-client">138.3. Zuul Http Client</a></h3>
<div class="paragraph">
<p>The default HTTP client used by Zuul is now backed by the Apache HTTP Client instead of the deprecated Ribbon <code>RestClient</code>.
To use <code>RestClient</code> or <code>okhttp3.OkHttpClient</code>, set <code>ribbon.restclient.enabled=true</code> or <code>ribbon.okhttp.enabled=true</code>, respectively.
If you would like to customize the Apache HTTP client or the OK HTTP client, provide a bean of type <code>CloseableHttpClient</code> or <code>OkHttpClient</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="cookies-and-sensitive-headers"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cookies-and-sensitive-headers"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#cookies-and-sensitive-headers">138.4. Cookies and Sensitive Headers</a></h3>
<div class="paragraph">
<p>You can share headers between services in the same system, but you probably do not want sensitive headers leaking downstream into external servers.
You can specify a list of ignored headers as part of the route configuration.
Cookies play a special role, because they have well defined semantics in browsers, and they are always to be treated as sensitive.
If the consumer of your proxy is a browser, then cookies for downstream services also cause problems for the user, because they all get jumbled up together (all downstream services look like they come from the same place).</p>
</div>
<div class="paragraph">
<p>If you are careful with the design of your services, (for example, if only one of the downstream services sets cookies), you might be able to let them flow from the back end all the way up to the caller.
Also, if your proxy sets cookies and all your back-end services are part of the same system, it can be natural to simply share them (and, for instance, use Spring Session to link them up to some shared state).
Other than that, any cookies that get set by downstream services are likely to be not useful to the caller, so it is recommended that you make (at least) <code>Set-Cookie</code> and <code>Cookie</code> into sensitive headers for routes that are not part of your domain.
Even for routes that are part of your domain, try to think carefully about what it means before letting cookies flow between them and the proxy.</p>
</div>
<div class="paragraph">
<p>The sensitive headers can be configured as a comma-separated list per route, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> zuul:
  routes:
    users:
      path: /myusers/**
      sensitiveHeaders: Cookie,Set-Cookie,Authorization
      url: https://downstream</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is the default value for <code>sensitiveHeaders</code>, so you need not set it unless you want it to be different.
This is new in Spring Cloud Netflix 1.1 (in 1.0, the user had no control over headers, and all cookies flowed in both directions).
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>sensitiveHeaders</code> are a blacklist, and the default is not empty.
Consequently, to make Zuul send all headers (except the <code>ignored</code> ones), you must explicitly set it to the empty list.
Doing so is necessary if you want to pass cookie or authorization headers to your back end. The following example shows how to use <code>sensitiveHeaders</code>:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> zuul:
  routes:
    users:
      path: /myusers/**
      sensitiveHeaders:
      url: https://downstream</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also set sensitive headers, by setting <code>zuul.sensitiveHeaders</code>.
If <code>sensitiveHeaders</code> is set on a route, it overrides the global <code>sensitiveHeaders</code> setting.</p>
</div>
</div>
<div class="sect2">
<h3 id="ignored-headers"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ignored-headers"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ignored-headers">138.5. Ignored Headers</a></h3>
<div class="paragraph">
<p>In addition to the route-sensitive headers, you can set a global value called <code>zuul.ignoredHeaders</code> for values (both request and response) that should be discarded during interactions with downstream services.
By default, if Spring Security is not on the classpath, these are empty.
Otherwise, they are initialized to a set of well known “security” headers (for example, involving caching) as specified by Spring Security.
The assumption in this case is that the downstream services might add these headers, too, but we want the values from the proxy.
To not discard these well known security headers when Spring Security is on the classpath, you can set <code>zuul.ignoreSecurityHeaders</code> to <code>false</code>.
Doing so can be useful if you disabled the HTTP Security response headers in Spring Security and want the values provided by downstream services.</p>
</div>
</div>
<div class="sect2">
<h3 id="management-endpoints"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#management-endpoints"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#management-endpoints">138.6. Management Endpoints</a></h3>
<div class="paragraph">
<p>By default, if you use <code>@EnableZuulProxy</code> with the Spring Boot Actuator, you enable two additional endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Routes</p>
</li>
<li>
<p>Filters</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="routes-endpoint"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#routes-endpoint"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#routes-endpoint">138.6.1. Routes Endpoint</a></h4>
<div class="paragraph">
<p>A GET to the routes endpoint at <code>/routes</code> returns a list of the mapped routes:</p>
</div>
<div class="listingblock">
<div class="title">GET /routes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  /stores/**: <span class="hljs-string">"http://localhost:8081"</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additional route details can be requested by adding the <code>?format=details</code> query string to <code>/routes</code>.
Doing so produces the following output:</p>
</div>
<div class="listingblock">
<div class="title">GET /routes/details</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  <span class="hljs-attr">"/stores/**"</span>: {
    <span class="hljs-attr">"id"</span>: <span class="hljs-string">"stores"</span>,
    <span class="hljs-attr">"fullPath"</span>: <span class="hljs-string">"/stores/**"</span>,
    <span class="hljs-attr">"location"</span>: <span class="hljs-string">"http://localhost:8081"</span>,
    <span class="hljs-attr">"path"</span>: <span class="hljs-string">"/**"</span>,
    <span class="hljs-attr">"prefix"</span>: <span class="hljs-string">"/stores"</span>,
    <span class="hljs-attr">"retryable"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"customSensitiveHeaders"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"prefixStripped"</span>: <span class="hljs-literal">true</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>POST</code> to <code>/routes</code> forces a refresh of the existing routes (for example, when there have been changes in the service catalog).
You can disable this endpoint by setting <code>endpoints.routes.enabled</code> to <code>false</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the routes should respond automatically to changes in the service catalog, but the <code>POST</code> to <code>/routes</code> is a way to force the change
to happen immediately.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="filters-endpoint"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#filters-endpoint"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#filters-endpoint">138.6.2. Filters Endpoint</a></h4>
<div class="paragraph">
<p>A <code>GET</code> to the filters endpoint at <code>/filters</code> returns a map of Zuul filters by type.
For each filter type in the map, you get a list of all the filters of that type, along with their details.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="strangulation-patterns-and-local-forwards"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#strangulation-patterns-and-local-forwards"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#strangulation-patterns-and-local-forwards">138.7. Strangulation Patterns and Local Forwards</a></h3>
<div class="paragraph">
<p>A common pattern when migrating an existing application or API is to “strangle” old endpoints, slowly replacing them with different implementations.
The Zuul proxy is a useful tool for this because you can use it to handle all traffic from the clients of the old endpoints but redirect some of the requests to new ones.</p>
</div>
<div class="paragraph">
<p>The following example shows the configuration details for a “strangle” scenario:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> zuul:
  routes:
    first:
      path: /first/**
      url: https://first.example.com
    second:
      path: /second/**
      url: forward:/second
    third:
      path: /third/**
      url: forward:/3rd
    legacy:
      path: /**
      url: https://legacy.example.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, we are strangle the “legacy” application, which is mapped to all requests that do not match one of the other patterns.
Paths in <code>/first/**</code> have been extracted into a new service with an external URL.
Paths in <code>/second/**</code> are forwarded so that they can be handled locally (for example, with a normal Spring <code>@RequestMapping</code>).
Paths in <code>/third/**</code> are also forwarded but with a different prefix (<code>/third/foo</code> is forwarded to <code>/3rd/foo</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The ignored patterns aren’t completely ignored, they just are not handled by the proxy (so they are also effectively forwarded locally).
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="uploading-files-through-zuul"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#uploading-files-through-zuul"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#uploading-files-through-zuul">138.8. Uploading Files through Zuul</a></h3>
<div class="paragraph">
<p>If you use <code>@EnableZuulProxy</code>, you can use the proxy paths to upload files and it should work, so long as the files are small.
For large files there is an alternative path that bypasses the Spring <code>DispatcherServlet</code> (to avoid multipart processing) in "/zuul/*".
In other words, if you have <code>zuul.routes.customers=/customers/**</code>, then you can <code>POST</code> large files to <code>/zuul/customers/*</code>.
The servlet path is externalized via <code>zuul.servletPath</code>.
If the proxy route takes you through a Ribbon load balancer, extremely large files also require elevated timeout settings, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds: 60000
ribbon:
  ConnectTimeout: 3000
  ReadTimeout: 60000</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that, for streaming to work with large files, you need to use chunked encoding in the request (which some browsers do not do by default), as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -v -H <span class="hljs-string">"Transfer-Encoding: chunked"</span> \
    -F <span class="hljs-string">"file=@mylarge.iso"</span> localhost:9999/zuul/simple/file</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="query-string-encoding"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-string-encoding"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#query-string-encoding">138.9. Query String Encoding</a></h3>
<div class="paragraph">
<p>When processing the incoming request, query params are decoded so that they can be available for possible modifications in Zuul filters.
They are then re-encoded the back end request is rebuilt in the route filters.
The result can be different than the original input if (for example) it was encoded with Javascript’s <code>encodeURIComponent()</code> method.
While this causes no issues in most cases, some web servers can be picky with the encoding of complex query string.</p>
</div>
<div class="paragraph">
<p>To force the original encoding of the query string, it is possible to pass a special flag to <code>ZuulProperties</code> so that the query string is taken as is with the <code>HttpServletRequest::getQueryString</code> method, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> zuul:
  forceOriginalQueryStringEncoding: true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This special flag works only with <code>SimpleHostRoutingFilter</code>. Also, you loose the ability to easily override
query parameters with <code>RequestContext.getCurrentContext().setRequestQueryParams(someOverriddenParameters)</code>, because
the query string is now fetched directly on the original <code>HttpServletRequest</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="request-uri-encoding"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#request-uri-encoding"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#request-uri-encoding">138.10. Request URI Encoding</a></h3>
<div class="paragraph">
<p>When processing the incoming request, request URI is decoded before matching them to routes.
The request URI is then re-encoded when the back end request is rebuilt in the route filters.
This can cause some unexpected behavior if your URI includes the encoded "/" character.</p>
</div>
<div class="paragraph">
<p>To use the original request URI, it is possible to pass a special flag to 'ZuulProperties' so that the URI will be taken as is with the <code>HttpServletRequest::getRequestURI</code> method, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> zuul:
  decodeUrl: false</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are overriding request URI using <code>requestURI</code> RequestContext attribute and this flag is set to false, then the URL set in the request context will not be encoded. It will be your responsibility to make sure the URL is already encoded.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="plain-embedded-zuul"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#plain-embedded-zuul"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#plain-embedded-zuul">138.11. Plain Embedded Zuul</a></h3>
<div class="paragraph">
<p>If you use <code>@EnableZuulServer</code> (instead of <code>@EnableZuulProxy</code>), you can also run a Zuul server without proxying or selectively switch on parts of the proxying platform.
Any beans that you add to the application of type <code>ZuulFilter</code> are installed automatically (as they are with <code>@EnableZuulProxy</code>) but without any of the proxy filters being added automatically.</p>
</div>
<div class="paragraph">
<p>In that case, the routes into the Zuul server are still specified by configuring "zuul.routes.*", but there is no service discovery and no proxying. Consequently, the "serviceId" and "url" settings are ignored.
The following example maps all paths in "/api/**" to the Zuul filter chain:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> zuul:
  routes:
    api: /api/**</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="disable-zuul-filters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#disable-zuul-filters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#disable-zuul-filters">138.12. Disable Zuul Filters</a></h3>
<div class="paragraph">
<p>Zuul for Spring Cloud comes with a number of <code>ZuulFilter</code> beans enabled by default in both proxy and server mode.
See <a href="https://github.com/spring-cloud/spring-cloud-netflix/tree/master/spring-cloud-netflix-zuul/src/main/java/org/springframework/cloud/netflix/zuul/filters">the Zuul filters package</a> for the list of filters that you can enable.
If you want to disable one, set <code>zuul.&lt;SimpleClassName&gt;.&lt;filterType&gt;.disable=true</code>.
By convention, the package after <code>filters</code> is the Zuul filter type.
For example to disable <code>org.springframework.cloud.netflix.zuul.filters.post.SendResponseFilter</code>, set <code>zuul.SendResponseFilter.post.disable=true</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="hystrix-fallbacks-for-routes"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix-fallbacks-for-routes"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix-fallbacks-for-routes">138.13. Providing Hystrix Fallbacks For Routes</a></h3>
<div class="paragraph">
<p>When a circuit for a given route in Zuul is tripped, you can provide a fallback response by creating a bean of type <code>FallbackProvider</code>.
Within this bean, you need to specify the route ID the fallback is for and provide a <code>ClientHttpResponse</code> to return as a fallback.
The following example shows a relatively simple <code>FallbackProvider</code> implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFallbackProvider</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FallbackProvider</span> </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getRoute</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"customers"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ClientHttpResponse <span class="hljs-title">fallbackResponse</span><span class="hljs-params">(String route, <span class="hljs-keyword">final</span> Throwable cause)</span> </span>{
        <span class="hljs-keyword">if</span> (cause <span class="hljs-keyword">instanceof</span> HystrixTimeoutException) {
            <span class="hljs-keyword">return</span> response(HttpStatus.GATEWAY_TIMEOUT);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> response(HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> ClientHttpResponse <span class="hljs-title">response</span><span class="hljs-params">(<span class="hljs-keyword">final</span> HttpStatus status)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ClientHttpResponse() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> HttpStatus <span class="hljs-title">getStatusCode</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{
                <span class="hljs-keyword">return</span> status;
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getRawStatusCode</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{
                <span class="hljs-keyword">return</span> status.value();
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getStatusText</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{
                <span class="hljs-keyword">return</span> status.getReasonPhrase();
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> </span>{
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> InputStream <span class="hljs-title">getBody</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ByteArrayInputStream(<span class="hljs-string">"fallback"</span>.getBytes());
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> HttpHeaders <span class="hljs-title">getHeaders</span><span class="hljs-params">()</span> </span>{
                HttpHeaders headers = <span class="hljs-keyword">new</span> HttpHeaders();
                headers.setContentType(MediaType.APPLICATION_JSON);
                <span class="hljs-keyword">return</span> headers;
            }
        };
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how the route configuration for the previous example might appear:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">zuul:
  routes:
    customers: /customers/**</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you would like to provide a default fallback for all routes, you can create a bean of type <code>FallbackProvider</code> and have the <code>getRoute</code> method return <code>*</code> or <code>null</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFallbackProvider</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FallbackProvider</span> </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getRoute</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"*"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ClientHttpResponse <span class="hljs-title">fallbackResponse</span><span class="hljs-params">(String route, Throwable throwable)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ClientHttpResponse() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> HttpStatus <span class="hljs-title">getStatusCode</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{
                <span class="hljs-keyword">return</span> HttpStatus.OK;
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getRawStatusCode</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-number">200</span>;
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getStatusText</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-string">"OK"</span>;
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> </span>{

            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> InputStream <span class="hljs-title">getBody</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ByteArrayInputStream(<span class="hljs-string">"fallback"</span>.getBytes());
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> HttpHeaders <span class="hljs-title">getHeaders</span><span class="hljs-params">()</span> </span>{
                HttpHeaders headers = <span class="hljs-keyword">new</span> HttpHeaders();
                headers.setContentType(MediaType.APPLICATION_JSON);
                <span class="hljs-keyword">return</span> headers;
            }
        };
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="zuul-timeouts"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-timeouts"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-timeouts">138.14. Zuul Timeouts</a></h3>
<div class="paragraph">
<p>If you want to configure the socket timeouts and read timeouts for requests proxied through Zuul, you have two options, based on your configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If Zuul uses service discovery, you need to configure these timeouts with the
<code>ribbon.ReadTimeout</code> and <code>ribbon.SocketTimeout</code> Ribbon properties.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you have configured Zuul routes by specifying URLs, you need to use
<code>zuul.host.connect-timeout-millis</code> and <code>zuul.host.socket-timeout-millis</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="zuul-redirect-location-rewrite"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-redirect-location-rewrite"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-redirect-location-rewrite">138.15. Rewriting the <code>Location</code> header</a></h3>
<div class="paragraph">
<p>If Zuul is fronting a web application, you may need to re-write the <code>Location</code> header when the web application redirects through a HTTP status code of <code>3XX</code>.
Otherwise, the browser redirects to the web application’s URL instead of the Zuul URL.
You can configure a <code>LocationRewriteFilter</code> Zuul filter to re-write the <code>Location</code> header to the Zuul’s URL.
It also adds back the stripped global and route-specific prefixes.
The following example adds a filter by using a Spring Configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> org.springframework.cloud.netflix.zuul.filters.post.LocationRewriteFilter;
...

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableZuulProxy</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ZuulConfig</span> </span>{
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> LocationRewriteFilter <span class="hljs-title">locationRewriteFilter</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LocationRewriteFilter();
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Use this filter carefully. The filter acts on the <code>Location</code> header of ALL <code>3XX</code> response codes, which may not be appropriate in all scenarios, such as when redirecting the user to an external URL.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="enabling-cross-origin-requests"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enabling-cross-origin-requests"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enabling-cross-origin-requests">138.16. Enabling Cross Origin Requests</a></h3>
<div class="paragraph">
<p>By default Zuul routes all Cross Origin requests (CORS) to the services. If you want instead Zuul to handle these requests it can be done by providing custom <code>WebMvcConfigurer</code> bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> WebMvcConfigurer <span class="hljs-title">corsConfigurer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> WebMvcConfigurer() {
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCorsMappings</span><span class="hljs-params">(CorsRegistry registry)</span> </span>{
            registry.addMapping(<span class="hljs-string">"/path-1/**"</span>)
                    .allowedOrigins(<span class="hljs-string">"https://allowed-origin.com"</span>)
                    .allowedMethods(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"POST"</span>);
        }
    };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, we allow <code>GET</code> and <code>POST</code> methods from <code><a href="https://allowed-origin.com/" class="bare">allowed-origin.com</a></code> to send cross-origin requests to the endpoints starting with <code>path-1</code>.
You can apply CORS configuration to a specific path pattern or globally for the whole application, using <code>/**</code> mapping.
You can customize properties: <code>allowedOrigins</code>,<code>allowedMethods</code>,<code>allowedHeaders</code>,<code>exposedHeaders</code>,<code>allowCredentials</code> and <code>maxAge</code> via this configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="metrics"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#metrics"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#metrics">138.17. Metrics</a></h3>
<div class="paragraph">
<p>Zuul will provide metrics under the Actuator metrics endpoint for any failures that might occur when routing requests.
These metrics can be viewed by hitting <code>/actuator/metrics</code>. The metrics will have a name that has the format
<code>ZUUL::EXCEPTION:errorCause:statusCode</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="zuul-developer-guide"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-developer-guide"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-developer-guide">138.18. Zuul Developer Guide</a></h3>
<div class="paragraph">
<p>For a general overview of how Zuul works, see <a href="https://github.com/Netflix/zuul/wiki/How-it-Works">the Zuul Wiki</a>.</p>
</div>
<div class="sect3">
<h4 id="the-zuul-servlet"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-zuul-servlet"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#the-zuul-servlet">138.18.1. The Zuul Servlet</a></h4>
<div class="paragraph">
<p>Zuul is implemented as a Servlet. For the general cases, Zuul is embedded into the Spring Dispatch mechanism. This lets Spring MVC be in control of the routing.
In this case, Zuul buffers requests.
If there is a need to go through Zuul without buffering requests (for example, for large file uploads), the Servlet is also installed outside of the Spring Dispatcher.
By default, the servlet has an address of <code>/zuul</code>.
This path can be changed with the <code>zuul.servlet-path</code> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="zuul-requestcontext"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-requestcontext"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-requestcontext">138.18.2. Zuul RequestContext</a></h4>
<div class="paragraph">
<p>To pass information between filters, Zuul uses a <a href="https://github.com/Netflix/zuul/blob/1.x/zuul-core/src/main/java/com/netflix/zuul/context/RequestContext.java"><code>RequestContext</code></a>.
Its data is held in a <code>ThreadLocal</code> specific to each request.
Information about where to route requests, errors, and the actual <code>HttpServletRequest</code> and <code>HttpServletResponse</code> are stored there.
The <code>RequestContext</code> extends <code>ConcurrentHashMap</code>, so anything can be stored in the context. <a href="https://github.com/spring-cloud/spring-cloud-netflix/blob/master/spring-cloud-netflix-zuul/src/main/java/org/springframework/cloud/netflix/zuul/filters/support/FilterConstants.java"><code>FilterConstants</code></a> contains the keys used by the filters installed by Spring Cloud Netflix (more on these <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-developer-guide-enable-filters">later</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="enablezuulproxy-vs-enablezuulserver"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enablezuulproxy-vs-enablezuulserver"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enablezuulproxy-vs-enablezuulserver">138.18.3. <code>@EnableZuulProxy</code> vs. <code>@EnableZuulServer</code></a></h4>
<div class="paragraph">
<p>Spring Cloud Netflix installs a number of filters, depending on which annotation was used to enable Zuul. <code>@EnableZuulProxy</code> is a superset of <code>@EnableZuulServer</code>. In other words, <code>@EnableZuulProxy</code> contains all the filters installed by <code>@EnableZuulServer</code>. The additional filters in the “proxy” enable routing functionality. If you want a “blank” Zuul, you should use <code>@EnableZuulServer</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="zuul-developer-guide-enable-filters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-developer-guide-enable-filters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-developer-guide-enable-filters">138.18.4. <code>@EnableZuulServer</code> Filters</a></h4>
<div class="paragraph">
<p><code>@EnableZuulServer</code> creates a <code>SimpleRouteLocator</code> that loads route definitions from Spring Boot configuration files.</p>
</div>
<div class="paragraph">
<p>The following filters are installed (as normal Spring Beans):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pre filters:</p>
<div class="ulist">
<ul>
<li>
<p><code>ServletDetectionFilter</code>: Detects whether the request is through the Spring Dispatcher. Sets a boolean with a key of <code>FilterConstants.IS_DISPATCHER_SERVLET_REQUEST_KEY</code>.</p>
</li>
<li>
<p><code>FormBodyWrapperFilter</code>: Parses form data and re-encodes it for downstream requests.</p>
</li>
<li>
<p><code>DebugFilter</code>: If the <code>debug</code> request parameter is set, sets <code>RequestContext.setDebugRouting()</code> and <code>RequestContext.setDebugRequest()</code> to <code>true</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Route filters:</p>
<div class="ulist">
<ul>
<li>
<p><code>SendForwardFilter</code>: Forwards requests by using the Servlet <code>RequestDispatcher</code>. The forwarding location is stored in the <code>RequestContext</code> attribute, <code>FilterConstants.FORWARD_TO_KEY</code>. This is useful for forwarding to endpoints in the current application.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Post filters:</p>
<div class="ulist">
<ul>
<li>
<p><code>SendResponseFilter</code>: Writes responses from proxied requests to the current response.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Error filters:</p>
<div class="ulist">
<ul>
<li>
<p><code>SendErrorFilter</code>: Forwards to <code>/error</code> (by default) if <code>RequestContext.getThrowable()</code> is not null. You can change the default forwarding path (<code>/error</code>) by setting the <code>error.path</code> property.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="enablezuulproxy-filters"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enablezuulproxy-filters"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#enablezuulproxy-filters">138.18.5. <code>@EnableZuulProxy</code> Filters</a></h4>
<div class="paragraph">
<p>Creates a <code>DiscoveryClientRouteLocator</code> that loads route definitions from a <code>DiscoveryClient</code> (such as Eureka) as well as from properties. A route is created for each <code>serviceId</code> from the <code>DiscoveryClient</code>. As new services are added, the routes are refreshed.</p>
</div>
<div class="paragraph">
<p>In addition to the filters described earlier, the following filters are installed (as normal Spring Beans):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pre filters:</p>
<div class="ulist">
<ul>
<li>
<p><code>PreDecorationFilter</code>: Determines where and how to route, depending on the supplied <code>RouteLocator</code>. It also sets various proxy-related headers for downstream requests.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Route filters:</p>
<div class="ulist">
<ul>
<li>
<p><code>RibbonRoutingFilter</code>: Uses Ribbon, Hystrix, and pluggable HTTP clients to send requests. Service IDs are found in the <code>RequestContext</code> attribute, <code>FilterConstants.SERVICE_ID_KEY</code>. This filter can use different HTTP clients:</p>
<div class="ulist">
<ul>
<li>
<p>Apache <code>HttpClient</code>: The default client.</p>
</li>
<li>
<p>Squareup <code>OkHttpClient</code> v3: Enabled by having the <code>com.squareup.okhttp3:okhttp</code> library on the classpath and setting <code>ribbon.okhttp.enabled=true</code>.</p>
</li>
<li>
<p>Netflix Ribbon HTTP client: Enabled by setting <code>ribbon.restclient.enabled=true</code>. This client has limitations, including that it does not support the PATCH method, but it also has built-in retry.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>SimpleHostRoutingFilter</code>: Sends requests to predetermined URLs through an Apache HttpClient. URLs are found in <code>RequestContext.getRouteHost()</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="custom-zuul-filter-examples"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-zuul-filter-examples"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-zuul-filter-examples">138.18.6. Custom Zuul Filter Examples</a></h4>
<div class="paragraph">
<p>Most of the following "How to Write" examples below are included <a href="https://github.com/spring-cloud-samples/sample-zuul-filters">Sample Zuul Filters</a> project. There are also examples of manipulating the request or response body in that repository.</p>
</div>
<div class="paragraph">
<p>This section includes the following examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-developer-guide-sample-pre-filter">How to Write a Pre Filter</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-developer-guide-sample-route-filter">How to Write a Route Filter</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-developer-guide-sample-post-filter">How to Write a Post Filter</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="zuul-developer-guide-sample-pre-filter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-developer-guide-sample-pre-filter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-developer-guide-sample-pre-filter">How to Write a Pre Filter</a></h5>
<div class="paragraph">
<p>Pre filters set up data in the <code>RequestContext</code> for use in filters downstream.
The main use case is to set information required for route filters.
The following example shows a Zuul pre filter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QueryParamPreFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ZuulFilter</span> </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">filterOrder</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> PRE_DECORATION_FILTER_ORDER - <span class="hljs-number">1</span>; <span class="hljs-comment">// run before PreDecoration</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">filterType</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> PRE_TYPE;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">shouldFilter</span><span class="hljs-params">()</span> </span>{
        RequestContext ctx = RequestContext.getCurrentContext();
        <span class="hljs-keyword">return</span> !ctx.containsKey(FORWARD_TO_KEY) <span class="hljs-comment">// a filter has already forwarded</span>
                &amp;&amp; !ctx.containsKey(SERVICE_ID_KEY); <span class="hljs-comment">// a filter has already determined serviceId</span>
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
        RequestContext ctx = RequestContext.getCurrentContext();
        HttpServletRequest request = ctx.getRequest();
        <span class="hljs-keyword">if</span> (request.getParameter(<span class="hljs-string">"sample"</span>) != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// put the serviceId in `RequestContext`</span>
            ctx.put(SERVICE_ID_KEY, request.getParameter(<span class="hljs-string">"foo"</span>));
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding filter populates <code>SERVICE_ID_KEY</code> from the <code>sample</code> request parameter.
In practice, you should not do that kind of direct mapping. Instead, the service ID should be looked up from the value of <code>sample</code> instead.</p>
</div>
<div class="paragraph">
<p>Now that <code>SERVICE_ID_KEY</code> is populated, <code>PreDecorationFilter</code> does not run and <code>RibbonRoutingFilter</code> runs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to route to a full URL, call <code>ctx.setRouteHost(url)</code> instead.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To modify the path to which routing filters forward, set the <code>REQUEST_URI_KEY</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="zuul-developer-guide-sample-route-filter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-developer-guide-sample-route-filter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-developer-guide-sample-route-filter">How to Write a Route Filter</a></h5>
<div class="paragraph">
<p>Route filters run after pre filters and make requests to other services.
Much of the work here is to translate request and response data to and from the model required by the client.
The following example shows a Zuul route filter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OkHttpRoutingFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ZuulFilter</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ProxyRequestHelper helper;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">filterType</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> ROUTE_TYPE;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">filterOrder</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> SIMPLE_HOST_ROUTING_FILTER_ORDER - <span class="hljs-number">1</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">shouldFilter</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> RequestContext.getCurrentContext().getRouteHost() != <span class="hljs-keyword">null</span>
                &amp;&amp; RequestContext.getCurrentContext().sendZuulResponse();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
        OkHttpClient httpClient = <span class="hljs-keyword">new</span> OkHttpClient.Builder()
                <span class="hljs-comment">// customize</span>
                .build();

        RequestContext context = RequestContext.getCurrentContext();
        HttpServletRequest request = context.getRequest();

        String method = request.getMethod();

        String uri = <span class="hljs-keyword">this</span>.helper.buildZuulRequestURI(request);

        Headers.Builder headers = <span class="hljs-keyword">new</span> Headers.Builder();
        Enumeration&lt;String&gt; headerNames = request.getHeaderNames();
        <span class="hljs-keyword">while</span> (headerNames.hasMoreElements()) {
            String name = headerNames.nextElement();
            Enumeration&lt;String&gt; values = request.getHeaders(name);

            <span class="hljs-keyword">while</span> (values.hasMoreElements()) {
                String value = values.nextElement();
                headers.add(name, value);
            }
        }

        InputStream inputStream = request.getInputStream();

        RequestBody requestBody = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">if</span> (inputStream != <span class="hljs-keyword">null</span> &amp;&amp; HttpMethod.permitsRequestBody(method)) {
            MediaType mediaType = <span class="hljs-keyword">null</span>;
            <span class="hljs-keyword">if</span> (headers.get(<span class="hljs-string">"Content-Type"</span>) != <span class="hljs-keyword">null</span>) {
                mediaType = MediaType.parse(headers.get(<span class="hljs-string">"Content-Type"</span>));
            }
            requestBody = RequestBody.create(mediaType, StreamUtils.copyToByteArray(inputStream));
        }

        Request.Builder builder = <span class="hljs-keyword">new</span> Request.Builder()
                .headers(headers.build())
                .url(uri)
                .method(method, requestBody);

        Response response = httpClient.newCall(builder.build()).execute();

        LinkedMultiValueMap&lt;String, String&gt; responseHeaders = <span class="hljs-keyword">new</span> LinkedMultiValueMap&lt;&gt;();

        <span class="hljs-keyword">for</span> (Map.Entry&lt;String, List&lt;String&gt;&gt; entry : response.headers().toMultimap().entrySet()) {
            responseHeaders.put(entry.getKey(), entry.getValue());
        }

        <span class="hljs-keyword">this</span>.helper.setResponse(response.code(), response.body().byteStream(),
                responseHeaders);
        context.setRouteHost(<span class="hljs-keyword">null</span>); <span class="hljs-comment">// prevent SimpleHostRoutingFilter from running</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding filter translates Servlet request information into OkHttp3 request information, executes an HTTP request, and translates OkHttp3 response information to the Servlet response.</p>
</div>
</div>
<div class="sect4">
<h5 id="zuul-developer-guide-sample-post-filter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-developer-guide-sample-post-filter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-developer-guide-sample-post-filter">How to Write a Post Filter</a></h5>
<div class="paragraph">
<p>Post filters typically manipulate the response. The following filter adds a random <code>UUID</code> as the <code>X-Sample</code> header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddResponseHeaderFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ZuulFilter</span> </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">filterType</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> POST_TYPE;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">filterOrder</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> SEND_RESPONSE_FILTER_ORDER - <span class="hljs-number">1</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">shouldFilter</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
        RequestContext context = RequestContext.getCurrentContext();
        HttpServletResponse servletResponse = context.getResponse();
        servletResponse.addHeader(<span class="hljs-string">"X-Sample"</span>, UUID.randomUUID().toString());
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Other manipulations, such as transforming the response body, are much more complex and computationally intensive.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how-zuul-errors-work"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-zuul-errors-work"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#how-zuul-errors-work">138.18.7. How Zuul Errors Work</a></h4>
<div class="paragraph">
<p>If an exception is thrown during any portion of the Zuul filter lifecycle, the error filters are executed.
The <code>SendErrorFilter</code> is only run if <code>RequestContext.getThrowable()</code> is not <code>null</code>.
It then sets specific <code>javax.servlet.error.*</code> attributes in the request and forwards the request to the Spring Boot error page.</p>
</div>
</div>
<div class="sect3">
<h4 id="zuul-eager-application-context-loading"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-eager-application-context-loading"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-eager-application-context-loading">138.18.8. Zuul Eager Application Context Loading</a></h4>
<div class="paragraph">
<p>Zuul internally uses Ribbon for calling the remote URLs.
By default, Ribbon clients are lazily loaded by Spring Cloud on first call.
This behavior can be changed for Zuul by using the following configuration, which results eager loading of the child Ribbon related Application contexts at application startup time.
The following example shows how to enable eager loading:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre>zuul:
  ribbon:
    eager-load:
      enabled: true</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="polyglot-support-with-sidecar"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#polyglot-support-with-sidecar"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#polyglot-support-with-sidecar">139. Polyglot support with Sidecar</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Do you have non-JVM languages with which you want to take advantage of Eureka, Ribbon, and Config Server?
The Spring Cloud Netflix Sidecar was inspired by <a href="https://github.com/Netflix/Prana">Netflix Prana</a>.
It includes an HTTP API to get all of the instances (by host and port) for a given service.
You can also proxy service calls through an embedded Zuul proxy that gets its route entries from Eureka.
The Spring Cloud Config Server can be accessed directly through host lookup or through the Zuul Proxy.
The non-JVM application should implement a health check so the Sidecar can report to Eureka whether the app is up or down.</p>
</div>
<div class="paragraph">
<p>To include Sidecar in your project, use the dependency with a group ID of <code>org.springframework.cloud</code>
and artifact ID or <code>spring-cloud-netflix-sidecar</code>.</p>
</div>
<div class="paragraph">
<p>To enable the Sidecar, create a Spring Boot application with <code>@EnableSidecar</code>.
This annotation includes <code>@EnableCircuitBreaker</code>, <code>@EnableDiscoveryClient</code>, and <code>@EnableZuulProxy</code>.
Run the resulting application on the same host as the non-JVM application.</p>
</div>
<div class="paragraph">
<p>To configure the side car, add <code>sidecar.port</code> and <code>sidecar.health-uri</code> to <code>application.yml</code>.
The <code>sidecar.port</code> property is the port on which the non-JVM application listens.
This is so the Sidecar can properly register the application with Eureka.
The <code>sidecar.secure-port-enabled</code> options provides a way to enable secure port for traffic.
The <code>sidecar.health-uri</code> is a URI accessible on the non-JVM application that mimics a Spring Boot health indicator.
It should return a JSON document that resembles the following:</p>
</div>
<div class="listingblock">
<div class="title">health-uri-document</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  <span class="hljs-attr">"status"</span>:<span class="hljs-string">"UP"</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following application.yml example shows sample configuration for a Sidecar application:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">server:
  port: 5678
spring:
  application:
    name: sidecar

sidecar:
  port: 8000
  health-uri: http://localhost:8000/health.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API for the <code>DiscoveryClient.getInstances()</code> method is <code>/hosts/{serviceId}</code>.
The following example response for <code>/hosts/customers</code> returns two instances on different hosts:</p>
</div>
<div class="listingblock">
<div class="title">/hosts/customers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
    {
        <span class="hljs-attr">"host"</span>: <span class="hljs-string">"myhost"</span>,
        <span class="hljs-attr">"port"</span>: <span class="hljs-number">9000</span>,
        <span class="hljs-attr">"uri"</span>: <span class="hljs-string">"https://myhost:9000"</span>,
        <span class="hljs-attr">"serviceId"</span>: <span class="hljs-string">"CUSTOMERS"</span>,
        <span class="hljs-attr">"secure"</span>: <span class="hljs-literal">false</span>
    },
    {
        <span class="hljs-attr">"host"</span>: <span class="hljs-string">"myhost2"</span>,
        <span class="hljs-attr">"port"</span>: <span class="hljs-number">9000</span>,
        <span class="hljs-attr">"uri"</span>: <span class="hljs-string">"https://myhost2:9000"</span>,
        <span class="hljs-attr">"serviceId"</span>: <span class="hljs-string">"CUSTOMERS"</span>,
        <span class="hljs-attr">"secure"</span>: <span class="hljs-literal">false</span>
    }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This API is accessible to the non-JVM application (if the sidecar is on port 5678) at <code><a href="http://localhost:5678/hosts/%7BserviceId%7D" class="bare">localhost:5678/hosts/{serviceId}</a></code>.</p>
</div>
<div class="paragraph">
<p>The Zuul proxy automatically adds routes for each service known in Eureka to <code>/&lt;serviceId&gt;</code>, so the customers service is available at <code>/customers</code>.
The non-JVM application can access the customer service at <code><a href="http://localhost:5678/customers" class="bare">localhost:5678/customers</a></code> (assuming the sidecar is listening on port 5678).</p>
</div>
<div class="paragraph">
<p>If the Config Server is registered with Eureka, the non-JVM application can access it through the Zuul proxy.
If the <code>serviceId</code> of the ConfigServer is <code>configserver</code> and the Sidecar is on port 5678, then it can be accessed at <a href="http://localhost:5678/configserver" class="bare">localhost:5678/configserver</a>.</p>
</div>
<div class="paragraph">
<p>Non-JVM applications can take advantage of the Config Server’s ability to return YAML documents.
For example, a call to <a href="https://sidecar.local.spring.io:5678/configserver/default-master.yml" class="bare">sidecar.local.spring.io:5678/configserver/default-master.yml</a>
might result in a YAML document resembling the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">eureka:
  client:
    serviceUrl:
      defaultZone: http://localhost:8761/eureka/
  password: password
info:
  description: Spring Cloud Samples
  url: https://github.com/spring-cloud-samples</code></pre>
</div>
</div>
<div class="paragraph">
<p>To enable the health check request to accept all certificates when using HTTPs set <code>sidecar.accept-all-ssl-certificates</code> to `true.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="retrying-failed-requests"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#retrying-failed-requests"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#retrying-failed-requests">140. Retrying Failed Requests</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Netflix offers a variety of ways to make HTTP requests.
You can use a load balanced <code>RestTemplate</code>, Ribbon, or Feign.
No matter how you choose to create your HTTP requests, there is always a chance that a request may fail.
When a request fails, you may want to have the request be retried automatically.
To do so when using Sping Cloud Netflix, you need to include <a href="https://github.com/spring-projects/spring-retry">Spring Retry</a> on your application’s classpath.
When Spring Retry is present, load-balanced <code>RestTemplates</code>, Feign, and Zuul automatically retry any failed requests (assuming your configuration allows doing so).</p>
</div>
<div class="sect2">
<h3 id="backoff-policies"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#backoff-policies"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#backoff-policies">140.1. BackOff Policies</a></h3>
<div class="paragraph">
<p>By default, no backoff policy is used when retrying requests.
If you would like to configure a backoff policy, you need to create a bean of type <code>LoadBalancedRetryFactory</code> and override the <code>createBackOffPolicy</code> method for a given service, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfiguration</span> </span>{
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function">LoadBalancedRetryFactory <span class="hljs-title">retryFactory</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LoadBalancedRetryFactory() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> BackOffPolicy <span class="hljs-title">createBackOffPolicy</span><span class="hljs-params">(String service)</span> </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ExponentialBackOffPolicy();
            }
        };
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-16"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-16"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-16">140.2. Configuration</a></h3>
<div class="paragraph">
<p>When you use Ribbon with Spring Retry, you can control the retry functionality by configuring certain Ribbon properties.
To do so, set the <code>client.ribbon.MaxAutoRetries</code>, <code>client.ribbon.MaxAutoRetriesNextServer</code>, and <code>client.ribbon.OkToRetryOnAllOperations</code> properties.
See the <a href="https://github.com/Netflix/ribbon/wiki/Getting-Started#the-properties-file-sample-clientproperties">Ribbon documentation</a> for a description of what these properties do.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Enabling <code>client.ribbon.OkToRetryOnAllOperations</code> includes retrying POST requests, which can have an impact
on the server’s resources, due to the buffering of the request body.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The property names are case-sensitive, and since some of these properties are defined in the Netflix Ribbon project, they are in Pascal Case and the ones from Spring Cloud are in Camel Case.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In addition, you may want to retry requests when certain status codes are returned in the response.
You can list the response codes you would like the Ribbon client to retry by setting the <code>clientName.ribbon.retryableStatusCodes</code> property, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">clientName:
  ribbon:
    retryableStatusCodes: 404,502</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also create a bean of type <code>LoadBalancedRetryPolicy</code> and implement the <code>retryableStatusCode</code> method to retry a request given the status code.</p>
</div>
<div class="sect3">
<h4 id="zuul"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul">140.2.1. Zuul</a></h4>
<div class="paragraph">
<p>You can turn off Zuul’s retry functionality by setting <code>zuul.retryable</code> to <code>false</code>.
You can also disable retry functionality on a route-by-route basis by setting <code>zuul.routes.routename.retryable</code> to <code>false</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-clients-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-clients-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-clients-2">141. HTTP Clients</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Netflix automatically creates the HTTP client used by Ribbon, Feign, and Zuul for you.
However, you can also provide your own HTTP clients customized as you need them to be.
To do so, you can create a bean of type <code>CloseableHttpClient</code> if you
are using the Apache HTTP Client or <code>OkHttpClient</code> if you are using OK HTTP.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you create your own HTTP client, you are also responsible for implementing the correct connection management strategies for these clients.
Doing so improperly can result in resource management issues.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="modules-in-maintenance-mode"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#modules-in-maintenance-mode"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#modules-in-maintenance-mode">142. Modules In Maintenance Mode</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Placing a module in maintenance mode means that the Spring Cloud team will no longer be adding new features to the module.
We will fix blocker bugs and security issues, and we will also consider and review small pull requests from the community.</p>
</div>
<div class="paragraph">
<p>We intend to continue to support these modules for a period of at least a year from the general availability
of the Greenwich release train.</p>
</div>
<div class="paragraph">
<p>The following Spring Cloud Netflix modules and corresponding starters will be placed into maintenance mode:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>spring-cloud-netflix-archaius</p>
</li>
<li>
<p>spring-cloud-netflix-concurrency-limits</p>
</li>
<li>
<p>spring-cloud-netflix-hystrix-contract</p>
</li>
<li>
<p>spring-cloud-netflix-hystrix-dashboard</p>
</li>
<li>
<p>spring-cloud-netflix-hystrix-stream</p>
</li>
<li>
<p>spring-cloud-netflix-hystrix</p>
</li>
<li>
<p>spring-cloud-netflix-ribbon</p>
</li>
<li>
<p>spring-cloud-netflix-turbine-stream</p>
</li>
<li>
<p>spring-cloud-netflix-turbine</p>
</li>
<li>
<p>spring-cloud-netflix-zuul</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This does not include the Eureka modules.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-properties-8"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-8"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-8">143. Configuration properties</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To see the list of all Spring Cloud Netflix related configuration properties please check <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/appendix.html">the Appendix page</a>.</p>
</div>
</div>
</div>
<h1 id="spring-cloud-openfeign" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-openfeign"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-openfeign">Spring Cloud OpenFeign</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><strong>Hoxton.SR10</strong></p>
</div>
<div class="paragraph">
<p>This project provides OpenFeign integrations for Spring Boot apps through autoconfiguration
and binding to the Spring Environment and other Spring programming model idioms.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-feign"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign">144. Declarative REST Client: Feign</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/OpenFeign/feign">Feign</a> is a declarative web service client.
It makes writing web service clients easier.
To use Feign create an interface and annotate it.
It has pluggable annotation support including Feign annotations and JAX-RS annotations.
Feign also supports pluggable encoders and decoders.
Spring Cloud adds support for Spring MVC annotations and for using the same <code>HttpMessageConverters</code> used by default in Spring Web.
Spring Cloud integrates Ribbon and Eureka, Spring Cloud CircuitBreaker, as well as Spring Cloud LoadBalancer to provide a load-balanced http client when using Feign.</p>
</div>
<div class="sect2">
<h3 id="netflix-feign-starter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-feign-starter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netflix-feign-starter">144.1. How to Include Feign</a></h3>
<div class="paragraph">
<p>To include Feign in your project use the starter with group <code>org.springframework.cloud</code>
and artifact id <code>spring-cloud-starter-openfeign</code>. See the <a href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a>
for details on setting up your build system with the current Spring Cloud Release Train.</p>
</div>
<div class="paragraph">
<p>Example spring boot app</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableFeignClients</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        SpringApplication.run(Application.class, args);
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">StoreClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FeignClient</span>(<span class="hljs-string">"stores"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">StoreClient</span> </span>{
    <span class="hljs-meta">@RequestMapping</span>(method = RequestMethod.GET, value = <span class="hljs-string">"/stores"</span>)
    <span class="hljs-function">List&lt;Store&gt; <span class="hljs-title">getStores</span><span class="hljs-params">()</span></span>;

    <span class="hljs-meta">@RequestMapping</span>(method = RequestMethod.GET, value = <span class="hljs-string">"/stores"</span>)
    <span class="hljs-function">Page&lt;Store&gt; <span class="hljs-title">getStores</span><span class="hljs-params">(Pageable pageable)</span></span>;

    <span class="hljs-meta">@RequestMapping</span>(method = RequestMethod.POST, value = <span class="hljs-string">"/stores/{storeId}"</span>, consumes = <span class="hljs-string">"application/json"</span>)
    <span class="hljs-function">Store <span class="hljs-title">update</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"storeId"</span>)</span> Long storeId, Store store)</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>@FeignClient</code> annotation the String value ("stores" above) is an arbitrary client name, which is used to create either a <a href="https://github.com/Netflix/ribbon">Ribbon</a> load-balancer (see <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-ribbon">below for details of Ribbon support</a> and <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-circuitbreaker">below for details of Spring Cloud CircuitBreaker support</a>) or <a href="https://github.com/spring-cloud/spring-cloud-commons/blob/master/spring-cloud-commons/src/main/java/org/springframework/cloud/client/loadbalancer/reactive/ReactiveLoadBalancer.java">Spring Cloud LoadBalancer</a>.
You can also specify a URL using the <code>url</code> attribute
(absolute value or just a hostname). The name of the bean in the
application context is the fully qualified name of the interface.
To specify your own alias value you can use the <code>qualifier</code> value
of the <code>@FeignClient</code> annotation.</p>
</div>
<div class="paragraph">
<p>The load-balancer client above will want to discover the physical addresses
for the "stores" service. If your application is a Eureka client then
it will resolve the service in the Eureka service registry. If you
don’t want to use Eureka, you can simply configure a list of servers
in your external configuration using <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/current/reference/html/#simplediscoveryclient"><code>SimpleDiscoveryClient</code></a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In order to maintain backward compatibility, is used as the default load-balancer implementation.
However, Spring Cloud Netflix Ribbon is now in maintenance mode, so we recommend using Spring Cloud LoadBalancer instead.
To do this, set the value of <code>spring.cloud.loadbalancer.ribbon.enabled</code> to <code>false</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-feign-overriding-defaults"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-overriding-defaults"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-overriding-defaults">144.2. Overriding Feign Defaults</a></h3>
<div class="paragraph">
<p>A central concept in Spring Cloud’s Feign support is that of the named client. Each feign client is part of an ensemble of components that work together to contact a remote server on demand, and the ensemble has a name that you give it as an application developer using the <code>@FeignClient</code> annotation. Spring Cloud creates a new ensemble as an
<code>ApplicationContext</code> on demand for each named client using <code>FeignClientsConfiguration</code>. This contains (amongst other things) an <code>feign.Decoder</code>, a <code>feign.Encoder</code>, and a <code>feign.Contract</code>.
It is possible to override the name of that ensemble by using the <code>contextId</code>
attribute of the <code>@FeignClient</code> annotation.</p>
</div>
<div class="paragraph">
<p>Spring Cloud lets you take full control of the feign client by declaring additional configuration (on top of the <code>FeignClientsConfiguration</code>) using <code>@FeignClient</code>. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FeignClient</span>(name = <span class="hljs-string">"stores"</span>, configuration = FooConfiguration.class)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">StoreClient</span> </span>{
    <span class="hljs-comment">//..</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the client is composed from the components already in <code>FeignClientsConfiguration</code> together with any in <code>FooConfiguration</code> (where the latter will override the former).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>FooConfiguration</code> does not need to be annotated with <code>@Configuration</code>. However, if it is, then take care to exclude it from any <code>@ComponentScan</code> that would otherwise include this configuration as it will become the default source for <code>feign.Decoder</code>, <code>feign.Encoder</code>, <code>feign.Contract</code>, etc., when specified. This can be avoided by putting it in a separate, non-overlapping package from any <code>@ComponentScan</code> or <code>@SpringBootApplication</code>, or it can be explicitly excluded in <code>@ComponentScan</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>serviceId</code> attribute is now deprecated in favor of the <code>name</code> attribute.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using <code>contextId</code> attribute of the <code>@FeignClient</code> annotation in addition to changing the name of
the <code>ApplicationContext</code> ensemble, it will override the alias of the client name
and it will be used as part of the name of the configuration bean created for that client.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Previously, using the <code>url</code> attribute, did not require the <code>name</code> attribute. Using <code>name</code> is now required.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Placeholders are supported in the <code>name</code> and <code>url</code> attributes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FeignClient</span>(name = <span class="hljs-string">"${feign.name}"</span>, url = <span class="hljs-string">"${feign.url}"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">StoreClient</span> </span>{
    <span class="hljs-comment">//..</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Cloud OpenFeign provides the following beans by default for feign (<code>BeanType</code> beanName: <code>ClassName</code>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Decoder</code> feignDecoder: <code>ResponseEntityDecoder</code> (which wraps a <code>SpringDecoder</code>)</p>
</li>
<li>
<p><code>Encoder</code> feignEncoder: <code>SpringEncoder</code></p>
</li>
<li>
<p><code>Logger</code> feignLogger: <code>Slf4jLogger</code></p>
</li>
<li>
<p><code>Contract</code> feignContract: <code>SpringMvcContract</code></p>
</li>
<li>
<p><code>Feign.Builder</code> feignBuilder: <code>HystrixFeign.Builder</code></p>
</li>
<li>
<p><code>Feign.Builder</code> feignBuilder: <code>FeignCircuitBreaker.Builder</code></p>
</li>
<li>
<p><code>Client</code> feignClient: if Ribbon is in the classpath and is enabled it is a <code>LoadBalancerFeignClient</code>, otherwise if Spring Cloud LoadBalancer is in the classpath, <code>FeignBlockingLoadBalancerClient</code> is used.
If none of them is in the classpath, the default feign client is used.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>spring-cloud-starter-openfeign</code> supports both <code>spring-cloud-starter-netflix-ribbon</code> and <code>spring-cloud-starter-loadbalancer</code>. However, as they are optional dependencies, you need to make sure the one you want to use has been added to your project.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The OkHttpClient and ApacheHttpClient feign clients can be used by setting <code>feign.okhttp.enabled</code> or <code>feign.httpclient.enabled</code> to <code>true</code>, respectively, and having them on the classpath.
You can customize the HTTP client used by providing a bean of either <code>org.apache.http.impl.client.CloseableHttpClient</code> when using Apache or <code>okhttp3.OkHttpClient</code> when using OK HTTP.</p>
</div>
<div class="paragraph">
<p>Spring Cloud OpenFeign <em>does not</em> provide the following beans by default for feign, but still looks up beans of these types from the application context to create the feign client:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Logger.Level</code></p>
</li>
<li>
<p><code>Retryer</code></p>
</li>
<li>
<p><code>ErrorDecoder</code></p>
</li>
<li>
<p><code>Request.Options</code></p>
</li>
<li>
<p><code>Collection&lt;RequestInterceptor&gt;</code></p>
</li>
<li>
<p><code>SetterFactory</code></p>
</li>
<li>
<p><code>QueryMapEncoder</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A bean of <code>Retryer.NEVER_RETRY</code> with the type <code>Retryer</code> is created by default, which will disable retrying.
Notice this retrying behavior is different from the Feign default one, where it will automatically retry IOExceptions,
treating them as transient network related exceptions, and any RetryableException thrown from an ErrorDecoder.</p>
</div>
<div class="paragraph">
<p>Creating a bean of one of those type and placing it in a <code>@FeignClient</code> configuration (such as <code>FooConfiguration</code> above) allows you to override each one of the beans described. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooConfiguration</span> </span>{
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Contract <span class="hljs-title">feignContract</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> feign.Contract.Default();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> BasicAuthRequestInterceptor <span class="hljs-title">basicAuthRequestInterceptor</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BasicAuthRequestInterceptor(<span class="hljs-string">"user"</span>, <span class="hljs-string">"password"</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This replaces the <code>SpringMvcContract</code> with <code>feign.Contract.Default</code> and adds a <code>RequestInterceptor</code> to the collection of <code>RequestInterceptor</code>.</p>
</div>
<div class="paragraph">
<p><code>@FeignClient</code> also can be configured using configuration properties.</p>
</div>
<div class="paragraph">
<p>application.yml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">feign:
  client:
    config:
      feignName:
        connectTimeout: 5000
        readTimeout: 5000
        loggerLevel: full
        errorDecoder: com.example.SimpleErrorDecoder
        retryer: com.example.SimpleRetryer
       defaultQueryParameters:
          query: queryValue
        defaultRequestHeaders:
          header: headerValue
        requestInterceptors:
          - com.example.FooRequestInterceptor
          - com.example.BarRequestInterceptor
        decode404: false
        encoder: com.example.SimpleEncoder
        decoder: com.example.SimpleDecoder
        contract: com.example.SimpleContract</code></pre>
</div>
</div>
<div class="paragraph">
<p>Default configurations can be specified in the <code>@EnableFeignClients</code> attribute <code>defaultConfiguration</code> in a similar manner as described above. The difference is that this configuration will apply to <em>all</em> feign clients.</p>
</div>
<div class="paragraph">
<p>If you prefer using configuration properties to configured all <code>@FeignClient</code>, you can create configuration properties with <code>default</code> feign name.</p>
</div>
<div class="paragraph">
<p>You can use <code>feign.client.config.feignName.defaultQueryParameters</code> and <code>feign.client.config.feignName.defaultRequestHeaders</code> to specify query parameters and headers that will be sent with every request of the client named <code>feignName</code>.</p>
</div>
<div class="paragraph">
<p>application.yml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">feign:
  client:
    config:
      default:
        connectTimeout: 5000
        readTimeout: 5000
        loggerLevel: basic</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we create both <code>@Configuration</code> bean and configuration properties, configuration properties will win.
It will override <code>@Configuration</code> values. But if you want to change the priority to <code>@Configuration</code>,
you can change <code>feign.client.default-to-properties</code> to <code>false</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you need to use <code>ThreadLocal</code> bound variables in your <code>RequestInterceptor`s you will need to either set the
thread isolation strategy for Hystrix to `SEMAPHORE</code> or disable Hystrix in Feign.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>application.yml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># To disable Hystrix in Feign
feign:
  hystrix:
    enabled: false

# To set thread isolation to SEMAPHORE
hystrix:
  command:
    default:
      execution:
        isolation:
          strategy: SEMAPHORE</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we want to create multiple feign clients with the same name or url
so that they would point to the same server but each with a different custom configuration then
we have to use <code>contextId</code> attribute of the <code>@FeignClient</code> in order to avoid name
collision of these configuration beans.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FeignClient</span>(contextId = <span class="hljs-string">"fooClient"</span>, name = <span class="hljs-string">"stores"</span>, configuration = FooConfiguration.class)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">FooClient</span> </span>{
    <span class="hljs-comment">//..</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FeignClient</span>(contextId = <span class="hljs-string">"barClient"</span>, name = <span class="hljs-string">"stores"</span>, configuration = BarConfiguration.class)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BarClient</span> </span>{
    <span class="hljs-comment">//..</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to configure FeignClient not to inherit beans from the parent context.
You can do this by overriding the <code>inheritParentConfiguration()</code> in a <code>FeignClientConfigurer</code>
bean to return <code>false</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomConfiguration</span></span>{

<span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> FeignClientConfigurer <span class="hljs-title">feignClientConfigurer</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FeignClientConfigurer() {

                <span class="hljs-meta">@Override</span>
                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">inheritParentConfiguration</span><span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
                }
            };

        }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By default, Feign clients do not encode slash <code>/</code> characters. You can change this behaviour, by setting the value of <code>feign.client.decodeSlash</code> to <code>false</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="timeout-handling"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#timeout-handling"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#timeout-handling">144.3. Timeout Handling</a></h3>
<div class="paragraph">
<p>We can configure timeouts on both the default and the named client. OpenFeign works with two timeout parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>connectTimeout</code> prevents blocking the caller due to the long server processing time.</p>
</li>
<li>
<p><code>readTimeout</code> is applied from the time of connection establishment and is triggered when returning the response takes too long.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In case the server is not running or available a packet results in <em>connection refused</em>. The communication ends either with an error message or in a fallback. This can happen <em>before</em> the <code>connectTimeout</code> if it is set very low. The time taken to perform a lookup and to receive such a packet causes a significant part of this delay. It is subject to change based on the remote host that involves a DNS lookup.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>When Hystrix <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/spring-cloud-openfeign.html#spring-cloud-feign-hystrix">is enabled</a>, its timeout configuration <a href="https://github.com/Netflix/Hystrix/wiki/Configuration#execution.isolation.thread.timeoutInMilliseconds">defaults</a> to 1000 milliseconds. Hence, it might occur before the client timeout that we configured earlier. Increasing this timeout prevents it from happening.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">feign:
  client:
    config:
      default:
        connectTimeout: 5000
        readTimeout: 5000
  hystrix:
    enabled: true

hystrix:
  command:
    default:
      execution:
        timeout:
          enabled: true
        isolation:
          thread:
            timeoutInMilliseconds: 60000</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When the Hystrix timeout is enabled and its timeout is set longer than that of a feign client, <code>HystrixTimeoutException</code> wraps a feign exception. Otherwise, the only difference is the cause of the exception. The purpose of <code>HystrixTimeoutException</code> is to wrap any runtime exception that occurs first and throw an instance of itself.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="creating-feign-clients-manually"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-feign-clients-manually"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-feign-clients-manually">144.4. Creating Feign Clients Manually</a></h3>
<div class="paragraph">
<p>In some cases it might be necessary to customize your Feign Clients in a way that is not
possible using the methods above. In this case you can create Clients using the
<a href="https://github.com/OpenFeign/feign/#basics">Feign Builder API</a>. Below is an example
which creates two Feign Clients with the same interface but configures each one with
a separate request interceptor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Import</span>(FeignClientsConfiguration.class)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooController</span> </span>{

    <span class="hljs-keyword">private</span> FooClient fooClient;

    <span class="hljs-keyword">private</span> FooClient adminClient;

        <span class="hljs-meta">@Autowired</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">FooController</span><span class="hljs-params">(Decoder decoder, Encoder encoder, Client client, Contract contract)</span> </span>{
        <span class="hljs-keyword">this</span>.fooClient = Feign.builder().client(client)
                .encoder(encoder)
                .decoder(decoder)
                .contract(contract)
                .requestInterceptor(<span class="hljs-keyword">new</span> BasicAuthRequestInterceptor(<span class="hljs-string">"user"</span>, <span class="hljs-string">"user"</span>))
                .target(FooClient.class, <span class="hljs-string">"https://PROD-SVC"</span>);

        <span class="hljs-keyword">this</span>.adminClient = Feign.builder().client(client)
                .encoder(encoder)
                .decoder(decoder)
                .contract(contract)
                .requestInterceptor(<span class="hljs-keyword">new</span> BasicAuthRequestInterceptor(<span class="hljs-string">"admin"</span>, <span class="hljs-string">"admin"</span>))
                .target(FooClient.class, <span class="hljs-string">"https://PROD-SVC"</span>);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the above example <code>FeignClientsConfiguration.class</code> is the default configuration
provided by Spring Cloud OpenFeign.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>PROD-SVC</code> is the name of the service the Clients will be making requests to.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Feign <code>Contract</code> object defines what annotations and values are valid on interfaces. The
autowired <code>Contract</code> bean provides supports for SpringMVC annotations, instead of
the default Feign native annotations.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can also use the <code>Builder`to configure FeignClient not to inherit beans from the parent context.
You can do this by overriding calling `inheritParentContext(false)</code> on the <code>Builder</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-feign-hystrix"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-hystrix"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-hystrix">144.5. Feign Hystrix Support</a></h3>
<div class="paragraph">
<p>If Hystrix is on the classpath and <code>feign.hystrix.enabled=true</code>, Feign will wrap all methods with a circuit breaker. Returning a <code>com.netflix.hystrix.HystrixCommand</code> is also available. This lets you use reactive patterns (with a call to <code>.toObservable()</code> or <code>.observe()</code> or asynchronous use (with a call to <code>.queue()</code>).</p>
</div>
<div class="paragraph">
<p>To disable Hystrix support on a per-client basis create a vanilla <code>Feign.Builder</code> with the "prototype" scope, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooConfiguration</span> </span>{
        <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Scope</span>(<span class="hljs-string">"prototype"</span>)
    <span class="hljs-keyword">public</span> Feign.<span class="hljs-function">Builder <span class="hljs-title">feignBuilder</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> Feign.builder();
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Prior to the Spring Cloud Dalston release, if Hystrix was on the classpath Feign would have wrapped
all methods in a circuit breaker by default. This default behavior was changed in Spring Cloud Dalston in
favor for an opt-in approach.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-feign-hystrix-fallback"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-hystrix-fallback"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-hystrix-fallback">144.6. Feign Hystrix Fallbacks</a></h3>
<div class="paragraph">
<p>Hystrix supports the notion of a fallback: a default code path that is executed when they circuit is open or there is an error. To enable fallbacks for a given <code>@FeignClient</code> set the <code>fallback</code> attribute to the class name that implements the fallback. You also need to declare your implementation as a Spring bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FeignClient</span>(name = <span class="hljs-string">"hello"</span>, fallback = HystrixClientFallback.class)
<span class="hljs-keyword">protected</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">HystrixClient</span> </span>{
    <span class="hljs-meta">@RequestMapping</span>(method = RequestMethod.GET, value = <span class="hljs-string">"/hello"</span>)
    <span class="hljs-function">Hello <span class="hljs-title">iFailSometimes</span><span class="hljs-params">()</span></span>;
}

<span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HystrixClientFallback</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HystrixClient</span> </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Hello <span class="hljs-title">iFailSometimes</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Hello(<span class="hljs-string">"fallback"</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If one needs access to the cause that made the fallback trigger, one can use the <code>fallbackFactory</code> attribute inside <code>@FeignClient</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FeignClient</span>(name = <span class="hljs-string">"hello"</span>, fallbackFactory = HystrixClientFallbackFactory.class)
<span class="hljs-keyword">protected</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">HystrixClient</span> </span>{
    <span class="hljs-meta">@RequestMapping</span>(method = RequestMethod.GET, value = <span class="hljs-string">"/hello"</span>)
    <span class="hljs-function">Hello <span class="hljs-title">iFailSometimes</span><span class="hljs-params">()</span></span>;
}

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HystrixClientFallbackFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FallbackFactory</span>&lt;<span class="hljs-title">HystrixClient</span>&gt; </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> HystrixClient <span class="hljs-title">create</span><span class="hljs-params">(Throwable cause)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HystrixClient() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> Hello <span class="hljs-title">iFailSometimes</span><span class="hljs-params">()</span> </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Hello(<span class="hljs-string">"fallback; reason was: "</span> + cause.getMessage());
            }
        };
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
There is a limitation with the implementation of fallbacks in Feign and how Hystrix fallbacks work. Fallbacks are currently not supported for methods that return <code>com.netflix.hystrix.HystrixCommand</code> and <code>rx.Observable</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-feign-circuitbreaker"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-circuitbreaker"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-circuitbreaker">144.7. Feign Spring Cloud CircuitBreaker Support</a></h3>
<div class="paragraph">
<p>If Spring Cloud CircuitBreaker is on the classpath and <code>feign.circuitbreaker.enabled=true</code>, Feign will wrap all methods with a circuit breaker.</p>
</div>
<div class="paragraph">
<p>To disable Spring Cloud CircuitBreaker support on a per-client basis create a vanilla <code>Feign.Builder</code> with the "prototype" scope, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooConfiguration</span> </span>{
        <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Scope</span>(<span class="hljs-string">"prototype"</span>)
    <span class="hljs-keyword">public</span> Feign.<span class="hljs-function">Builder <span class="hljs-title">feignBuilder</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> Feign.builder();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The circuit breaker name follows this pattern <code>&lt;feignClientName&gt;_&lt;calledMethod&gt;</code>. When calling a <code>@FeignClient</code> with name <code>foo</code> and the called interface method is <code>bar</code> then the circuit breaker name will be <code>foo_bar</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-feign-circuitbreaker-fallback"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-circuitbreaker-fallback"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-circuitbreaker-fallback">144.8. Feign Spring Cloud CircuitBreaker Fallbacks</a></h3>
<div class="paragraph">
<p>Spring Cloud CircuitBreaker supports the notion of a fallback: a default code path that is executed when they circuit is open or there is an error. To enable fallbacks for a given <code>@FeignClient</code> set the <code>fallback</code> attribute to the class name that implements the fallback. You also need to declare your implementation as a Spring bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FeignClient</span>(name = <span class="hljs-string">"test"</span>, url = <span class="hljs-string">"http://localhost:${server.port}/"</span>,
        fallback = Fallback.class)
<span class="hljs-keyword">protected</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TestClient</span> </span>{

    <span class="hljs-meta">@RequestMapping</span>(method = RequestMethod.GET, value = <span class="hljs-string">"/hello"</span>)
    <span class="hljs-function">Hello <span class="hljs-title">getHello</span><span class="hljs-params">()</span></span>;

    <span class="hljs-meta">@RequestMapping</span>(method = RequestMethod.GET, value = <span class="hljs-string">"/hellonotfound"</span>)
    <span class="hljs-function">String <span class="hljs-title">getException</span><span class="hljs-params">()</span></span>;

}

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fallback</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">TestClient</span> </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Hello <span class="hljs-title">getHello</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoFallbackAvailableException(<span class="hljs-string">"Boom!"</span>, <span class="hljs-keyword">new</span> RuntimeException());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getException</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Fixed response"</span>;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If one needs access to the cause that made the fallback trigger, one can use the <code>fallbackFactory</code> attribute inside <code>@FeignClient</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FeignClient</span>(name = <span class="hljs-string">"testClientWithFactory"</span>, url = <span class="hljs-string">"http://localhost:${server.port}/"</span>,
        fallbackFactory = TestFallbackFactory.class)
<span class="hljs-keyword">protected</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TestClientWithFactory</span> </span>{

    <span class="hljs-meta">@RequestMapping</span>(method = RequestMethod.GET, value = <span class="hljs-string">"/hello"</span>)
    <span class="hljs-function">Hello <span class="hljs-title">getHello</span><span class="hljs-params">()</span></span>;

    <span class="hljs-meta">@RequestMapping</span>(method = RequestMethod.GET, value = <span class="hljs-string">"/hellonotfound"</span>)
    <span class="hljs-function">String <span class="hljs-title">getException</span><span class="hljs-params">()</span></span>;

}

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestFallbackFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FallbackFactory</span>&lt;<span class="hljs-title">FallbackWithFactory</span>&gt; </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> FallbackWithFactory <span class="hljs-title">create</span><span class="hljs-params">(Throwable cause)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FallbackWithFactory();
    }

}

<span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FallbackWithFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">TestClientWithFactory</span> </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Hello <span class="hljs-title">getHello</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoFallbackAvailableException(<span class="hljs-string">"Boom!"</span>, <span class="hljs-keyword">new</span> RuntimeException());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getException</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Fixed response"</span>;
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="feign-and-primary"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign-and-primary"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign-and-primary">144.9. Feign and <code>@Primary</code></a></h3>
<div class="paragraph">
<p>When using Feign with Hystrix fallbacks, there are multiple beans in the <code>ApplicationContext</code> of the same type. This will cause <code>@Autowired</code> to not work because there isn’t exactly one bean, or one marked as primary. To work around this, Spring Cloud OpenFeign marks all Feign instances as <code>@Primary</code>, so Spring Framework will know which bean to inject. In some cases, this may not be desirable. To turn off this behavior set the <code>primary</code> attribute of <code>@FeignClient</code> to false.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FeignClient</span>(name = <span class="hljs-string">"hello"</span>, primary = <span class="hljs-keyword">false</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">HelloClient</span> </span>{
    <span class="hljs-comment">// methods here</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-feign-inheritance"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-inheritance"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-feign-inheritance">144.10. Feign Inheritance Support</a></h3>
<div class="paragraph">
<p>Feign supports boilerplate apis via single-inheritance interfaces.
This allows grouping common operations into convenient base interfaces.</p>
</div>
<div class="listingblock">
<div class="title">UserService.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserService</span> </span>{

    <span class="hljs-meta">@RequestMapping</span>(method = RequestMethod.GET, value =<span class="hljs-string">"/users/{id}"</span>)
    <span class="hljs-function">User <span class="hljs-title">getUser</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> <span class="hljs-keyword">long</span> id)</span>;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">UserResource.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserResource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>{

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">UserClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">package</span> project.user;

<span class="hljs-meta">@FeignClient</span>(<span class="hljs-string">"users"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserClient</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">UserService</span> </span>{

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is generally not advisable to share an interface between a
server and a client. It introduces tight coupling, and also actually
doesn’t work with Spring MVC in its current form (method parameter
mapping is not inherited).
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="feign-requestresponse-compression"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign-requestresponse-compression"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign-requestresponse-compression">144.11. Feign request/response compression</a></h3>
<div class="paragraph">
<p>You may consider enabling the request or response GZIP compression for your
Feign requests. You can do this by enabling one of the properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">feign.compression.request.enabled=<span class="hljs-keyword">true</span>
feign.compression.response.enabled=<span class="hljs-keyword">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Feign request compression gives you settings similar to what you may set for your web server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">feign.compression.request.enabled=<span class="hljs-keyword">true</span>
feign.compression.request.mime-types=text/xml,application/xml,application/json
feign.compression.request.min-request-size=<span class="hljs-number">2048</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These properties allow you to be selective about the compressed media types and minimum request threshold length.</p>
</div>
<div class="paragraph">
<p>For http clients except OkHttpClient, default gzip decoder can be enabled to decode gzip response in UTF-8 encoding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">feign.compression.response.enabled=<span class="hljs-keyword">true</span>
feign.compression.response.useGzipDecoder=<span class="hljs-keyword">true</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="feign-logging"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign-logging"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign-logging">144.12. Feign logging</a></h3>
<div class="paragraph">
<p>A logger is created for each Feign client created. By default the name of the logger is the full class name of the interface used to create the Feign client. Feign logging only responds to the <code>DEBUG</code> level.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">logging.level.project.user.UserClient: DEBUG</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Logger.Level</code> object that you may configure per client, tells Feign how much to log. Choices are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NONE</code>, No logging (<strong>DEFAULT</strong>).</p>
</li>
<li>
<p><code>BASIC</code>, Log only the request method and URL and the response status code and execution time.</p>
</li>
<li>
<p><code>HEADERS</code>, Log the basic information along with request and response headers.</p>
</li>
<li>
<p><code>FULL</code>, Log the headers, body, and metadata for both requests and responses.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the following would set the <code>Logger.Level</code> to <code>FULL</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooConfiguration</span> </span>{
    <span class="hljs-meta">@Bean</span>
    Logger.<span class="hljs-function">Level <span class="hljs-title">feignLoggerLevel</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> Logger.Level.FULL;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="feign-querymap-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign-querymap-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign-querymap-support">144.13. Feign @QueryMap support</a></h3>
<div class="paragraph">
<p>The OpenFeign <code>@QueryMap</code> annotation provides support for POJOs to be used as
GET parameter maps. Unfortunately, the default OpenFeign QueryMap annotation is
incompatible with Spring because it lacks a <code>value</code> property.</p>
</div>
<div class="paragraph">
<p>Spring Cloud OpenFeign provides an equivalent <code>@SpringQueryMap</code> annotation, which
is used to annotate a POJO or Map parameter as a query parameter map.</p>
</div>
<div class="paragraph">
<p>For example, the <code>Params</code> class defines parameters <code>param1</code> and <code>param2</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// Params.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Params</span> </span>{
    <span class="hljs-keyword">private</span> String param1;
    <span class="hljs-keyword">private</span> String param2;

    <span class="hljs-comment">// [Getters and setters omitted for brevity]</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following feign client uses the <code>Params</code> class by using the <code>@SpringQueryMap</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FeignClient</span>(<span class="hljs-string">"demo"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DemoTemplate</span> </span>{

    <span class="hljs-meta">@GetMapping</span>(path = <span class="hljs-string">"/demo"</span>)
    <span class="hljs-function">String <span class="hljs-title">demoEndpoint</span><span class="hljs-params">(@SpringQueryMap Params params)</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need more control over the generated query parameter map, you can implement a custom <code>QueryMapEncoder</code> bean.</p>
</div>
</div>
<div class="sect2">
<h3 id="hateoas-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hateoas-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hateoas-support">144.14. HATEOAS support</a></h3>
<div class="paragraph">
<p>Spring provides some APIs to create REST representations that follow the <a href="https://en.wikipedia.org/wiki/HATEOAS">HATEOAS</a> principle, <a href="https://spring.io/projects/spring-hateoas">Spring Hateoas</a> and <a href="https://spring.io/projects/spring-data-rest">Spring Data REST</a>.</p>
</div>
<div class="paragraph">
<p>If your project use the <code>org.springframework.boot:spring-boot-starter-hateoas</code> starter
or the <code>org.springframework.boot:spring-boot-starter-data-rest</code> starter, Feign HATEOAS support is enabled by default.</p>
</div>
<div class="paragraph">
<p>When HATEOAS support is enabled, Feign clients are allowed to serialize
and deserialize HATEOAS representation models: <a href="https://docs.spring.io/spring-hateoas/docs/1.0.0.M1/apidocs/org/springframework/hateoas/EntityModel.html">EntityModel</a>, <a href="https://docs.spring.io/spring-hateoas/docs/1.0.0.M1/apidocs/org/springframework/hateoas/CollectionModel.html">CollectionModel</a> and <a href="https://docs.spring.io/spring-hateoas/docs/1.0.0.M1/apidocs/org/springframework/hateoas/PagedModel.html">PagedModel</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FeignClient</span>(<span class="hljs-string">"demo"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DemoTemplate</span> </span>{

    <span class="hljs-meta">@GetMapping</span>(path = <span class="hljs-string">"/stores"</span>)
    <span class="hljs-function">CollectionModel&lt;Store&gt; <span class="hljs-title">getStores</span><span class="hljs-params">()</span></span>;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-matrixvariable-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-matrixvariable-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-matrixvariable-support">144.15. Spring @MatrixVariable Support</a></h3>
<div class="paragraph">
<p>Spring Cloud OpenFeign provides support for the Spring <code>@MatrixVariable</code> annotation.</p>
</div>
<div class="paragraph">
<p>If a map is passed as the method argument, the <code>@MatrixVariable</code> path segment is created by joining key-value pairs from the map with a <code>=</code>.</p>
</div>
<div class="paragraph">
<p>If a different object is passed, either the <code>name</code> provided in the <code>@MatrixVariable</code> annotation (if defined) or the annotated variable name is
joined with the provided method argument using <code>=</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">IMPORTANT</dt>
<dd>
<p>Even though, on the server side, Spring does not require the users to name the path segment placeholder same as the matrix variable name, since it would be too ambiguous on the client side, Spring Cloud OpenFeign requires that you add a path segment placeholder with a name matching either the <code>name</code> provided in the <code>@MatrixVariable</code> annotation (if defined) or the annotated variable name.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/objects/links/{matrixVars}"</span>)
Map&lt;String, List&lt;String&gt;&gt; getObjects(<span class="hljs-meta">@MatrixVariable</span> Map&lt;String, List&lt;String&gt;&gt; matrixVars);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that both variable name and the path segment placeholder are called <code>matrixVars</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FeignClient</span>(<span class="hljs-string">"demo"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DemoTemplate</span> </span>{

    <span class="hljs-meta">@GetMapping</span>(path = <span class="hljs-string">"/stores"</span>)
    <span class="hljs-function">CollectionModel&lt;Store&gt; <span class="hljs-title">getStores</span><span class="hljs-params">()</span></span>;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="feign-collectionformat-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign-collectionformat-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign-collectionformat-support">144.16. Feign <code>CollectionFormat</code> support</a></h3>
<div class="paragraph">
<p>We support <code>feign.CollectionFormat</code> by providing the <code>@CollectionFormat</code> annotation. You can annotate a Feign client method with it by passing the desired <code>feign.CollectionFormat</code> as annotation value.</p>
</div>
<div class="paragraph">
<p>In the following example, the <code>CSV</code> format is used instead of the default <code>EXPLODED</code> to process the method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FeignClient</span>(name = <span class="hljs-string">"demo"</span>)
    <span class="hljs-keyword">protected</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PageableFeignClient</span> </span>{

        <span class="hljs-meta">@CollectionFormat</span>(feign.CollectionFormat.CSV)
        <span class="hljs-meta">@GetMapping</span>(path = <span class="hljs-string">"/page"</span>)
        <span class="hljs-function">ResponseEntity <span class="hljs-title">performRequest</span><span class="hljs-params">(Pageable page)</span></span>;

    }</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Set the <code>CSV</code> format while sending <code>Pageable</code> as a query parameter in order for it to be encoded correctly.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="reactive-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#reactive-support">144.17. Reactive Support</a></h3>
<div class="paragraph">
<p>As the <a href="https://github.com/OpenFeign/feign">OpenFeign project</a> does not currently support reactive clients, such as <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/reactive/function/client/WebClient.html">Spring WebClient</a>, neither does Spring Cloud OpenFeign. We will add support for it here as soon as it becomes available in the core project.</p>
</div>
<div class="paragraph">
<p>Until that is done, we recommend using <a href="https://github.com/Playtika/feign-reactive">feign-reactive</a> for Spring WebClient support.</p>
</div>
<div class="sect3">
<h4 id="early-initialization-errors"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#early-initialization-errors"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#early-initialization-errors">144.17.1. Early Initialization Errors</a></h4>
<div class="paragraph">
<p>Depending on how you are using your Feign clients you may see initialization errors when starting your application.
To work around this problem you can use an <code>ObjectProvider</code> when autowiring your client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
ObjectProvider&lt;TestFeginClient&gt; testFeginClient;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-data-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-data-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-data-support">144.18. Spring Data Support</a></h3>
<div class="paragraph">
<p>You may consider enabling Jackson Modules for the support <code>org.springframework.data.domain.Page</code> and <code>org.springframework.data.domain.Sort</code> decoding.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">feign.autoconfiguration.jackson.enabled=<span class="hljs-keyword">true</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-properties-9"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-9"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-9">145. Configuration properties</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To see the list of all Sleuth related configuration properties please check <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/appendix.html">the Appendix page</a>.</p>
</div>
</div>
</div>
<h1 id="spring-cloud-security" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-security"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-security">Spring Cloud Security</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Spring Cloud Security offers a set of primitives for building secure
applications and services with minimum fuss. A declarative model which
can be heavily configured externally (or centrally) lends itself to
the implementation of large systems of co-operating, remote components,
usually with a central indentity management service. It is also extremely
easy to use in a service platform like Cloud Foundry. Building on
Spring Boot and Spring Security OAuth2 we can quickly create systems that
implement common patterns like single sign on, token relay and token
exchange.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In a future major release, the functionality contained in this project will move to the respective projects.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Cloud is released under the non-restrictive Apache 2.0 license. If you would like to contribute to this section of the documentation or if you find an error, please find the source code and issue trackers in the project at <a href="https://github.com/spring-cloud/spring-cloud">github</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quickstart"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quickstart"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quickstart">146. Quickstart</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="oauth2-single-sign-on"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#oauth2-single-sign-on"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#oauth2-single-sign-on">146.1. OAuth2 Single Sign On</a></h3>
<div class="paragraph">
<p>Here’s a Spring Cloud "Hello World" app with HTTP Basic
authentication and a single user account:</p>
</div>
<div class="listingblock">
<div class="title">app.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Grab</span>(<span class="hljs-string">'spring-boot-starter-security'</span>)
<span class="hljs-meta">@Controller</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{

  <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">'/'</span>)
  <span class="hljs-function">String <span class="hljs-title">home</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-string">'Hello World'</span>
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can run it with <code>spring run app.groovy</code> and watch the logs for the password (username is "user"). So far this is just the default for a Spring Boot app.</p>
</div>
<div class="paragraph">
<p>Here’s a Spring Cloud app with OAuth2 SSO:</p>
</div>
<div class="listingblock">
<div class="title">app.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@EnableOAuth</span>2Sso
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{

  <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">'/'</span>)
  <span class="hljs-function">String <span class="hljs-title">home</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-string">'Hello World'</span>
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spot the difference? This app will actually behave exactly the same as
the previous one, because it doesn’t know it’s OAuth2 credentals
yet.</p>
</div>
<div class="paragraph">
<p>You can register an app in github quite easily, so try that if you
want a production app on your own domain. If you are happy to test on
localhost:8080, then set up these properties in your application
configuration:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">security:
  oauth2:
    client:
      clientId: bd1c0a783ccdd1c9b9e4
      clientSecret: 1a9030fbca47a5b2c28e92f19050bb77824b5ad1
      accessTokenUri: https://github.com/login/oauth/access_token
      userAuthorizationUri: https://github.com/login/oauth/authorize
      clientAuthenticationScheme: form
    resource:
      userInfoUri: https://api.github.com/user
      preferTokenInfo: false</code></pre>
</div>
</div>
<div class="paragraph">
<p>run the app above and it will redirect to github for authorization. If
you are already signed into github you won’t even notice that it has
authenticated. These credentials will only work if your app is
running on port 8080.</p>
</div>
<div class="paragraph">
<p>To limit the scope that the client asks for when it obtains an access token
you can set <code>security.oauth2.client.scope</code> (comma separated or an array in YAML). By
default the scope is empty and it is up to to Authorization Server to
decide what the defaults should be, usually depending on the settings in
the client registration that it holds.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The examples above are all Groovy scripts. If you want to write the
same code in Java (or Groovy) you need to add Spring Security OAuth2
to the classpath (e.g. see the
<a href="https://github.com/spring-cloud-samples/sso">sample here</a>).
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="oauth2-protected-resource"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#oauth2-protected-resource"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#oauth2-protected-resource">146.2. OAuth2 Protected Resource</a></h3>
<div class="paragraph">
<p>You want to protect an API resource with an OAuth2 token? Here’s a
simple example (paired with the client above):</p>
</div>
<div class="listingblock">
<div class="title">app.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Grab</span>(<span class="hljs-string">'spring-cloud-starter-security'</span>)
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@EnableResourceServer</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{

  <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">'/'</span>)
  <span class="hljs-function">def <span class="hljs-title">home</span><span class="hljs-params">()</span> </span>{
    [message: <span class="hljs-string">'Hello World'</span>]
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">security:
  oauth2:
    resource:
      userInfoUri: https://api.github.com/user
      preferTokenInfo: false</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="more-detail"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#more-detail"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#more-detail">147. More Detail</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="single-sign-on-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#single-sign-on-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#single-sign-on-2">147.1. Single Sign On</a></h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All of the OAuth2 SSO and resource server features moved to Spring Boot
in version 1.3. You can find documentation in the
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/">Spring Boot user guide</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="token-relay"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#token-relay"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#token-relay">147.2. Token Relay</a></h3>
<div class="paragraph">
<p>A Token Relay is where an OAuth2 consumer acts as a Client and
forwards the incoming token to outgoing resource requests. The
consumer can be a pure Client (like an SSO application) or a Resource
Server.</p>
</div>
<div class="sect3">
<h4 id="client-token-relay-in-spring-cloud-gateway"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#client-token-relay-in-spring-cloud-gateway"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#client-token-relay-in-spring-cloud-gateway">147.2.1. Client Token Relay in Spring Cloud Gateway</a></h4>
<div class="paragraph">
<p>If your app also has a
<a href="https://cloud.spring.io/spring-cloud-static/current/single/spring-cloud.html#_spring_cloud_gateway">Spring
Cloud Gateway</a> embedded reverse proxy then you
can ask it to forward OAuth2 access tokens downstream to the services
it is proxying. Thus the SSO app above can be enhanced simply like
this:</p>
</div>
<div class="listingblock">
<div class="title">App.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> TokenRelayGatewayFilterFactory filterFactory;

<span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> RouteLocator <span class="hljs-title">customRouteLocator</span><span class="hljs-params">(RouteLocatorBuilder builder)</span> </span>{
    <span class="hljs-keyword">return</span> builder.routes()
            .route(<span class="hljs-string">"resource"</span>, r -&gt; r.path(<span class="hljs-string">"/resource"</span>)
                    .filters(f -&gt; f.filter(filterFactory.apply()))
                    .uri(<span class="hljs-string">"http://localhost:9000"</span>))
            .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or this</p>
</div>
<div class="listingblock">
<div class="title">application.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  cloud:
    gateway:
      routes:
      - id: resource
        uri: http://localhost:9000
        predicates:
        - Path=/resource
        filters:
        - TokenRelay=</code></pre>
</div>
</div>
<div class="paragraph">
<p>and it will (in addition to logging the user in and grabbing a token)
pass the authentication token downstream to the services (in this case
<code>/resource</code>).</p>
</div>
<div class="paragraph">
<p>To enable this for Spring Cloud Gateway add the following dependencies</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.springframework.boot:spring-boot-starter-oauth2-client</code></p>
</li>
<li>
<p><code>org.springframework.cloud:spring-cloud-starter-security</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>How does it work? The
<a href="https://github.com/spring-cloud/spring-cloud-security/tree/master/src/main/java/org/springframework/cloud/security/oauth2/gateway/TokenRelayGatewayFilterFactory.java">filter</a>
extracts an access token from the currently authenticated user,
and puts it in a request header for the downstream requests.</p>
</div>
<div class="paragraph">
<p>For a full working sample see <a href="https://github.com/spring-cloud-samples/sample-gateway-oauth2login">this project</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default implementation of <code>ReactiveOAuth2AuthorizedClientService</code> used by <code>TokenRelayGatewayFilterFactory</code>
uses an in-memory data store. You will need to provide your own implementation <code>ReactiveOAuth2AuthorizedClientService</code>
if you need a more robust solution.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="client-token-relay"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#client-token-relay"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#client-token-relay">147.2.2. Client Token Relay</a></h4>
<div class="paragraph">
<p>If your app is a user facing OAuth2 client (i.e. has declared
<code>@EnableOAuth2Sso</code> or <code>@EnableOAuth2Client</code>) then it has an
<code>OAuth2ClientContext</code> in request scope from Spring Boot. You can
create your own <code>OAuth2RestTemplate</code> from this context and an
autowired <code>OAuth2ProtectedResourceDetails</code>, and then the context will
always forward the access token downstream, also refreshing the access
token automatically if it expires. (These are features of Spring
Security and Spring Boot.)</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Boot (1.4.1) does not create an
<code>OAuth2ProtectedResourceDetails</code> automatically if you are using
<code>client_credentials</code> tokens. In that case you need to create your own
<code>ClientCredentialsResourceDetails</code> and configure it with
<code>@ConfigurationProperties("security.oauth2.client")</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="client-token-relay-in-zuul-proxy"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#client-token-relay-in-zuul-proxy"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#client-token-relay-in-zuul-proxy">147.2.3. Client Token Relay in Zuul Proxy</a></h4>
<div class="paragraph">
<p>If your app also has a
<a href="https://cloud.spring.io/spring-cloud.html#netflix-zuul-reverse-proxy">Spring
Cloud Zuul</a> embedded reverse proxy (using <code>@EnableZuulProxy</code>) then you
can ask it to forward OAuth2 access tokens downstream to the services
it is proxying. Thus the SSO app above can be enhanced simply like
this:</p>
</div>
<div class="listingblock">
<div class="title">app.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@EnableOAuth</span>2Sso
<span class="hljs-meta">@EnableZuulProxy</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and it will (in addition to logging the user in and grabbing a token)
pass the authentication token downstream to the <code>/proxy/*</code>
services. If those services are implemented with
<code>@EnableResourceServer</code> then they will get a valid token in the
correct header.</p>
</div>
<div class="paragraph">
<p>How does it work? The <code>@EnableOAuth2Sso</code> annotation pulls in
<code>spring-cloud-starter-security</code> (which you could do manually in a
traditional app), and that in turn triggers some autoconfiguration for
a <code>ZuulFilter</code>, which itself is activated because Zuul is on the
classpath (via <code>@EnableZuulProxy</code>). The
<a href="https://github.com/spring-cloud/spring-cloud-security/tree/master/src/main/java/org/springframework/cloud/security/oauth2/proxy/OAuth2TokenRelayFilter.java">filter</a>
just extracts an access token from the currently authenticated user,
and puts it in a request header for the downstream requests.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Boot does not create an <code>OAuth2RestOperations</code> automatically which is needed for <code>refresh_token</code>. In that case you need to create your own
<code>OAuth2RestOperations</code> so <code>OAuth2TokenRelayFilter</code> can refresh the token if needed.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="resource-server-token-relay"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#resource-server-token-relay"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#resource-server-token-relay">147.2.4. Resource Server Token Relay</a></h4>
<div class="paragraph">
<p>If your app has <code>@EnableResourceServer</code> you might want to relay the
incoming token downstream to other services. If you use a
<code>RestTemplate</code> to contact the downstream services then this is just a
matter of how to create the template with the right context.</p>
</div>
<div class="paragraph">
<p>If your service uses <code>UserInfoTokenServices</code> to authenticate incoming
tokens (i.e. it is using the <code>security.oauth2.user-info-uri</code>
configuration), then you can simply create an <code>OAuth2RestTemplate</code>
using an autowired <code>OAuth2ClientContext</code> (it will be populated by the
authentication process before it hits the backend code). Equivalently
(with Spring Boot 1.4), you could inject a
<code>UserInfoRestTemplateFactory</code> and grab its <code>OAuth2RestTemplate</code> in
your configuration. For example:</p>
</div>
<div class="listingblock">
<div class="title">MyConfiguration.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> OAuth2RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">(UserInfoRestTemplateFactory factory)</span> </span>{
    <span class="hljs-keyword">return</span> factory.getUserInfoRestTemplate();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This rest template will then have the same <code>OAuth2ClientContext</code>
(request-scoped) that is used by the authentication filter, so you can
use it to send requests with the same access token.</p>
</div>
<div class="paragraph">
<p>If your app is not using <code>UserInfoTokenServices</code> but is still a client
(i.e. it declares <code>@EnableOAuth2Client</code> or <code>@EnableOAuth2Sso</code>), then
with Spring Security Cloud any <code>OAuth2RestOperations</code> that the user
creates from an <code>@Autowired</code> <code>OAuth2Context</code> will also forward
tokens. This feature is implemented by default as an MVC handler
interceptor, so it only works in Spring MVC. If you are not using MVC
you could use a custom filter or AOP interceptor wrapping an
<code>AccessTokenContextRelay</code> to provide the same feature.</p>
</div>
<div class="paragraph">
<p>Here’s a basic
example showing the use of an autowired rest template created
elsewhere ("foo.com" is a Resource Server accepting the same tokens as
the surrounding app):</p>
</div>
<div class="listingblock">
<div class="title">MyController.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> OAuth2RestOperations restTemplate;

<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/relay"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">relay</span><span class="hljs-params">()</span> </span>{
    ResponseEntity&lt;String&gt; response =
      restTemplate.getForEntity(<span class="hljs-string">"https://foo.com/bar"</span>, String.class);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Success! ("</span> + response.getBody() + <span class="hljs-string">")"</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don’t want to forward tokens (and that is a valid
choice, since you might want to act as yourself, rather than the
client that sent you the token), then you only need to create your own
<code>OAuth2Context</code> instead of autowiring the default one.</p>
</div>
<div class="paragraph">
<p>Feign clients will also pick up an interceptor that uses the
<code>OAuth2ClientContext</code> if it is available, so they should also do a
token relay anywhere where a <code>RestTemplate</code> would.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-authentication-downstream-of-a-zuul-proxy"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-authentication-downstream-of-a-zuul-proxy"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuring-authentication-downstream-of-a-zuul-proxy">148. Configuring Authentication Downstream of a Zuul Proxy</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can control the authorization behaviour downstream of an
<code>@EnableZuulProxy</code> through the <code>proxy.auth.*</code> settings. Example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">proxy:
  auth:
    routes:
      customers: oauth2
      stores: passthru
      recommendations: none</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example the "customers" service gets an OAuth2 token relay,
the "stores" service gets a passthrough (the authorization header is
just passed downstream), and the "recommendations" service has its
authorization header removed. The default behaviour is to do a token
relay if there is a token available, and passthru otherwise.</p>
</div>
<div class="paragraph">
<p>See
<a href="https://github.com/spring-cloud/spring-cloud-security/tree/master/src/main/java/org/springframework/cloud/security/oauth2/proxy/ProxyAuthenticationProperties">
ProxyAuthenticationProperties</a> for full details.</p>
</div>
</div>
</div>
<h1 id="spring-cloud-sleuth" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-sleuth"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-sleuth">Spring Cloud Sleuth</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Adrian Cole, Spencer Gibb, Marcin Grzejszczak, Dave Syer, Jay Bryant</p>
</div>
<div class="paragraph">
<p><strong>Hoxton.SR10</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction-4"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#introduction-4"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#introduction-4">149. Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Sleuth implements a distributed tracing solution for <a href="https://cloud.spring.io/">Spring Cloud</a>.</p>
</div>
<div class="sect2">
<h3 id="terminology"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#terminology"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#terminology">149.1. Terminology</a></h3>
<div class="paragraph">
<p>Spring Cloud Sleuth borrows <a href="https://research.google.com/pubs/pub36356.html">Dapper’s</a> terminology.</p>
</div>
<div class="paragraph">
<p><strong>Span</strong>: The basic unit of work. For example, sending an RPC is a new span, as is sending a response to an RPC.
Spans are identified by a unique 64-bit ID for the span and another 64-bit ID for the trace the span is a part of.
Spans also have other data, such as descriptions, timestamped events, key-value annotations (tags), the ID of the span that caused them, and process IDs (normally IP addresses).</p>
</div>
<div class="paragraph">
<p>Spans can be started and stopped, and they keep track of their timing information.
Once you create a span, you must stop it at some point in the future.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The initial span that starts a trace is called a <code>root span</code>. The value of the ID
of that span is equal to the trace ID.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><strong>Trace:</strong> A set of spans forming a tree-like structure.
For example, if you run a distributed big-data store, a trace might be formed by a <code>PUT</code> request.</p>
</div>
<div class="paragraph">
<p><strong>Annotation:</strong> Used to record the existence of an event in time. With
<a href="https://github.com/openzipkin/brave">Brave</a> instrumentation, we no longer need to set special events
for <a href="https://zipkin.io/">Zipkin</a> to understand who the client and server are, where
the request started, and where it ended. For learning purposes,
however, we mark these events to highlight what kind
of an action took place.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>cs</strong>: Client Sent. The client has made a request. This annotation indicates the start of the span.</p>
</li>
<li>
<p><strong>sr</strong>: Server Received: The server side got the request and started processing it.
Subtracting the <code>cs</code> timestamp from this timestamp reveals the network latency.</p>
</li>
<li>
<p><strong>ss</strong>: Server Sent. Annotated upon completion of request processing (when the response got sent back to the client).
Subtracting the <code>sr</code> timestamp from this timestamp reveals the time needed by the server side to process the request.</p>
</li>
<li>
<p><strong>cr</strong>: Client Received. Signifies the end of the span.
The client has successfully received the response from the server side.
Subtracting the <code>cs</code> timestamp from this timestamp reveals the whole time needed by the client to receive the response from the server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following image shows how <strong>Span</strong> and <strong>Trace</strong> look in a system, together with the Zipkin annotations:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/trace-id.png" alt="Trace Info propagation">
</div>
</div>
<div class="paragraph">
<p>Each color of a note signifies a span (there are seven spans - from <strong>A</strong> to <strong>G</strong>).
Consider the following note:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs properties"><span class="hljs-attr">Trace</span> <span class="hljs-string">Id = X</span>
<span class="hljs-attr">Span</span> <span class="hljs-string">Id = D</span>
<span class="hljs-attr">Client</span> <span class="hljs-string">Sent</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This note indicates that the current span has <strong>Trace Id</strong> set to <strong>X</strong> and <strong>Span Id</strong> set to <strong>D</strong>.
Also, the <code>Client Sent</code> event took place.</p>
</div>
<div class="paragraph">
<p>The following image shows how parent-child relationships of spans look:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/parents.png" alt="Parent child relationship">
</div>
</div>
</div>
<div class="sect2">
<h3 id="purpose"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#purpose"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#purpose">149.2. Purpose</a></h3>
<div class="paragraph">
<p>The following sections refer to the example shown in the preceding image.</p>
</div>
<div class="sect3">
<h4 id="distributed-tracing-with-zipkin"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#distributed-tracing-with-zipkin"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#distributed-tracing-with-zipkin">149.2.1. Distributed Tracing with Zipkin</a></h4>
<div class="paragraph">
<p>This example has seven spans.
If you go to traces in Zipkin, you can see this number in the second trace, as shown in the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/zipkin-traces.png" alt="Traces">
</div>
</div>
<div class="paragraph">
<p>However, if you pick a particular trace, you can see four spans, as shown in the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/zipkin-ui.png" alt="Traces Info propagation">
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you pick a particular trace, you see merged spans.
That means that, if there were two spans sent to Zipkin with Server Received and Server Sent or Client Received and Client Sent annotations, they are presented as a single span.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Why is there a difference between the seven and four spans in this case?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One span comes from the <code>http:/start</code> span. It has the Server Received (<code>sr</code>) and Server Sent (<code>ss</code>) annotations.</p>
</li>
<li>
<p>Two spans come from the RPC call from <code>service1</code> to <code>service2</code> to the <code>http:/foo</code> endpoint.
The Client Sent (<code>cs</code>) and Client Received (<code>cr</code>) events took place on the <code>service1</code> side.
Server Received (<code>sr</code>) and Server Sent (<code>ss</code>) events took place on the <code>service2</code> side.
These two spans form one logical span related to an RPC call.</p>
</li>
<li>
<p>Two spans come from the RPC call from <code>service2</code> to <code>service3</code> to the <code>http:/bar</code> endpoint.
The Client Sent (<code>cs</code>) and Client Received (<code>cr</code>) events took place on the <code>service2</code> side.
The Server Received (<code>sr</code>) and Server Sent (<code>ss</code>) events took place on the <code>service3</code> side.
These two spans form one logical span related to an RPC call.</p>
</li>
<li>
<p>Two spans come from the RPC call from <code>service2</code> to <code>service4</code> to the <code>http:/baz</code> endpoint.
The Client Sent (<code>cs</code>) and Client Received (<code>cr</code>) events took place on the <code>service2</code> side.
Server Received (<code>sr</code>) and Server Sent (<code>ss</code>) events took place on the <code>service4</code> side.
These two spans form one logical span related to an RPC call.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So, if we count the physical spans, we have one from <code>http:/start</code>, two from <code>service1</code> calling <code>service2</code>, two from <code>service2</code>
calling <code>service3</code>, and two from <code>service2</code> calling <code>service4</code>. In sum, we have a total of seven spans.</p>
</div>
<div class="paragraph">
<p>Logically, we see the information of four total Spans because we have one span related to the incoming request
to <code>service1</code> and three spans related to RPC calls.</p>
</div>
</div>
<div class="sect3">
<h4 id="visualizing-errors"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#visualizing-errors"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#visualizing-errors">149.2.2. Visualizing errors</a></h4>
<div class="paragraph">
<p>Zipkin lets you visualize errors in your trace.
When an exception was thrown and was not caught, we set proper tags on the span, which Zipkin can then properly colorize.
You could see in the list of traces one trace that is red. That appears because an exception was thrown.</p>
</div>
<div class="paragraph">
<p>If you click that trace, you see a similar picture, as follows:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/zipkin-error-traces.png" alt="Error Traces">
</div>
</div>
<div class="paragraph">
<p>If you then click on one of the spans, you see the following</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/zipkin-error-trace-screenshot.png" alt="Error Traces Info propagation">
</div>
</div>
<div class="paragraph">
<p>The span shows the reason for the error and the whole stack trace related to it.</p>
</div>
</div>
<div class="sect3">
<h4 id="distributed-tracing-with-brave"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#distributed-tracing-with-brave"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#distributed-tracing-with-brave">149.2.3. Distributed Tracing with Brave</a></h4>
<div class="paragraph">
<p>Starting with version <code>2.0.0</code>, Spring Cloud Sleuth uses <a href="https://github.com/openzipkin/brave">Brave</a> as the tracing library.
Consequently, Sleuth no longer takes care of storing the context but delegates that work to Brave.</p>
</div>
<div class="paragraph">
<p>Due to the fact that Sleuth had different naming and tagging conventions than Brave, we decided to follow Brave’s conventions from now on.
However, if you want to use the legacy Sleuth approaches, you can set the <code>spring.sleuth.http.legacy.enabled</code> property to <code>true</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="live-examples"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#live-examples"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#live-examples">149.2.4. Live examples</a></h4>
<div class="imageblock">
<div class="content">
<a class="image" href="https://docssleuth-zipkin-server.cfapps.io/"><img src="./Spring Cloud_files/pws.png" alt="Zipkin deployed on Pivotal Web Services" width="150" height="74"></a>
</div>
<div class="title">Click the Pivotal Web Services icon to see it live!Click the Pivotal Web Services icon to see it live!</div>
</div>
<div class="paragraph">
<p><a href="https://docssleuth-zipkin-server.cfapps.io/">Click here to see it live!</a></p>
</div>
<div class="paragraph">
<p>The dependency graph in Zipkin should resemble the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/dependencies.png" alt="Dependencies">
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://docssleuth-zipkin-server.cfapps.io/dependency"><img src="./Spring Cloud_files/pws.png" alt="Zipkin deployed on Pivotal Web Services" width="150" height="74"></a>
</div>
<div class="title">Click the Pivotal Web Services icon to see it live!Click the Pivotal Web Services icon to see it live!</div>
</div>
<div class="paragraph">
<p><a href="https://docssleuth-zipkin-server.cfapps.io/dependency">Click here to see it live!</a></p>
</div>
</div>
<div class="sect3">
<h4 id="log-correlation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#log-correlation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#log-correlation">149.2.5. Log correlation</a></h4>
<div class="paragraph">
<p>When using grep to read the logs of those four applications by scanning for a trace ID equal to (for example) <code>2485ec27856c56f4</code>, you get output resembling the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-selector-tag">service1</span><span class="hljs-selector-class">.log</span><span class="hljs-selector-pseudo">:2016-02-26</span> 11<span class="hljs-selector-pseudo">:15</span><span class="hljs-selector-pseudo">:47.561</span>  <span class="hljs-selector-tag">INFO</span> <span class="hljs-selector-attr">[service1,2485ec27856c56f4,2485ec27856c56f4,true]</span> 68058 <span class="hljs-selector-tag">---</span> <span class="hljs-selector-attr">[nio-8081-exec-1]</span> <span class="hljs-selector-tag">i</span><span class="hljs-selector-class">.s</span><span class="hljs-selector-class">.c</span><span class="hljs-selector-class">.sleuth</span><span class="hljs-selector-class">.docs</span><span class="hljs-selector-class">.service1</span><span class="hljs-selector-class">.Application</span>   : <span class="hljs-selector-tag">Hello</span> <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">service1</span>. <span class="hljs-selector-tag">Calling</span> <span class="hljs-selector-tag">service2</span>
<span class="hljs-selector-tag">service2</span><span class="hljs-selector-class">.log</span><span class="hljs-selector-pseudo">:2016-02-26</span> 11<span class="hljs-selector-pseudo">:15</span><span class="hljs-selector-pseudo">:47.710</span>  <span class="hljs-selector-tag">INFO</span> <span class="hljs-selector-attr">[service2,2485ec27856c56f4,9aa10ee6fbde75fa,true]</span> 68059 <span class="hljs-selector-tag">---</span> <span class="hljs-selector-attr">[nio-8082-exec-1]</span> <span class="hljs-selector-tag">i</span><span class="hljs-selector-class">.s</span><span class="hljs-selector-class">.c</span><span class="hljs-selector-class">.sleuth</span><span class="hljs-selector-class">.docs</span><span class="hljs-selector-class">.service2</span><span class="hljs-selector-class">.Application</span>   : <span class="hljs-selector-tag">Hello</span> <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">service2</span>. <span class="hljs-selector-tag">Calling</span> <span class="hljs-selector-tag">service3</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">then</span> <span class="hljs-selector-tag">service4</span>
<span class="hljs-selector-tag">service3</span><span class="hljs-selector-class">.log</span><span class="hljs-selector-pseudo">:2016-02-26</span> 11<span class="hljs-selector-pseudo">:15</span><span class="hljs-selector-pseudo">:47.895</span>  <span class="hljs-selector-tag">INFO</span> <span class="hljs-selector-attr">[service3,2485ec27856c56f4,1210be13194bfe5,true]</span> 68060 <span class="hljs-selector-tag">---</span> <span class="hljs-selector-attr">[nio-8083-exec-1]</span> <span class="hljs-selector-tag">i</span><span class="hljs-selector-class">.s</span><span class="hljs-selector-class">.c</span><span class="hljs-selector-class">.sleuth</span><span class="hljs-selector-class">.docs</span><span class="hljs-selector-class">.service3</span><span class="hljs-selector-class">.Application</span>   : <span class="hljs-selector-tag">Hello</span> <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">service3</span>
<span class="hljs-selector-tag">service2</span><span class="hljs-selector-class">.log</span><span class="hljs-selector-pseudo">:2016-02-26</span> 11<span class="hljs-selector-pseudo">:15</span><span class="hljs-selector-pseudo">:47.924</span>  <span class="hljs-selector-tag">INFO</span> <span class="hljs-selector-attr">[service2,2485ec27856c56f4,9aa10ee6fbde75fa,true]</span> 68059 <span class="hljs-selector-tag">---</span> <span class="hljs-selector-attr">[nio-8082-exec-1]</span> <span class="hljs-selector-tag">i</span><span class="hljs-selector-class">.s</span><span class="hljs-selector-class">.c</span><span class="hljs-selector-class">.sleuth</span><span class="hljs-selector-class">.docs</span><span class="hljs-selector-class">.service2</span><span class="hljs-selector-class">.Application</span>   : <span class="hljs-selector-tag">Got</span> <span class="hljs-selector-tag">response</span> <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">service3</span> <span class="hljs-selector-attr">[Hello from service3]</span>
<span class="hljs-selector-tag">service4</span><span class="hljs-selector-class">.log</span><span class="hljs-selector-pseudo">:2016-02-26</span> 11<span class="hljs-selector-pseudo">:15</span><span class="hljs-selector-pseudo">:48.134</span>  <span class="hljs-selector-tag">INFO</span> <span class="hljs-selector-attr">[service4,2485ec27856c56f4,1b1845262ffba49d,true]</span> 68061 <span class="hljs-selector-tag">---</span> <span class="hljs-selector-attr">[nio-8084-exec-1]</span> <span class="hljs-selector-tag">i</span><span class="hljs-selector-class">.s</span><span class="hljs-selector-class">.c</span><span class="hljs-selector-class">.sleuth</span><span class="hljs-selector-class">.docs</span><span class="hljs-selector-class">.service4</span><span class="hljs-selector-class">.Application</span>   : <span class="hljs-selector-tag">Hello</span> <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">service4</span>
<span class="hljs-selector-tag">service2</span><span class="hljs-selector-class">.log</span><span class="hljs-selector-pseudo">:2016-02-26</span> 11<span class="hljs-selector-pseudo">:15</span><span class="hljs-selector-pseudo">:48.156</span>  <span class="hljs-selector-tag">INFO</span> <span class="hljs-selector-attr">[service2,2485ec27856c56f4,9aa10ee6fbde75fa,true]</span> 68059 <span class="hljs-selector-tag">---</span> <span class="hljs-selector-attr">[nio-8082-exec-1]</span> <span class="hljs-selector-tag">i</span><span class="hljs-selector-class">.s</span><span class="hljs-selector-class">.c</span><span class="hljs-selector-class">.sleuth</span><span class="hljs-selector-class">.docs</span><span class="hljs-selector-class">.service2</span><span class="hljs-selector-class">.Application</span>   : <span class="hljs-selector-tag">Got</span> <span class="hljs-selector-tag">response</span> <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">service4</span> <span class="hljs-selector-attr">[Hello from service4]</span>
<span class="hljs-selector-tag">service1</span><span class="hljs-selector-class">.log</span><span class="hljs-selector-pseudo">:2016-02-26</span> 11<span class="hljs-selector-pseudo">:15</span><span class="hljs-selector-pseudo">:48.182</span>  <span class="hljs-selector-tag">INFO</span> <span class="hljs-selector-attr">[service1,2485ec27856c56f4,2485ec27856c56f4,true]</span> 68058 <span class="hljs-selector-tag">---</span> <span class="hljs-selector-attr">[nio-8081-exec-1]</span> <span class="hljs-selector-tag">i</span><span class="hljs-selector-class">.s</span><span class="hljs-selector-class">.c</span><span class="hljs-selector-class">.sleuth</span><span class="hljs-selector-class">.docs</span><span class="hljs-selector-class">.service1</span><span class="hljs-selector-class">.Application</span>   : <span class="hljs-selector-tag">Got</span> <span class="hljs-selector-tag">response</span> <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">service2</span> <span class="hljs-selector-attr">[Hello from service2, response from service3 [Hello from service3]</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">service4</span> <span class="hljs-selector-attr">[Hello from service4]</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use a log aggregating tool (such as <a href="https://www.elastic.co/products/kibana">Kibana</a>, <a href="https://www.splunk.com/">Splunk</a>, and others), you can order the events that took place.
An example from Kibana would resemble the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/kibana.png" alt="Log correlation with Kibana">
</div>
</div>
<div class="paragraph">
<p>If you want to use <a href="https://www.elastic.co/guide/en/logstash/current/index.html">Logstash</a>, the following listing shows the Grok pattern for Logstash:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs properties"><span class="hljs-attr">filter</span> <span class="hljs-string">{</span>
<span class="hljs-comment">  # pattern matching logback pattern</span>
  <span class="hljs-attr">grok</span> <span class="hljs-string">{</span>
    <span class="hljs-attr">match</span> =<span class="hljs-string">&gt; { "message" =&gt; "%{TIMESTAMP_ISO8601:timestamp}\s+%{LOGLEVEL:severity}\s+\[%{DATA:service},%{DATA:trace},%{DATA:span},%{DATA:exportable}\]\s+%{DATA:pid}\s+---\s+\[%{DATA:thread}\]\s+%{DATA:class}\s+:\s+%{GREEDYDATA:rest}" }</span>
  <span class="hljs-attr">}</span>
  <span class="hljs-attr">date</span> <span class="hljs-string">{</span>
    <span class="hljs-attr">match</span> =<span class="hljs-string">&gt; ["timestamp", "ISO8601"]</span>
  <span class="hljs-attr">}</span>
  <span class="hljs-attr">mutate</span> <span class="hljs-string">{</span>
    <span class="hljs-attr">remove_field</span> =<span class="hljs-string">&gt; ["timestamp"]</span>
  <span class="hljs-attr">}</span>
<span class="hljs-attr">}</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you want to use Grok together with the logs from Cloud Foundry, you have to use the following pattern:
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs properties"><span class="hljs-attr">filter</span> <span class="hljs-string">{</span>
<span class="hljs-comment">  # pattern matching logback pattern</span>
  <span class="hljs-attr">grok</span> <span class="hljs-string">{</span>
    <span class="hljs-attr">match</span> =<span class="hljs-string">&gt; { "message" =&gt; "(?m)OUT\s+%{TIMESTAMP_ISO8601:timestamp}\s+%{LOGLEVEL:severity}\s+\[%{DATA:service},%{DATA:trace},%{DATA:span},%{DATA:exportable}\]\s+%{DATA:pid}\s+---\s+\[%{DATA:thread}\]\s+%{DATA:class}\s+:\s+%{GREEDYDATA:rest}" }</span>
  <span class="hljs-attr">}</span>
  <span class="hljs-attr">date</span> <span class="hljs-string">{</span>
    <span class="hljs-attr">match</span> =<span class="hljs-string">&gt; ["timestamp", "ISO8601"]</span>
  <span class="hljs-attr">}</span>
  <span class="hljs-attr">mutate</span> <span class="hljs-string">{</span>
    <span class="hljs-attr">remove_field</span> =<span class="hljs-string">&gt; ["timestamp"]</span>
  <span class="hljs-attr">}</span>
<span class="hljs-attr">}</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="json-logback-with-logstash"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#json-logback-with-logstash"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#json-logback-with-logstash">JSON Logback with Logstash</a></h5>
<div class="paragraph">
<p>Often, you do not want to store your logs in a text file but in a JSON file that Logstash can immediately pick.
To do so, you have to do the following (for readability, we pass the dependencies in the <code>groupId:artifactId:version</code> notation).</p>
</div>
<div class="paragraph">
<p><strong>Dependencies Setup</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that Logback is on the classpath (<code>ch.qos.logback:logback-core</code>).</p>
</li>
<li>
<p>Add Logstash Logback encode. For example, to use version <code>4.6</code>, add <code>net.logstash.logback:logstash-logback-encoder:4.6</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Logback Setup</strong></p>
</div>
<div class="paragraph">
<p>Consider the following example of a Logback configuration file (named <a href="https://github.com/spring-cloud-samples/sleuth-documentation-apps/blob/master/service1/src/main/resources/logback-spring.xml">logback-spring.xml</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"org/springframework/boot/logging/logback/defaults.xml"</span>/&gt;</span>
    ​
    <span class="hljs-tag">&lt;<span class="hljs-name">springProperty</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">"context"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"springAppName"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"spring.application.name"</span>/&gt;</span>
    <span class="hljs-comment">&lt;!-- Example for logging into the build folder of your project --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"LOG_FILE"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${BUILD_FOLDER:-build}/${springAppName}"</span>/&gt;</span>​

    <span class="hljs-comment">&lt;!-- You can override this to have a custom pattern --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"CONSOLE_LOG_PATTERN"</span>
              <span class="hljs-attr">value</span>=<span class="hljs-string">"%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}"</span>/&gt;</span>

    <span class="hljs-comment">&lt;!-- Appender to log to console --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"console"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.filter.ThresholdFilter"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- Minimum logging level to be presented in the console logs--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>DEBUG<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>${CONSOLE_LOG_PATTERN}<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>utf8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Appender to log to file --&gt;</span>​
    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"flatfile"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>${LOG_FILE}<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>${LOG_FILE}.%d{yyyy-MM-dd}.gz<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>${CONSOLE_LOG_PATTERN}<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>utf8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>
    ​
    <span class="hljs-comment">&lt;!-- Appender to log to file in a JSON format --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"logstash"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>${LOG_FILE}.json<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>${LOG_FILE}.json.%d{yyyy-MM-dd}.gz<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">providers</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">timestamp</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">timeZone</span>&gt;</span>UTC<span class="hljs-tag">&lt;/<span class="hljs-name">timeZone</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">timestamp</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>
                        {
                        "severity": "%level",
                        "service": "${springAppName:-}",
                        "trace": "%X{traceId:-}",
                        "span": "%X{spanId:-}",
                        "baggage": "%X{key:-}",
                        "pid": "${PID:-}",
                        "thread": "%thread",
                        "class": "%logger{40}",
                        "rest": "%message"
                        }
                    <span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">providers</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>
    ​
    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"INFO"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"console"</span>/&gt;</span>
        <span class="hljs-comment">&lt;!-- uncomment this to have also JSON logs --&gt;</span>
        <span class="hljs-comment">&lt;!--&lt;appender-ref ref="logstash"/&gt;--&gt;</span>
        <span class="hljs-comment">&lt;!--&lt;appender-ref ref="flatfile"/&gt;--&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That Logback configuration file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Logs information from the application in a JSON format to a <code>build/${spring.application.name}.json</code> file.</p>
</li>
<li>
<p>Has commented out two additional appenders: console and standard log file.</p>
</li>
<li>
<p>Has the same logging pattern as the one presented in the previous section.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use a custom <code>logback-spring.xml</code>, you must pass the <code>spring.application.name</code> in the <code>bootstrap</code> rather than the <code>application</code> property file.
Otherwise, your custom logback file does not properly read the property.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="propagating-span-context"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#propagating-span-context"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#propagating-span-context">149.2.6. Propagating Span Context</a></h4>
<div class="paragraph">
<p>The span context is the state that must get propagated to any child spans across process boundaries.
Part of the Span Context is the Baggage. The trace and span IDs are a required part of the span context.
Baggage is an optional part.</p>
</div>
<div class="paragraph">
<p>Baggage is a set of key:value pairs stored in the span context.
Baggage travels together with the trace and is attached to every span.
Spring Cloud Sleuth understands that a header is baggage-related if the HTTP header is prefixed with <code>baggage-</code> and, for messaging, it starts with <code>baggage_</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
There is currently no limitation of the count or size of baggage items.
However, keep in mind that too many can decrease system throughput or increase RPC latency.
In extreme cases, too much baggage can crash the application, due to exceeding transport-level message or header capacity.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following example shows setting baggage on a span:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Span initialSpan = <span class="hljs-keyword">this</span>.tracer.nextSpan().name(<span class="hljs-string">"span"</span>).start();
ExtraFieldPropagation.set(initialSpan.context(), <span class="hljs-string">"foo"</span>, <span class="hljs-string">"bar"</span>);
ExtraFieldPropagation.set(initialSpan.context(), <span class="hljs-string">"UPPER_CASE"</span>, <span class="hljs-string">"someValue"</span>);</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="baggage-versus-span-tags"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#baggage-versus-span-tags"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#baggage-versus-span-tags">Baggage versus Span Tags</a></h5>
<div class="paragraph">
<p>Baggage travels with the trace (every child span contains the baggage of its parent).
Zipkin has no knowledge of baggage and does not receive that information.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Starting from Sleuth 2.0.0 you have to pass the baggage key names explicitly
in your project configuration. Read more about that setup <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#prefixed-fields">here</a>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Tags are attached to a specific span. In other words, they are presented only for that particular span.
However, you can search by tag to find the trace, assuming a span having the searched tag value exists.</p>
</div>
<div class="paragraph">
<p>If you want to be able to lookup a span based on baggage, you should add a corresponding entry as a tag in the root span.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The span must be in scope.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following listing shows integration tests that use baggage:</p>
</div>
<div class="listingblock">
<div class="title">The setup</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">spring.sleuth:
  baggage-keys:
    - baz
    - bizarrecase
  propagation-keys:
    - foo
    - upper_case</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">The code</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">initialSpan.tag(<span class="hljs-string">"foo"</span>,
        ExtraFieldPropagation.get(initialSpan.context(), <span class="hljs-string">"foo"</span>));
initialSpan.tag(<span class="hljs-string">"UPPER_CASE"</span>,
        ExtraFieldPropagation.get(initialSpan.context(), <span class="hljs-string">"UPPER_CASE"</span>));</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sleuth-adding-project"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sleuth-adding-project"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sleuth-adding-project">149.3. Adding Sleuth to the Project</a></h3>
<div class="paragraph">
<p>This section addresses how to add Sleuth to your project with either Maven or Gradle.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To ensure that your application name is properly displayed in Zipkin, set the <code>spring.application.name</code> property in <code>bootstrap.yml</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="only-sleuth-log-correlation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#only-sleuth-log-correlation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#only-sleuth-log-correlation">149.3.1. Only Sleuth (log correlation)</a></h4>
<div class="paragraph">
<p>If you want to use only Spring Cloud Sleuth without the Zipkin integration, add the <code>spring-cloud-starter-sleuth</code> module to your project.</p>
</div>
<div class="paragraph">
<p>The following example shows how to add Sleuth with Maven:</p>
</div>
<div class="listingblock primary"><div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div>

<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${release.train.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-sleuth<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We recommend that you add the dependency management through the Spring BOM so that you need not manage versions yourself.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the dependency to <code>spring-cloud-starter-sleuth</code>.</td>
</tr>
</tbody></table>
</div></div>
<div class="content hidden">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencyManagement { <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
    imports {
        mavenBom <span class="hljs-string">"org.springframework.cloud:spring-cloud-dependencies:${releaseTrainVersion}"</span>
    }
}

dependencies { <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
    compile <span class="hljs-string">"org.springframework.cloud:spring-cloud-starter-sleuth"</span>
}</code></pre>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We recommend that you add the dependency management through the Spring BOM so that you need not manage versions yourself.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the dependency to <code>spring-cloud-starter-sleuth</code>.</td>
</tr>
</tbody></table>
</div></div></div>

<div class="paragraph">
<p>The following example shows how to add Sleuth with Gradle:</p>
</div>


</div>
<div class="sect3">
<h4 id="sleuth-with-zipkin-via-http"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sleuth-with-zipkin-via-http"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sleuth-with-zipkin-via-http">149.3.2. Sleuth with Zipkin via HTTP</a></h4>
<div class="paragraph">
<p>If you want both Sleuth and Zipkin, add the <code>spring-cloud-starter-zipkin</code> dependency.</p>
</div>
<div class="paragraph">
<p>The following example shows how to do so for Maven:</p>
</div>
<div class="listingblock primary"><div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div>

<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${release.train.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We recommend that you add the dependency management through the Spring BOM so that you need not manage versions yourself.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the dependency to <code>spring-cloud-starter-zipkin</code>.</td>
</tr>
</tbody></table>
</div></div>
<div class="content hidden">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencyManagement { <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
    imports {
        mavenBom <span class="hljs-string">"org.springframework.cloud:spring-cloud-dependencies:${releaseTrainVersion}"</span>
    }
}

dependencies { <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
    compile <span class="hljs-string">"org.springframework.cloud:spring-cloud-starter-zipkin"</span>
}</code></pre>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We recommend that you add the dependency management through the Spring BOM so that you need not manage versions yourself.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the dependency to <code>spring-cloud-starter-zipkin</code>.</td>
</tr>
</tbody></table>
</div></div></div>

<div class="paragraph">
<p>The following example shows how to do so for Gradle:</p>
</div>


</div>
<div class="sect3">
<h4 id="sleuth-with-zipkin-over-rabbitmq-or-kafka"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sleuth-with-zipkin-over-rabbitmq-or-kafka"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sleuth-with-zipkin-over-rabbitmq-or-kafka">149.3.3. Sleuth with Zipkin over RabbitMQ or Kafka</a></h4>
<div class="paragraph">
<p>If you want to use RabbitMQ or Kafka instead of HTTP, add the <code>spring-rabbit</code> or <code>spring-kafka</code> dependency.
The default destination name is <code>zipkin</code>.</p>
</div>
<div class="paragraph">
<p>If using Kafka, you must set the property <code>spring.zipkin.sender.type</code> property accordingly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.zipkin.sender.type: kafka</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<code>spring-cloud-sleuth-stream</code> is deprecated and incompatible with these destinations.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you want Sleuth over RabbitMQ, add the <code>spring-cloud-starter-zipkin</code> and <code>spring-rabbit</code>
dependencies.</p>
</div>
<div class="paragraph">
<p>The following example shows how to do so for Gradle:</p>
</div>
<div class="listingblock primary"><div class="switch"><div class="switch--item selected">Maven</div><div class="switch--item">Gradle</div></div>

<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${release.train.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.amqp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-rabbit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We recommend that you add the dependency management through the Spring BOM so that you need not manage versions yourself.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the dependency to <code>spring-cloud-starter-zipkin</code>. That way, all nested dependencies get downloaded.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>To automatically configure RabbitMQ, add the <code>spring-rabbit</code> dependency.</td>
</tr>
</tbody></table>
</div></div>
<div class="content hidden">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencyManagement { <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
    imports {
        mavenBom <span class="hljs-string">"org.springframework.cloud:spring-cloud-dependencies:${releaseTrainVersion}"</span>
    }
}

dependencies {
    compile <span class="hljs-string">"org.springframework.cloud:spring-cloud-starter-zipkin"</span> <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
    compile <span class="hljs-string">"org.springframework.amqp:spring-rabbit"</span> <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
}</code></pre>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We recommend that you add the dependency management through the Spring BOM so that you need not manage versions yourself.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the dependency to <code>spring-cloud-starter-zipkin</code>. That way, all nested dependencies get downloaded.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>To automatically configure RabbitMQ, add the <code>spring-rabbit</code> dependency.</td>
</tr>
</tbody></table>
</div></div></div>



</div>
</div>
<div class="sect2">
<h3 id="overriding-the-auto-configuration-of-zipkin"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#overriding-the-auto-configuration-of-zipkin"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#overriding-the-auto-configuration-of-zipkin">149.4. Overriding the auto-configuration of Zipkin</a></h3>
<div class="paragraph">
<p>Spring Cloud Sleuth supports sending traces to multiple tracing systems as of version 2.1.0.
In order to get this to work, every tracing system needs to have a <code>Reporter&lt;Span&gt;</code> and <code>Sender</code>.
If you want to override the provided beans you need to give them a specific name.
To do this you can use respectively <code>ZipkinAutoConfiguration.REPORTER_BEAN_NAME</code> and <code>ZipkinAutoConfiguration.SENDER_BEAN_NAME</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfig</span> </span>{

    <span class="hljs-meta">@Bean</span>(ZipkinAutoConfiguration.REPORTER_BEAN_NAME)
    Reporter&lt;zipkin2.Span&gt; myReporter() {
        <span class="hljs-keyword">return</span> AsyncReporter.create(mySender());
    }

    <span class="hljs-meta">@Bean</span>(ZipkinAutoConfiguration.SENDER_BEAN_NAME)
    <span class="hljs-function">MySender <span class="hljs-title">mySender</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MySender();
    }

    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MySender</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Sender</span> </span>{

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> spanSent = <span class="hljs-keyword">false</span>;

        <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isSpanSent</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.spanSent;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Encoding <span class="hljs-title">encoding</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> Encoding.JSON;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">messageMaxBytes</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> Integer.MAX_VALUE;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">messageSizeInBytes</span><span class="hljs-params">(List&lt;<span class="hljs-keyword">byte</span>[]&gt; encodedSpans)</span> </span>{
            <span class="hljs-keyword">return</span> encoding().listSizeInBytes(encodedSpans);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Call&lt;Void&gt; <span class="hljs-title">sendSpans</span><span class="hljs-params">(List&lt;<span class="hljs-keyword">byte</span>[]&gt; encodedSpans)</span> </span>{
            <span class="hljs-keyword">this</span>.spanSent = <span class="hljs-keyword">true</span>;
            <span class="hljs-keyword">return</span> Call.create(<span class="hljs-keyword">null</span>);
        }

    }

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="additional-resources"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#additional-resources"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#additional-resources">150. Additional Resources</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can watch a video of <a href="https://twitter.com/reshmi9k">Reshmi Krishna</a> and <a href="https://twitter.com/mgrzejszczak">Marcin Grzejszczak</a> talking about Spring Cloud
Sleuth and Zipkin <a href="https://content.pivotal.io/springone-platform-2017/distributed-tracing-latency-analysis-for-your-microservices-grzejszczak-krishna">by clicking here</a>.</p>
</div>
<div class="paragraph">
<p>You can check different setups of Sleuth and Brave <a href="https://github.com/openzipkin/sleuth-webmvc-example">in the openzipkin/sleuth-webmvc-example repository</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="features-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-2">151. Features</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Adds trace and span IDs to the Slf4J MDC, so you can extract all the logs from a given trace or span in a log aggregator, as shown in the following example logs:</p>
<div class="listingblock">
<div class="content">
<pre>2016-02-02 15:30:57.902  INFO [bar,6bfd228dc00d216b,6bfd228dc00d216b,false] 23030 --- [nio-8081-exec-3] ...
2016-02-02 15:30:58.372 ERROR [bar,6bfd228dc00d216b,6bfd228dc00d216b,false] 23030 --- [nio-8081-exec-3] ...
2016-02-02 15:31:01.936  INFO [bar,46ab0d418373cbc9,46ab0d418373cbc9,false] 23030 --- [nio-8081-exec-4] ...</pre>
</div>
</div>
<div class="paragraph">
<p>Notice the <code>[appname,traceId,spanId,exportable]</code> entries from the MDC:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>spanId</code></strong>: The ID of a specific operation that took place.</p>
</li>
<li>
<p><strong><code>appname</code></strong>: The name of the application that logged the span.</p>
</li>
<li>
<p><strong><code>traceId</code></strong>: The ID of the latency graph that contains the span.</p>
</li>
<li>
<p><strong><code>exportable</code></strong>: Whether the log should be exported to Zipkin.
When would you like the span not to be exportable?
When you want to wrap some operation in a Span and have it written to the logs only.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Provides an abstraction over common distributed tracing data models: traces, spans (forming a DAG), annotations, and key-value annotations.
Spring Cloud Sleuth is loosely based on HTrace but is compatible with Zipkin (Dapper).</p>
</li>
<li>
<p>Sleuth records timing information to aid in latency analysis.
By using sleuth, you can pinpoint causes of latency in your applications.</p>
</li>
<li>
<p>Sleuth is written to not log too much and to not cause your production application to crash.
To that end, Sleuth:</p>
<div class="ulist">
<ul>
<li>
<p>Propagates structural data about your call graph in-band and the rest out-of-band.</p>
</li>
<li>
<p>Includes opinionated instrumentation of layers such as HTTP.</p>
</li>
<li>
<p>Includes a sampling policy to manage volume.</p>
</li>
<li>
<p>Can report to a Zipkin system for query and visualization.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Instruments common ingress and egress points from Spring applications (servlet filter, async endpoints, rest template, scheduled actions, message channels, Zuul filters, and Feign client).</p>
</li>
<li>
<p>Sleuth includes default logic to join a trace across HTTP or messaging boundaries.
For example, HTTP propagation works over Zipkin-compatible request headers.</p>
</li>
<li>
<p>Sleuth can propagate context (also known as baggage) between processes.
Consequently, if you set a baggage element on a Span, it is sent downstream to other processes over either HTTP or messaging.</p>
</li>
<li>
<p>Provides a way to create or continue spans and add tags and logs through annotations.</p>
</li>
<li>
<p>If <code>spring-cloud-sleuth-zipkin</code> is on the classpath, the app generates and collects Zipkin-compatible traces.
By default, it sends them over HTTP to a Zipkin server on localhost (port 9411).
You can configure the location of the service by setting <code>spring.zipkin.baseUrl</code>.</p>
<div class="ulist">
<ul>
<li>
<p>If you depend on <code>spring-rabbit</code>, your app sends traces to a RabbitMQ broker instead of HTTP.</p>
</li>
<li>
<p>If you depend on <code>spring-kafka</code>, and set <code>spring.zipkin.sender.type: kafka</code>, your app sends traces to a Kafka broker instead of HTTP.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<code>spring-cloud-sleuth-stream</code> is deprecated and should no longer be used.
</td>
</tr>
</tbody></table>
</div>
<div class="ulist">
<ul>
<li>
<p>Spring Cloud Sleuth is <a href="https://opentracing.io/">OpenTracing</a> compatible.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The SLF4J MDC is always set and logback users immediately see the trace and span IDs in logs per the example
shown earlier.
Other logging systems have to configure their own formatter to get the same result.
The default is as follows:
<code>logging.pattern.level</code> set to <code>%5p [${spring.zipkin.service.name:${spring.application.name:-}},%X{X-B3-TraceId:-},%X{X-B3-SpanId:-},%X{X-Span-Export:-}]</code>
(this is a Spring Boot feature for logback users).
If you do not use SLF4J, this pattern is NOT automatically applied.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="introduction-to-brave"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#introduction-to-brave"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#introduction-to-brave">151.1. Introduction to Brave</a></h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Starting with version <code>2.0.0</code>, Spring Cloud Sleuth uses
<a href="https://github.com/openzipkin/brave">Brave</a> as the tracing library.
For your convenience, we embed part of the Brave’s docs here.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In the vast majority of cases you need to just use the <code>Tracer</code>
or <code>SpanCustomizer</code> beans from Brave that Sleuth provides. The documentation below contains
a high overview of what Brave is and how it works.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Brave is a library used to capture and report latency information about distributed operations to Zipkin.
Most users do not use Brave directly. They use libraries or frameworks rather than employ Brave on their behalf.</p>
</div>
<div class="paragraph">
<p>This module includes a tracer that creates and joins spans that model the latency of potentially distributed work.
It also includes libraries to propagate the trace context over network boundaries (for example, with HTTP headers).</p>
</div>
<div class="sect3">
<h4 id="tracing-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tracing-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tracing-2">151.1.1. Tracing</a></h4>
<div class="paragraph">
<p>Most importantly, you need a <code>brave.Tracer</code>, configured to <a href="https://github.com/openzipkin/zipkin-reporter-java">report to Zipkin</a>.</p>
</div>
<div class="paragraph">
<p>The following example setup sends trace data (spans) to Zipkin over HTTP (as opposed to Kafka):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Tracer tracer;

    <span class="hljs-comment">// Tracer will be autowired</span>
    MyClass(Tracer tracer) {
        <span class="hljs-keyword">this</span>.tracer = tracer;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">doSth</span><span class="hljs-params">()</span> </span>{
        Span span = tracer.newTrace().name(<span class="hljs-string">"encode"</span>).start();
        <span class="hljs-comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If your span contains a name longer than 50 chars, then that name is truncated to 50 chars.
Your names have to be explicit and concrete.
Big names lead to latency issues and sometimes even thrown exceptions.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The tracer creates and joins spans that model the latency of potentially distributed work.
It can employ sampling to reduce overhead during the process, to reduce the amount of data sent to Zipkin, or both.</p>
</div>
<div class="paragraph">
<p>Spans returned by a tracer report data to Zipkin when finished or do nothing if unsampled.
After starting a span, you can annotate events of interest or add tags containing details or lookup keys.</p>
</div>
<div class="paragraph">
<p>Spans have a context that includes trace identifiers that place the span at the correct spot in the tree representing the distributed operation.</p>
</div>
</div>
<div class="sect3">
<h4 id="local-tracing"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#local-tracing"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#local-tracing">151.1.2. Local Tracing</a></h4>
<div class="paragraph">
<p>When tracing code that never leaves your process, run it inside a scoped span.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span> Tracer tracer;

<span class="hljs-comment">// Start a new trace or a span within an existing trace representing an operation</span>
ScopedSpan span = tracer.startScopedSpan(<span class="hljs-string">"encode"</span>);
<span class="hljs-keyword">try</span> {
  <span class="hljs-comment">// The span is in "scope" meaning downstream code such as loggers can see trace IDs</span>
  <span class="hljs-keyword">return</span> encoder.encode();
} <span class="hljs-keyword">catch</span> (RuntimeException | Error e) {
  span.error(e); <span class="hljs-comment">// Unless you handle exceptions, you might not know the operation failed!</span>
  <span class="hljs-keyword">throw</span> e;
} <span class="hljs-keyword">finally</span> {
  span.finish(); <span class="hljs-comment">// always finish the span</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you need more features, or finer control, use the <code>Span</code> type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span> Tracer tracer;

<span class="hljs-comment">// Start a new trace or a span within an existing trace representing an operation</span>
Span span = tracer.nextSpan().name(<span class="hljs-string">"encode"</span>).start();
<span class="hljs-comment">// Put the span in "scope" so that downstream code such as loggers can see trace IDs</span>
<span class="hljs-keyword">try</span> (SpanInScope ws = tracer.withSpanInScope(span)) {
  <span class="hljs-keyword">return</span> encoder.encode();
} <span class="hljs-keyword">catch</span> (RuntimeException | Error e) {
  span.error(e); <span class="hljs-comment">// Unless you handle exceptions, you might not know the operation failed!</span>
  <span class="hljs-keyword">throw</span> e;
} <span class="hljs-keyword">finally</span> {
  span.finish(); <span class="hljs-comment">// note the scope is independent of the span. Always finish a span.</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both of the above examples report the exact same span on finish!</p>
</div>
<div class="paragraph">
<p>In the above example, the span will be either a new root span or the
next child in an existing trace.</p>
</div>
</div>
<div class="sect3">
<h4 id="customizing-spans-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-spans-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-spans-2">151.1.3. Customizing Spans</a></h4>
<div class="paragraph">
<p>Once you have a span, you can add tags to it.
The tags can be used as lookup keys or details.
For example, you might add a tag with your runtime version, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">span.tag(<span class="hljs-string">"clnt/finagle.version"</span>, <span class="hljs-string">"6.36.0"</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When exposing the ability to customize spans to third parties, prefer <code>brave.SpanCustomizer</code> as opposed to <code>brave.Span</code>.
The former is simpler to understand and test and does not tempt users with span lifecycle hooks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyTraceCallback</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">request</span><span class="hljs-params">(Request request, SpanCustomizer customizer)</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since <code>brave.Span</code> implements <code>brave.SpanCustomizer</code>, you can pass it to users, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">for</span> (MyTraceCallback callback : userCallbacks) {
  callback.request(request, span);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="implicitly-looking-up-the-current-span"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#implicitly-looking-up-the-current-span"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#implicitly-looking-up-the-current-span">151.1.4. Implicitly Looking up the Current Span</a></h4>
<div class="paragraph">
<p>Sometimes, you do not know if a trace is in progress or not, and you do not want users to do null checks.
<code>brave.CurrentSpanCustomizer</code> handles this problem by adding data to any span that’s in progress or drops, as shown in the following example:</p>
</div>
<div class="paragraph">
<p>Ex.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// The user code can then inject this without a chance of it being null.</span>
<span class="hljs-meta">@Autowired</span> SpanCustomizer span;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">userCode</span><span class="hljs-params">()</span> </span>{
  span.annotate(<span class="hljs-string">"tx.started"</span>);
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rpc-tracing"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rpc-tracing"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rpc-tracing">151.1.5. RPC tracing</a></h4>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Check for <a href="https://github.com/openzipkin/brave/tree/master/instrumentation">instrumentation written here</a> and <a href="https://zipkin.io/pages/existing_instrumentations.html">Zipkin’s list</a> before rolling your own RPC instrumentation.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>RPC tracing is often done automatically by interceptors. Behind the scenes, they add tags and events that relate to their role in an RPC operation.</p>
</div>
<div class="paragraph">
<p>The following example shows how to add a client span:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span> Tracing tracing;
<span class="hljs-meta">@Autowired</span> Tracer tracer;

<span class="hljs-comment">// before you send a request, add metadata that describes the operation</span>
span = tracer.nextSpan().name(service + <span class="hljs-string">"/"</span> + method).kind(CLIENT);
span.tag(<span class="hljs-string">"myrpc.version"</span>, <span class="hljs-string">"1.0.0"</span>);
span.remoteServiceName(<span class="hljs-string">"backend"</span>);
span.remoteIpAndPort(<span class="hljs-string">"172.3.4.1"</span>, <span class="hljs-number">8108</span>);

<span class="hljs-comment">// Add the trace context to the request, so it can be propagated in-band</span>
tracing.propagation().injector(Request::addHeader)
                     .inject(span.context(), request);

<span class="hljs-comment">// when the request is scheduled, start the span</span>
span.start();

<span class="hljs-comment">// if there is an error, tag the span</span>
span.tag(<span class="hljs-string">"error"</span>, error.getCode());
<span class="hljs-comment">// or if there is an exception</span>
span.error(exception);

<span class="hljs-comment">// when the response is complete, finish the span</span>
span.finish();</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="one-way-tracing"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#one-way-tracing"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#one-way-tracing">One-Way tracing</a></h5>
<div class="paragraph">
<p>Sometimes, you need to model an asynchronous operation where there is a
request but no response. In normal RPC tracing, you use <code>span.finish()</code>
to indicate that the response was received. In one-way tracing, you use
<code>span.flush()</code> instead, as you do not expect a response.</p>
</div>
<div class="paragraph">
<p>The following example shows how a client might model a one-way operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span> Tracing tracing;
<span class="hljs-meta">@Autowired</span> Tracer tracer;

<span class="hljs-comment">// start a new span representing a client request</span>
oneWaySend = tracer.nextSpan().name(service + <span class="hljs-string">"/"</span> + method).kind(CLIENT);

<span class="hljs-comment">// Add the trace context to the request, so it can be propagated in-band</span>
tracing.propagation().injector(Request::addHeader)
                     .inject(oneWaySend.context(), request);

<span class="hljs-comment">// fire off the request asynchronously, totally dropping any response</span>
request.execute();

<span class="hljs-comment">// start the client side and flush instead of finish</span>
oneWaySend.start().flush();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how a server might handle a one-way operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span> Tracing tracing;
<span class="hljs-meta">@Autowired</span> Tracer tracer;

<span class="hljs-comment">// pull the context out of the incoming request</span>
extractor = tracing.propagation().extractor(Request::getHeader);

<span class="hljs-comment">// convert that context to a span which you can name and add tags to</span>
oneWayReceive = nextSpan(tracer, extractor.extract(request))
    .name(<span class="hljs-string">"process-request"</span>)
    .kind(SERVER)
    ... add tags etc.

<span class="hljs-comment">// start the server side and flush instead of finish</span>
oneWayReceive.start().flush();

<span class="hljs-comment">// you should not modify this span anymore as it is complete. However,</span>
<span class="hljs-comment">// you can create children to represent follow-up work.</span>
next = tracer.newSpan(oneWayReceive.context()).name(<span class="hljs-string">"step2"</span>).start();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sampling"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sampling"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sampling">152. Sampling</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sampling may be employed to reduce the data collected and reported out of process.
When a span is not sampled, it adds no overhead (a noop).</p>
</div>
<div class="paragraph">
<p>Sampling is an up-front decision, meaning that the decision to report data is made at the first operation in a trace and that decision is propagated downstream.</p>
</div>
<div class="paragraph">
<p>By default, a global sampler applies a single rate to all traced operations.
<code>Tracer.Builder.sampler</code> controls this setting, and it defaults to tracing every request.</p>
</div>
<div class="sect2">
<h3 id="declarative-sampling"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#declarative-sampling"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#declarative-sampling">152.1. Declarative sampling</a></h3>
<div class="paragraph">
<p>Some applications need to sample based on the type or annotations of a java method.</p>
</div>
<div class="paragraph">
<p>Most users use a framework interceptor to automate this sort of policy.
The following example shows how that might work internally:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span> Tracer tracer;

<span class="hljs-comment">// derives a sample rate from an annotation on a java method</span>
DeclarativeSampler&lt;Traced&gt; sampler = DeclarativeSampler.create(Traced::sampleRate);

<span class="hljs-meta">@Around</span>(<span class="hljs-string">"@annotation(traced)"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">traceThing</span><span class="hljs-params">(ProceedingJoinPoint pjp, Traced traced)</span> <span class="hljs-keyword">throws</span> Throwable </span>{
  <span class="hljs-comment">// When there is no trace in progress, this decides using an annotation</span>
  Sampler decideUsingAnnotation = declarativeSampler.toSampler(traced);
  Tracer tracer = tracer.withSampler(decideUsingAnnotation);

  <span class="hljs-comment">// This code looks the same as if there was no declarative override</span>
  ScopedSpan span = tracer.startScopedSpan(spanName(pjp));
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> pjp.proceed();
  } <span class="hljs-keyword">catch</span> (RuntimeException | Error e) {
    span.error(e);
    <span class="hljs-keyword">throw</span> e;
  } <span class="hljs-keyword">finally</span> {
    span.finish();
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-sampling"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-sampling"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-sampling">152.2. Custom sampling</a></h3>
<div class="paragraph">
<p>Depending on what the operation is, you may want to apply different policies.
For example, you might not want to trace requests to static resources such as images, or you might want to trace all requests to a new api.</p>
</div>
<div class="paragraph">
<p>Most users use a framework interceptor to automate this sort of policy.
The following example shows how that might work internally:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span> Tracer tracer;
<span class="hljs-meta">@Autowired</span> Sampler fallback;

<span class="hljs-function">Span <span class="hljs-title">nextSpan</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Request input)</span> </span>{
  Sampler requestBased = Sampler() {
    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isSampled</span><span class="hljs-params">(<span class="hljs-keyword">long</span> traceId)</span> </span>{
      <span class="hljs-keyword">if</span> (input.url().startsWith(<span class="hljs-string">"/experimental"</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (input.url().startsWith(<span class="hljs-string">"/static"</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
      }
      <span class="hljs-keyword">return</span> fallback.isSampled(traceId);
    }
  };
  <span class="hljs-keyword">return</span> tracer.withSampler(requestBased).nextSpan();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sampling-in-spring-cloud-sleuth"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sampling-in-spring-cloud-sleuth"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sampling-in-spring-cloud-sleuth">152.3. Sampling in Spring Cloud Sleuth</a></h3>
<div class="paragraph">
<p>Sampling only applies to tracing backends, such as Zipkin. Trace IDs appear in logs regardless of
sample rate. Sampling is a way to prevent overloading the system, by consistently tracing some, but
not all requests.</p>
</div>
<div class="paragraph">
<p>The default rate of 10 traces per second is controlled by the <code>spring.sleuth.sampler.rate</code>
property and applies when we know Sleuth is used for reasons besides logging. Use a rate above 100
traces per second with extreme caution as it can overload your tracing system.</p>
</div>
<div class="paragraph">
<p>The sampler can be set by Java Config also, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Sampler <span class="hljs-title">defaultSampler</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> Sampler.ALWAYS_SAMPLE;
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can set the HTTP header <code>X-B3-Flags</code> to <code>1</code>, or, when doing messaging, you can set the <code>spanFlags</code> header to <code>1</code>.
Doing so forces the corresponding trace to be sampled regardless of the sampling configuration.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="propagation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#propagation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#propagation">153. Propagation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Propagation is needed to ensure activities originating from the same root are collected together in the same trace.
The most common propagation approach is to copy a trace context from a client by sending an RPC request to a server receiving it.</p>
</div>
<div class="paragraph">
<p>For example, when a downstream HTTP call is made, its trace context is encoded as request headers and sent along with it, as shown in the following image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs properties">   <span class="hljs-attr">Client</span> <span class="hljs-string">Span                                                Server Span</span>
<span class="hljs-meta">┌──────────────────┐</span>                                       <span class="hljs-string">┌──────────────────┐</span>
<span class="hljs-meta">│</span>                  <span class="hljs-string">│                                       │                  │</span>
<span class="hljs-meta">│</span>   <span class="hljs-string">TraceContext   │           Http Request Headers        │   TraceContext   │</span>
<span class="hljs-meta">│</span> <span class="hljs-string">┌──────────────┐ │          ┌───────────────────┐        │ ┌──────────────┐ │</span>
<span class="hljs-meta">│</span> <span class="hljs-string">│ TraceId      │ │          │ X─B3─TraceId      │        │ │ TraceId      │ │</span>
<span class="hljs-meta">│</span> <span class="hljs-string">│              │ │          │                   │        │ │              │ │</span>
<span class="hljs-meta">│</span> <span class="hljs-string">│ ParentSpanId │ │ Extract  │ X─B3─ParentSpanId │ Inject │ │ ParentSpanId │ │</span>
<span class="hljs-meta">│</span> <span class="hljs-string">│              ├─┼─────────&gt;│                   ├────────┼&gt;│              │ │</span>
<span class="hljs-meta">│</span> <span class="hljs-string">│ SpanId       │ │          │ X─B3─SpanId       │        │ │ SpanId       │ │</span>
<span class="hljs-meta">│</span> <span class="hljs-string">│              │ │          │                   │        │ │              │ │</span>
<span class="hljs-meta">│</span> <span class="hljs-string">│ Sampled      │ │          │ X─B3─Sampled      │        │ │ Sampled      │ │</span>
<span class="hljs-meta">│</span> <span class="hljs-string">└──────────────┘ │          └───────────────────┘        │ └──────────────┘ │</span>
<span class="hljs-meta">│</span>                  <span class="hljs-string">│                                       │                  │</span>
<span class="hljs-meta">└──────────────────┘</span>                                       <span class="hljs-string">└──────────────────┘</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The names above are from <a href="https://github.com/openzipkin/b3-propagation">B3 Propagation</a>, which is built-in to Brave and has implementations in many languages and frameworks.</p>
</div>
<div class="paragraph">
<p>Most users use a framework interceptor to automate propagation.
The next two examples show how that might work for a client and a server.</p>
</div>
<div class="paragraph">
<p>The following example shows how client-side propagation might work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span> Tracing tracing;

<span class="hljs-comment">// configure a function that injects a trace context into a request</span>
injector = tracing.propagation().injector(Request.Builder::addHeader);

<span class="hljs-comment">// before a request is sent, add the current span's context to it</span>
injector.inject(span.context(), request);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how server-side propagation might work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span> Tracing tracing;
<span class="hljs-meta">@Autowired</span> Tracer tracer;

<span class="hljs-comment">// configure a function that extracts the trace context from a request</span>
extractor = tracing.propagation().extractor(Request::getHeader);

<span class="hljs-comment">// when a server receives a request, it joins or starts a new trace</span>
span = tracer.nextSpan(extractor.extract(request));</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="propagating-extra-fields"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#propagating-extra-fields"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#propagating-extra-fields">153.1. Propagating extra fields</a></h3>
<div class="paragraph">
<p>Sometimes you need to propagate extra fields, such as a request ID or an alternate trace context.
For example, if you are in a Cloud Foundry environment, you might want to pass the request ID, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// when you initialize the builder, define the extra field you want to propagate</span>
Tracing.newBuilder().propagationFactory(
  ExtraFieldPropagation.newFactory(B3Propagation.FACTORY, <span class="hljs-string">"x-vcap-request-id"</span>)
);

<span class="hljs-comment">// later, you can tag that request ID or use it in log correlation</span>
requestId = ExtraFieldPropagation.get(<span class="hljs-string">"x-vcap-request-id"</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may also need to propagate a trace context that you are not using.
For example, you may be in an Amazon Web Services environment but not be reporting data to X-Ray.
To ensure X-Ray can co-exist correctly, pass-through its tracing header, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">tracingBuilder.propagationFactory(
  ExtraFieldPropagation.newFactory(B3Propagation.FACTORY, <span class="hljs-string">"x-amzn-trace-id"</span>)
);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In Spring Cloud Sleuth all elements of the tracing builder <code>Tracing.newBuilder()</code>
are defined as beans. So if you want to pass a custom <code>PropagationFactory</code>, it’s enough
for you to create a bean of that type and we will set it in the <code>Tracing</code> bean.
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="prefixed-fields"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#prefixed-fields"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#prefixed-fields">153.1.1. Prefixed fields</a></h4>
<div class="paragraph">
<p>If they follow a common pattern, you can also prefix fields.
The following example shows how to propagate <code>x-vcap-request-id</code> the field as-is but send the <code>country-code</code> and <code>user-id</code> fields on the wire as <code>x-baggage-country-code</code> and <code>x-baggage-user-id</code>, respectively:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Tracing.newBuilder().propagationFactory(
  ExtraFieldPropagation.newFactoryBuilder(B3Propagation.FACTORY)
                       .addField(<span class="hljs-string">"x-vcap-request-id"</span>)
                       .addPrefixedFields(<span class="hljs-string">"x-baggage-"</span>, Arrays.asList(<span class="hljs-string">"country-code"</span>, <span class="hljs-string">"user-id"</span>))
                       .build()
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Later, you can call the following code to affect the country code of the current trace context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ExtraFieldPropagation.set(<span class="hljs-string">"x-country-code"</span>, <span class="hljs-string">"FO"</span>);
String countryCode = ExtraFieldPropagation.get(<span class="hljs-string">"x-country-code"</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if you have a reference to a trace context, you can use it explicitly, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ExtraFieldPropagation.set(span.context(), <span class="hljs-string">"x-country-code"</span>, <span class="hljs-string">"FO"</span>);
String countryCode = ExtraFieldPropagation.get(span.context(), <span class="hljs-string">"x-country-code"</span>);</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A difference from previous versions of Sleuth is that, with Brave, you must pass the list of baggage keys.
There are the following properties to achieve this.
With the <code>spring.sleuth.baggage-keys</code>, you set keys that get prefixed with <code>baggage-</code> for HTTP calls and <code>baggage_</code> for messaging.
You can also use the <code>spring.sleuth.propagation-keys</code> property to pass a list of prefixed keys that are propagated to remote services without any prefix.
You can also use the <code>spring.sleuth.local-keys</code> property to pass a list keys that will be propagated locally but will not be propagated over the wire.
Notice that there’s no <code>x-</code> in front of the header keys.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In order to automatically set the baggage values to Slf4j’s MDC, you have to set
the <code>spring.sleuth.log.slf4j.whitelisted-mdc-keys</code> property with a list of whitelisted
baggage and propagation keys. E.g. <code>spring.sleuth.log.slf4j.whitelisted-mdc-keys=foo</code> will set the value of the <code>foo</code> baggage into MDC.</p>
</div>
<div class="paragraph">
<p>Note that the extra field is propagated and added to MDC starting with the next downstream trace context. To immediately
add the extra field to MDC in the current trace context, configure the field to flush on update:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs kotlin"><span class="hljs-meta">@Bean</span>
ScopeDecorator mdcScopeDecorator() {
    BaggageField countryCodeField = BaggageField.create(<span class="hljs-string">"x-country-code"</span>);
    <span class="hljs-keyword">return</span> MDCScopeDecorator.newBuilder()
            .clear()
            .add(SingleCorrelationField.newBuilder(countryCodeField)
                    .flushOnUpdate()
                    .build())
            .build();
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Remember that adding entries to MDC can drastically decrease the performance of your application!
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you want to add the baggage entries as tags, to make it possible to search for spans via the baggage entries, you can set the value of
<code>spring.sleuth.propagation.tag.whitelisted-keys</code> with a list of whitelisted baggage keys. To disable the feature you have to pass the <code>spring.sleuth.propagation.tag.enabled=false</code> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="extracting-a-propagated-context"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#extracting-a-propagated-context"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#extracting-a-propagated-context">153.1.2. Extracting a Propagated Context</a></h4>
<div class="paragraph">
<p>The <code>TraceContext.Extractor&lt;C&gt;</code> reads trace identifiers and sampling status from an incoming request or message.
The carrier is usually a request object or headers.</p>
</div>
<div class="paragraph">
<p>This utility is used in standard instrumentation (such as <code>HttpServerHandler</code>) but can also be used for custom RPC or messaging code.</p>
</div>
<div class="paragraph">
<p><code>TraceContextOrSamplingFlags</code> is usually used only with <code>Tracer.nextSpan(extracted)</code>, unless you are
sharing span IDs between a client and a server.</p>
</div>
</div>
<div class="sect3">
<h4 id="sharing-span-ids-between-client-and-server"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sharing-span-ids-between-client-and-server"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sharing-span-ids-between-client-and-server">153.1.3. Sharing span IDs between Client and Server</a></h4>
<div class="paragraph">
<p>A normal instrumentation pattern is to create a span representing the server side of an RPC.
<code>Extractor.extract</code> might return a complete trace context when applied to an incoming client request.
<code>Tracer.joinSpan</code> attempts to continue this trace, using the same span ID if supported or creating a child span
if not. When the span ID is shared, the reported data includes a flag saying so.</p>
</div>
<div class="paragraph">
<p>The following image shows an example of B3 propagation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle">                              ┌───────────────────┐      ┌───────────────────┐
 Incoming Headers             │   TraceContext    │      │   TraceContext    │
┌───────────────────┐(extract)│ ┌───────────────┐ │(<span class="hljs-keyword">join</span>)│ ┌───────────────┐ │
│ X─B3-TraceId      │─────────┼─┼&gt; TraceId      │ │──────┼─┼&gt; TraceId      │ │
│                   │         │ │               │ │      │ │               │ │
│ X─B3-ParentSpanId │─────────┼─┼&gt; ParentSpanId │ │──────┼─┼&gt; ParentSpanId │ │
│                   │         │ │               │ │      │ │               │ │
│ X─B3-SpanId       │─────────┼─┼&gt; SpanId       │ │──────┼─┼&gt; SpanId       │ │
└───────────────────┘         │ │               │ │      │ │               │ │
                              │ │               │ │      │ │  Shared: <span class="hljs-keyword">true</span> │ │
                              │ └───────────────┘ │      │ └───────────────┘ │
                              └───────────────────┘      └───────────────────┘</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some propagation systems forward only the parent span ID, detected when <code>Propagation.Factory.supportsJoin() == false</code>.
In this case, a new span ID is always provisioned, and the incoming context determines the parent ID.</p>
</div>
<div class="paragraph">
<p>The following image shows an example of AWS propagation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle">                              ┌───────────────────┐      ┌───────────────────┐
 x-amzn-trace-id              │   TraceContext    │      │   TraceContext    │
┌───────────────────┐(extract)│ ┌───────────────┐ │(<span class="hljs-keyword">join</span>)│ ┌───────────────┐ │
│ Root              │─────────┼─┼&gt; TraceId      │ │──────┼─┼&gt; TraceId      │ │
│                   │         │ │               │ │      │ │               │ │
│ Parent            │─────────┼─┼&gt; SpanId       │ │──────┼─┼&gt; ParentSpanId │ │
└───────────────────┘         │ └───────────────┘ │      │ │               │ │
                              └───────────────────┘      │ │  SpanId: <span class="hljs-keyword">New</span>  │ │
                                                         │ └───────────────┘ │
                                                         └───────────────────┘</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: Some span reporters do not support sharing span IDs.
For example, if you set <code>Tracing.Builder.spanReporter(amazonXrayOrGoogleStackdrive)</code>, you should disable join by setting <code>Tracing.Builder.supportsJoin(false)</code>.
Doing so forces a new child span on <code>Tracer.joinSpan()</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="implementing-propagation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#implementing-propagation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#implementing-propagation">153.1.4. Implementing Propagation</a></h4>
<div class="paragraph">
<p><code>TraceContext.Extractor&lt;C&gt;</code> is implemented by a <code>Propagation.Factory</code> plugin.
Internally, this code creates the union type, <code>TraceContextOrSamplingFlags</code>, with one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TraceContext</code> if trace and span IDs were present.</p>
</li>
<li>
<p><code>TraceIdContext</code> if a trace ID was present but span IDs were not present.</p>
</li>
<li>
<p><code>SamplingFlags</code> if no identifiers were present.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some <code>Propagation</code> implementations carry extra data from the point of extraction (for example, reading incoming headers) to injection (for example, writing outgoing headers).
For example, it might carry a request ID.
When implementations have extra data, they handle it as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a <code>TraceContext</code> were extracted, add the extra data as <code>TraceContext.extra()</code>.</p>
</li>
<li>
<p>Otherwise, add it as <code>TraceContextOrSamplingFlags.extra()</code>, which <code>Tracer.nextSpan</code> handles.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="current-tracing-component"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#current-tracing-component"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#current-tracing-component">154. Current Tracing Component</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Brave supports a “current tracing component” concept, which should only be used when you have no other way to get a reference.
This was made for JDBC connections, as they often initialize prior to the tracing component.</p>
</div>
<div class="paragraph">
<p>The most recent tracing component instantiated is available through <code>Tracing.current()</code>.
You can also use <code>Tracing.currentTracer()</code> to get only the tracer.
If you use either of these methods, do not cache the result.
Instead, look them up each time you need them.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="current-span"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#current-span"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#current-span">155. Current Span</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Brave supports a “current span” concept which represents the in-flight operation.
You can use <code>Tracer.currentSpan()</code> to add custom tags to a span and <code>Tracer.nextSpan()</code> to create a child of whatever is in-flight.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In Sleuth, you can autowire the <code>Tracer</code> bean to retrieve the current span via
<code>tracer.currentSpan()</code> method. To retrieve the current context just call
<code>tracer.currentSpan().context()</code>. To get the current trace id as String
you can use the <code>traceIdString()</code> method like this: <code>tracer.currentSpan().context().traceIdString()</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="setting-a-span-in-scope-manually"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#setting-a-span-in-scope-manually"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#setting-a-span-in-scope-manually">155.1. Setting a span in scope manually</a></h3>
<div class="paragraph">
<p>When writing new instrumentation, it is important to place a span you created in scope as the current span.
Not only does doing so let users access it with <code>Tracer.currentSpan()</code>, but it also allows customizations such as SLF4J MDC to see the current trace IDs.</p>
</div>
<div class="paragraph">
<p><code>Tracer.withSpanInScope(Span)</code> facilitates this and is most conveniently employed by using the try-with-resources idiom.
Whenever external code might be invoked (such as proceeding an interceptor or otherwise), place the span in scope, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span> Tracer tracer;

<span class="hljs-keyword">try</span> (SpanInScope ws = tracer.withSpanInScope(span)) {
  <span class="hljs-keyword">return</span> inboundRequest.invoke();
} <span class="hljs-keyword">finally</span> { <span class="hljs-comment">// note the scope is independent of the span</span>
  span.finish();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In edge cases, you may need to clear the current span temporarily (for example, launching a task that should not be associated with the current request). To do tso, pass null to <code>withSpanInScope</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span> Tracer tracer;

<span class="hljs-keyword">try</span> (SpanInScope cleared = tracer.withSpanInScope(<span class="hljs-keyword">null</span>)) {
  startBackgroundThread();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="instrumentation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#instrumentation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#instrumentation">156. Instrumentation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Sleuth automatically instruments all your Spring applications, so you should not have to do anything to activate it.
The instrumentation is added by using a variety of technologies according to the stack that is available. For example, for a servlet web application, we use a <code>Filter</code>, and, for Spring Integration, we use <code>ChannelInterceptors</code>.</p>
</div>
<div class="paragraph">
<p>You can customize the keys used in span tags.
To limit the volume of span data, an HTTP request is, by default, tagged only with a handful of metadata, such as the status code, the host, and the URL.
You can add request headers by configuring <code>spring.sleuth.keys.http.headers</code> (a list of header names).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Tags are collected and exported only if there is a <code>Sampler</code> that allows it. By default, there is no such <code>Sampler</code>, to ensure that there is no danger of accidentally collecting too much data without configuring something).
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="span-lifecycle"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#span-lifecycle"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#span-lifecycle">157. Span lifecycle</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can do the following operations on the Span by means of <code>brave.Tracer</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-and-finishing-spans">start</a>: When you start a span, its name is assigned and the start timestamp is recorded.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-and-finishing-spans">close</a>: The span gets finished (the end time of the span is recorded) and, if the span is sampled, it is eligible for collection (for example, to Zipkin).</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#continuing-spans">continue</a>: A new instance of span is created.
It is a copy of the one that it continues.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#continuing-spans">detach</a>: The span does not get stopped or closed.
It only gets removed from the current thread.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-spans-with-explicit-parent">create with explicit parent</a>: You can create a new span and set an explicit parent for it.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Spring Cloud Sleuth creates an instance of <code>Tracer</code> for you. In order to use it, you can autowire it.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="creating-and-finishing-spans"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-and-finishing-spans"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-and-finishing-spans">157.1. Creating and finishing spans</a></h3>
<div class="paragraph">
<p>You can manually create spans by using the <code>Tracer</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// Start a span. If there was a span present in this thread it will become</span>
<span class="hljs-comment">// the `newSpan`'s parent.</span>
Span newSpan = <span class="hljs-keyword">this</span>.tracer.nextSpan().name(<span class="hljs-string">"calculateTax"</span>);
<span class="hljs-keyword">try</span> (Tracer.SpanInScope ws = <span class="hljs-keyword">this</span>.tracer.withSpanInScope(newSpan.start())) {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// You can tag a span</span>
    newSpan.tag(<span class="hljs-string">"taxValue"</span>, taxValue);
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// You can log an event on a span</span>
    newSpan.annotate(<span class="hljs-string">"taxCalculated"</span>);
}
<span class="hljs-keyword">finally</span> {
    <span class="hljs-comment">// Once done remember to finish the span. This will allow collecting</span>
    <span class="hljs-comment">// the span to send it to Zipkin</span>
    newSpan.finish();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, we could see how to create a new instance of the span.
If there is already a span in this thread, it becomes the parent of the new span.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Always clean after you create a span. Also, always finish any span that you want to send to Zipkin.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If your span contains a name greater than 50 chars, that name is truncated to 50 chars.
Your names have to be explicit and concrete. Big names lead to latency issues and sometimes even exceptions.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="continuing-spans"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#continuing-spans"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#continuing-spans">157.2. Continuing Spans</a></h3>
<div class="paragraph">
<p>Sometimes, you do not want to create a new span but you want to continue one. An example of such a
situation might be as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>AOP</strong>: If there was already a span created before an aspect was reached, you might not want to create a new span.</p>
</li>
<li>
<p><strong>Hystrix</strong>: Executing a Hystrix command is most likely a logical part of the current processing.
It is in fact merely a technical implementation detail that you would not necessarily want to reflect in tracing as a separate being.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To continue a span, you can use <code>brave.Tracer</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// let's assume that we're in a thread Y and we've received</span>
<span class="hljs-comment">// the `initialSpan` from thread X</span>
Span continuedSpan = <span class="hljs-keyword">this</span>.tracer.toSpan(newSpan.context());
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// You can tag a span</span>
    continuedSpan.tag(<span class="hljs-string">"taxValue"</span>, taxValue);
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// You can log an event on a span</span>
    continuedSpan.annotate(<span class="hljs-string">"taxCalculated"</span>);
}
<span class="hljs-keyword">finally</span> {
    <span class="hljs-comment">// Once done remember to flush the span. That means that</span>
    <span class="hljs-comment">// it will get reported but the span itself is not yet finished</span>
    continuedSpan.flush();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-spans-with-explicit-parent"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-spans-with-explicit-parent"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-spans-with-explicit-parent">157.3. Creating a Span with an explicit Parent</a></h3>
<div class="paragraph">
<p>You might want to start a new span and provide an explicit parent of that span.
Assume that the parent of a span is in one thread and you want to start a new span in another thread.
In Brave, whenever you call <code>nextSpan()</code>, it creates a span in reference to the span that is currently in scope.
You can put the span in scope and then call <code>nextSpan()</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// let's assume that we're in a thread Y and we've received</span>
<span class="hljs-comment">// the `initialSpan` from thread X. `initialSpan` will be the parent</span>
<span class="hljs-comment">// of the `newSpan`</span>
Span newSpan = <span class="hljs-keyword">null</span>;
<span class="hljs-keyword">try</span> (Tracer.SpanInScope ws = <span class="hljs-keyword">this</span>.tracer.withSpanInScope(initialSpan)) {
    newSpan = <span class="hljs-keyword">this</span>.tracer.nextSpan().name(<span class="hljs-string">"calculateCommission"</span>);
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// You can tag a span</span>
    newSpan.tag(<span class="hljs-string">"commissionValue"</span>, commissionValue);
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// You can log an event on a span</span>
    newSpan.annotate(<span class="hljs-string">"commissionCalculated"</span>);
}
<span class="hljs-keyword">finally</span> {
    <span class="hljs-comment">// Once done remember to finish the span. This will allow collecting</span>
    <span class="hljs-comment">// the span to send it to Zipkin. The tags and events set on the</span>
    <span class="hljs-comment">// newSpan will not be present on the parent</span>
    <span class="hljs-keyword">if</span> (newSpan != <span class="hljs-keyword">null</span>) {
        newSpan.finish();
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
After creating such a span, you must finish it. Otherwise it is not reported (for example, to Zipkin).
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="naming-spans"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#naming-spans"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#naming-spans">158. Naming spans</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Picking a span name is not a trivial task. A span name should depict an operation name.
The name should be low cardinality, so it should not include identifiers.</p>
</div>
<div class="paragraph">
<p>Since there is a lot of instrumentation going on, some span names are artificial:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>controller-method-name</code> when received by a Controller with a method name of <code>controllerMethodName</code></p>
</li>
<li>
<p><code>async</code> for asynchronous operations done with wrapped <code>Callable</code> and <code>Runnable</code> interfaces.</p>
</li>
<li>
<p>Methods annotated with <code>@Scheduled</code> return the simple name of the class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Fortunately, for asynchronous processing, you can provide explicit naming.</p>
</div>
<div class="sect2">
<h3 id="spanname-annotation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spanname-annotation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spanname-annotation">158.1. <code>@SpanName</code> Annotation</a></h3>
<div class="paragraph">
<p>You can name the span explicitly by using the <code>@SpanName</code> annotation, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpanName</span>(<span class="hljs-string">"calculateTax"</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaxCountingRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// perform logic</span>
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, when processed in the following manner, the span is named <code>calculateTax</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Runnable runnable = <span class="hljs-keyword">new</span> TraceRunnable(<span class="hljs-keyword">this</span>.tracing, spanNamer,
        <span class="hljs-keyword">new</span> TaxCountingRunnable());
Future&lt;?&gt; future = executorService.submit(runnable);
<span class="hljs-comment">// ... some additional logic ...</span>
future.get();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tostring-method"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tostring-method"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tostring-method">158.2. <code>toString()</code> method</a></h3>
<div class="paragraph">
<p>It is pretty rare to create separate classes for <code>Runnable</code> or <code>Callable</code>.
Typically, one creates an anonymous instance of those classes.
You cannot annotate such classes.
To overcome that limitation, if there is no <code>@SpanName</code> annotation present, we check whether the class has a custom implementation of the <code>toString()</code> method.</p>
</div>
<div class="paragraph">
<p>Running such code leads to creating a span named <code>calculateTax</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Runnable runnable = <span class="hljs-keyword">new</span> TraceRunnable(<span class="hljs-keyword">this</span>.tracing, spanNamer, <span class="hljs-keyword">new</span> Runnable() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// perform logic</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"calculateTax"</span>;
    }
});
Future&lt;?&gt; future = executorService.submit(runnable);
<span class="hljs-comment">// ... some additional logic ...</span>
future.get();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="managing-spans-with-annotations"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#managing-spans-with-annotations"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#managing-spans-with-annotations">159. Managing Spans with Annotations</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can manage spans with a variety of annotations.</p>
</div>
<div class="sect2">
<h3 id="rationale"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rationale"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rationale">159.1. Rationale</a></h3>
<div class="paragraph">
<p>There are a number of good reasons to manage spans with annotations, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>API-agnostic means to collaborate with a span. Use of annotations lets users add to a span with no library dependency on a span api.
Doing so lets Sleuth change its core API to create less impact to user code.</p>
</li>
<li>
<p>Reduced surface area for basic span operations. Without this feature, you must use the span api, which has lifecycle commands that could be used incorrectly.
By only exposing scope, tag, and log functionality, you can collaborate without accidentally breaking span lifecycle.</p>
</li>
<li>
<p>Collaboration with runtime generated code. With libraries such as Spring Data and Feign, the implementations of interfaces are generated at runtime.
Consequently, span wrapping of objects was tedious.
Now you can provide annotations over interfaces and the arguments of those interfaces.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-new-spans"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-new-spans"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#creating-new-spans">159.2. Creating New Spans</a></h3>
<div class="paragraph">
<p>If you do not want to create local spans manually, you can use the <code>@NewSpan</code> annotation.
Also, we provide the <code>@SpanTag</code> annotation to add tags in an automated fashion.</p>
</div>
<div class="paragraph">
<p>Now we can consider some examples of usage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@NewSpan</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testMethod</span><span class="hljs-params">()</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Annotating the method without any parameter leads to creating a new span whose name equals the annotated method name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@NewSpan</span>(<span class="hljs-string">"customNameOnTestMethod4"</span>)
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testMethod4</span><span class="hljs-params">()</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you provide the value in the annotation (either directly or by setting the <code>name</code> parameter), the created span has the provided value as the name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// method declaration</span>
<span class="hljs-meta">@NewSpan</span>(name = <span class="hljs-string">"customNameOnTestMethod5"</span>)
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testMethod5</span><span class="hljs-params">(@SpanTag(<span class="hljs-string">"testTag"</span>)</span> String param)</span>;

<span class="hljs-comment">// and method execution</span>
<span class="hljs-keyword">this</span>.testBean.testMethod5(<span class="hljs-string">"test"</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can combine both the name and a tag. Let’s focus on the latter.
In this case, the value of the annotated method’s parameter runtime value becomes the value of the tag.
In our sample, the tag key is <code>testTag</code>, and the tag value is <code>test</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@NewSpan</span>(name = <span class="hljs-string">"customNameOnTestMethod3"</span>)
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testMethod3</span><span class="hljs-params">()</span> </span>{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can place the <code>@NewSpan</code> annotation on both the class and an interface.
If you override the interface’s method and provide a different value for the <code>@NewSpan</code> annotation, the most
concrete one wins (in this case <code>customNameOnTestMethod3</code> is set).</p>
</div>
</div>
<div class="sect2">
<h3 id="continuing-spans-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#continuing-spans-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#continuing-spans-2">159.3. Continuing Spans</a></h3>
<div class="paragraph">
<p>If you want to add tags and annotations to an existing span, you can use the <code>@ContinueSpan</code> annotation, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// method declaration</span>
<span class="hljs-meta">@ContinueSpan</span>(log = <span class="hljs-string">"testMethod11"</span>)
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testMethod11</span><span class="hljs-params">(@SpanTag(<span class="hljs-string">"testTag11"</span>)</span> String param)</span>;

<span class="hljs-comment">// method execution</span>
<span class="hljs-keyword">this</span>.testBean.testMethod11(<span class="hljs-string">"test"</span>);
<span class="hljs-keyword">this</span>.testBean.testMethod13();</code></pre>
</div>
</div>
<div class="paragraph">
<p>(Note that, in contrast with the <code>@NewSpan</code> annotation ,you can also add logs with the <code>log</code> parameter.)</p>
</div>
<div class="paragraph">
<p>That way, the span gets continued and:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log entries named <code>testMethod11.before</code> and <code>testMethod11.after</code> are created.</p>
</li>
<li>
<p>If an exception is thrown, a log entry named <code>testMethod11.afterFailure</code> is also created.</p>
</li>
<li>
<p>A tag with a key of <code>testTag11</code> and a value of <code>test</code> is created.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="advanced-tag-setting"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#advanced-tag-setting"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#advanced-tag-setting">159.4. Advanced Tag Setting</a></h3>
<div class="paragraph">
<p>There are 3 different ways to add tags to a span. All of them are controlled by the <code>SpanTag</code> annotation.
The precedence is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Try with a bean of <code>TagValueResolver</code> type and a provided name.</p>
</li>
<li>
<p>If the bean name has not been provided, try to evaluate an expression.
We search for a <code>TagValueExpressionResolver</code> bean.
The default implementation uses SPEL expression resolution.
<strong>IMPORTANT</strong> You can only reference properties from the SPEL expression. Method execution is not allowed due to security constraints.</p>
</li>
<li>
<p>If we do not find any expression to evaluate, return the <code>toString()</code> value of the parameter.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="custom-extractor"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-extractor"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-extractor">159.4.1. Custom extractor</a></h4>
<div class="paragraph">
<p>The value of the tag for the following method is computed by an implementation of <code>TagValueResolver</code> interface.
Its class name has to be passed as the value of the <code>resolver</code> attribute.</p>
</div>
<div class="paragraph">
<p>Consider the following annotated method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@NewSpan</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getAnnotationForTagValueResolver</span><span class="hljs-params">(
        @SpanTag(key = <span class="hljs-string">"test"</span>, resolver = TagValueResolver.class)</span> String test) </span>{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now further consider the following <code>TagValueResolver</code> bean implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>(name = <span class="hljs-string">"myCustomTagValueResolver"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> TagValueResolver <span class="hljs-title">tagValueResolver</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> parameter -&gt; <span class="hljs-string">"Value from myCustomTagValueResolver"</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two preceding examples lead to setting a tag value equal to <code>Value from myCustomTagValueResolver</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="resolving-expressions-for-a-value"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#resolving-expressions-for-a-value"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#resolving-expressions-for-a-value">159.4.2. Resolving Expressions for a Value</a></h4>
<div class="paragraph">
<p>Consider the following annotated method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@NewSpan</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getAnnotationForTagValueExpression</span><span class="hljs-params">(@SpanTag(key = <span class="hljs-string">"test"</span>,
        expression = <span class="hljs-string">"'hello' + ' characters'"</span>)</span> String test) </span>{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>No custom implementation of a <code>TagValueExpressionResolver</code> leads to evaluation of the SPEL expression, and a tag with a value of <code>4 characters</code> is set on the span.
If you want to use some other expression resolution mechanism, you can create your own implementation of the bean.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-the-tostring-method"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-the-tostring-method"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-the-tostring-method">159.4.3. Using the <code>toString()</code> method</a></h4>
<div class="paragraph">
<p>Consider the following annotated method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@NewSpan</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getAnnotationForArgumentToString</span><span class="hljs-params">(@SpanTag(<span class="hljs-string">"test"</span>)</span> Long param) </span>{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running the preceding method with a value of <code>15</code> leads to setting a tag with a String value of <code>"15"</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="customizations"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizations"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizations">160. Customizations</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="customizers"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizers"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizers">160.1. Customizers</a></h3>
<div class="paragraph">
<p>With Brave 5.7 you have various options of providing customizers for your project. Brave ships with</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TracingCustomizer</code> - allows configuration plugins to collaborate on building an instance of <code>Tracing</code>.</p>
</li>
<li>
<p><code>CurrentTraceContextCustomizer</code> - allows configuration plugins to collaborate on building an instance of <code>CurrentTraceContext</code>.</p>
</li>
<li>
<p><code>ExtraFieldCustomizer</code> - allows configuration plugins to collaborate on building an instance of <code>ExtraFieldPropagation.Factory</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sleuth will search for beans of those types and automatically apply customizations.</p>
</div>
</div>
<div class="sect2">
<h3 id="http"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http">160.2. HTTP</a></h3>
<div class="sect3">
<h4 id="data-policy"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#data-policy"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#data-policy">160.2.1. Data Policy</a></h4>
<div class="paragraph">
<p>The default span data policy for HTTP requests is described in Brave:
<a href="https://github.com/openzipkin/brave/tree/master/instrumentation/http#span-data-policy" class="bare">github.com/openzipkin/brave/tree/master/instrumentation/http#span-data-policy</a></p>
</div>
<div class="paragraph">
<p>To add different data to the span, you need to register a bean of type
<code>brave.http.HttpRequestParser</code> or <code>brave.http.HttpResponseParser</code> based on when
the data is collected.</p>
</div>
<div class="paragraph">
<p>The bean names correspond to the request or response side, and whether it is
a client or server. For example, <code>sleuthHttpClientRequestParser</code> changes what
is collected before a client request is sent to the server.</p>
</div>
<div class="paragraph">
<p>For your convenience <code>@HttpClientRequestParser</code>, <code>@HttpClientResponseParser</code>
and corresponding server annotations can be used to inject the proper beans
or to reference the bean names via their static String <code>NAME</code> fields.</p>
</div>
<div class="paragraph">
<p>Here’s an example adding the HTTP url in addition to defaults:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{
  <span class="hljs-meta">@Bean</span>(name = { HttpClientRequestParser.NAME, HttpServerRequestParser.NAME })
  <span class="hljs-function">HttpRequestParser <span class="hljs-title">sleuthHttpServerRequestParser</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">return</span> (req, context, span) -&gt; {
          HttpRequestParser.DEFAULT.parse(req, context, span);
          String url = req.url();
          <span class="hljs-keyword">if</span> (url != <span class="hljs-keyword">null</span>) {
              span.tag(<span class="hljs-string">"http.url"</span>, url);
          }
      };
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sampling-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sampling-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sampling-2">160.2.2. Sampling</a></h4>
<div class="paragraph">
<p>If client /server sampling is required, just register a bean of type
<code>brave.sampler.SamplerFunction&lt;HttpRequest&gt;</code> and name the bean
<code>sleuthHttpClientSampler</code> for client sampler and <code>sleuthHttpServerSampler</code>
for server sampler.</p>
</div>
<div class="paragraph">
<p>For your convenience the <code>@HttpClientSampler</code> and <code>@HttpServerSampler</code>
annotations can be used to inject the proper beans or to reference the bean
names via their static String <code>NAME</code> fields.</p>
</div>
<div class="paragraph">
<p>Check out Brave’s code to see an example of how to make a path-based sampler
<a href="https://github.com/openzipkin/brave/tree/master/instrumentation/http#sampling-policy" class="bare">github.com/openzipkin/brave/tree/master/instrumentation/http#sampling-policy</a></p>
</div>
<div class="paragraph">
<p>If you want to completely rewrite the <code>HttpTracing</code> bean you can use the <code>SkipPatternProvider</code>
interface to retrieve the URL <code>Pattern</code> for spans that should be not sampled. Below you can see
an example of usage of <code>SkipPatternProvider</code> inside a server side, <code>Sampler&lt;HttpRequest&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{
  <span class="hljs-meta">@Bean</span>(name = HttpServerSampler.NAME)
  <span class="hljs-function">SamplerFunction&lt;HttpRequest&gt; <span class="hljs-title">myHttpSampler</span><span class="hljs-params">(SkipPatternProvider provider)</span> </span>{
      Pattern pattern = provider.skipPattern();
      <span class="hljs-keyword">return</span> request -&gt; {
          String url = request.path();
          <span class="hljs-keyword">boolean</span> shouldSkip = pattern.matcher(url).matches();
          <span class="hljs-keyword">if</span> (shouldSkip) {
              <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
          }
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
      };
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tracingfilter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tracingfilter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#tracingfilter">160.3. <code>TracingFilter</code></a></h3>
<div class="paragraph">
<p>You can also modify the behavior of the <code>TracingFilter</code>, which is the component that is responsible for processing the input HTTP request and adding tags basing on the HTTP response.
You can customize the tags or modify the response headers by registering your own instance of the <code>TracingFilter</code> bean.</p>
</div>
<div class="paragraph">
<p>In the following example, we register the <code>TracingFilter</code> bean, add the <code>ZIPKIN-TRACE-ID</code> response header containing the current Span’s trace id, and add a tag with key <code>custom</code> and a value <code>tag</code> to the span.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Order</span>(TraceWebServletAutoConfiguration.TRACING_FILTER_ORDER + <span class="hljs-number">1</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GenericFilterBean</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Tracer tracer;

    MyFilter(Tracer tracer) {
        <span class="hljs-keyword">this</span>.tracer = tracer;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response,
            FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{
        Span currentSpan = <span class="hljs-keyword">this</span>.tracer.currentSpan();
        <span class="hljs-keyword">if</span> (currentSpan == <span class="hljs-keyword">null</span>) {
            chain.doFilter(request, response);
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-comment">// for readability we're returning trace id in a hex form</span>
        ((HttpServletResponse) response).addHeader(<span class="hljs-string">"ZIPKIN-TRACE-ID"</span>,
                currentSpan.context().traceIdString());
        <span class="hljs-comment">// we can also add some custom tags</span>
        currentSpan.tag(<span class="hljs-string">"custom"</span>, <span class="hljs-string">"tag"</span>);
        chain.doFilter(request, response);
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="messaging-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#messaging-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#messaging-2">160.4. Messaging</a></h3>
<div class="paragraph">
<p>Sleuth automatically configures the <code>MessagingTracing</code> bean which serves as a
foundation for Messaging instrumentation such as Kafka or JMS.</p>
</div>
<div class="paragraph">
<p>If a customization of producer / consumer sampling of messaging traces is required,
just register a bean of type <code>brave.sampler.SamplerFunction&lt;MessagingRequest&gt;</code> and
name the bean <code>sleuthProducerSampler</code> for producer sampler and <code>sleuthConsumerSampler</code>
for consumer sampler.</p>
</div>
<div class="paragraph">
<p>For your convenience the <code>@ProducerSampler</code> and <code>@ConsumerSampler</code>
annotations can be used to inject the proper beans or to reference the bean
names via their static String <code>NAME</code> fields.</p>
</div>
<div class="paragraph">
<p>Ex. Here’s a sampler that traces 100 consumer requests per second, except for
the "alerts" channel. Other requests will use a global rate provided by the
<code>Tracing</code> component.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more, see <a href="https://github.com/openzipkin/brave/tree/master/instrumentation/messaging#sampling-policy" class="bare">github.com/openzipkin/brave/tree/master/instrumentation/messaging#sampling-policy</a></p>
</div>
<div class="sect3">
<h4 id="customizing-messaging-spans"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-messaging-spans"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-messaging-spans">160.4.1. Customizing messaging spans</a></h4>
<div class="paragraph">
<p>In order to change the default span names and tags, just register a bean of type <code>MessageSpanCustomizer</code>. You can also
override the existing <code>DefaultMessageSpanCustomizer</code> to extend the existing behaviour.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Component</span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyMessageSpanCustomizer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DefaultMessageSpanCustomizer</span> </span>{
      <span class="hljs-meta">@Override</span>
      <span class="hljs-function"><span class="hljs-keyword">public</span> SpanCustomizer <span class="hljs-title">customizeHandle</span><span class="hljs-params">(SpanCustomizer spanCustomizer,
              Message&lt;?&gt; message, MessageChannel messageChannel)</span> </span>{
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.customizeHandle(spanCustomizer, message, messageChannel)
                  .name(<span class="hljs-string">"changedHandle"</span>)
                  .tag(<span class="hljs-string">"handleKey"</span>, <span class="hljs-string">"handleValue"</span>)
                  .tag(<span class="hljs-string">"channelName"</span>, channelName(messageChannel));
      }

      <span class="hljs-meta">@Override</span>
      <span class="hljs-function"><span class="hljs-keyword">public</span> SpanCustomizer <span class="hljs-title">customizeSend</span><span class="hljs-params">(SpanCustomizer spanCustomizer,
              Message&lt;?&gt; message, MessageChannel messageChannel)</span> </span>{
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.customizeSend(spanCustomizer, message, messageChannel)
                  .name(<span class="hljs-string">"changedSend"</span>)
                  .tag(<span class="hljs-string">"sendKey"</span>, <span class="hljs-string">"sendValue"</span>)
                  .tag(<span class="hljs-string">"channelName"</span>, channelName(messageChannel));
      }
  }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rpc"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rpc"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rpc">160.5. RPC</a></h3>
<div class="paragraph">
<p>Sleuth automatically configures the <code>RpcTracing</code> bean which serves as a
foundation for RPC instrumentation such as gRPC or Dubbo.</p>
</div>
<div class="paragraph">
<p>If a customization of client / server sampling of the RPC traces is required,
just register a bean of type <code>brave.sampler.SamplerFunction&lt;RpcRequest&gt;</code> and
name the bean <code>sleuthRpcClientSampler</code> for client sampler and
<code>sleuthRpcServerSampler</code> for server sampler.</p>
</div>
<div class="paragraph">
<p>For your convenience the <code>@RpcClientSampler</code> and <code>@RpcServerSampler</code>
annotations can be used to inject the proper beans or to reference the bean
names via their static String <code>NAME</code> fields.</p>
</div>
<div class="paragraph">
<p>Ex. Here’s a sampler that traces 100 "GetUserToken" server requests per second.
This doesn’t start new traces for requests to the health check service. Other
requests will use the global sampling configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{
  <span class="hljs-meta">@Bean</span>(name = RpcServerSampler.NAME)
  <span class="hljs-function">SamplerFunction&lt;RpcRequest&gt; <span class="hljs-title">myRpcSampler</span><span class="hljs-params">()</span> </span>{
      Matcher&lt;RpcRequest&gt; userAuth = and(serviceEquals(<span class="hljs-string">"users.UserService"</span>),
              methodEquals(<span class="hljs-string">"GetUserToken"</span>));
      <span class="hljs-keyword">return</span> RpcRuleSampler.newBuilder()
              .putRule(serviceEquals(<span class="hljs-string">"grpc.health.v1.Health"</span>), Sampler.NEVER_SAMPLE)
              .putRule(userAuth, RateLimitingSampler.create(<span class="hljs-number">100</span>)).build();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more, see <a href="https://github.com/openzipkin/brave/tree/master/instrumentation/rpc#sampling-policy" class="bare">github.com/openzipkin/brave/tree/master/instrumentation/rpc#sampling-policy</a></p>
</div>
</div>
<div class="sect2">
<h3 id="custom-service-name"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-service-name"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-service-name">160.6. Custom service name</a></h3>
<div class="paragraph">
<p>By default, Sleuth assumes that, when you send a span to Zipkin, you want the span’s service name to be equal to the value of the <code>spring.application.name</code> property.
That is not always the case, though.
There are situations in which you want to explicitly provide a different service name for all spans coming from your application.
To achieve that, you can pass the following property to your application to override that value (the example is for a service named <code>myService</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.zipkin.service.name: myService</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="customization-of-reported-spans"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customization-of-reported-spans"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customization-of-reported-spans">160.7. Customization of Reported Spans</a></h3>
<div class="paragraph">
<p>Before reporting spans (for example, to Zipkin) you may want to modify that span in some way.
You can do so by implementing a <code>SpanHandler</code>.</p>
</div>
<div class="paragraph">
<p>In Sleuth, we generate spans with a fixed name.
Some users want to modify the name depending on values of tags.
You can implement the <code>SpanHandler</code> interface to alter that name.</p>
</div>
<div class="paragraph">
<p>The following example shows how to register two beans that implement <code>SpanHandler</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function">SpanHandler <span class="hljs-title">handlerOne</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SpanHandler() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">end</span><span class="hljs-params">(TraceContext traceContext, MutableSpan span,
                Cause cause)</span> </span>{
            span.name(<span class="hljs-string">"foo"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>; <span class="hljs-comment">// keep this span</span>
        }
    };
}

<span class="hljs-meta">@Bean</span>
<span class="hljs-function">SpanHandler <span class="hljs-title">handlerTwo</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SpanHandler() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">end</span><span class="hljs-params">(TraceContext traceContext, MutableSpan span,
                Cause cause)</span> </span>{
            span.name(span.name() + <span class="hljs-string">" bar"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>; <span class="hljs-comment">// keep this span</span>
        }
    };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding example results in changing the name of the reported span to <code>foo bar</code>, just before it gets reported (for example, to Zipkin).</p>
</div>
</div>
<div class="sect2">
<h3 id="host-locator"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#host-locator"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#host-locator">160.8. Host Locator</a></h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This section is about defining <strong>host</strong> from service discovery.
It is <strong>NOT</strong> about finding Zipkin through service discovery.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To define the host that corresponds to a particular span, we need to resolve the host name and port.
The default approach is to take these values from server properties.
If those are not set, we try to retrieve the host name from the network interfaces.</p>
</div>
<div class="paragraph">
<p>If you have the discovery client enabled and prefer to retrieve the host address from the registered instance in a service registry, you have to set the <code>spring.zipkin.locator.discovery.enabled</code> property (it is applicable for both HTTP-based and Stream-based span reporting), as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.zipkin.locator.discovery.enabled: true</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sending-spans-to-zipkin"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-spans-to-zipkin"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-spans-to-zipkin">161. Sending Spans to Zipkin</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, if you add <code>spring-cloud-starter-zipkin</code> as a dependency to your project, when the span is closed, it is sent to Zipkin over HTTP.
The communication is asynchronous.
You can configure the URL by setting the <code>spring.zipkin.baseUrl</code> property, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.zipkin.baseUrl: https://192.168.99.100:9411/</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to find Zipkin through service discovery, you can pass the Zipkin’s service ID inside the URL, as shown in the following example for <code>zipkinserver</code> service ID:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.zipkin.baseUrl: https://zipkinserver/</code></pre>
</div>
</div>
<div class="paragraph">
<p>To disable this feature just set <code>spring.zipkin.discoveryClientEnabled</code> to `false.</p>
</div>
<div class="paragraph">
<p>When the Discovery Client feature is enabled, Sleuth uses
<code>LoadBalancerClient</code> to find the URL of the Zipkin Server. It means
that you can set up the load balancing configuration e.g. via Ribbon.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">zipkinserver:
  ribbon:
    ListOfServers: host1,host2</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have web, rabbit, activemq or kafka together on the classpath, you might need to pick the means by which you would like to send spans to zipkin.
To do so, set <code>web</code>, <code>rabbit</code>, <code>activemq</code> or <code>kafka</code> to the <code>spring.zipkin.sender.type</code> property.
The following example shows setting the sender type for <code>web</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.zipkin.sender.type: web</code></pre>
</div>
</div>
<div class="paragraph">
<p>To customize the <code>RestTemplate</code> that sends spans to Zipkin via HTTP, you can register
the <code>ZipkinRestTemplateCustomizer</code> bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfig</span> </span>{
    <span class="hljs-meta">@Bean</span> <span class="hljs-function">ZipkinRestTemplateCustomizer <span class="hljs-title">myCustomizer</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ZipkinRestTemplateCustomizer() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">customize</span><span class="hljs-params">(RestTemplate restTemplate)</span> </span>{
                <span class="hljs-comment">// customize the RestTemplate</span>
            }
        };
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If, however, you would like to control the full process of creating the <code>RestTemplate</code>
object, you will have to create a bean of <code>zipkin2.reporter.Sender</code> type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    <span class="hljs-meta">@Bean</span> <span class="hljs-function">Sender <span class="hljs-title">myRestTemplateSender</span><span class="hljs-params">(ZipkinProperties zipkin,
            ZipkinRestTemplateCustomizer zipkinRestTemplateCustomizer)</span> </span>{
        RestTemplate restTemplate = mySuperCustomRestTemplate();
        zipkinRestTemplateCustomizer.customize(restTemplate);
        <span class="hljs-keyword">return</span> myCustomSender(zipkin, restTemplate);
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="zipkin-stream-span-consumer"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zipkin-stream-span-consumer"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zipkin-stream-span-consumer">162. Zipkin Stream Span Consumer</a></h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
We recommend using Zipkin’s native support for message-based span sending.
Starting from the Edgware release, the Zipkin Stream server is deprecated.
In the Finchley release, it got removed.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If for some reason you need to create the deprecated Stream Zipkin server, see the <a href="https://cloud.spring.io/spring-cloud-static/Dalston.SR4/multi/multi__span_data_as_messages.html#_zipkin_consumer">Dalston Documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="integrations"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#integrations"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#integrations">163. Integrations</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="opentracing"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#opentracing"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#opentracing">163.1. OpenTracing</a></h3>
<div class="paragraph">
<p>Spring Cloud Sleuth is compatible with <a href="https://opentracing.io/">OpenTracing</a>.
If you have OpenTracing on the classpath, we automatically register the OpenTracing <code>Tracer</code> bean.
If you wish to disable this, set <code>spring.sleuth.opentracing.enabled</code> to <code>false</code></p>
</div>
</div>
<div class="sect2">
<h3 id="runnable-and-callable"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#runnable-and-callable"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#runnable-and-callable">163.2. Runnable and Callable</a></h3>
<div class="paragraph">
<p>If you wrap your logic in <code>Runnable</code> or <code>Callable</code>, you can wrap those classes in their Sleuth representative, as shown in the following example for <code>Runnable</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Runnable runnable = <span class="hljs-keyword">new</span> Runnable() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// do some work</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"spanNameFromToStringMethod"</span>;
    }
};
<span class="hljs-comment">// Manual `TraceRunnable` creation with explicit "calculateTax" Span name</span>
Runnable traceRunnable = <span class="hljs-keyword">new</span> TraceRunnable(<span class="hljs-keyword">this</span>.tracing, spanNamer, runnable,
        <span class="hljs-string">"calculateTax"</span>);
<span class="hljs-comment">// Wrapping `Runnable` with `Tracing`. That way the current span will be available</span>
<span class="hljs-comment">// in the thread of `Runnable`</span>
Runnable traceRunnableFromTracer = <span class="hljs-keyword">this</span>.tracing.currentTraceContext()
        .wrap(runnable);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to do so for <code>Callable</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Callable&lt;String&gt; callable = <span class="hljs-keyword">new</span> Callable&lt;String&gt;() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-keyword">return</span> someLogic();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"spanNameFromToStringMethod"</span>;
    }
};
<span class="hljs-comment">// Manual `TraceCallable` creation with explicit "calculateTax" Span name</span>
Callable&lt;String&gt; traceCallable = <span class="hljs-keyword">new</span> TraceCallable&lt;&gt;(<span class="hljs-keyword">this</span>.tracing, spanNamer,
        callable, <span class="hljs-string">"calculateTax"</span>);
<span class="hljs-comment">// Wrapping `Callable` with `Tracing`. That way the current span will be available</span>
<span class="hljs-comment">// in the thread of `Callable`</span>
Callable&lt;String&gt; traceCallableFromTracer = <span class="hljs-keyword">this</span>.tracing.currentTraceContext()
        .wrap(callable);</code></pre>
</div>
</div>
<div class="paragraph">
<p>That way, you ensure that a new span is created and closed for each execution.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-circuitbreaker"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-circuitbreaker"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-circuitbreaker">163.3. Spring Cloud CircuitBreaker</a></h3>
<div class="paragraph">
<p>If you have Spring Cloud CircuitBreaker on the classpath, we will wrap the passed command <code>Supplier</code> and the fallback <code>Function</code> in its trace representations. In order to disable this instrumentation set <code>spring.sleuth.circuitbreaker.enabled</code> to <code>false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="hystrix-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#hystrix-2">163.4. Hystrix</a></h3>
<div class="sect3">
<h4 id="custom-concurrency-strategy"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-concurrency-strategy"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-concurrency-strategy">163.4.1. Custom Concurrency Strategy</a></h4>
<div class="paragraph">
<p>We register a custom <a href="https://github.com/Netflix/Hystrix/wiki/Plugins#concurrencystrategy"><code>HystrixConcurrencyStrategy</code></a> called <code>TraceCallable</code> that wraps all <code>Callable</code> instances in their Sleuth representative.
The strategy either starts or continues a span, depending on whether tracing was already going on before the Hystrix command was called.
Optionally, you can set <code>spring.sleuth.hystrix.strategy.passthrough</code> to <code>true</code> to just propagate the trace context to the Hystrix execution thread if you don’t wish to start a new span.
To disable the custom Hystrix Concurrency Strategy, set the <code>spring.sleuth.hystrix.strategy.enabled</code> to <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="manual-command-setting"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#manual-command-setting"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#manual-command-setting">163.4.2. Manual Command setting</a></h4>
<div class="paragraph">
<p>Assume that you have the following <code>HystrixCommand</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HystrixCommand&lt;String&gt; hystrixCommand = <span class="hljs-keyword">new</span> HystrixCommand&lt;String&gt;(setter) {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> String <span class="hljs-title">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-keyword">return</span> someLogic();
    }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>To pass the tracing information, you have to wrap the same logic in the Sleuth version of the <code>HystrixCommand</code>, which is called
<code>TraceCommand</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">TraceCommand&lt;String&gt; traceCommand = <span class="hljs-keyword">new</span> TraceCommand&lt;String&gt;(tracer, setter) {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">doRun</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-keyword">return</span> someLogic();
    }
};</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rxjava"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rxjava"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#rxjava">163.5. RxJava</a></h3>
<div class="paragraph">
<p>We registering a custom <a href="https://github.com/ReactiveX/RxJava/wiki/Plugins#rxjavaschedulershook"><code>RxJavaSchedulersHook</code></a> that wraps all <code>Action0</code> instances in their Sleuth representative, which is called <code>TraceAction</code>.
The hook either starts or continues a span, depending on whether tracing was already going on before the Action was scheduled.
To disable the custom <code>RxJavaSchedulersHook</code>, set the <code>spring.sleuth.rxjava.schedulers.hook.enabled</code> to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>You can define a list of regular expressions for thread names for which you do not want spans to be created.
To do so, provide a comma-separated list of regular expressions in the <code>spring.sleuth.rxjava.schedulers.ignoredthreads</code> property.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The suggest approach to reactive programming and Sleuth is to use
the Reactor support.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="http-integration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-integration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-integration">163.6. HTTP integration</a></h3>
<div class="paragraph">
<p>Features from this section can be disabled by setting the <code>spring.sleuth.web.enabled</code> property with value equal to <code>false</code>.</p>
</div>
<div class="sect3">
<h4 id="http-filter"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-filter"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-filter">163.6.1. HTTP Filter</a></h4>
<div class="paragraph">
<p>Through the <code>TracingFilter</code>, all sampled incoming requests result in creation of a Span.
That Span’s name is <code>http:</code> + the path to which the request was sent.
For example, if the request was sent to <code>/this/that</code> then the name will be <code>http:/this/that</code>.
You can configure which URIs you would like to skip by setting the <code>spring.sleuth.web.skipPattern</code> property.
If you have <code>ManagementServerProperties</code> on classpath, its value of <code>contextPath</code> gets appended to the provided skip pattern.
If you want to reuse the Sleuth’s default skip patterns and just append your own, pass those patterns by using the <code>spring.sleuth.web.additionalSkipPattern</code>.</p>
</div>
<div class="paragraph">
<p>By default, all the spring boot actuator endpoints are automatically added to the skip pattern.
If you want to disable this behaviour set <code>spring.sleuth.web.ignore-auto-configured-skip-patterns</code>
to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>To change the order of tracing filter registration, please set the
<code>spring.sleuth.web.filter-order</code> property.</p>
</div>
<div class="paragraph">
<p>To disable the filter that logs uncaught exceptions you can disable the
<code>spring.sleuth.web.exception-throwing-filter-enabled</code> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="handlerinterceptor"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#handlerinterceptor"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#handlerinterceptor">163.6.2. HandlerInterceptor</a></h4>
<div class="paragraph">
<p>Since we want the span names to be precise, we use a <code>TraceHandlerInterceptor</code> that either wraps an existing <code>HandlerInterceptor</code> or is added directly to the list of existing <code>HandlerInterceptors</code>.
The <code>TraceHandlerInterceptor</code> adds a special request attribute to the given <code>HttpServletRequest</code>.
If the the <code>TracingFilter</code> does not see this attribute, it creates a “fallback” span, which is an additional span created on the server side so that the trace is presented properly in the UI.
If that happens, there is probably missing instrumentation.
In that case, please file an issue in Spring Cloud Sleuth.</p>
</div>
</div>
<div class="sect3">
<h4 id="async-servlet-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#async-servlet-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#async-servlet-support">163.6.3. Async Servlet support</a></h4>
<div class="paragraph">
<p>If your controller returns a <code>Callable</code> or a <code>WebAsyncTask</code>, Spring Cloud Sleuth continues the existing span instead of creating a new one.</p>
</div>
</div>
<div class="sect3">
<h4 id="webflux-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#webflux-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#webflux-support">163.6.4. WebFlux support</a></h4>
<div class="paragraph">
<p>Through <code>TraceWebFilter</code>, all sampled incoming requests result in creation of a Span.
That Span’s name is <code>http:</code> + the path to which the request was sent.
For example, if the request was sent to <code>/this/that</code>, the name is <code>http:/this/that</code>.
You can configure which URIs you would like to skip by using the <code>spring.sleuth.web.skipPattern</code> property.
If you have <code>ManagementServerProperties</code> on the classpath, its value of <code>contextPath</code> gets appended to the provided skip pattern.
If you want to reuse Sleuth’s default skip patterns and append your own, pass those patterns by using the <code>spring.sleuth.web.additionalSkipPattern</code>.</p>
</div>
<div class="paragraph">
<p>To change the order of tracing filter registration, please set the
<code>spring.sleuth.web.filter-order</code> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="dubbo-rpc-support"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dubbo-rpc-support"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dubbo-rpc-support">163.6.5. Dubbo RPC support</a></h4>
<div class="paragraph">
<p>Via the integration with Brave, Spring Cloud Sleuth supports <a href="https://dubbo.apache.org/">Dubbo</a>.
It’s enough to add the <code>brave-instrumentation-dubbo</code> dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.zipkin.brave<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>brave-instrumentation-dubbo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to also set a <code>dubbo.properties</code> file with the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"><span class="hljs-meta">dubbo.provider.filter</span>=<span class="hljs-string">tracing</span>
<span class="hljs-meta">dubbo.consumer.filter</span>=<span class="hljs-string">tracing</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can read more about Brave - Dubbo integration <a href="https://github.com/openzipkin/brave/tree/master/instrumentation/dubbo-rpc">here</a>.
An example of Spring Cloud Sleuth and Dubbo can be found <a href="https://github.com/openzipkin/sleuth-webmvc-example/compare/add-dubbo-tracing">here</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="http-client-integration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-client-integration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#http-client-integration">163.7. HTTP Client Integration</a></h3>
<div class="sect3">
<h4 id="synchronous-rest-template"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#synchronous-rest-template"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#synchronous-rest-template">163.7.1. Synchronous Rest Template</a></h4>
<div class="paragraph">
<p>We inject a <code>RestTemplate</code> interceptor to ensure that all the tracing information is passed to the requests.
Each time a call is made, a new Span is created.
It gets closed upon receiving the response.
To block the synchronous <code>RestTemplate</code> features, set <code>spring.sleuth.web.client.enabled</code> to <code>false</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You have to register <code>RestTemplate</code> as a bean so that the interceptors get injected.
If you create a <code>RestTemplate</code> instance with a <code>new</code> keyword, the instrumentation does NOT work.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="asynchronous-rest-template"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#asynchronous-rest-template"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#asynchronous-rest-template">163.7.2. Asynchronous Rest Template</a></h4>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Starting with Sleuth <code>2.0.0</code>, we no longer register a bean of <code>AsyncRestTemplate</code> type.
It is up to you to create such a bean.
Then we instrument it.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To block the <code>AsyncRestTemplate</code> features, set <code>spring.sleuth.web.async.client.enabled</code> to <code>false</code>.
To disable creation of the default <code>TraceAsyncClientHttpRequestFactoryWrapper</code>, set <code>spring.sleuth.web.async.client.factory.enabled</code>
to <code>false</code>.
If you do not want to create <code>AsyncRestClient</code> at all, set <code>spring.sleuth.web.async.client.template.enabled</code> to <code>false</code>.</p>
</div>
<div class="sect4">
<h5 id="multiple-asynchronous-rest-templates"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#multiple-asynchronous-rest-templates"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#multiple-asynchronous-rest-templates">Multiple Asynchronous Rest Templates</a></h5>
<div class="paragraph">
<p>Sometimes you need to use multiple implementations of the Asynchronous Rest Template.
In the following snippet, you can see an example of how to set up such a custom <code>AsyncRestTemplate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAutoConfiguration</span>
<span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>{

    <span class="hljs-meta">@Bean</span>(name = <span class="hljs-string">"customAsyncRestTemplate"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> AsyncRestTemplate <span class="hljs-title">traceAsyncRestTemplate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AsyncRestTemplate(asyncClientFactory(),
                clientHttpRequestFactory());
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> ClientHttpRequestFactory <span class="hljs-title">clientHttpRequestFactory</span><span class="hljs-params">()</span> </span>{
        ClientHttpRequestFactory clientHttpRequestFactory = <span class="hljs-keyword">new</span> CustomClientHttpRequestFactory();
        <span class="hljs-comment">// CUSTOMIZE HERE</span>
        <span class="hljs-keyword">return</span> clientHttpRequestFactory;
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> AsyncClientHttpRequestFactory <span class="hljs-title">asyncClientFactory</span><span class="hljs-params">()</span> </span>{
        AsyncClientHttpRequestFactory factory = <span class="hljs-keyword">new</span> CustomAsyncClientHttpRequestFactory();
        <span class="hljs-comment">// CUSTOMIZE HERE</span>
        <span class="hljs-keyword">return</span> factory;
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="webclient"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#webclient"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#webclient">163.7.3. <code>WebClient</code></a></h4>
<div class="paragraph">
<p>We inject a <code>ExchangeFilterFunction</code> implementation that creates a span and, through on-success and on-error callbacks, takes care of closing client-side spans.</p>
</div>
<div class="paragraph">
<p>To block this feature, set <code>spring.sleuth.web.client.enabled</code> to <code>false</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You have to register either a <code>WebClient</code> or <code>WebClient.Builder</code> as a bean so that the tracing instrumentation gets applied.
If you manually create a <code>WebClient</code> or <code>WebClient.Builder</code>, the instrumentation does NOT work.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="traverson"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#traverson"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#traverson">163.7.4. Traverson</a></h4>
<div class="paragraph">
<p>If you use the <a href="https://docs.spring.io/spring-hateoas/docs/current/reference/html/#client.traverson">Traverson</a> library, you can inject a <code>RestTemplate</code> as a bean into your Traverson object.
Since <code>RestTemplate</code> is already intercepted, you get full support for tracing in your client. The following pseudo code
shows how to do that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span> RestTemplate restTemplate;

Traverson traverson = <span class="hljs-keyword">new</span> Traverson(URI.create(<span class="hljs-string">"https://some/address"</span>),
    MediaType.APPLICATION_JSON, MediaType.APPLICATION_JSON_UTF8).setRestOperations(restTemplate);
<span class="hljs-comment">// use Traverson</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="apache-httpclientbuilder-and-httpasyncclientbuilder"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#apache-httpclientbuilder-and-httpasyncclientbuilder"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#apache-httpclientbuilder-and-httpasyncclientbuilder">163.7.5. Apache <code>HttpClientBuilder</code> and <code>HttpAsyncClientBuilder</code></a></h4>
<div class="paragraph">
<p>We instrument the <code>HttpClientBuilder</code> and <code>HttpAsyncClientBuilder</code> so that
tracing context gets injected to the sent requests.</p>
</div>
<div class="paragraph">
<p>To block these features, set <code>spring.sleuth.web.client.enabled</code> to <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="netty-httpclient"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netty-httpclient"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#netty-httpclient">163.7.6. Netty <code>HttpClient</code></a></h4>
<div class="paragraph">
<p>We instrument the Netty’s <code>HttpClient</code>.</p>
</div>
<div class="paragraph">
<p>To block this feature, set <code>spring.sleuth.web.client.enabled</code> to <code>false</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You have to register <code>HttpClient</code> as a bean so that the instrumentation happens.
If you create a <code>HttpClient</code> instance with a <code>new</code> keyword, the instrumentation does NOT work.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="userinforesttemplatecustomizer"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#userinforesttemplatecustomizer"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#userinforesttemplatecustomizer">163.7.7. <code>UserInfoRestTemplateCustomizer</code></a></h4>
<div class="paragraph">
<p>We instrument the Spring Security’s <code>UserInfoRestTemplateCustomizer</code>.</p>
</div>
<div class="paragraph">
<p>To block this feature, set <code>spring.sleuth.web.client.enabled</code> to <code>false</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="feign"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#feign">163.8. Feign</a></h3>
<div class="paragraph">
<p>By default, Spring Cloud Sleuth provides integration with Feign through <code>TraceFeignClientAutoConfiguration</code>.
You can disable it entirely by setting <code>spring.sleuth.feign.enabled</code> to <code>false</code>.
If you do so, no Feign-related instrumentation take place.</p>
</div>
<div class="paragraph">
<p>Part of Feign instrumentation is done through a <code>FeignBeanPostProcessor</code>.
You can disable it by setting <code>spring.sleuth.feign.processor.enabled</code> to <code>false</code>.
If you set it to <code>false</code>, Spring Cloud Sleuth does not instrument any of your custom Feign components.
However, all the default instrumentation is still there.</p>
</div>
</div>
<div class="sect2">
<h3 id="grpc"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#grpc"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#grpc">163.9. gRPC</a></h3>
<div class="paragraph">
<p>Spring Cloud Sleuth provides instrumentation for <a href="https://grpc.io/">gRPC</a> through <code>TraceGrpcAutoConfiguration</code>. You can disable it entirely by setting <code>spring.sleuth.grpc.enabled</code> to <code>false</code>.</p>
</div>
<div class="sect3">
<h4 id="variant-1"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#variant-1"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#variant-1">163.9.1. Variant 1</a></h4>
<div class="sect4">
<h5 id="dependencies"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dependencies"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#dependencies">Dependencies</a></h5>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The gRPC integration relies on two external libraries to instrument clients and servers and both of those libraries must be on the class path to enable the instrumentation.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.lognet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>grpc-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.zipkin.brave<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>brave-instrumentation-grpc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css">    <span class="hljs-selector-tag">compile</span>("<span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.lognet</span><span class="hljs-selector-pseudo">:grpc-spring-boot-starter")</span>
    <span class="hljs-selector-tag">compile</span>("<span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.zipkin</span><span class="hljs-selector-class">.brave</span><span class="hljs-selector-pseudo">:brave-instrumentation-grpc")</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="server-instrumentation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#server-instrumentation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#server-instrumentation">Server Instrumentation</a></h5>
<div class="paragraph">
<p>Spring Cloud Sleuth leverages grpc-spring-boot-starter to register Brave’s gRPC server interceptor with all services annotated with <code>@GRpcService</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="client-instrumentation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#client-instrumentation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#client-instrumentation">Client Instrumentation</a></h5>
<div class="paragraph">
<p>gRPC clients leverage a <code>ManagedChannelBuilder</code> to construct a <code>ManagedChannel</code> used to communicate to the gRPC server. The native <code>ManagedChannelBuilder</code> provides static methods as entry points for construction of <code>ManagedChannel</code> instances, however, this mechanism is outside the influence of the Spring application context.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Spring Cloud Sleuth provides a <code>SpringAwareManagedChannelBuilder</code> that can be customized through the Spring application context and injected by gRPC clients. <strong>This builder must be used when creating <code>ManagedChannel</code> instances.</strong>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Sleuth creates a <code>TracingManagedChannelBuilderCustomizer</code> which inject Brave’s client interceptor into the <code>SpringAwareManagedChannelBuilder</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="variant-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#variant-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#variant-2">163.9.2. Variant 2</a></h4>
<div class="paragraph">
<p><a href="https://github.com/yidongnan/grpc-spring-boot-starter">Grpc Spring Boot Starter</a> automatically detects the presence of Spring Cloud Sleuth and brave’s instrumentation for gRPC and registers the necessary client and/or server tooling.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="asynchronous-communication"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#asynchronous-communication"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#asynchronous-communication">163.10. Asynchronous Communication</a></h3>
<div class="sect3">
<h4 id="async-annotated-methods"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#async-annotated-methods"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#async-annotated-methods">163.10.1. <code>@Async</code> Annotated methods</a></h4>
<div class="paragraph">
<p>In Spring Cloud Sleuth, we instrument async-related components so that the tracing information is passed between threads.
You can disable this behavior by setting the value of <code>spring.sleuth.async.enabled</code> to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>If you annotate your method with <code>@Async</code>, we automatically modify the existing Span as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the method is annotated with <code>@SpanName</code>, the value of the annotation is the Span’s name.</p>
</li>
<li>
<p>If the method is not annotated with <code>@SpanName</code>, the Span name is the annotated method name.</p>
</li>
<li>
<p>The span is tagged with the method’s class name and method name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since we’re modifying the existing span, if you want to maintain its original name (e.g. a span created by receiving an HTTP request)
you should wrap your <code>@Async</code> annotated method with a <code>@NewSpan</code> annotation or create a new span manually.</p>
</div>
</div>
<div class="sect3">
<h4 id="scheduled-annotated-methods"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#scheduled-annotated-methods"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#scheduled-annotated-methods">163.10.2. <code>@Scheduled</code> Annotated Methods</a></h4>
<div class="paragraph">
<p>In Spring Cloud Sleuth, we instrument scheduled method execution so that the tracing information is passed between threads.
You can disable this behavior by setting the value of <code>spring.sleuth.scheduled.enabled</code> to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>If you annotate your method with <code>@Scheduled</code>, we automatically create a new span with the following characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The span name is the annotated method name.</p>
</li>
<li>
<p>The span is tagged with the method’s class name and method name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want to skip span creation for some <code>@Scheduled</code> annotated classes, you can set the <code>spring.sleuth.scheduled.skipPattern</code> with a regular expression that matches the fully qualified name of the <code>@Scheduled</code> annotated class.
If you use <code>spring-cloud-sleuth-stream</code> and <code>spring-cloud-netflix-hystrix-stream</code> together, a span is created for each Hystrix metrics and sent to Zipkin.
This behavior may be annoying. That’s why, by default, <code>spring.sleuth.scheduled.skipPattern=org.springframework.cloud.netflix.hystrix.stream.HystrixStreamTask</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="executor-executorservice-and-scheduledexecutorservice"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#executor-executorservice-and-scheduledexecutorservice"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#executor-executorservice-and-scheduledexecutorservice">163.10.3. Executor, ExecutorService, and ScheduledExecutorService</a></h4>
<div class="paragraph">
<p>We provide <code>LazyTraceExecutor</code>, <code>TraceableExecutorService</code>, and <code>TraceableScheduledExecutorService</code>. Those implementations create spans each time a new task is submitted, invoked, or scheduled.</p>
</div>
<div class="paragraph">
<p>The following example shows how to pass tracing information with <code>TraceableExecutorService</code> when working with <code>CompletableFuture</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">CompletableFuture&lt;Long&gt; completableFuture = CompletableFuture.supplyAsync(() -&gt; {
    <span class="hljs-comment">// perform some logic</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">1_000_000L</span>;
}, <span class="hljs-keyword">new</span> TraceableExecutorService(beanFactory, executorService,
        <span class="hljs-comment">// 'calculateTax' explicitly names the span - this param is optional</span>
        <span class="hljs-string">"calculateTax"</span>));</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Sleuth does not work with <code>parallelStream()</code> out of the box.
If you want to have the tracing information propagated through the stream, you have to use the approach with <code>supplyAsync(…​)</code>, as shown earlier.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If there are beans that implement the <code>Executor</code> interface that you would like
to exclude from span creation, you can use the <code>spring.sleuth.async.ignored-beans</code>
property where you can provide a list of bean names.</p>
</div>
<div class="sect4">
<h5 id="customization-of-executors"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customization-of-executors"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customization-of-executors">Customization of Executors</a></h5>
<div class="paragraph">
<p>Sometimes, you need to set up a custom instance of the <code>AsyncExecutor</code>.
The following example shows how to set up such a custom <code>Executor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAutoConfiguration</span>
<span class="hljs-meta">@EnableAsync</span>
<span class="hljs-comment">// add the infrastructure role to ensure that the bean gets auto-proxied</span>
<span class="hljs-meta">@Role</span>(BeanDefinition.ROLE_INFRASTRUCTURE)
<span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomExecutorConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AsyncConfigurerSupport</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    BeanFactory beanFactory;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Executor <span class="hljs-title">getAsyncExecutor</span><span class="hljs-params">()</span> </span>{
        ThreadPoolTaskExecutor executor = <span class="hljs-keyword">new</span> ThreadPoolTaskExecutor();
        <span class="hljs-comment">// CUSTOMIZE HERE</span>
        executor.setCorePoolSize(<span class="hljs-number">7</span>);
        executor.setMaxPoolSize(<span class="hljs-number">42</span>);
        executor.setQueueCapacity(<span class="hljs-number">11</span>);
        executor.setThreadNamePrefix(<span class="hljs-string">"MyExecutor-"</span>);
        <span class="hljs-comment">// DON'T FORGET TO INITIALIZE</span>
        executor.initialize();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> LazyTraceExecutor(<span class="hljs-keyword">this</span>.beanFactory, executor);
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To ensure that your configuration gets post processed, remember
to add the <code>@Role(BeanDefinition.ROLE_INFRASTRUCTURE)</code> on your
<code>@Configuration</code> class
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="messaging-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#messaging-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#messaging-3">163.11. Messaging</a></h3>
<div class="paragraph">
<p>Features from this section can be disabled by setting the <code>spring.sleuth.messaging.enabled</code> property with value equal to <code>false</code>.</p>
</div>
<div class="sect3">
<h4 id="spring-integration-and-spring-cloud-stream"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-integration-and-spring-cloud-stream"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-integration-and-spring-cloud-stream">163.11.1. Spring Integration and Spring Cloud Stream</a></h4>
<div class="paragraph">
<p>Spring Cloud Sleuth integrates with <a href="https://projects.spring.io/spring-integration/">Spring Integration</a>.
It creates spans for publish and subscribe events.
To disable Spring Integration instrumentation, set <code>spring.sleuth.integration.enabled</code> to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>You can provide the <code>spring.sleuth.integration.patterns</code> pattern to explicitly provide the names of channels that you want to include for tracing.
By default, all channels but <code>hystrixStreamOutput</code> channel are included.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When using the <code>Executor</code> to build a Spring Integration <code>IntegrationFlow</code>, you must use the untraced version of the <code>Executor</code>.
Decorating the Spring Integration Executor Channel with <code>TraceableExecutorService</code> causes the spans to be improperly closed.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you want to customize the way tracing context is read from and written to message headers,
it’s enough for you to register beans of types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Propagation.Setter&lt;MessageHeaderAccessor, String&gt;</code> - for writing headers to the message</p>
</li>
<li>
<p><code>Propagation.Getter&lt;MessageHeaderAccessor, String&gt;</code> - for reading headers from the message</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="spring-rabbitmq"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-rabbitmq"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-rabbitmq">163.11.2. Spring RabbitMq</a></h4>
<div class="paragraph">
<p>We instrument the <code>RabbitTemplate</code> so that tracing headers get injected
into the message.</p>
</div>
<div class="paragraph">
<p>To block this feature, set <code>spring.sleuth.messaging.rabbit.enabled</code> to <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="spring-kafka"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-kafka"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-kafka">163.11.3. Spring Kafka</a></h4>
<div class="paragraph">
<p>We instrument the Spring Kafka’s <code>ProducerFactory</code> and <code>ConsumerFactory</code>
so that tracing headers get injected into the created Spring Kafka’s
<code>Producer</code> and <code>Consumer</code>.</p>
</div>
<div class="paragraph">
<p>To block this feature, set <code>spring.sleuth.messaging.kafka.enabled</code> to <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="spring-kafka-streams"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-kafka-streams"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-kafka-streams">163.11.4. Spring Kafka Streams</a></h4>
<div class="paragraph">
<p>We instrument the <code>KafkaStreams</code> <code>KafkaClientSupplier</code> so that tracing headers
get injected into the <code>Producer</code> and <code>Consumer`s. A `KafkaStreamsTracing</code> bean
allows for further instrumentation through additional <code>TransformerSupplier</code> and
<code>ProcessorSupplier</code> methods.</p>
</div>
<div class="paragraph">
<p>To block this feature, set <code>spring.sleuth.messaging.kafka.streams.enabled</code> to <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="spring-jms"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-jms"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-jms">163.11.5. Spring JMS</a></h4>
<div class="paragraph">
<p>We instrument the <code>JmsTemplate</code> so that tracing headers get injected
into the message. We also support <code>@JmsListener</code> annotated methods on the consumer side.</p>
</div>
<div class="paragraph">
<p>To block this feature, set <code>spring.sleuth.messaging.jms.enabled</code> to <code>false</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
We don’t support baggage propagation for JMS
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="spring-cloud-aws-messaging-sqs"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-aws-messaging-sqs"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-aws-messaging-sqs">163.11.6. Spring Cloud AWS Messaging SQS</a></h4>
<div class="paragraph">
<p>We instrument <code>@SqsListener</code> which is provided by <code>org.springframework.cloud:spring-cloud-aws-messaging</code>
so that tracing headers get extracted from the message and a trace gets put into the context.</p>
</div>
<div class="paragraph">
<p>To block this feature, set <code>spring.sleuth.messaging.sqs.enabled</code> to <code>false</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="zuul-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#zuul-2">163.12. Zuul</a></h3>
<div class="paragraph">
<p>We instrument the Zuul Ribbon integration by enriching the Ribbon requests with tracing information.
To disable Zuul support, set the <code>spring.sleuth.zuul.enabled</code> property to <code>false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="redis"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#redis"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#redis">163.13. Redis</a></h3>
<div class="paragraph">
<p>We set <code>tracing</code> property to Lettcue <code>ClientResources</code> instance to enable Brave tracing built in Lettuce .
To disable Redis support, set the <code>spring.sleuth.redis.enabled</code> property to <code>false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="quartz"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quartz"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quartz">163.14. Quartz</a></h3>
<div class="paragraph">
<p>We instrument quartz jobs by adding Job/Trigger listeners to the Quartz Scheduler.</p>
</div>
<div class="paragraph">
<p>To turn off this feature, set the <code>spring.sleuth.quartz.enabled</code> property to <code>false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="project-reactor"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#project-reactor"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#project-reactor">163.15. Project Reactor</a></h3>
<div class="paragraph">
<p>For projects depending on Project Reactor such as Spring Cloud Gateway, we suggest turning the <code>spring.sleuth.reactor.decorate-on-each</code> option to <code>false</code>. That way an increased performance gain should be observed in comparison to the standard instrumentation mechanism. What this option does is it will wrap decorate <code>onLast</code> operator instead of <code>onEach</code> which will result in creation of far fewer objects. The downside of this is that when Project Reactor will change threads, the trace propagation will continue without issues, however anything relying on the <code>ThreadLocal</code> such as e.g. MDC entries can be buggy.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-properties-10"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-10"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#configuration-properties-10">164. Configuration properties</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To see the list of all Sleuth related configuration properties please check <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/appendix.html">the Appendix page</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-examples"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#running-examples"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#running-examples">165. Running examples</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can see the running examples deployed in the <a href="https://run.pivotal.io/">Pivotal Web Services</a>.
Check them out at the following links:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docssleuth-zipkin-server.cfapps.io/">Zipkin for apps presented in the samples to the top</a>. First make
a request to <a href="https://docssleuth-service1.cfapps.io/start">Service 1</a> and then check out the trace in Zipkin.</p>
</li>
<li>
<p><a href="https://docsbrewing-zipkin-server.cfapps.io/">Zipkin for Brewery on PWS</a>, its <a href="https://github.com/spring-cloud-samples/brewery">Github Code</a>.
Ensure that you’ve picked the lookback period of 7 days. If there are no traces, go to <a href="https://docsbrewing-presenting.cfapps.io/">Presenting application</a>
and order some beers. Then check Zipkin for traces.</p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="spring-cloud-task-reference-guide" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-task-reference-guide"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-task-reference-guide">Spring Cloud Task Reference Guide</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Michael Minella, Glenn Renfro, Jay Bryant
:doctype: book
:toc:
:toclevels: 4
:source-highlighter: prettify
:numbered:
:icons: font
:hide-uri-scheme:
:spring-cloud-task-repo: snapshot
:github-tag: master
:spring-cloud-task-docs-version: current
:spring-cloud-task-docs: <a href="https://docs.spring.io/spring-cloud-task/docs/%7Bversion%7D/reference" class="bare">docs.spring.io/spring-cloud-task/docs/{version}/reference</a>
:spring-cloud-task-docs-current: <a href="https://docs.spring.io/spring-cloud-task/docs/current-SNAPSHOT/reference/html/" class="bare">docs.spring.io/spring-cloud-task/docs/current-SNAPSHOT/reference/html/</a>
:github-repo: spring-cloud/spring-cloud-task
:github-raw: <a href="https://raw.github.com/spring-cloud/spring-cloud-netflix/master" class="bare">raw.github.com/spring-cloud/spring-cloud-netflix/master</a>
:github-code: <a href="https://github.com/spring-cloud/spring-cloud-netflix/tree/master" class="bare">github.com/spring-cloud/spring-cloud-netflix/tree/master</a>
:github-wiki: <a href="https://github.com/spring-cloud/spring-cloud-netflix/wiki" class="bare">github.com/spring-cloud/spring-cloud-netflix/wiki</a>
:github-master-code: <a href="https://github.com/spring-cloud/spring-cloud-netflix/tree/master" class="bare">github.com/spring-cloud/spring-cloud-netflix/tree/master</a>
:sc-ext: java
:sc-spring-boot: <a href="https://github.com/spring-cloud/spring-cloud-netflix/tree/master/spring-boot/src/main/java/org/springframework/boot" class="bare">github.com/spring-cloud/spring-cloud-netflix/tree/master/spring-boot/src/main/java/org/springframework/boot</a>
:dc-ext: html
:dc-root: <a href="https://docs.spring.io/spring-cloud-task/docs/%7Bspring-cloud-dataflow-docs-version%7D/api" class="bare">docs.spring.io/spring-cloud-task/docs/{spring-cloud-dataflow-docs-version}/api</a>
:dc-spring-boot: {dc-root}/org/springframework/boot
:dependency-management-plugin: <a href="https://github.com/spring-gradle-plugins/dependency-management-plugin" class="bare">github.com/spring-gradle-plugins/dependency-management-plugin</a>
:dependency-management-plugin-documentation: {dependency-management-plugin}/blob/master/README.md
:spring-boot-maven-plugin-site: <a href="https://docs.spring.io/spring-boot/docs/%7Bspring-boot-docs-version%7D/maven-plugin" class="bare">docs.spring.io/spring-boot/docs/{spring-boot-docs-version}/maven-plugin</a>
:spring-reference: <a href="https://docs.spring.io/spring/docs/%7Bspring-docs-version%7D/spring-framework-reference/htmlsingle" class="bare">docs.spring.io/spring/docs/{spring-docs-version}/spring-framework-reference/htmlsingle</a>
:spring-security-reference: <a href="https://docs.spring.io/spring-security/site/docs/%7Bspring-security-docs-version%7D/reference/htmlsingle" class="bare">docs.spring.io/spring-security/site/docs/{spring-security-docs-version}/reference/htmlsingle</a>
:spring-javadoc: <a href="https://docs.spring.io/spring/docs/%7Bspring-docs-version%7D/javadoc-api/org/springframework" class="bare">docs.spring.io/spring/docs/{spring-docs-version}/javadoc-api/org/springframework</a>
:spring-amqp-javadoc: <a href="https://docs.spring.io/spring-amqp/docs/current/api/org/springframework/amqp" class="bare">docs.spring.io/spring-amqp/docs/current/api/org/springframework/amqp</a>
:spring-data-javadoc: <a href="https://docs.spring.io/spring-data/jpa/docs/current/api/org/springframework/data/jpa" class="bare">docs.spring.io/spring-data/jpa/docs/current/api/org/springframework/data/jpa</a>
:spring-data-commons-javadoc: <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data" class="bare">docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data</a>
:spring-data-mongo-javadoc: <a href="https://docs.spring.io/spring-data/mongodb/docs/current/api/org/springframework/data/mongodb" class="bare">docs.spring.io/spring-data/mongodb/docs/current/api/org/springframework/data/mongodb</a>
:spring-data-rest-javadoc: <a href="https://docs.spring.io/spring-data/rest/docs/current/api/org/springframework/data/rest" class="bare">docs.spring.io/spring-data/rest/docs/current/api/org/springframework/data/rest</a>
:gradle-userguide: <a href="https://www.gradle.org/docs/current/userguide" class="bare">www.gradle.org/docs/current/userguide</a>
:propdeps-plugin: <a href="https://github.com/spring-projects/gradle-plugins/tree/master/propdeps-plugin" class="bare">github.com/spring-projects/gradle-plugins/tree/master/propdeps-plugin</a>
:ant-manual: <a href="https://ant.apache.org/manual" class="bare">ant.apache.org/manual</a>
:attributes: allow-uri-read</p>
</div>
<div class="paragraph">
<p>© 2009-2018 Pivotal Software, Inc. All rights reserved.</p>
</div>
<div class="paragraph">
<p>Copies of this document may be made for your own use and for distribution to
others, provided that you do not charge any fee for such copies and further
provided that each copy contains this Copyright Notice, whether distributed in
print or electronically.</p>
</div>
</div>
</div>
<h1 id="preface" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#preface"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#preface">Preface</a></h1>
<div id="task-documentation-about" class="openblock partintro">
<div class="content">
This section provides a brief overview of the Spring Cloud Task reference documentation.
Think of it as a map for the rest of the document. You can read this reference guide in a
linear fashion or you can skip sections if something does not interest you.
</div>
</div>
<div class="sect1">
<h2 id="about-the-documentation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#about-the-documentation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#about-the-documentation">166. About the documentation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Cloud Task reference guide is available in {spring-cloud-task-docs}/html[html],
{spring-cloud-task-docs}/pdf/spring-cloud-task-reference.pdf[pdf]
and {spring-cloud-task-docs}/epub/spring-cloud-task-reference.epub[epub] formats. The
latest copy is available at {spring-cloud-task-docs-current}.</p>
</div>
<div class="paragraph">
<p>Copies of this document may be made for your own use and for distribution to others,
provided that you do not charge any fee for such copies and further provided that each
copy contains this Copyright Notice, whether distributed in print or electronically.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="task-documentation-getting-help"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#task-documentation-getting-help"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#task-documentation-getting-help">167. Getting help</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Having trouble with Spring Cloud Task? We would like to help!</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ask a question. We monitor <a href="https://stackoverflow.com/">stackoverflow.com</a> for questions
tagged with <a href="https://stackoverflow.com/tags/spring-cloud-task"><code>spring-cloud-task</code></a>.</p>
</li>
<li>
<p>Report bugs with Spring Cloud Task at
<a href="https://github.com/spring-cloud/spring-cloud-task/issues" class="bare">github.com/spring-cloud/spring-cloud-task/issues</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All of Spring Cloud Task is open source, including the documentation. If you find
a problem with the docs or if you just want to improve them, please <a href="https://github.com/spring-cloud/spring-cloud-netflix/tree/master">get
involved</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="task-documentation-first-steps"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#task-documentation-first-steps"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#task-documentation-first-steps">168. First Steps</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are just getting started with Spring Cloud Task or with 'Spring' in general, we
suggesting reading the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#getting-started">getting-started.html</a> chapter.</p>
</div>
<div class="paragraph">
<p>To get started from scratch, read the following sections:
* “<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#getting-started-introducing-spring-cloud-task">getting-started.html</a>”
* “<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#getting-started-system-requirements">getting-started.html</a>”
To follow the tutorial, read
“<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#getting-started-developing-first-task">getting-started.html</a>”
To run your example, read
“<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/getting-started.html#getting-started-running-the-example">getting-started.html</a>”</p>
</div>
</div>
</div>
<h1 id="getting-started" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started">Getting started</a></h1>
<div class="openblock partintro">
<div class="content">
<div id="partintro" class="openblock">
<div class="content">
<div class="paragraph">
<p>If you are just getting started with Spring Cloud Task, you should read this section.
Here, we answer the basic “what?”, “how?”, and “why?” questions. We start with a
gentle introduction to Spring Cloud Task. We then build a Spring Cloud Task application,
discussing some core principles as we go.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-introducing-spring-cloud-task"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-introducing-spring-cloud-task"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-introducing-spring-cloud-task">169. Introducing Spring Cloud Task</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Task makes it easy to create short-lived microservices. It provides
capabilities that let short lived JVM processes be executed on demand in a production
environment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-system-requirements"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-system-requirements"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-system-requirements">170. System Requirements</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need to have Java installed (Java 8 or better). To build, you need to have Maven
installed as well.</p>
</div>
<div class="sect2">
<h3 id="database-requirements"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#database-requirements"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#database-requirements">170.1. Database Requirements</a></h3>
<div class="paragraph">
<p>Spring Cloud Task uses a relational database to store the results of an executed task.
While you can begin developing a task without a database (the status of the task is logged
as part of the task repository’s updates), for production environments, you want to
use a supported database. Spring Cloud Task currently supports the following databases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DB2</p>
</li>
<li>
<p>H2</p>
</li>
<li>
<p>HSQLDB</p>
</li>
<li>
<p>MySql</p>
</li>
<li>
<p>Oracle</p>
</li>
<li>
<p>Postgres</p>
</li>
<li>
<p>SqlServer</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-developing-first-task"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-developing-first-task"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-developing-first-task">171. Developing Your First Spring Cloud Task Application</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A good place to start is with a simple “Hello, World!” application, so we create the
Spring Cloud Task equivalent to highlight the features of the framework. Most IDEs have
good support for Apache Maven, so we use it as the build tool for this project.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The spring.io web site contains many <a href="https://spring.io/guides">“<code>Getting Started</code>”
guides</a> that use Spring Boot. If you need to solve a specific problem, check there first.
You can shortcut the following steps by going to the
<a href="https://start.spring.io/">Spring Initializr</a> and creating a new project. Doing so
automatically generates a new project structure so that you can start coding right away.
We recommend experimenting with the Spring Initializr to become familiar with it.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="getting-started-creating-project"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-creating-project"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-creating-project">171.1. Creating the Spring Task Project using Spring Initializr</a></h3>
<div class="paragraph">
<p>Now we can create and test an application that prints <code>Hello, World!</code> to the console.</p>
</div>
<div class="paragraph">
<p>To do so:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Visit the <a href="https://start.spring.io/">Spring Initialzr</a> site.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a new Maven project with a <strong>Group</strong> name of <code>io.spring.demo</code> and an <strong>Artifact</strong> name of <code>helloworld</code>.</p>
</li>
<li>
<p>In the Dependencies text box, type <code>task</code> and then select the <code>Cloud Task</code> dependency.</p>
</li>
<li>
<p>In the Dependencies text box, type <code>jdbc</code> and then select the <code>JDBC</code> dependency.</p>
</li>
<li>
<p>In the Dependencies text box, type <code>h2</code> and then select the <code>H2</code>. (or your favorite database)</p>
</li>
<li>
<p>Click the <strong>Generate Project</strong> button</p>
</li>
</ol>
</div>
</li>
<li>
<p>Unzip the helloworld.zip file and import the project into your favorite IDE.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-writing-the-code"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-writing-the-code"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-writing-the-code">171.2. Writing the Code</a></h3>
<div class="paragraph">
<p>To finish our application, we need to update the generated <code>HelloworldApplication</code> with the following contents so that it launches a Task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">package</span> io.spring.demo.helloworld;

<span class="hljs-keyword">import</span> org.springframework.boot.CommandLineRunner;
<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloworldApplication</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CommandLineRunner <span class="hljs-title">commandLineRunner</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HelloWorldCommandLineRunner();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        SpringApplication.run(HelloworldApplication.class, args);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorldCommandLineRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CommandLineRunner</span> </span>{

        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(String... strings)</span> <span class="hljs-keyword">throws</span> Exception </span>{
            System.out.println(<span class="hljs-string">"Hello, World!"</span>);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>While it may seem small, quite a bit is going on. For more about Spring
Boot specifics, see the
<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/">Spring Boot reference documentation</a>.</p>
</div>
<div class="paragraph">
<p>Now we can open the <code>application.properties</code> file in <code>src/main/resources</code>.
We need to configure two properties in <code>application.properties</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>application.name</code>: To set the application name (which is translated to the task name)</p>
</li>
<li>
<p><code>logging.level</code>: To set the logging for Spring Cloud Task to <code>DEBUG</code> in order to
get a view of what is going on.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows how to do both:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs gradle">logging.level.org.springframework.cloud.<span class="hljs-keyword">task</span>=DEBUG
spring.application.name=helloWorld</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-at-task"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-at-task"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-at-task">171.2.1. Task Auto Configuration</a></h4>
<div class="paragraph">
<p>When including Spring Cloud Task Starter dependency, Task auto configures all beans to bootstrap it’s functionality.
Part of this configuration registers the <code>TaskRepository</code> and the infrastructure for its use.</p>
</div>
<div class="paragraph">
<p>In our demo, the <code>TaskRepository</code> uses an embedded H2 database to record the results
of a task. This H2 embedded database is not a practical solution for a production environment, since
the H2 DB goes away once the task ends. However, for a quick getting-started
experience, we can use this in our example as well as echoing to the logs what is being updated
in that repository. In the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-configuration">Configuration</a> section (later in this
documentation), we cover how to customize the configuration of the pieces provided by
Spring Cloud Task.</p>
</div>
<div class="paragraph">
<p>When our sample application runs, Spring Boot launches our <code>HelloWorldCommandLineRunner</code>
and outputs our “Hello, World!” message to standard out. The <code>TaskLifecycleListener</code>
records the start of the task and the end of the task in the repository.</p>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-main-method"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-main-method"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-main-method">171.2.2. The main method</a></h4>
<div class="paragraph">
<p>The main method serves as the entry point to any java application. Our main method
delegates to Spring Boot’s <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-spring-application.html">SpringApplication</a> class.</p>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-clr"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-clr"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-clr">171.2.3. The CommandLineRunner</a></h4>
<div class="paragraph">
<p>Spring includes many ways to bootstrap an application’s logic. Spring Boot provides
a convenient method of doing so in an organized manner through its <code>*Runner</code> interfaces
(<code>CommandLineRunner</code> or <code>ApplicationRunner</code>). A well behaved task can bootstrap any
logic by using one of these two runners.</p>
</div>
<div class="paragraph">
<p>The lifecycle of a task is considered from before the <code>*Runner#run</code> methods are executed
to once they are all complete. Spring Boot lets an application use multiple
<code>*Runner</code> implementations, as does Spring Cloud Task.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Any processing bootstrapped from mechanisms other than a <code>CommandLineRunner</code> or
<code>ApplicationRunner</code> (by using <code>InitializingBean#afterPropertiesSet</code> for example) is not
recorded by Spring Cloud Task.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-running-the-example"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-running-the-example"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-running-the-example">171.3. Running the Example</a></h3>
<div class="paragraph">
<p>At this point, our application should work. Since this application is Spring Boot-based,
we can run it from the command line by using <code>$ mvn spring-boot:run</code> from the root
of our application, as shown (with its output) in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">$ mvn clean spring-boot:run
....... . . .
....... . . . (Maven log output here)
....... . . .

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v2.0.3.RELEASE)

2018-07-23 17:44:34.426  INFO 1978 <span class="hljs-comment">--- [           main] i.s.d.helloworld.HelloworldApplication   : Starting HelloworldApplication on Glenns-MBP-2.attlocal.net with PID 1978 (/Users/glennrenfro/project/helloworld/target/classes started by glennrenfro in /Users/glennrenfro/project/helloworld)</span>
2018-07-23 17:44:34.430  INFO 1978 <span class="hljs-comment">--- [           main] i.s.d.helloworld.HelloworldApplication   : No active profile set, falling back to default profiles: default</span>
2018-07-23 17:44:34.472  INFO 1978 <span class="hljs-comment">--- [           main] s.c.a.AnnotationConfigApplicationContext : Refreshing org.springframework.context.annotation.AnnotationConfigApplicationContext@1d24f32d: startup date [Mon Jul 23 17:44:34 EDT 2018]; root of context hierarchy</span>
2018-07-23 17:44:35.280  INFO 1978 <span class="hljs-comment">--- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...</span>
2018-07-23 17:44:35.410  INFO 1978 <span class="hljs-comment">--- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.</span>
2018-07-23 17:44:35.419 DEBUG 1978 <span class="hljs-comment">--- [           main] o.s.c.t.c.SimpleTaskConfiguration        : Using org.springframework.cloud.task.configuration.DefaultTaskConfigurer TaskConfigurer</span>
2018-07-23 17:44:35.420 DEBUG 1978 <span class="hljs-comment">--- [           main] o.s.c.t.c.DefaultTaskConfigurer          : No EntityManager was found, using DataSourceTransactionManager</span>
2018-07-23 17:44:35.522 DEBUG 1978 <span class="hljs-comment">--- [           main] o.s.c.t.r.s.TaskRepositoryInitializer    : Initializing task schema for h2 database</span>
2018-07-23 17:44:35.525  INFO 1978 <span class="hljs-comment">--- [           main] o.s.jdbc.datasource.init.ScriptUtils     : Executing SQL script from class path resource [org/springframework/cloud/task/schema-h2.sql]</span>
2018-07-23 17:44:35.558  INFO 1978 <span class="hljs-comment">--- [           main] o.s.jdbc.datasource.init.ScriptUtils     : Executed SQL script from class path resource [org/springframework/cloud/task/schema-h2.sql] in 33 ms.</span>
2018-07-23 17:44:35.728  INFO 1978 <span class="hljs-comment">--- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup</span>
2018-07-23 17:44:35.730  INFO 1978 <span class="hljs-comment">--- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Bean with name 'dataSource' has been autodetected for JMX exposure</span>
2018-07-23 17:44:35.733  INFO 1978 <span class="hljs-comment">--- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Located MBean 'dataSource': registering with JMX server as MBean [com.zaxxer.hikari:name=dataSource,type=HikariDataSource]</span>
2018-07-23 17:44:35.738  INFO 1978 <span class="hljs-comment">--- [           main] o.s.c.support.DefaultLifecycleProcessor  : Starting beans in phase 0</span>
2018-07-23 17:44:35.762 DEBUG 1978 <span class="hljs-comment">--- [           main] o.s.c.t.r.support.SimpleTaskRepository   : Creating: TaskExecution{executionId=0, parentExecutionId=null, exitCode=null, taskName='application', startTime=Mon Jul 23 17:44:35 EDT 2018, endTime=null, exitMessage='null', externalExecutionId='null', errorMessage='null', arguments=[]}</span>
2018-07-23 17:44:35.772  INFO 1978 <span class="hljs-comment">--- [           main] i.s.d.helloworld.HelloworldApplication   : Started HelloworldApplication in 1.625 seconds (JVM running for 4.764)</span>
Hello, World!
2018-07-23 17:44:35.782 DEBUG 1978 <span class="hljs-comment">--- [           main] o.s.c.t.r.support.SimpleTaskRepository   : Updating: TaskExecution with executionId=1 with the following {exitCode=0, endTime=Mon Jul 23 17:44:35 EDT 2018, exitMessage='null', errorMessage='null'}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding output has three lines that of interest to us here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SimpleTaskRepository</code> logged the creation of the entry in the <code>TaskRepository</code>.</p>
</li>
<li>
<p>The execution of our <code>CommandLineRunner</code>, demonstrated by the “Hello, World!” output.</p>
</li>
<li>
<p><code>SimpleTaskRepository</code> logs the completion of the task in the <code>TaskRepository</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A simple task application can be found in the samples module of the Spring Cloud
Task Project
<a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples/timestamp">here</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<h1 id="features" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features">Features</a></h1>
<div class="openblock partintro">
<div class="content">
<div id="partintro" class="openblock">
<div class="content">
<div class="paragraph">
<p>This section goes into more detail about Spring Cloud Task, including how to use it, how
to configure it, and the appropriate extension points.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="features-lifecycle"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-lifecycle"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-lifecycle">172. The lifecycle of a Spring Cloud Task</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In most cases, the modern cloud environment is designed around the execution of processes
that are not expected to end. If they do end, they are typically restarted. While most
platforms do have some way to run a process that is not restarted when it ends, the
results of that run are typically not maintained in a consumable way. Spring Cloud
Task offers the ability to execute short-lived processes in an environment and record the
results. Doing so allows for a microservices architecture around short-lived processes as
well as longer running services through the integration of tasks by messages.</p>
</div>
<div class="paragraph">
<p>While this functionality is useful in a cloud environment, the same issues can arise in a
traditional deployment model as well. When running Spring Boot applications with a
scheduler such as cron, it can be useful to be able to monitor the results of the
application after its completion.</p>
</div>
<div class="paragraph">
<p>Spring Cloud Task takes the approach that a Spring Boot application can have a start and
an end and still be successful. Batch applications are one example of how processes that
are expected to end (and that are often short-lived) can be helpful.</p>
</div>
<div class="paragraph">
<p>Spring Cloud Task records the lifecycle events of a given task. Most long-running
processes, typified by most web applications, do not save their lifecycle events. The
tasks at the heart of Spring Cloud Task do.</p>
</div>
<div class="paragraph">
<p>The lifecycle consists of a single task execution. This is a physical execution of a
Spring Boot application configured to be a task (that is, it has the Sprint Cloud Task dependencies).</p>
</div>
<div class="paragraph">
<p>At the beginning of a task, before any <code>CommandLineRunner</code> or <code>ApplicationRunner</code>
implementations have been run, an entry in the <code>TaskRepository</code> that records the start
event is created. This event is triggered through <code>SmartLifecycle#start</code> being triggered
by the Spring Framework. This indicates to the system that all beans are ready for use and
comes before running any of the <code>CommandLineRunner</code> or <code>ApplicationRunner</code> implementations
provided by Spring Boot.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The recording of a task only occurs upon the successful bootstrapping of an
<code>ApplicationContext</code>. If the context fails to bootstrap at all, the task’s run is not
recorded.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Upon completion of all of the <code>*Runner#run</code> calls from Spring Boot or the failure of an
<code>ApplicationContext</code> (indicated by an <code>ApplicationFailedEvent</code>), the task execution is
updated in the repository with the results.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the application requires the <code>ApplicationContext</code> to be closed at the
completion of a task (all <code>*Runner#run</code> methods have been called and the task
repository has been updated), set the property <code>spring.cloud.task.closecontextEnabled</code>
to true.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="features-task-execution-details"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-execution-details"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-execution-details">172.1. The TaskExecution</a></h3>
<div class="paragraph">
<p>The information stored in the <code>TaskRepository</code> is modeled in the <code>TaskExecution</code> class and
consists of the following information:</p>
</div>
<table class="tableblock frame-topbot grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>executionid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unique ID for the task’s run.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exitCode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The exit code generated from an <code>ExitCodeExceptionMapper</code> implementation. If there is no
exit code generated but an <code>ApplicationFailedEvent</code> is thrown, 1 is set. Otherwise, it is
assumed to be 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>taskName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name for the task, as determined by the configured <code>TaskNameResolver</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>startTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time the task was started, as indicated by the <code>SmartLifecycle#start</code> call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>endTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time the task was completed, as indicated by the <code>ApplicationReadyEvent</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exitMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any information available at the time of exit. This can programmatically be set by a
<code>TaskExecutionListener</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>errorMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If an exception is the cause of the end of the task (as indicated by an
<code>ApplicationFailedEvent</code>), the stack trace for that exception is stored here.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>arguments</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>List</code> of the string command line arguments as they were passed into the executable
boot application.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="features-lifecycle-exit-codes"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-lifecycle-exit-codes"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-lifecycle-exit-codes">172.2. Mapping Exit Codes</a></h3>
<div class="paragraph">
<p>When a task completes, it tries to return an exit code to the OS. If we take a look
at our <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#getting-started-developing-first-task">original example</a>, we can see that we are
not controlling that aspect of our application. So, if an exception is thrown, the JVM
returns a code that may or may not be of any use to you in debugging.</p>
</div>
<div class="paragraph">
<p>Consequently, Spring Boot provides an interface, <code>ExitCodeExceptionMapper</code>, that lets you
map uncaught exceptions to exit codes. Doing so lets you indicate, at the level of exit
codes, what went wrong. Also, by mapping exit codes in this manner, Spring Cloud Task
records the returned exit code.</p>
</div>
<div class="paragraph">
<p>If the task terminates with a SIG-INT or a SIG-TERM, the exit code is zero unless
otherwise specified within the code.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
While the task is running, the exit code is stored as a null in the repository.
Once the task completes, the appropriate exit code is stored based on the guidelines described
earlier in this section.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="features-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-configuration">173. Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Task provides a ready-to-use configuration, as defined in the
<code>DefaultTaskConfigurer</code> and <code>SimpleTaskConfiguration</code> classes. This section walks through
the defaults and how to customize Spring Cloud Task for your needs.</p>
</div>
<div class="sect2">
<h3 id="features-data-source"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-data-source"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-data-source">173.1. DataSource</a></h3>
<div class="paragraph">
<p>Spring Cloud Task uses a datasource for storing the results of task executions. By
default, we provide an in-memory instance of H2 to provide a simple method of
bootstrapping development. However, in a production environment, you probably want to
configure your own <code>DataSource</code>.</p>
</div>
<div class="paragraph">
<p>If your application uses only a single <code>DataSource</code> and that serves as both your business
schema and the task repository, all you need to do is provide any <code>DataSource</code> (the
easiest way to do so is through Spring Boot’s configuration conventions). This
<code>DataSource</code> is automatically used by Spring Cloud Task for the repository.</p>
</div>
<div class="paragraph">
<p>If your application uses more than one <code>DataSource</code>, you need to configure the task
repository with the appropriate <code>DataSource</code>. This customization can be done through an
implementation of <code>TaskConfigurer</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="features-table-prefix"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-table-prefix"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-table-prefix">173.2. Table Prefix</a></h3>
<div class="paragraph">
<p>One modifiable property of <code>TaskRepository</code> is the table prefix for the task tables. By
default, they are all prefaced with <code>TASK_</code>. <code>TASK_EXECUTION</code> and <code>TASK_EXECUTION_PARAMS</code>
are two examples. However, there are potential reasons to modify this prefix. If the
schema name needs to be prepended to the table names or if more than one set of task
tables is needed within the same schema, you must change the table prefix. You can do so
by setting the <code>spring.cloud.task.tablePrefix</code> to the prefix you need, as follows:</p>
</div>
<div class="paragraph">
<p><code>spring.cloud.task.tablePrefix=yourPrefix</code></p>
</div>
</div>
<div class="sect2">
<h3 id="features-table-initialization"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-table-initialization"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-table-initialization">173.3. Enable/Disable table initialization</a></h3>
<div class="paragraph">
<p>In cases where you are creating the task tables and do not wish for Spring Cloud Task to
create them at task startup, set the <code>spring.cloud.task.initialize-enabled</code> property to
<code>false</code>, as follows:</p>
</div>
<div class="paragraph">
<p><code>spring.cloud.task.initialize-enabled=false</code></p>
</div>
<div class="paragraph">
<p>It defaults to <code>true</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The property <code>spring.cloud.task.initialize.enable</code> has been deprecated.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="features-generated_task_id"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-generated_task_id"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-generated_task_id">173.4. Externally Generated Task ID</a></h3>
<div class="paragraph">
<p>In some cases, you may want to allow for the time difference between when a task is
requested and when the infrastructure actually launches it. Spring Cloud Task lets you
create a <code>TaskExecution</code> when the task is requested. Then pass the execution ID of the
generated <code>TaskExecution</code> to the task so that it can update the <code>TaskExecution</code> through
the task’s lifecycle.</p>
</div>
<div class="paragraph">
<p>A <code>TaskExecution</code> can be created by calling the <code>createTaskExecution</code> method on an
implementation of the <code>TaskRepository</code> that references the datastore that holds
the <code>TaskExecution</code> objects.</p>
</div>
<div class="paragraph">
<p>In order to configure your Task to use a generated <code>TaskExecutionId</code>, add the
following property:</p>
</div>
<div class="paragraph">
<p><code>spring.cloud.task.executionid=yourtaskId</code></p>
</div>
</div>
<div class="sect2">
<h3 id="features-external_task_id"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-external_task_id"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-external_task_id">173.5. External Task Id</a></h3>
<div class="paragraph">
<p>Spring Cloud Task lets you store an external task ID for each
<code>TaskExecution</code>. An example of this would be a task ID provided by
Cloud Foundry when a task is launched on the platform.
In order to configure your Task to use a generated <code>TaskExecutionId</code>, add the
following property:</p>
</div>
<div class="paragraph">
<p><code>spring.cloud.task.external-execution-id=&lt;externalTaskId&gt;</code></p>
</div>
</div>
<div class="sect2">
<h3 id="features-parent_task_id"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-parent_task_id"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-parent_task_id">173.6. Parent Task Id</a></h3>
<div class="paragraph">
<p>Spring Cloud Task lets you store a parent task ID for each <code>TaskExecution</code>. An example of
this would be a task that executes another task or tasks and you want to record which task
launched each of the child tasks. In order to configure your Task to set a parent
<code>TaskExecutionId</code> add the following property on the child task:</p>
</div>
<div class="paragraph">
<p><code>spring.cloud.task.parent-execution-id=&lt;parentExecutionTaskId&gt;</code></p>
</div>
</div>
<div class="sect2">
<h3 id="features-task-configurer"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-configurer"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-configurer">173.7. TaskConfigurer</a></h3>
<div class="paragraph">
<p>The <code>TaskConfigurer</code> is a strategy interface that lets you customize the way components of
Spring Cloud Task are configured. By default, we provide the <code>DefaultTaskConfigurer</code> that
provides logical defaults: <code>Map</code>-based in-memory components (useful for development if no
<code>DataSource</code> is provided) and JDBC based components (useful if there is a <code>DataSource</code>
available).</p>
</div>
<div class="paragraph">
<p>The <code>TaskConfigurer</code> lets you configure three main components:</p>
</div>
<table class="tableblock frame-topbot grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default (provided by <code>DefaultTaskConfigurer</code>)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TaskRepository</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The implementation of the <code>TaskRepository</code> to be used.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleTaskRepository</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TaskExplorer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The implementation of the <code>TaskExplorer</code> (a component for read-only access to the task
repository) to be used.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleTaskExplorer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PlatformTransactionManager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A transaction manager to be used when running updates for tasks.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DataSourceTransactionManager</code> if a <code>DataSource</code> is used.
<code>ResourcelessTransactionManager</code> if it is not.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can customize any of the components described in the preceding table by creating a
custom implementation of the <code>TaskConfigurer</code> interface. Typically, extending the
<code>DefaultTaskConfigurer</code> (which is provided if a <code>TaskConfigurer</code> is not found) and
overriding the required getter is sufficient. However, implementing your own from scratch
may be required.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Users should not directly use getter methods from a <code>TaskConfigurer</code> directly
unless they are using it to supply implementations to be exposed as Spring Beans.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="features-task-name"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-name"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-name">173.8. Task Name</a></h3>
<div class="paragraph">
<p>In most cases, the name of the task is the application name as configured in Spring
Boot. However, there are some cases where you may want to map the run of a task to a
different name. Spring Cloud Data Flow is an example of this (because you probably want
the task to be run with the name of the task definition). Because of this, we offer the
ability to customize how the task is named, through the <code>TaskNameResolver</code> interface.</p>
</div>
<div class="paragraph">
<p>By default, Spring Cloud Task provides the <code>SimpleTaskNameResolver</code>, which uses the
following options (in order of precedence):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A Spring Boot property (configured in any of the ways Spring Boot allows) called
<code>spring.cloud.task.name</code>.</p>
</li>
<li>
<p>The application name as resolved using Spring Boot’s rules (obtained through
<code>ApplicationContext#getId</code>).</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="features-task-execution-listener"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-execution-listener"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-execution-listener">173.9. Task Execution Listener</a></h3>
<div class="paragraph">
<p><code>TaskExecutionListener</code> lets you register listeners for specific events that occur during
the task lifecycle. To do so, create a class that implements the
<code>TaskExecutionListener</code> interface. The class that implements the <code>TaskExecutionListener</code>
interface is notified of the following events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>onTaskStartup</code>: Prior to storing the <code>TaskExecution</code> into the <code>TaskRepository</code>.</p>
</li>
<li>
<p><code>onTaskEnd</code>: Prior to updating the <code>TaskExecution</code> entry in the <code>TaskRepository</code> and
marking the final state of the task.</p>
</li>
<li>
<p><code>onTaskFailed</code>: Prior to the <code>onTaskEnd</code> method being invoked when an unhandled
exception is thrown by the task.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring Cloud Task also lets you add <code>TaskExecution</code> Listeners to methods within a bean
by using the following method annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@BeforeTask</code>: Prior to the storing the <code>TaskExecution</code> into the <code>TaskRepository</code></p>
</li>
<li>
<p><code>@AfterTask</code>: Prior to the updating of the <code>TaskExecution</code> entry in the <code>TaskRepository</code>
marking the final state of the task.</p>
</li>
<li>
<p><code>@FailedTask</code>: Prior to the <code>@AfterTask</code> method being invoked when an unhandled
exception is thrown by the task.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows the three annotations in use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBean</span> </span>{

    <span class="hljs-meta">@BeforeTask</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">methodA</span><span class="hljs-params">(TaskExecution taskExecution)</span> </span>{
    }

    <span class="hljs-meta">@AfterTask</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">methodB</span><span class="hljs-params">(TaskExecution taskExecution)</span> </span>{
    }

    <span class="hljs-meta">@FailedTask</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">methodC</span><span class="hljs-params">(TaskExecution taskExecution, Throwable throwable)</span> </span>{
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Inserting an <code>ApplicationListener</code> earlier in the chain than <code>TaskLifecycleListener</code> exists may cause unexpected effects.
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="features-task-execution-listener-Exceptions"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-execution-listener-Exceptions"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-execution-listener-Exceptions">173.9.1. Exceptions Thrown by Task Execution Listener</a></h4>
<div class="paragraph">
<p>If an exception is thrown by a <code>TaskExecutionListener</code> event handler, all listener
processing for that event handler stops. For example, if three <code>onTaskStartup</code> listeners
have started and the first <code>onTaskStartup</code> event handler throws an exception, the other
two <code>onTaskStartup</code> methods are not called. However, the other event handlers (<code>onTaskEnd</code>
and <code>onTaskFailed</code>) for the <code>TaskExecutionListeners</code> are called.</p>
</div>
<div class="paragraph">
<p>The exit code returned when a exception is thrown by a <code>TaskExecutionListener</code>
event handler is the exit code that was reported by the
<a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/ExitCodeEvent.html">ExitCodeEvent</a>.
If no <code>ExitCodeEvent</code> is emitted, the Exception thrown is evaluated to see
if it is of type
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-application-exit">ExitCodeGenerator</a>.
If so, it returns the exit code from the <code>ExitCodeGenerator</code>. Otherwise, <code>1</code>
is returned.</p>
</div>
<div class="paragraph">
<p>In the case that an exception is thrown in an <code>onTaskStartup</code> method, the exit code for the application will be <code>1</code>.
If an exception is thrown in either a <code>onTaskEnd</code> or <code>onTaskFailed</code>
method, the exit code for the application will be the one established using the rules enumerated above.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the case of an exception being thrown in a <code>onTaskStartup</code>, <code>onTaskEnd</code>, or <code>onTaskFailed</code>
you can not override the exit code for the application using <code>ExitCodeExceptionMapper</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="features-task-execution-listener-exit-messages"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-execution-listener-exit-messages"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-execution-listener-exit-messages">173.9.2. Exit Messages</a></h4>
<div class="paragraph">
<p>You can set the exit message for a task programmatically by using a
<code>TaskExecutionListener</code>. This is done by setting the <code>TaskExecution’s</code> <code>exitMessage</code>,
which then gets passed into the <code>TaskExecutionListener</code>. The following example shows
a method that is annotated with the <code>@AfterTask</code> <code>ExecutionListener</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@AfterTask</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterMe</span><span class="hljs-params">(TaskExecution taskExecution)</span> </span>{
    taskExecution.setExitMessage(<span class="hljs-string">"AFTER EXIT MESSAGE"</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An <code>ExitMessage</code> can be set at any of the listener events (<code>onTaskStartup</code>,
<code>onTaskFailed</code>, and <code>onTaskEnd</code>). The order of precedence for the three listeners follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>onTaskEnd</code></p>
</li>
<li>
<p><code>onTaskFailed</code></p>
</li>
<li>
<p><code>onTaskStartup</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, if you set an <code>exitMessage</code> for the <code>onTaskStartup</code> and <code>onTaskFailed</code>
listeners and the task ends without failing, the <code>exitMessage</code> from the <code>onTaskStartup</code>
is stored in the repository. Otherwise, if a failure occurs, the <code>exitMessage</code> from
the <code>onTaskFailed</code> is stored. Also if you set the <code>exitMessage</code> with an
<code>onTaskEnd</code> listener, the <code>exitMessage</code> from the <code>onTaskEnd</code> supersedes
the exit messages from both the <code>onTaskStartup</code> and <code>onTaskFailed</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="features-single-instance-enabled"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-single-instance-enabled"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-single-instance-enabled">173.10. Restricting Spring Cloud Task Instances</a></h3>
<div class="paragraph">
<p>Spring Cloud Task lets you establish that only one task with a given task name can be run
at a time. To do so, you need to establish the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-name">task name</a> and set
<code>spring.cloud.task.single-instance-enabled=true</code> for each task execution. While the first
task execution is running, any other time you try to run a task with the same
<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-name">task name</a> and`spring.cloud.task.single-instance-enabled=true`, the
task fails with the following error message: <code>Task with name "application" is already
running.</code> The default value for <code>spring.cloud.task.single-instance-enabled</code> is <code>false</code>. The
following example shows how to set <code>spring.cloud.task.single-instance-enabled</code> to <code>true</code>:</p>
</div>
<div class="paragraph">
<p><code>spring.cloud.task.single-instance-enabled=true or false</code></p>
</div>
<div class="paragraph">
<p>To use this feature, you must add the following Spring Integration dependencies to your
application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.integration<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-integration-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.integration<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-integration-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The exit code for the application will be 1 if the task fails because this feature
is enabled and another task is running with the same task name.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="disabling-spring-cloud-task-auto-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#disabling-spring-cloud-task-auto-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#disabling-spring-cloud-task-auto-configuration">173.11. Disabling Spring Cloud Task Auto Configuration</a></h3>
<div class="paragraph">
<p>In cases where Spring Cloud Task should not be auto configured for an implementation, you can disable Task’s auto configuration.
This can be done either by adding the following annotation to your Task application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css">@<span class="hljs-keyword">EnableAutoConfiguration</span>(<span class="hljs-keyword">exclude</span>={<span class="hljs-selector-tag">SimpleTaskAutoConfiguration</span><span class="hljs-selector-class">.class</span>})</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may also disable Task auto configuration by setting the <code>spring.cloud.task.autoconfiguration.enabled</code> property to <code>false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="closing-the-context"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#closing-the-context"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#closing-the-context">173.12. Closing the Context</a></h3>
<div class="paragraph">
<p>If the application requires the <code>ApplicationContext</code> to be closed at the
completion of a task (all <code>*Runner#run</code> methods have been called and the task
repository has been updated), set the property <code>spring.cloud.task.closecontextEnabled</code>
to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>Another case to close the context is when the Task Execution completes however the application does not terminate.
In these cases the context is held open because a thread has been allocated
(for example: if you are using a TaskExecutor). In these cases
set the <code>spring.cloud.task.closecontextEnabled</code> property to <code>true</code> when launching your task.
This will close the application’s context once the task is complete.
Thus allowing the application to terminate.</p>
</div>
</div>
</div>
</div>
<h1 id="batch" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch">Batch</a></h1>
<div class="openblock partintro">
<div class="content">
<div id="partintro" class="openblock">
<div class="content">
<div class="paragraph">
<p>This section goes into more detail about Spring Cloud Task’s integration with Spring
Batch. Tracking the association between a job execution and the task in which it was
executed as well as remote partitioning through Spring Cloud Deployer are covered in
this section.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="batch-association"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch-association"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch-association">174. Associating a Job Execution to the Task in which It Was Executed</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Boot provides facilities for the execution of batch jobs within an über-jar.
Spring Boot’s support of this functionality lets a developer execute multiple batch jobs
within that execution. Spring Cloud Task provides the ability to associate the execution
of a job (a job execution) with a task’s execution so that one can be traced back to the
other.</p>
</div>
<div class="paragraph">
<p>Spring Cloud Task achieves this functionality by using the <code>TaskBatchExecutionListener</code>.
By default,
this listener is auto configured in any context that has both a Spring Batch Job
configured (by having a bean of type <code>Job</code> defined in the context) and the
<code>spring-cloud-task-batch</code> jar on the classpath. The listener is injected into all jobs
that meet those conditions.</p>
</div>
<div class="sect2">
<h3 id="batch-association-override"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch-association-override"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch-association-override">174.1. Overriding the TaskBatchExecutionListener</a></h3>
<div class="paragraph">
<p>To prevent the listener from being injected into any batch jobs within the current
context, you can disable the autoconfiguration by using standard Spring Boot mechanisms.</p>
</div>
<div class="paragraph">
<p>To only have the listener injected into particular jobs within the context, override the
<code>batchTaskExecutionListenerBeanPostProcessor</code> and provide a list of job bean IDs, as shown
in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> TaskBatchExecutionListenerBeanPostProcessor <span class="hljs-title">batchTaskExecutionListenerBeanPostProcessor</span><span class="hljs-params">()</span> </span>{
    TaskBatchExecutionListenerBeanPostProcessor postProcessor =
        <span class="hljs-keyword">new</span> TaskBatchExecutionListenerBeanPostProcessor();

    postProcessor.setJobNames(Arrays.asList(<span class="hljs-keyword">new</span> String[] {<span class="hljs-string">"job1"</span>, <span class="hljs-string">"job2"</span>}));

    <span class="hljs-keyword">return</span> postProcessor;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can find a sample batch application in the samples module of the Spring Cloud
Task Project,
<a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples/batch-job">here</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="batch-partitioning"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch-partitioning"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch-partitioning">175. Remote Partitioning</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Deployer provides facilities for launching Spring Boot-based applications on
most cloud infrastructures. The <code>DeployerPartitionHandler</code> and
<code>DeployerStepExecutionHandler</code> delegate the launching of worker step executions to Spring
Cloud Deployer.</p>
</div>
<div class="paragraph">
<p>To configure the <code>DeployerStepExecutionHandler</code>, you must provide a <code>Resource</code>
representing the Spring Boot über-jar to be executed, a <code>TaskLauncher</code>, and a
<code>JobExplorer</code>. You can configure any environment properties as well as the max number of
workers to be executing at once, the interval to poll for the results (defaults to 10
seconds), and a timeout (defaults to -1 or no timeout). The following example shows how
configuring this <code>PartitionHandler</code> might look:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> PartitionHandler <span class="hljs-title">partitionHandler</span><span class="hljs-params">(TaskLauncher taskLauncher,
        JobExplorer jobExplorer)</span> <span class="hljs-keyword">throws</span> Exception </span>{

    MavenProperties mavenProperties = <span class="hljs-keyword">new</span> MavenProperties();
    mavenProperties.setRemoteRepositories(<span class="hljs-keyword">new</span> HashMap&lt;&gt;(Collections.singletonMap(<span class="hljs-string">"springRepo"</span>,
        <span class="hljs-keyword">new</span> MavenProperties.RemoteRepository(repository))));

    Resource resource =
        MavenResource.parse(String.format(<span class="hljs-string">"%s:%s:%s"</span>,
                <span class="hljs-string">"io.spring.cloud"</span>,
                <span class="hljs-string">"partitioned-batch-job"</span>,
                <span class="hljs-string">"1.1.0.RELEASE"</span>), mavenProperties);

    DeployerPartitionHandler partitionHandler =
        <span class="hljs-keyword">new</span> DeployerPartitionHandler(taskLauncher, jobExplorer, resource, <span class="hljs-string">"workerStep"</span>);

    List&lt;String&gt; commandLineArgs = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(<span class="hljs-number">3</span>);
    commandLineArgs.add(<span class="hljs-string">"--spring.profiles.active=worker"</span>);
    commandLineArgs.add(<span class="hljs-string">"--spring.cloud.task.initialize.enable=false"</span>);
    commandLineArgs.add(<span class="hljs-string">"--spring.batch.initializer.enabled=false"</span>);

    partitionHandler.setCommandLineArgsProvider(
        <span class="hljs-keyword">new</span> PassThroughCommandLineArgsProvider(commandLineArgs));
    partitionHandler.setEnvironmentVariablesProvider(<span class="hljs-keyword">new</span> NoOpEnvironmentVariablesProvider());
    partitionHandler.setMaxWorkers(<span class="hljs-number">2</span>);
    partitionHandler.setApplicationName(<span class="hljs-string">"PartitionedBatchJobTask"</span>);

    <span class="hljs-keyword">return</span> partitionHandler;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When passing environment variables to partitions, each partition may
be on a different machine with different environment settings.
Consequently, you should pass only those environment variables that are required.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Notice in the example above that we have set the maximum number of workers to 2.
Setting the maximum of workers establishes the maximum number of
partitions that should be running at one time.</p>
</div>
<div class="paragraph">
<p>The <code>Resource</code> to be executed is expected to be a Spring Boot über-jar with a
<code>DeployerStepExecutionHandler</code> configured as a <code>CommandLineRunner</code> in the current context.
The repository enumerated in the preceding example should be the remote repository in
which the über-jar is located. Both the manager and worker are expected to have visibility
into the same data store being used as the job repository and task repository. Once the
underlying infrastructure has bootstrapped the Spring Boot jar and Spring Boot has
launched the <code>DeployerStepExecutionHandler</code>, the step handler executes the requested
<code>Step</code>. The following example shows how to configure the <code>DefaultStepExecutionHandler</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> DeployerStepExecutionHandler <span class="hljs-title">stepExecutionHandler</span><span class="hljs-params">(JobExplorer jobExplorer)</span> </span>{
    DeployerStepExecutionHandler handler =
        <span class="hljs-keyword">new</span> DeployerStepExecutionHandler(<span class="hljs-keyword">this</span>.context, jobExplorer, <span class="hljs-keyword">this</span>.jobRepository);

    <span class="hljs-keyword">return</span> handler;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can find a sample remote partition application in the samples module of the
Spring Cloud Task project,
<a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples/partitioned-batch-job">here</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="notes-on-developing-a-batch-partitioned-application-for-the-kubernetes-platform"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#notes-on-developing-a-batch-partitioned-application-for-the-kubernetes-platform"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#notes-on-developing-a-batch-partitioned-application-for-the-kubernetes-platform">175.1. Notes on Developing a Batch-partitioned application for the Kubernetes Platform</a></h3>
<div class="ulist">
<ul>
<li>
<p>When deploying partitioned apps on the Kubernetes platform, you must use the following
dependency for the Spring Cloud Kubernetes Deployer:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-deployer-kubernetes<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>The application name for the task application and its partitions need to follow
the following regex pattern: <code>[a-z0-9]([-a-z0-9]*[a-z0-9])</code>.
Otherwise, an exception is thrown.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="notes-on-developing-a-batch-partitioned-application-for-the-cloud-foundry-platform"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#notes-on-developing-a-batch-partitioned-application-for-the-cloud-foundry-platform"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#notes-on-developing-a-batch-partitioned-application-for-the-cloud-foundry-platform">175.2. Notes on Developing a Batch-partitioned Application for the Cloud Foundry Platform</a></h3>
<div class="ulist">
<ul>
<li>
<p>When deploying partitioned apps on the Cloud Foundry platform, you must use the
following dependencies for the Spring Cloud Foundry Deployer:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-deployer-cloudfoundry<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.projectreactor<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>reactor-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.projectreactor.ipc<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>reactor-netty<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.7.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>When configuring the partition handler, Cloud Foundry Deployment
environment variables need to be established so that the partition handler
can start the partitions. The following list shows the required environment
variables:</p>
<div class="ulist">
<ul>
<li>
<p><code>spring_cloud_deployer_cloudfoundry_url</code></p>
</li>
<li>
<p><code>spring_cloud_deployer_cloudfoundry_org</code></p>
</li>
<li>
<p><code>spring_cloud_deployer_cloudfoundry_space</code></p>
</li>
<li>
<p><code>spring_cloud_deployer_cloudfoundry_domain</code></p>
</li>
<li>
<p><code>spring_cloud_deployer_cloudfoundry_username</code></p>
</li>
<li>
<p><code>spring_cloud_deployer_cloudfoundry_password</code></p>
</li>
<li>
<p><code>spring_cloud_deployer_cloudfoundry_services</code></p>
</li>
<li>
<p><code>spring_cloud_deployer_cloudfoundry_taskTimeout</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example set of deployment environment variables for a partitioned task that
uses a <code>mysql</code> database service might resemble the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">spring_cloud_deployer_cloudfoundry_url=https://api.local.pcfdev.io
spring_cloud_deployer_cloudfoundry_org=pcfdev-org
spring_cloud_deployer_cloudfoundry_space=pcfdev-space
spring_cloud_deployer_cloudfoundry_domain=local.pcfdev.io
spring_cloud_deployer_cloudfoundry_username=admin
spring_cloud_deployer_cloudfoundry_password=admin
spring_cloud_deployer_cloudfoundry_services=mysql
spring_cloud_deployer_cloudfoundry_taskTimeout=300</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using PCF-Dev, the following environment variable is also required:
<code>spring_cloud_deployer_cloudfoundry_skipSslValidation=true</code>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="batch-informational-messages"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch-informational-messages"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch-informational-messages">176. Batch Informational Messages</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Task provides the ability for batch jobs to emit informational messages. The
“<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/stream.html#stream-integration-batch-events">stream.html</a>” section covers this feature in detail.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="batch-failures-and-tasks"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch-failures-and-tasks"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#batch-failures-and-tasks">177. Batch Job Exit Codes</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>As discussed <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/features.html#features-lifecycle-exit-codes">earlier</a>, Spring Cloud Task
applications support the ability to record the exit code of a task execution. However, in
cases where you run a Spring Batch Job within a task, regardless of how the Batch Job
Execution completes, the result of the task is always zero when using the default
Batch/Boot behavior. Keep in mind that a task is a boot application and that the exit code
returned from the task is the same as a boot application.
To override this behavior and allow the task to return an exit code other than zero when a
batch job returns an
<a href="https://docs.spring.io/spring-batch/4.0.x/reference/html/step.html#batchStatusVsExitStatus">BatchStatus</a>
of <code>FAILED</code>, set <code>spring.cloud.task.batch.fail-on-job-failure</code> to <code>true</code>. Then the exit code
can be 1 (the default) or be based on the
<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-spring-application.html#boot-features-application-exit">specified
<code>ExitCodeGenerator</code></a>)</p>
</div>
<div class="paragraph">
<p>This functionality uses a new <code>CommandLineRunner</code> that replaces the one provided by Spring
Boot. By default, it is configured with the same order. However, if you want to customize
the order in which the <code>CommandLineRunner</code> is run, you can set its order by setting the
<code>spring.cloud.task.batch.commandLineRunnerOrder</code> property. To have your task return the
exit code based on the result of the batch job execution, you need to write your own
<code>CommandLineRunner</code>.</p>
</div>
</div>
</div>
<h1 id="stream-integration" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration">Spring Cloud Stream Integration</a></h1>
<div class="openblock partintro">
<div class="content">
<div id="partintro" class="openblock">
<div class="content">
<div class="paragraph">
<p>A task by itself can be useful, but integration of a task into a larger ecosystem lets it
be useful for more complex processing and orchestration. This section
covers the integration options for Spring Cloud Task with Spring Cloud Stream.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stream-integration-launching-sink"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration-launching-sink"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration-launching-sink">178. Launching a Task from a Spring Cloud Stream</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can launch tasks from a stream. To do so, create a sink that listens for a message
that contains a <code>TaskLaunchRequest</code> as its payload. The <code>TaskLaunchRequest</code> contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>uri</code>: To the task artifact that is to be executed.</p>
</li>
<li>
<p><code>applicationName</code>: The name that is associated with the task. If no
applicationName is set, the <code>TaskLaunchRequest</code> generates a task name
comprised of the following: <code>Task-&lt;UUID&gt;</code>.</p>
</li>
<li>
<p><code>commandLineArguments</code>: A list containing the command line arguments for the task.</p>
</li>
<li>
<p><code>environmentProperties</code>: A map containing the environment variables to be used by the
task.</p>
</li>
<li>
<p><code>deploymentProperties</code>: A map containing the properties that are used by the deployer to
deploy the task.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the payload is of a different type, the sink throws an exception.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>For example, a stream can be created that has a processor that takes in data from an
HTTP source and creates a <code>GenericMessage</code> that contains the <code>TaskLaunchRequest</code> and sends
the message to its output channel. The task sink would then receive the message from its
input channnel and then launch the task.</p>
</div>
<div class="paragraph">
<p>To create a taskSink, you need only create a Spring Boot application that includes the
<code>EnableTaskLauncher</code> annotation, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableTaskLauncher</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskSinkApplication</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        SpringApplication.run(TaskSinkApplication.class, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples">samples
module</a> of the Spring Cloud Task project contains a sample Sink and Processor. To install
these samples into your local maven repository, run a maven build from the
<code>spring-cloud-task-samples</code> directory with the <code>skipInstall</code> property set to <code>false</code>, as
shown in the following example:</p>
</div>
<div class="paragraph">
<p><code>mvn clean install</code></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>maven.remoteRepositories.springRepo.url</code> property must be set to the location
of the remote repository in which the über-jar is located. If not set, there is no remote
repository, so it relies upon the local repository only.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="stream-integration-launching-sink-dataflow"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration-launching-sink-dataflow"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration-launching-sink-dataflow">178.1. Spring Cloud Data Flow</a></h3>
<div class="paragraph">
<p>To create a stream in Spring Cloud Data Flow, you must first register the Task Sink
Application we created. In the following example, we are registering the Processor and
Sink sample applications by using the Spring Cloud Data Flow shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">app register --name taskSink --<span class="hljs-built_in">type</span> sink --uri maven://io.spring.cloud:tasksink:&lt;version&gt;
app register --name taskProcessor --<span class="hljs-built_in">type</span> processor --uri maven:io.spring.cloud:taskprocessor:&lt;version&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to create a stream from the Spring Cloud Data Flow shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">stream create foo --definition <span class="hljs-string">"http --server.port=9000|taskProcessor|taskSink"</span> --deploy</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stream-integration-events"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration-events"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration-events">179. Spring Cloud Task Events</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Task provides the ability to emit events through a Spring Cloud Stream
channel when the task is run through a Spring Cloud Stream channel. A task listener is
used to publish the <code>TaskExecution</code> on a message channel named <code>task-events</code>. This feature
is autowired into any task that has <code>spring-cloud-stream</code>, <code>spring-cloud-stream-&lt;binder&gt;</code>,
and a defined task on its classpath.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To disable the event emitting listener, set the <code>spring.cloud.task.events.enabled</code>
property to <code>false</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>With the appropriate classpath defined, the following task emits the <code>TaskExecution</code> as an
event on the <code>task-events</code> channel (at both the start and the end of the task):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskEventsApplication</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        SpringApplication.run(TaskEventsApplication.class, args);
    }

    <span class="hljs-meta">@Configuration</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskConfiguration</span> </span>{

        <span class="hljs-meta">@Bean</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> CommandLineRunner <span class="hljs-title">commandLineRunner</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CommandLineRunner() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception </span>{
                    System.out.println(<span class="hljs-string">"The CommandLineRunner was executed"</span>);
                }
            };
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A binder implementation is also required to be on the classpath.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A sample task event application can be found in the samples module
of the Spring Cloud Task Project,
<a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples/task-events">here</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="stream-integration-disable-task-events"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration-disable-task-events"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration-disable-task-events">179.1. Disabling Specific Task Events</a></h3>
<div class="paragraph">
<p>To disable task events, you can set the <code>spring.cloud.task.events.enabled</code> property to
<code>false</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stream-integration-batch-events"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration-batch-events"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stream-integration-batch-events">180. Spring Batch Events</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>When executing a Spring Batch job through a task, Spring Cloud Task can be configured to
emit informational messages based on the Spring Batch listeners available in Spring Batch.
Specifically, the following Spring Batch listeners are autoconfigured into each batch job
and emit messages on the associated Spring Cloud Stream channels when run through Spring
Cloud Task:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JobExecutionListener</code> listens for <code>job-execution-events</code></p>
</li>
<li>
<p><code>StepExecutionListener</code> listens for <code>step-execution-events</code></p>
</li>
<li>
<p><code>ChunkListener</code> listens for <code>chunk-events</code></p>
</li>
<li>
<p><code>ItemReadListener</code> listens for <code>item-read-events</code></p>
</li>
<li>
<p><code>ItemProcessListener</code> listens for <code>item-process-events</code></p>
</li>
<li>
<p><code>ItemWriteListener</code> listens for <code>item-write-events</code></p>
</li>
<li>
<p><code>SkipListener</code> listens for <code>skip-events</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These listeners are autoconfigured into any <code>AbstractJob</code> when the appropriate
beans (a <code>Job</code> and a <code>TaskLifecycleListener</code>) exist in the context. Configuration to
listen to these events is handled the same way binding to any other Spring
Cloud Stream channel is done. Our task (the one running the batch job) serves as a
<code>Source</code>, with the listening applications serving as either a <code>Processor</code> or a <code>Sink</code>.</p>
</div>
<div class="paragraph">
<p>An example could be to have an application listening to the <code>job-execution-events</code> channel
for the start and stop of a job. To configure the listening application, you would
configure the input to be <code>job-execution-events</code> as follows:</p>
</div>
<div class="paragraph">
<p><code>spring.cloud.stream.bindings.input.destination=job-execution-events</code></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A binder implementation is also required to be on the classpath.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A sample batch event application can be found in the samples module
of the Spring Cloud Task Project,
<a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples/batch-events">here</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="sending-batch-events-to-different-channels"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-batch-events-to-different-channels"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#sending-batch-events-to-different-channels">180.1. Sending Batch Events to Different Channels</a></h3>
<div class="paragraph">
<p>One of the options that Spring Cloud Task offers for batch events is the ability to alter
the channel to which a specific listener can emit its messages. To do so, use the
following configuration:
<code>spring.cloud.stream.bindings.&lt;the channel&gt;.destination=&lt;new destination&gt;</code>. For example,
if <code>StepExecutionListener</code> needs to emit its messages to another channel called
<code>my-step-execution-events</code> instead of the default <code>step-execution-events</code>, you can add the
following configuration:</p>
</div>
<div class="paragraph">
<p><code>spring.cloud.stream.bindings.step-execution-events.destination=my-step-execution-events</code></p>
</div>
</div>
<div class="sect2">
<h3 id="disabling-batch-events"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#disabling-batch-events"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#disabling-batch-events">180.2. Disabling Batch Events</a></h3>
<div class="paragraph">
<p>To disable the listener functionality for all batch events, use the following
configuration:</p>
</div>
<div class="paragraph">
<p><code>spring.cloud.task.batch.events.enabled=false</code></p>
</div>
<div class="paragraph">
<p>To disable a specific batch event, use the following configuration:</p>
</div>
<div class="paragraph">
<p><code>spring.cloud.task.batch.events.&lt;batch event listener&gt;.enabled=false</code>:</p>
</div>
<div class="paragraph">
<p>The following listing shows individual listeners that you can disable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">spring.cloud.task.batch.events.job-execution.enabled=<span class="hljs-literal">false</span>
spring.cloud.task.batch.events.step-execution.enabled=<span class="hljs-literal">false</span>
spring.cloud.task.batch.events.chunk.enabled=<span class="hljs-literal">false</span>
spring.cloud.task.batch.events.item-read.enabled=<span class="hljs-literal">false</span>
spring.cloud.task.batch.events.item-process.enabled=<span class="hljs-literal">false</span>
spring.cloud.task.batch.events.item-write.enabled=<span class="hljs-literal">false</span>
spring.cloud.task.batch.events.skip.enabled=<span class="hljs-literal">false</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="emit-order-for-batch-events"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#emit-order-for-batch-events"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#emit-order-for-batch-events">180.3. Emit Order for Batch Events</a></h3>
<div class="paragraph">
<p>By default, batch events have <code>Ordered.LOWEST_PRECEDENCE</code>. To change this value (for
example, to 5 ), use the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">spring.cloud.task.batch.events.job-execution-order=5
spring.cloud.task.batch.events.step-execution-order=5
spring.cloud.task.batch.events.chunk-order=5
spring.cloud.task.batch.events.item-read-order=5
spring.cloud.task.batch.events.item-process-order=5
spring.cloud.task.batch.events.item-write-order=5
spring.cloud.task.batch.events.skip-order=5</code></pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="appendix" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#appendix"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#appendix">Appendices</a></h1>
<div class="sect1">
<h2 id="appendix-task-repository-schema"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#appendix-task-repository-schema"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#appendix-task-repository-schema">181. Task Repository Schema</a></h2>
<div class="sectionbody">
<div id="partintro" class="openblock">
<div class="content">
<div class="paragraph">
<p>This appendix provides an ERD for the database schema used in the task repository.</p>
</div>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Spring Cloud_files/task_schema.png" alt="task schema">
</div>
</div>
<div class="sect2">
<h3 id="table-information"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#table-information"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#table-information">181.1. Table Information</a></h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<div class="title">TASK_EXECUTION</div>
<p>Stores the task execution information.</p>
</div>
<table class="tableblock frame-topbot grid-all" style="width: 80%;">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 71.4288%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column Name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Field Length</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK_EXECUTION_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIGINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Cloud Task Framework at app startup establishes the next available id as obtained from the <code>TASK_SEQ</code>. Or if the record is created outside of task then the value must be populated at record creation time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">START_TIME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FALSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DATETIME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Cloud Task Framework at app startup establishes the value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">END_TIME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FALSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DATETIME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Cloud Task Framework at app exit establishes the value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK_NAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FALSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Cloud Task Framework at app startup will set this to "Application" unless user establish the name using the spring.cloud.task.name as discussed <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-task-name">here</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXIT_CODE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FALSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INTEGER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Follows Spring Boot defaults unless overridden by the user as discussed <a href="https://docs.spring.io/spring-cloud-task/docs/current/reference/#features-lifecycle-exit-codes">here</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXIT_MESSAGE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FALSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Defined as discussed <a href="https://docs.spring.io/spring-cloud-task/docs/current/reference/#features-task-execution-listener-exit-messages">here</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERROR_MESSAGE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FALSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Cloud Task Framework at app exit establishes the value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAST_UPDATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DATETIME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Cloud Task Framework at app startup establishes the value. Or if the record is created outside of task then the value must be populated at record creation time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXTERNAL_EXECUTION_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FALSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">250</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the <code>spring.cloud.task.external-execution-id</code> property is set then Spring Cloud Task Framework at app startup will set this to the value specified. More information can be found <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-external_task_id">here</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PARENT_TASK_EXECUTION_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FALSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIGINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the <code>spring.cloud.task.parent-execution-id</code> property is set then Spring Cloud Task Framework at app startup will set this to the value specified. More information can be found <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-parent_task_id">here</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">TASK_EXECUTION_PARAMS</div>
<p>Stores the parameters used for a task execution</p>
</div>
<table class="tableblock frame-topbot grid-all" style="width: 80%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column Name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Field Length</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK_EXECUTION_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIGINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK_PARAM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FALSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">TASK_TASK_BATCH</div>
<p>Used to link the task execution to the batch execution.</p>
</div>
<table class="tableblock frame-topbot grid-all" style="width: 80%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column Name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Field Length</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK_EXECUTION_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIGINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JOB_EXECUTION_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIGINT</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">TASK_LOCK</div>
<p>Used for the <code>single-instance-enabled</code> feature discussed <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#features-single-instance-enabled">here</a>.</p>
</div>
<table class="tableblock frame-topbot grid-all" style="width: 80%;">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 71.4288%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column Name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Field Length</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCK_KEY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">36</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UUID for the this lock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REGION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User can establish a group of locks using this field.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLIENT_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">36</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task execution id that contains the name of the app to lock.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CREATED_DATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DATETIME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date that the entry was created</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The DDL for setting up tables for each database type can be found <a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-core/src/main/resources/org/springframework/cloud/task">here</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix-building-the-documentation"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#appendix-building-the-documentation"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#appendix-building-the-documentation">182. Building This Documentation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This project uses Maven to generate this documentation. To generate it for yourself,
run the following command: <code>$ ./mvnw clean package -P full</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix-cloud-foundry"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#appendix-cloud-foundry"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#appendix-cloud-foundry">183. Running a Task App on Cloud Foundry</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simplest way to launch a Spring Cloud Task application as a task on Cloud Foundry
is to use Spring Cloud Data Flow. Via Spring Cloud Data Flow you can register your task application,
create a definition for it and then launch it. You then can track the task execution(s)
via a RESTful API, the Spring Cloud Data Flow Shell, or the UI. To learn out to get started installing Data Flow
follow the instructions in the
<a href="https://docs.spring.io/spring-cloud-dataflow/docs/current/reference/htmlsingle/#getting-started">Getting Started</a>
section of the reference documentation. For info on how to register and launch tasks, see the <a href="https://docs.spring.io/spring-cloud-dataflow/docs/current/reference/htmlsingle/#_the_lifecycle_of_a_task">Lifecycle of a Task</a> documentation.</p>
</div>
</div>
</div>
<h1 id="spring-cloud-vault" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-vault"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-vault">Spring Cloud Vault</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>© 2016-2020 The original authors.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</em>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Spring Cloud Vault Config provides client-side support for externalized configuration in a distributed system.
With <a href="https://www.vaultproject.io/">HashiCorp’s Vault</a> you have a central place to manage external secret properties for applications across all environments.
Vault can manage static and dynamic secrets such as username/password for remote applications/resources and provide credentials for external services such as MySQL, PostgreSQL, Apache Cassandra, MongoDB, Consul, AWS and more.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quick-start-4"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quick-start-4"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quick-start-4">184. Quick Start</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Prerequisites</strong></p>
</div>
<div class="paragraph">
<p>To get started with Vault and this guide you need a *NIX-like operating systems that provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>wget</code>, <code>openssl</code> and <code>unzip</code></p>
</li>
<li>
<p>at least Java 8 and a properly configured <code>JAVA_HOME</code> environment variable</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This guide explains Vault setup from a Spring Cloud Vault perspective for integration testing.
You can find a getting started guide directly on the Vault project site: <a href="https://learn.hashicorp.com/vault" class="bare">learn.hashicorp.com/vault</a>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><strong>Install Vault</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ wget https://releases.hashicorp.com/vault/<span class="hljs-variable">${vault_version}</span>/vault_<span class="hljs-variable">${vault_version}</span>_<span class="hljs-variable">${platform}</span>.zip
$ unzip vault_<span class="hljs-variable">${vault_version}</span>_<span class="hljs-variable">${platform}</span>.zip</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These steps can be achieved by downloading and running <a href="https://github.com/spring-cloud/spring-cloud-vault/blob/master/src/test/bash/install_vault.sh"><code>install_vault.sh</code></a>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><strong>Create SSL certificates for Vault</strong></p>
</div>
<div class="paragraph">
<p>Next, you’r required to generate a set of certificates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Root CA</p>
</li>
<li>
<p>Vault Certificate (decrypted key <code>work/ca/private/localhost.decrypted.key.pem</code> and certificate <code>work/ca/certs/localhost.cert.pem</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Make sure to import the Root Certificate into a Java-compliant truststore.</p>
</div>
<div class="paragraph">
<p>The easiest way to achieve this is by using OpenSSL.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="https://github.com/spring-cloud/spring-cloud-vault/blob/master/src/test/bash/"><code>create_certificates.sh</code></a> creates certificates in <code>work/ca</code> and a JKS truststore <code>work/keystore.jks</code>.
If you want to run Spring Cloud Vault using this quickstart guide you need to configure the truststore the <code>spring.cloud.vault.ssl.trust-store</code> property to <code>file:work/keystore.jks</code>.
</td>
</tr>
</tbody></table>
</div>
<div id="quickstart.vault.start" class="paragraph">
<p><strong>Start Vault server</strong></p>
</div>
<div class="paragraph">
<p>Next create a config file along the lines of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">backend <span class="hljs-string">"inmem"</span> {
}

listener <span class="hljs-string">"tcp"</span> {
  address = <span class="hljs-string">"0.0.0.0:8200"</span>
  tls_cert_file = <span class="hljs-string">"work/ca/certs/localhost.cert.pem"</span>
  tls_key_file = <span class="hljs-string">"work/ca/private/localhost.decrypted.key.pem"</span>
}

disable_mlock = <span class="hljs-literal">true</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can find an example config file at <a href="https://github.com/spring-clod/spring-cloud-vault/blob/master/src/test/bash/vault.conf"><code>vault.conf</code></a>.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ vault server -config=vault.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vault is started listening on <code>0.0.0.0:8200</code> using the <code>inmem</code> storage and <code>https</code>.
Vault is sealed and not initialized when starting up.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you want to run tests, leave Vault uninitialized.
The tests will initialize Vault and create a root token <code>00000000-0000-0000-0000-000000000000</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you want to use Vault for your application or give it a try then you need to initialize it first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ <span class="hljs-built_in">export</span> VAULT_ADDR=<span class="hljs-string">"https://localhost:8200"</span>
$ <span class="hljs-built_in">export</span> VAULT_SKIP_VERIFY=<span class="hljs-literal">true</span> <span class="hljs-comment"># Don't do this for production</span>
$ vault init</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Key 1: 7149c6a2e16b8833f6eb1e76df03e47f6113a3288b3093faf5033d44f0e70fe701
Key 2: 901c534c7988c18c20435a85213c683bdcf0efcd82e38e2893779f152978c18c02
Key 3: 03ff3948575b1165a20c20ee7c3e6edf04f4cdbe0e82dbff5be49c63f98bc03a03
Key 4: 216ae5cc3ddaf93ceb8e1d15bb9fc3176653f5b738f5f3d1ee00cd7dccbe926e04
Key 5: b2898fc8130929d569c1677ee69dc5f3be57d7c4b494a6062693ce0b1c4d93d805
Initial Root Token: 19aefa97-cccc-bbbb-aaaa-225940e63d76

Vault initialized with 5 keys and a key threshold of 3. Please
securely distribute the above keys. When the Vault is re-sealed,
restarted, or stopped, you must provide at least 3 of these keys
to unseal it again.

Vault does not store the master key. Without at least 3 keys,
your Vault will remain permanently sealed.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vault will initialize and return a set of unsealing keys and the root token.
Pick 3 keys and unseal Vault.
Store the Vault token in the <code>VAULT_TOKEN</code>
environment variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ vault unseal (Key 1)
$ vault unseal (Key 2)
$ vault unseal (Key 3)
$ <span class="hljs-built_in">export</span> VAULT_TOKEN=(Root token)
<span class="hljs-comment"># Required to run Spring Cloud Vault tests after manual initialization</span>
$ vault token-create -id=<span class="hljs-string">"00000000-0000-0000-0000-000000000000"</span> -policy=<span class="hljs-string">"root"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Cloud Vault accesses different resources.
By default, the secret backend is enabled which accesses secret config settings via JSON endpoints.</p>
</div>
<div class="paragraph">
<p>The HTTP service has resources in the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/secret/{application}/{profile}
/secret/{application}
/secret/{defaultContext}/{profile}
/secret/{defaultContext}</pre>
</div>
</div>
<div class="paragraph">
<p>where the "application" is injected as the <code>spring.application.name</code> in the
<code>SpringApplication</code> (i.e. what is normally "application" in a regular Spring Boot app), "profile" is an active profile (or comma-separated list of properties).
Properties retrieved from Vault will be used "as-is" without further prefixing of the property names.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="client-side-usage-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#client-side-usage-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#client-side-usage-2">185. Client Side Usage</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use these features in an application, just build it as a Spring Boot application that depends on <code>spring-cloud-vault-config</code> (e.g. see the test cases).
Example Maven configuration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 81. pom.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.0.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span> /&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-vault-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>

<span class="hljs-comment">&lt;!-- repositories also needed for snapshots and milestones --&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then you can create a standard Spring Boot application, like this simple HTTP server:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{

    <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">home</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello World!"</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        SpringApplication.run(Application.class, args);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When it runs it will pick up the external configuration from the default local Vault server on port <code>8200</code> if it is running.
To modify the startup behavior you can change the location of the Vault server using <code>bootstrap.properties</code> (like <code>application.properties</code> but for the bootstrap phase of an application context), e.g.</p>
</div>
<div class="exampleblock">
<div class="title">Example 82. bootstrap.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    host: localhost
    port: 8200
    scheme: https
    uri: https://localhost:8200
    connection-timeout: 5000
    read-timeout: 15000
    config:
        order: -10</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>host</code> sets the hostname of the Vault host.
The host name will be used for SSL certificate validation</p>
</li>
<li>
<p><code>port</code> sets the Vault port</p>
</li>
<li>
<p><code>scheme</code> setting the scheme to <code>http</code> will use plain HTTP.
Supported schemes are <code>http</code> and <code>https</code>.</p>
</li>
<li>
<p><code>uri</code> configure the Vault endpoint with an URI. Takes precedence over host/port/scheme configuration</p>
</li>
<li>
<p><code>connection-timeout</code> sets the connection timeout in milliseconds</p>
</li>
<li>
<p><code>read-timeout</code> sets the read timeout in milliseconds</p>
</li>
<li>
<p><code>config.order</code> sets the order for the property source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Enabling further integrations requires additional dependencies and configuration.
Depending on how you have set up Vault you might need additional configuration like
<a href="https://cloud.spring.io/spring-cloud-vault/spring-cloud-vault.html#vault.config.ssl">SSL</a> and
<a href="https://cloud.spring.io/spring-cloud-vault/spring-cloud-vault.html#vault.config.authentication">authentication</a>.</p>
</div>
<div class="paragraph">
<p>If the application imports the <code>spring-boot-starter-actuator</code> project, the status of the vault server will be available via the <code>/health</code> endpoint.</p>
</div>
<div class="paragraph">
<p>The vault health indicator can be enabled or disabled through the property <code>management.health.vault.enabled</code> (default to <code>true</code>).</p>
</div>
<div class="sect2">
<h3 id="authentication-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#authentication-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#authentication-2">185.1. Authentication</a></h3>
<div class="paragraph">
<p>Vault requires an <a href="https://www.vaultproject.io/docs/concepts/auth.html">authentication mechanism</a> to <a href="https://www.vaultproject.io/docs/concepts/tokens.html">authorize client requests</a>.</p>
</div>
<div class="paragraph">
<p>Spring Cloud Vault supports multiple <a href="https://cloud.spring.io/spring-cloud-vault/spring-cloud-vault.html#vault.config.authentication">authentication mechanisms</a> to authenticate applications with Vault.</p>
</div>
<div class="paragraph">
<p>For a quickstart, use the root token printed by the <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#quickstart.vault.start">Vault initialization</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 83. bootstrap.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    token: 19aefa97-cccc-bbbb-aaaa-225940e63d76</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Consider carefully your security requirements.
Static token authentication is fine if you want quickly get started with Vault, but a static token is not protected any further.
Any disclosure to unintended parties allows Vault use with the associated token roles.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vault.config.authentication"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication">186. Authentication methods</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Different organizations have different requirements for security and authentication.
Vault reflects that need by shipping multiple authentication methods.
Spring Cloud Vault supports token and AppId authentication.</p>
</div>
<div class="sect2">
<h3 id="vault.config.authentication.token"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.token"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.token">186.1. Token authentication</a></h3>
<div class="paragraph">
<p>Tokens are the core method for authentication within Vault.
Token authentication requires a static token to be provided using the
<a href="https://github.com/spring-cloud/spring-cloud-commons/blob/master/docs/src/main/asciidoc/spring-cloud-commons.adoc#the-bootstrap-application-context">Bootstrap Application Context</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Token authentication is the default authentication method.
If a token is disclosed an unintended party gains access to Vault and can access secrets for the intended client.
</td>
</tr>
</tbody></table>
</div>
<div class="exampleblock">
<div class="title">Example 84. bootstrap.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: TOKEN
    token: 00000000-0000-0000-0000-000000000000</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>authentication</code> setting this value to <code>TOKEN</code> selects the Token authentication method</p>
</li>
<li>
<p><code>token</code> sets the static token to use</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/concepts/tokens.html">Vault Documentation: Tokens</a></p>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.authentication.vault-agent"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.vault-agent"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.vault-agent">186.2. Vault Agent authentication</a></h3>
<div class="paragraph">
<p>Vault ships a sidecar utility with Vault Agent since version 0.11.0. Vault Agent implements the functionality of Spring Vault’s <code>SessionManager</code>
with its Auto-Auth feature.
Applications can reuse cached session credentials by relying on Vault Agent running on <code>localhost</code>.
Spring Vault can send requests without the
<code>X-Vault-Token</code> header.
Disable Spring Vault’s authentication infrastructure to disable client authentication and session management.</p>
</div>
<div class="exampleblock">
<div class="title">Example 85. bootstrap.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: NONE</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>authentication</code> setting this value to <code>NONE</code> disables <code>ClientAuthentication</code>
and <code>SessionManager</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/agent/index.html">Vault Documentation: Agent</a></p>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.authentication.appid"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.appid"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.appid">186.3. AppId authentication</a></h3>
<div class="paragraph">
<p>Vault supports <a href="https://www.vaultproject.io/docs/auth/app-id.html">AppId</a>
authentication that consists of two hard to guess tokens.
The AppId defaults to <code>spring.application.name</code> that is statically configured.
The second token is the UserId which is a part determined by the application, usually related to the runtime environment.
IP address, Mac address or a Docker container name are good examples.
Spring Cloud Vault Config supports IP address, Mac address and static UserId’s (e.g. supplied via System properties).
The IP and Mac address are represented as Hex-encoded SHA256 hash.</p>
</div>
<div class="paragraph">
<p>IP address-based UserId’s use the local host’s IP address.</p>
</div>
<div class="exampleblock">
<div class="title">Example 86. bootstrap.yml using SHA256 IP-Address UserId’s</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: APPID
    app-id:
        user-id: IP_ADDRESS</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>authentication</code> setting this value to <code>APPID</code> selects the AppId authentication method</p>
</li>
<li>
<p><code>app-id-path</code> sets the path of the AppId mount to use</p>
</li>
<li>
<p><code>user-id</code> sets the UserId method.
Possible values are <code>IP_ADDRESS</code>,
<code>MAC_ADDRESS</code> or a class name implementing a custom <code>AppIdUserIdMechanism</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The corresponding command to generate the IP address UserId from a command line is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ echo -n 192.168.99.1 | sha256sum</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Including the line break of <code>echo</code> leads to a different hash value so make sure to include the <code>-n</code> flag.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Mac address-based UserId’s obtain their network device from the localhost-bound device.
The configuration also allows specifying a <code>network-interface</code> hint to pick the right device.
The value of
<code>network-interface</code> is optional and can be either an interface name or interface index (0-based).</p>
</div>
<div class="exampleblock">
<div class="title">Example 87. bootstrap.yml using SHA256 Mac-Address UserId’s</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: APPID
    app-id:
        user-id: MAC_ADDRESS
        network-interface: eth0</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>network-interface</code> sets network interface to obtain the physical address</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The corresponding command to generate the IP address UserId from a command line is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ echo -n 0AFEDE1234AC | sha256sum</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Mac address is specified uppercase and without colons.
Including the line break of <code>echo</code> leads to a different hash value so make sure to include the <code>-n</code> flag.
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="custom-userid"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-userid"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#custom-userid">186.3.1. Custom UserId</a></h4>
<div class="paragraph">
<p>The UserId generation is an open mechanism.
You can set
<code>spring.cloud.vault.app-id.user-id</code> to any string and the configured value will be used as static UserId.</p>
</div>
<div class="paragraph">
<p>A more advanced approach lets you set <code>spring.cloud.vault.app-id.user-id</code> to a classname.
This class must be on your classpath and must implement the <code>org.springframework.cloud.vault.AppIdUserIdMechanism</code> interface and the <code>createUserId</code> method.
Spring Cloud Vault will obtain the UserId by calling <code>createUserId</code> each time it authenticates using AppId to obtain a token.</p>
</div>
<div class="exampleblock">
<div class="title">Example 88. bootstrap.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: APPID
    app-id:
        user-id: com.examlple.MyUserIdMechanism</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 89. MyUserIdMechanism.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">public class MyUserIdMechanism implements AppIdUserIdMechanism {

  @Override
  public String createUserId() {
    String userId = ...
    return userId;
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/auth/app-id.html">Vault Documentation: Using the App ID auth backend</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="approle-authentication"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#approle-authentication"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#approle-authentication">186.4. AppRole authentication</a></h3>
<div class="paragraph">
<p><a href="https://www.vaultproject.io/docs/auth/app-id.html">AppRole</a> is intended for machine authentication, like the deprecated (since Vault 0.6.1) <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.appid">AppId authentication</a>.
AppRole authentication consists of two hard to guess (secret) tokens: RoleId and SecretId.</p>
</div>
<div class="paragraph">
<p>Spring Vault supports various AppRole scenarios (push/pull mode and wrapped).</p>
</div>
<div class="paragraph">
<p>RoleId and optionally SecretId must be provided by configuration, Spring Vault will not look up these or create a custom SecretId.</p>
</div>
<div class="exampleblock">
<div class="title">Example 90. bootstrap.yml with AppRole authentication properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: APPROLE
    app-role:
        role-id: bde2076b-cccb-3cf0-d57e-bca7b1e83a52</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following scenarios are supported along the required configuration details:</p>
</div>
<table class="tableblock frame-topbot grid-all stretch">
<caption class="title">Table 11. Configuration</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RoleId</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SecretId</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RoleName</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Token</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided RoleId/SecretId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided RoleId without SecretId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided RoleId, Pull SecretId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pull RoleId, provided SecretId</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full Pull Mode</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wrapped</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wrapped RoleId, provided SecretId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided RoleId, wrapped SecretId</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-topbot grid-all stretch">
<caption class="title">Table 12. Pull/Push/Wrapped Matrix</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RoleId</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SecretId</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Supported</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wrapped</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Absent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wrapped</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Absent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wrapped</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provided</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wrapped</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wrapped</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wrapped</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wrapped</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Absent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can use still all combinations of push/pull/wrapped modes by providing a configured <code>AppRoleAuthentication</code> bean within the bootstrap context.
Spring Cloud Vault cannot derive all possible AppRole combinations from the configuration properties.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
AppRole authentication is limited to simple pull mode using reactive infrastructure.
Full pull mode is not yet supported.
Using Spring Cloud Vault with the Spring WebFlux stack enables Vault’s reactive auto-configuration which can be disabled by setting <code>spring.cloud.vault.reactive.enabled=false</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="exampleblock">
<div class="title">Example 91. bootstrap.yml with all AppRole authentication properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: APPROLE
    app-role:
        role-id: bde2076b-cccb-3cf0-d57e-bca7b1e83a52
        secret-id: 1696536f-1976-73b1-b241-0b4213908d39
        role: my-role
        app-role-path: approle</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>role-id</code> sets the RoleId.</p>
</li>
<li>
<p><code>secret-id</code> sets the SecretId.
SecretId can be omitted if AppRole is configured without requiring SecretId (See <code>bind_secret_id</code>).</p>
</li>
<li>
<p><code>role</code>: sets the AppRole name for pull mode.</p>
</li>
<li>
<p><code>app-role-path</code> sets the path of the approle authentication mount to use.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/auth/approle.html">Vault Documentation: Using the AppRole auth backend</a></p>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.authentication.awsec2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.awsec2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.awsec2">186.5. AWS-EC2 authentication</a></h3>
<div class="paragraph">
<p>The <a href="https://www.vaultproject.io/docs/auth/aws-ec2.html">aws-ec2</a>
auth backend provides a secure introduction mechanism for AWS EC2 instances, allowing automated retrieval of a Vault token.
Unlike most Vault authentication backends, this backend does not require first-deploying, or provisioning security-sensitive credentials (tokens, username/password, client certificates, etc.).
Instead, it treats AWS as a Trusted Third Party and uses the cryptographically signed dynamic metadata information that uniquely represents each EC2 instance.</p>
</div>
<div class="exampleblock">
<div class="title">Example 92. bootstrap.yml using AWS-EC2 Authentication</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: AWS_EC2</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>AWS-EC2 authentication enables nonce by default to follow the Trust On First Use (TOFU) principle.
Any unintended party that gains access to the PKCS#7 identity metadata can authenticate against Vault.</p>
</div>
<div class="paragraph">
<p>During the first login, Spring Cloud Vault generates a nonce that is stored in the auth backend aside the instance Id.
Re-authentication requires the same nonce to be sent.
Any other party does not have the nonce and can raise an alert in Vault for further investigation.</p>
</div>
<div class="paragraph">
<p>The nonce is kept in memory and is lost during application restart.
You can configure a static nonce with <code>spring.cloud.vault.aws-ec2.nonce</code>.</p>
</div>
<div class="paragraph">
<p>AWS-EC2 authentication roles are optional and default to the AMI.
You can configure the authentication role by setting the
<code>spring.cloud.vault.aws-ec2.role</code> property.</p>
</div>
<div class="exampleblock">
<div class="title">Example 93. bootstrap.yml with configured role</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: AWS_EC2
    aws-ec2:
        role: application-server</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 94. bootstrap.yml with all AWS EC2 authentication properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: AWS_EC2
    aws-ec2:
        role: application-server
        aws-ec2-path: aws-ec2
        identity-document: http://...
        nonce: my-static-nonce</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>authentication</code> setting this value to <code>AWS_EC2</code> selects the AWS EC2 authentication method</p>
</li>
<li>
<p><code>role</code> sets the name of the role against which the login is being attempted.</p>
</li>
<li>
<p><code>aws-ec2-path</code> sets the path of the AWS EC2 mount to use</p>
</li>
<li>
<p><code>identity-document</code> sets URL of the PKCS#7 AWS EC2 identity document</p>
</li>
<li>
<p><code>nonce</code> used for AWS-EC2 authentication.
An empty nonce defaults to nonce generation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/auth/aws.html">Vault Documentation: Using the aws auth backend</a></p>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.authentication.awsiam"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.awsiam"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.awsiam">186.6. AWS-IAM authentication</a></h3>
<div class="paragraph">
<p>The <a href="https://www.vaultproject.io/docs/auth/aws-ec2.html">aws</a> backend provides a secure authentication mechanism for AWS IAM roles, allowing the automatic authentication with vault based on the current IAM role of the running application.
Unlike most Vault authentication backends, this backend does not require first-deploying, or provisioning security-sensitive credentials (tokens, username/password, client certificates, etc.).
Instead, it treats AWS as a Trusted Third Party and uses the 4 pieces of information signed by the caller with their IAM credentials to verify that the caller is indeed using that IAM role.</p>
</div>
<div class="paragraph">
<p>The current IAM role the application is running in is automatically calculated.
If you are running your application on AWS ECS then the application will use the IAM role assigned to the ECS task of the running container.
If you are running your application naked on top of an EC2 instance then the IAM role used will be the one assigned to the EC2 instance.</p>
</div>
<div class="paragraph">
<p>When using the AWS-IAM authentication you must create a role in Vault and assign it to your IAM role.
An empty <code>role</code> defaults to the friendly name the current IAM role.</p>
</div>
<div class="exampleblock">
<div class="title">Example 95. bootstrap.yml with required AWS-IAM Authentication properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: AWS_IAM</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 96. bootstrap.yml with all AWS-IAM Authentication properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: AWS_IAM
    aws-iam:
        role: my-dev-role
        aws-path: aws
        server-name: some.server.name
        endpoint-uri: https://sts.eu-central-1.amazonaws.com</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>role</code> sets the name of the role against which the login is being attempted.
This should be bound to your IAM role.
If one is not supplied then the friendly name of the current IAM user will be used as the vault role.</p>
</li>
<li>
<p><code>aws-path</code> sets the path of the AWS mount to use</p>
</li>
<li>
<p><code>server-name</code> sets the value to use for the <code>X-Vault-AWS-IAM-Server-ID</code> header preventing certain types of replay attacks.</p>
</li>
<li>
<p><code>endpoint-uri</code> sets the value to use for the AWS STS API used for the <code>iam_request_url</code> parameter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>AWS-IAM requires the AWS Java SDK dependency (<code>com.amazonaws:aws-java-sdk-core</code>) as the authentication implementation uses AWS SDK types for credentials and request signing.</p>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/auth/aws.html">Vault Documentation: Using the aws auth backend</a></p>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.authentication.azuremsi"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.azuremsi"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.azuremsi">186.7. Azure MSI authentication</a></h3>
<div class="paragraph">
<p>The <a href="https://www.vaultproject.io/docs/auth/azure.html">azure</a>
auth backend provides a secure introduction mechanism for Azure VM instances, allowing automated retrieval of a Vault token.
Unlike most Vault authentication backends, this backend does not require first-deploying, or provisioning security-sensitive credentials (tokens, username/password, client certificates, etc.).
Instead, it treats Azure as a Trusted Third Party and uses the managed service identity and instance metadata information that can be bound to a VM instance.</p>
</div>
<div class="exampleblock">
<div class="title">Example 97. bootstrap.yml with required Azure Authentication properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: AZURE_MSI
    azure-msi:
        role: my-dev-role</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 98. bootstrap.yml with all Azure Authentication properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: AZURE_MSI
    azure-msi:
        role: my-dev-role
        azure-path: azure</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>role</code> sets the name of the role against which the login is being attempted.</p>
</li>
<li>
<p><code>azure-path</code> sets the path of the Azure mount to use</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Azure MSI authentication fetches environmental details about the virtual machine (subscription Id, resource group, VM name) from the instance metadata service.</p>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/auth/azure.html">Vault Documentation: Using the azure auth backend</a></p>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.authentication.clientcert"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.clientcert"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.clientcert">186.8. TLS certificate authentication</a></h3>
<div class="paragraph">
<p>The <code>cert</code> auth backend allows authentication using SSL/TLS client certificates that are either signed by a CA or self-signed.</p>
</div>
<div class="paragraph">
<p>To enable <code>cert</code> authentication you need to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use SSL, see <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.ssl">Vault Client SSL configuration</a></p>
</li>
<li>
<p>Configure a Java <code>Keystore</code> that contains the client certificate and the private key</p>
</li>
<li>
<p>Set the <code>spring.cloud.vault.authentication</code> to <code>CERT</code></p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="title">Example 99. bootstrap.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: CERT
    ssl:
        key-store: classpath:keystore.jks
        key-store-password: changeit
        cert-auth-path: cert</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/auth/cert.html">Vault Documentation: Using the Cert auth backend</a></p>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.authentication.cubbyhole"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.cubbyhole"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.cubbyhole">186.9. Cubbyhole authentication</a></h3>
<div class="paragraph">
<p>Cubbyhole authentication uses Vault primitives to provide a secured authentication workflow.
Cubbyhole authentication uses tokens as primary login method.
An ephemeral token is used to obtain a second, login VaultToken from Vault’s Cubbyhole secret backend.
The login token is usually longer-lived and used to interact with Vault.
The login token will be retrieved from a wrapped response stored at <code>/cubbyhole/response</code>.</p>
</div>
<div class="paragraph">
<p><strong>Creating a wrapped token</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Response Wrapping for token creation requires Vault 0.6.0 or higher.
</td>
</tr>
</tbody></table>
</div>
<div class="exampleblock">
<div class="title">Example 100. Creating and storing tokens</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"><span class="hljs-meta">$</span><span class="bash"> vault token-create -wrap-ttl=<span class="hljs-string">"10m"</span></span>
Key                            Value
---                            -----
wrapping_token:                397ccb93-ff6c-b17b-9389-380b01ca2645
wrapping_token_ttl:            0h10m0s
wrapping_token_creation_time:  2016-09-18 20:29:48.652957077 +0200 CEST
wrapped_accessor:              46b6aebb-187f-932a-26d7-4f3d86a68319</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 101. bootstrap.yml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: CUBBYHOLE
    token: 397ccb93-ff6c-b17b-9389-380b01ca2645</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.vaultproject.io/docs/concepts/tokens.html">Vault Documentation: Tokens</a></p>
</li>
<li>
<p><a href="https://www.vaultproject.io/docs/secrets/cubbyhole/index.html">Vault Documentation: Cubbyhole Secret Backend</a></p>
</li>
<li>
<p><a href="https://www.vaultproject.io/docs/concepts/response-wrapping.html">Vault Documentation: Response Wrapping</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.authentication.gcpgce"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.gcpgce"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.gcpgce">186.10. GCP-GCE authentication</a></h3>
<div class="paragraph">
<p>The <a href="https://www.vaultproject.io/docs/auth/gcp.html">gcp</a>
auth backend allows Vault login by using existing GCP (Google Cloud Platform) IAM and GCE credentials.</p>
</div>
<div class="paragraph">
<p>GCP GCE (Google Compute Engine) authentication creates a signature in the form of a JSON Web Token (JWT) for a service account.
A JWT for a Compute Engine instance is obtained from the GCE metadata service using <a href="https://cloud.google.com/compute/docs/instances/verifying-instance-identity">Instance identification</a>.
This API creates a JSON Web Token that can be used to confirm the instance identity.</p>
</div>
<div class="paragraph">
<p>Unlike most Vault authentication backends, this backend does not require first-deploying, or provisioning security-sensitive credentials (tokens, username/password, client certificates, etc.).
Instead, it treats GCP as a Trusted Third Party and uses the cryptographically signed dynamic metadata information that uniquely represents each GCP service account.</p>
</div>
<div class="exampleblock">
<div class="title">Example 102. bootstrap.yml with required GCP-GCE Authentication properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: GCP_GCE
    gcp-gce:
        role: my-dev-role</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 103. bootstrap.yml with all GCP-GCE Authentication properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: GCP_GCE
    gcp-gce:
        gcp-path: gcp
        role: my-dev-role
        service-account: my-service@projectid.iam.gserviceaccount.com</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>role</code> sets the name of the role against which the login is being attempted.</p>
</li>
<li>
<p><code>gcp-path</code> sets the path of the GCP mount to use</p>
</li>
<li>
<p><code>service-account</code> allows overriding the service account Id to a specific value.
Defaults to the <code>default</code> service account.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.vaultproject.io/docs/auth/gcp.html">Vault Documentation: Using the GCP auth backend</a></p>
</li>
<li>
<p><a href="https://cloud.google.com/compute/docs/instances/verifying-instance-identity">GCP Documentation: Verifying the Identity of Instances</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.authentication.gcpiam"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.gcpiam"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.gcpiam">186.11. GCP-IAM authentication</a></h3>
<div class="paragraph">
<p>The <a href="https://www.vaultproject.io/docs/auth/gcp.html">gcp</a>
auth backend allows Vault login by using existing GCP (Google Cloud Platform) IAM and GCE credentials.</p>
</div>
<div class="paragraph">
<p>GCP IAM authentication creates a signature in the form of a JSON Web Token (JWT) for a service account.
A JWT for a service account is obtained by calling GCP IAM’s <a href="https://cloud.google.com/iam/reference/rest/v1/projects.serviceAccounts/signJwt"><code>projects.serviceAccounts.signJwt</code></a> API. The caller authenticates against GCP IAM and proves thereby its identity.
This Vault backend treats GCP as a Trusted Third Party.</p>
</div>
<div class="paragraph">
<p>IAM credentials can be obtained from either the runtime environment , specifically the <a href="https://cloud.google.com/docs/authentication/production"><code>GOOGLE_APPLICATION_CREDENTIALS</code></a>
environment variable, the Google Compute metadata service, or supplied externally as e.g. JSON or base64 encoded.
JSON is the preferred form as it carries the project id and service account identifier required for calling <code>projects.serviceAccounts.signJwt</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 104. bootstrap.yml with required GCP-IAM Authentication properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: GCP_IAM
    gcp-iam:
        role: my-dev-role</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 105. bootstrap.yml with all GCP-IAM Authentication properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: GCP_IAM
    gcp-iam:
        credentials:
            location: classpath:credentials.json
            encoded-key: e+KApn0=
        gcp-path: gcp
        jwt-validity: 15m
        project-id: my-project-id
        role: my-dev-role
        service-account-id: my-service@projectid.iam.gserviceaccount.com</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>role</code> sets the name of the role against which the login is being attempted.</p>
</li>
<li>
<p><code>credentials.location</code> path to the credentials resource that contains Google credentials in JSON format.</p>
</li>
<li>
<p><code>credentials.encoded-key</code> the base64 encoded contents of an OAuth2 account private key in the JSON format.</p>
</li>
<li>
<p><code>gcp-path</code> sets the path of the GCP mount to use</p>
</li>
<li>
<p><code>jwt-validity</code> configures the JWT token validity.
Defaults to 15 minutes.</p>
</li>
<li>
<p><code>project-id</code> allows overriding the project Id to a specific value.
Defaults to the project Id from the obtained credential.</p>
</li>
<li>
<p><code>service-account</code> allows overriding the service account Id to a specific value.
Defaults to the service account from the obtained credential.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>GCP IAM authentication requires the Google Cloud Java SDK dependency (<code>com.google.apis:google-api-services-iam</code> and <code>com.google.auth:google-auth-library-oauth2-http</code>) as the authentication implementation uses Google APIs for credentials and JWT signing.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Google credentials require an OAuth 2 token maintaining the token lifecycle.
All API is synchronous therefore, <code>GcpIamAuthentication</code> does not support <code>AuthenticationSteps</code> which is required for reactive usage.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>See also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.vaultproject.io/docs/auth/gcp.html">Vault Documentation: Using the GCP auth backend</a></p>
</li>
<li>
<p><a href="https://cloud.google.com/iam/reference/rest/v1/projects.serviceAccounts/signJwt">GCP Documentation: projects.serviceAccounts.signJwt</a><a id="vault.authentication.gcpiam"></a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.authentication.kubernetes"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.kubernetes"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.kubernetes">186.12. Kubernetes authentication</a></h3>
<div class="paragraph">
<p>Kubernetes authentication mechanism (since Vault 0.8.3) allows to authenticate with Vault using a Kubernetes Service Account Token.
The authentication is role based and the role is bound to a service account name and a namespace.</p>
</div>
<div class="paragraph">
<p>A file containing a JWT token for a pod’s service account is automatically mounted at <code>/var/run/secrets/kubernetes.io/serviceaccount/token</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 106. bootstrap.yml with all Kubernetes authentication properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: KUBERNETES
    kubernetes:
        role: my-dev-role
        kubernetes-path: kubernetes
        service-account-token-file: /var/run/secrets/kubernetes.io/serviceaccount/token</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>role</code> sets the Role.</p>
</li>
<li>
<p><code>kubernetes-path</code> sets the path of the Kubernetes mount to use.</p>
</li>
<li>
<p><code>service-account-token-file</code> sets the location of the file containing the Kubernetes Service Account Token.
Defaults to <code>/var/run/secrets/kubernetes.io/serviceaccount/token</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.vaultproject.io/docs/auth/kubernetes.html">Vault Documentation: Kubernetes</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/">Kubernetes Documentation: Configure Service Accounts for Pods</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.authentication.pcf"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.pcf"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.authentication.pcf">186.13. Pivotal CloudFoundry authentication</a></h3>
<div class="paragraph">
<p>The <a href="https://www.vaultproject.io/docs/auth/pcf.html">pcf</a>
auth backend provides a secure introduction mechanism for applications running within Pivotal’s CloudFoundry instances allowing automated retrieval of a Vault token.
Unlike most Vault authentication backends, this backend does not require first-deploying, or provisioning security-sensitive credentials (tokens, username/password, client certificates, etc.) as identity provisioning is handled by PCF itself.
Instead, it treats PCF as a Trusted Third Party and uses the managed instance identity.</p>
</div>
<div class="exampleblock">
<div class="title">Example 107. bootstrap.yml with required PCF Authentication properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: PCF
    pcf:
        role: my-dev-role</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 108. bootstrap.yml with all PCF Authentication properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    authentication: PCF
    pcf:
        role: my-dev-role
        pcf-path: path
        instance-certificate: /etc/cf-instance-credentials/instance.crt
        instance-key: /etc/cf-instance-credentials/instance.key</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>role</code> sets the name of the role against which the login is being attempted.</p>
</li>
<li>
<p><code>pcf-path</code> sets the path of the PCF mount to use.</p>
</li>
<li>
<p><code>instance-certificate</code> sets the path to the PCF instance identity certificate.
Defaults to <code>${CF_INSTANCE_CERT}</code> env variable.</p>
</li>
<li>
<p><code>instance-key</code> sets the path to the PCF instance identity key.
Defaults to <code>${CF_INSTANCE_KEY}</code> env variable.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
PCF authentication requires BouncyCastle (bcpkix-jdk15on) to be on the classpath for RSA PSS signing.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/auth/pcf.html">Vault Documentation: Using the pcf auth backend</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vault.config.backends"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends">187. Secret Backends</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="vault.config.backends.generic"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.generic"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.generic">187.1. Generic Backend</a></h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This backend is deprecated in favor of the Key-Value backend and will be removed with the next major version.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Spring Cloud Vault supports at the basic level the key-value secret backend.
The key-value secret backend allows storage of arbitrary values as key-value store.
A single context can store one or many key-value tuples.
Contexts can be organized hierarchically.
Spring Cloud Vault allows using the Application name and a default context name (<code>application</code>) in combination with active profiles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/secret/{application}/{profile}
/secret/{application}
/secret/{default-context}/{profile}
/secret/{default-context}</pre>
</div>
</div>
<div class="paragraph">
<p>The application name is determined by the properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spring.cloud.vault.generic.application-name</code></p>
</li>
<li>
<p><code>spring.cloud.vault.application-name</code></p>
</li>
<li>
<p><code>spring.application.name</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Secrets can be obtained from other contexts within the key-value backend by adding their paths to the application name, separated by commas.
For example, given the application name <code>usefulapp,mysql1,projectx/aws</code>, each of these folders will be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/secret/usefulapp</code></p>
</li>
<li>
<p><code>/secret/mysql1</code></p>
</li>
<li>
<p><code>/secret/projectx/aws</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring Cloud Vault adds all active profiles to the list of possible context paths.
No active profiles will skip accessing contexts with a profile name.</p>
</div>
<div class="paragraph">
<p>Properties are exposed like they are stored (i.e. without additional prefixes).</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    generic:
        enabled: true
        backend: secret
        profile-separator: '/'
        default-context: application
        application-name: my-app</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> setting this value to <code>false</code> disables the secret backend config usage</p>
</li>
<li>
<p><code>backend</code> sets the path of the secret mount to use</p>
</li>
<li>
<p><code>default-context</code> sets the context name used by all applications</p>
</li>
<li>
<p><code>application-name</code> overrides the application name for use in the key-value backend</p>
</li>
<li>
<p><code>profile-separator</code> separates the profile name from the context in property sources with profiles</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/secrets/kv/kv-v1.html">Vault Documentation: Using the KV Secrets Engine - Version 1 (generic secret backend)</a></p>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.backends.kv.versioned"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.kv.versioned"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.kv.versioned">187.2. Key-Value Backend</a></h3>
<div class="paragraph">
<p>Spring Cloud Vault supports the Key-Value secret backend.
The key-value backend allows storage of arbitrary values as key-value store.
A single context can store one or many key-value tuples.
Contexts can be organized hierarchically.
Spring Cloud Vault determines itself whether a secret is using versioning.
Spring Cloud Vault allows using the Application name and a default context name (<code>application</code>) in combination with active profiles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/secret/{application}/{profile}
/secret/{application}
/secret/{default-context}/{profile}
/secret/{default-context}</pre>
</div>
</div>
<div class="paragraph">
<p>The application name is determined by the properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spring.cloud.vault.kv.application-name</code></p>
</li>
<li>
<p><code>spring.cloud.vault.application-name</code></p>
</li>
<li>
<p><code>spring.application.name</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Secrets can be obtained from other contexts within the key-value backend by adding their paths to the application name, separated by commas.
For example, given the application name <code>usefulapp,mysql1,projectx/aws</code>, each of these folders will be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/secret/usefulapp</code></p>
</li>
<li>
<p><code>/secret/mysql1</code></p>
</li>
<li>
<p><code>/secret/projectx/aws</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring Cloud Vault adds all active profiles to the list of possible context paths.
No active profiles will skip accessing contexts with a profile name.</p>
</div>
<div class="paragraph">
<p>Properties are exposed like they are stored (i.e. without additional prefixes).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Cloud Vault adds the <code>data/</code> context between the mount path and the actual context path.
</td>
</tr>
</tbody></table>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    kv:
        enabled: true
        backend: secret
        profile-separator: '/'
        default-context: application
        application-name: my-app</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> setting this value to <code>false</code> disables the secret backend config usage</p>
</li>
<li>
<p><code>backend</code> sets the path of the secret mount to use</p>
</li>
<li>
<p><code>default-context</code> sets the context name used by all applications</p>
</li>
<li>
<p><code>application-name</code> overrides the application name for use in the key-value backend</p>
</li>
<li>
<p><code>profile-separator</code> separates the profile name from the context in property sources with profiles</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The key-value secret backend can be operated in versioned (v2) and non-versioned (v1) modes.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>See also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.vaultproject.io/docs/secrets/kv/kv-v1.html">Vault Documentation: Using the KV Secrets Engine - Version 1 (generic secret backend)</a></p>
</li>
<li>
<p><a href="https://www.vaultproject.io/docs/secrets/kv/kv-v2.html">Vault Documentation: Using the KV Secrets Engine - Version 2 (versioned key-value backend)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.backends.consul"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.consul"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.consul">187.3. Consul</a></h3>
<div class="paragraph">
<p>Spring Cloud Vault can obtain credentials for HashiCorp Consul.
The Consul integration requires the <code>spring-cloud-vault-config-consul</code>
dependency.</p>
</div>
<div class="exampleblock">
<div class="title">Example 109. pom.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-vault-config-consul<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The integration can be enabled by setting
<code>spring.cloud.vault.consul.enabled=true</code> (default <code>false</code>) and providing the role name with <code>spring.cloud.vault.consul.role=…</code>.</p>
</div>
<div class="paragraph">
<p>The obtained token is stored in <code>spring.cloud.consul.token</code>
so using Spring Cloud Consul can pick up the generated credentials without further configuration.
You can configure the property name by setting <code>spring.cloud.vault.consul.token-property</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    consul:
        enabled: true
        role: readonly
        backend: consul
        token-property: spring.cloud.consul.token</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> setting this value to <code>true</code> enables the Consul backend config usage</p>
</li>
<li>
<p><code>role</code> sets the role name of the Consul role definition</p>
</li>
<li>
<p><code>backend</code> sets the path of the Consul mount to use</p>
</li>
<li>
<p><code>token-property</code> sets the property name in which the Consul ACL token is stored</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/secrets/consul/index.html">Vault Documentation: Setting up Consul with Vault</a></p>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.backends.rabbitmq"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.rabbitmq"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.rabbitmq">187.4. RabbitMQ</a></h3>
<div class="paragraph">
<p>Spring Cloud Vault can obtain credentials for RabbitMQ.</p>
</div>
<div class="paragraph">
<p>The RabbitMQ integration requires the <code>spring-cloud-vault-config-rabbitmq</code>
dependency.</p>
</div>
<div class="exampleblock">
<div class="title">Example 110. pom.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-vault-config-rabbitmq<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The integration can be enabled by setting
<code>spring.cloud.vault.rabbitmq.enabled=true</code> (default <code>false</code>) and providing the role name with <code>spring.cloud.vault.rabbitmq.role=…</code>.</p>
</div>
<div class="paragraph">
<p>Username and password are stored in <code>spring.rabbitmq.username</code>
and <code>spring.rabbitmq.password</code> so using Spring Boot will pick up the generated credentials without further configuration.
You can configure the property names by setting <code>spring.cloud.vault.rabbitmq.username-property</code> and
<code>spring.cloud.vault.rabbitmq.password-property</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    rabbitmq:
        enabled: true
        role: readonly
        backend: rabbitmq
        username-property: spring.rabbitmq.username
        password-property: spring.rabbitmq.password</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> setting this value to <code>true</code> enables the RabbitMQ backend config usage</p>
</li>
<li>
<p><code>role</code> sets the role name of the RabbitMQ role definition</p>
</li>
<li>
<p><code>backend</code> sets the path of the RabbitMQ mount to use</p>
</li>
<li>
<p><code>username-property</code> sets the property name in which the RabbitMQ username is stored</p>
</li>
<li>
<p><code>password-property</code> sets the property name in which the RabbitMQ password is stored</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/secrets/rabbitmq/index.html">Vault Documentation: Setting up RabbitMQ with Vault</a></p>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.backends.aws"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.aws"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.aws">187.5. AWS</a></h3>
<div class="paragraph">
<p>Spring Cloud Vault can obtain credentials for AWS.</p>
</div>
<div class="paragraph">
<p>The AWS integration requires the <code>spring-cloud-vault-config-aws</code>
dependency.</p>
</div>
<div class="exampleblock">
<div class="title">Example 111. pom.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-vault-config-aws<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The integration can be enabled by setting
<code>spring.cloud.vault.aws=true</code> (default <code>false</code>) and providing the role name with <code>spring.cloud.vault.aws.role=…</code>.</p>
</div>
<div class="paragraph">
<p>The access key and secret key are stored in <code>cloud.aws.credentials.accessKey</code>
and <code>cloud.aws.credentials.secretKey</code> so using Spring Cloud AWS will pick up the generated credentials without further configuration.
You can configure the property names by setting <code>spring.cloud.vault.aws.access-key-property</code> and
<code>spring.cloud.vault.aws.secret-key-property</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    aws:
        enabled: true
        role: readonly
        backend: aws
        access-key-property: cloud.aws.credentials.accessKey
        secret-key-property: cloud.aws.credentials.secretKey</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> setting this value to <code>true</code> enables the AWS backend config usage</p>
</li>
<li>
<p><code>role</code> sets the role name of the AWS role definition</p>
</li>
<li>
<p><code>backend</code> sets the path of the AWS mount to use</p>
</li>
<li>
<p><code>access-key-property</code> sets the property name in which the AWS access key is stored</p>
</li>
<li>
<p><code>secret-key-property</code> sets the property name in which the AWS secret key is stored</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/secrets/aws/index.html">Vault Documentation: Setting up AWS with Vault</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vault.config.backends.database-backends"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.database-backends"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.database-backends">188. Database backends</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vault supports several database secret backends to generate database credentials dynamically based on configured roles.
This means services that need to access a database no longer need to configure credentials: they can request them from Vault, and use Vault’s leasing mechanism to more easily roll keys.</p>
</div>
<div class="paragraph">
<p>Spring Cloud Vault integrates with these backends:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.database">Database</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.cassandra">Apache Cassandra</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.mongodb">MongoDB</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.mysql">MySQL</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.postgresql">PostgreSQL</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using a database secret backend requires to enable the backend in the configuration and the <code>spring-cloud-vault-config-databases</code>
dependency.</p>
</div>
<div class="paragraph">
<p>Vault ships since 0.7.1 with a dedicated <code>database</code> secret backend that allows database integration via plugins.
You can use that specific backend by using the generic database backend.
Make sure to specify the appropriate backend path, e.g. <code>spring.cloud.vault.mysql.role.backend=database</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 112. pom.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-vault-config-databases<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Enabling multiple JDBC-compliant databases will generate credentials and store them by default in the same property keys hence property names for JDBC secrets need to be configured separately.
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="vault.config.backends.database"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.database"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.database">188.1. Database</a></h3>
<div class="paragraph">
<p>Spring Cloud Vault can obtain credentials for any database listed at
<a href="https://www.vaultproject.io/api/secret/databases/index.html" class="bare">www.vaultproject.io/api/secret/databases/index.html</a>.
The integration can be enabled by setting
<code>spring.cloud.vault.database.enabled=true</code> (default <code>false</code>) and providing the role name with <code>spring.cloud.vault.database.role=…</code>.</p>
</div>
<div class="paragraph">
<p>While the database backend is a generic one, <code>spring.cloud.vault.database</code>
specifically targets JDBC databases.
Username and password are stored in <code>spring.datasource.username</code> and <code>spring.datasource.password</code>
so using Spring Boot will pick up the generated credentials for your <code>DataSource</code> without further configuration.
You can configure the property names by setting
<code>spring.cloud.vault.database.username-property</code> and
<code>spring.cloud.vault.database.password-property</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    database:
        enabled: true
        role: readonly
        backend: database
        username-property: spring.datasource.username
        password-property: spring.datasource.password</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> setting this value to <code>true</code> enables the Database backend config usage</p>
</li>
<li>
<p><code>role</code> sets the role name of the Database role definition</p>
</li>
<li>
<p><code>backend</code> sets the path of the Database mount to use</p>
</li>
<li>
<p><code>username-property</code> sets the property name in which the Database username is stored</p>
</li>
<li>
<p><code>password-property</code> sets the property name in which the Database password is stored</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/secrets/databases/index.html">Vault Documentation: Database Secrets backend</a></p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Spring Cloud Vault does not support getting new credentials and configuring your <code>DataSource</code> with them when the maximum lease time has been reached.
That is, if <code>max_ttl</code> of the Database role in Vault is set to <code>24h</code> that means that 24 hours after your application has started it can no longer authenticate with the database.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.backends.cassandra"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.cassandra"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.cassandra">188.2. Apache Cassandra</a></h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>cassandra</code> backend has been deprecated in Vault 0.7.1 and it is recommended to use the <code>database</code> backend and mount it as <code>cassandra</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Spring Cloud Vault can obtain credentials for Apache Cassandra.
The integration can be enabled by setting
<code>spring.cloud.vault.cassandra.enabled=true</code> (default <code>false</code>) and providing the role name with <code>spring.cloud.vault.cassandra.role=…</code>.</p>
</div>
<div class="paragraph">
<p>Username and password are stored in <code>spring.data.cassandra.username</code>
and <code>spring.data.cassandra.password</code> so using Spring Boot will pick up the generated credentials without further configuration.
You can configure the property names by setting
<code>spring.cloud.vault.cassandra.username-property</code> and
<code>spring.cloud.vault.cassandra.password-property</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    cassandra:
        enabled: true
        role: readonly
        backend: cassandra
        username-property: spring.data.cassandra.username
        password-property: spring.data.cassandra.password</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> setting this value to <code>true</code> enables the Cassandra backend config usage</p>
</li>
<li>
<p><code>role</code> sets the role name of the Cassandra role definition</p>
</li>
<li>
<p><code>backend</code> sets the path of the Cassandra mount to use</p>
</li>
<li>
<p><code>username-property</code> sets the property name in which the Cassandra username is stored</p>
</li>
<li>
<p><code>password-property</code> sets the property name in which the Cassandra password is stored</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/secrets/cassandra/index.html">Vault Documentation: Setting up Apache Cassandra with Vault</a></p>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.backends.mongodb"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.mongodb"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.mongodb">188.3. MongoDB</a></h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>mongodb</code> backend has been deprecated in Vault 0.7.1 and it is recommended to use the <code>database</code> backend and mount it as <code>mongodb</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Spring Cloud Vault can obtain credentials for MongoDB.
The integration can be enabled by setting
<code>spring.cloud.vault.mongodb.enabled=true</code> (default <code>false</code>) and providing the role name with <code>spring.cloud.vault.mongodb.role=…</code>.</p>
</div>
<div class="paragraph">
<p>Username and password are stored in <code>spring.data.mongodb.username</code>
and <code>spring.data.mongodb.password</code> so using Spring Boot will pick up the generated credentials without further configuration.
You can configure the property names by setting
<code>spring.cloud.vault.mongodb.username-property</code> and
<code>spring.cloud.vault.mongodb.password-property</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    mongodb:
        enabled: true
        role: readonly
        backend: mongodb
        username-property: spring.data.mongodb.username
        password-property: spring.data.mongodb.password</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> setting this value to <code>true</code> enables the MongodB backend config usage</p>
</li>
<li>
<p><code>role</code> sets the role name of the MongoDB role definition</p>
</li>
<li>
<p><code>backend</code> sets the path of the MongoDB mount to use</p>
</li>
<li>
<p><code>username-property</code> sets the property name in which the MongoDB username is stored</p>
</li>
<li>
<p><code>password-property</code> sets the property name in which the MongoDB password is stored</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/secrets/mongodb/index.html">Vault Documentation: Setting up MongoDB with Vault</a></p>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.backends.mysql"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.mysql"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.mysql">188.4. MySQL</a></h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>mysql</code> backend has been deprecated in Vault 0.7.1 and it is recommended to use the <code>database</code> backend and mount it as <code>mysql</code>.
Configuration for <code>spring.cloud.vault.mysql</code> will be removed in a future version.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Spring Cloud Vault can obtain credentials for MySQL.
The integration can be enabled by setting
<code>spring.cloud.vault.mysql.enabled=true</code> (default <code>false</code>) and providing the role name with <code>spring.cloud.vault.mysql.role=…</code>.</p>
</div>
<div class="paragraph">
<p>Username and password are stored in <code>spring.datasource.username</code>
and <code>spring.datasource.password</code> so using Spring Boot will pick up the generated credentials without further configuration.
You can configure the property names by setting
<code>spring.cloud.vault.mysql.username-property</code> and
<code>spring.cloud.vault.mysql.password-property</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    mysql:
        enabled: true
        role: readonly
        backend: mysql
        username-property: spring.datasource.username
        password-property: spring.datasource.password</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> setting this value to <code>true</code> enables the MySQL backend config usage</p>
</li>
<li>
<p><code>role</code> sets the role name of the MySQL role definition</p>
</li>
<li>
<p><code>backend</code> sets the path of the MySQL mount to use</p>
</li>
<li>
<p><code>username-property</code> sets the property name in which the MySQL username is stored</p>
</li>
<li>
<p><code>password-property</code> sets the property name in which the MySQL password is stored</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/secrets/mysql/index.html">Vault Documentation: Setting up MySQL with Vault</a></p>
</div>
</div>
<div class="sect2">
<h3 id="vault.config.backends.postgresql"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.postgresql"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.postgresql">188.5. PostgreSQL</a></h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>postgresql</code> backend has been deprecated in Vault 0.7.1 and it is recommended to use the <code>database</code> backend and mount it as <code>postgresql</code>.
Configuration for <code>spring.cloud.vault.postgresql</code> will be removed in a future version.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Spring Cloud Vault can obtain credentials for PostgreSQL.
The integration can be enabled by setting
<code>spring.cloud.vault.postgresql.enabled=true</code> (default <code>false</code>) and providing the role name with <code>spring.cloud.vault.postgresql.role=…</code>.</p>
</div>
<div class="paragraph">
<p>Username and password are stored in <code>spring.datasource.username</code>
and <code>spring.datasource.password</code> so using Spring Boot will pick up the generated credentials without further configuration.
You can configure the property names by setting
<code>spring.cloud.vault.postgresql.username-property</code> and
<code>spring.cloud.vault.postgresql.password-property</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    postgresql:
        enabled: true
        role: readonly
        backend: postgresql
        username-property: spring.datasource.username
        password-property: spring.datasource.password</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> setting this value to <code>true</code> enables the PostgreSQL backend config usage</p>
</li>
<li>
<p><code>role</code> sets the role name of the PostgreSQL role definition</p>
</li>
<li>
<p><code>backend</code> sets the path of the PostgreSQL mount to use</p>
</li>
<li>
<p><code>username-property</code> sets the property name in which the PostgreSQL username is stored</p>
</li>
<li>
<p><code>password-property</code> sets the property name in which the PostgreSQL password is stored</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/secrets/postgresql/index.html">Vault Documentation: Setting up PostgreSQL with Vault</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vault.config.backends.configurer"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.configurer"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.backends.configurer">189. Configure <code>PropertySourceLocator</code> behavior</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Vault uses property-based configuration to create <code>PropertySource</code>s for key-value and discovered secret backends.</p>
</div>
<div class="paragraph">
<p>Discovered backends provide <code>VaultSecretBackendDescriptor</code> beans to describe the configuration state to use secret backend as <code>PropertySource</code>.
A <code>SecretBackendMetadataFactory</code> is required to create a <code>SecretBackendMetadata</code> object which contains path, name and property transformation configuration.</p>
</div>
<div class="paragraph">
<p><code>SecretBackendMetadata</code> is used to back a particular <code>PropertySource</code>.</p>
</div>
<div class="paragraph">
<p>You can register an arbitrary number of beans implementing <code>VaultConfigurer</code> for customization.
Default key-value and discovered backend registration is disabled if Spring Cloud Vault discovers at least one <code>VaultConfigurer</code> bean.
You can however enable default registration with
<code>SecretBackendConfigurer.registerDefaultKeyValueSecretBackends()</code> and <code>SecretBackendConfigurer.registerDefaultDiscoveredSecretBackends()</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizationBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">VaultConfigurer</span> </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addSecretBackends</span><span class="hljs-params">(SecretBackendConfigurer configurer)</span> </span>{

        configurer.add(<span class="hljs-string">"secret/my-application"</span>);

        configurer.registerDefaultKeyValueSecretBackends(<span class="hljs-keyword">false</span>);
        configurer.registerDefaultDiscoveredSecretBackends(<span class="hljs-keyword">true</span>);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All customization is required to happen in the bootstrap context.
Add your configuration classes to <code>META-INF/spring.factories</code> at <code>org.springframework.cloud.bootstrap.BootstrapConfiguration</code>
in your application.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="service-registry-configuration"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-registry-configuration"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#service-registry-configuration">190. Service Registry Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use a <code>DiscoveryClient</code> (such as from Spring Cloud Consul) to locate a Vault server by setting spring.cloud.vault.discovery.enabled=true (default <code>false</code>).
The net result of that is that your apps need a bootstrap.yml (or an environment variable) with the appropriate discovery configuration.
The benefit is that the Vault can change its co-ordinates, as long as the discovery service is a fixed point.
The default service id is <code>vault</code> but you can change that on the client with
<code>spring.cloud.vault.discovery.serviceId</code>.</p>
</div>
<div class="paragraph">
<p>The discovery client implementations all support some kind of metadata map (e.g. for Eureka we have eureka.instance.metadataMap).
Some additional properties of the service may need to be configured in its service registration metadata so that clients can connect correctly.
Service registries that do not provide details about transport layer security need to provide a <code>scheme</code> metadata entry to be set either to <code>https</code> or <code>http</code>.
If no scheme is configured and the service is not exposed as secure service, then configuration defaults to <code>spring.cloud.vault.scheme</code> which is <code>https</code> when it’s not set.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault.discovery:
    enabled: true
    service-id: my-vault-service</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vault.config.fail-fast"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.fail-fast"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.fail-fast">191. Vault Client Fail Fast</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some cases, it may be desirable to fail startup of a service if it cannot connect to the Vault Server.
If this is the desired behavior, set the bootstrap configuration property
<code>spring.cloud.vault.fail-fast=true</code> and the client will halt with an Exception.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    fail-fast: true</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vault.config.namespaces"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.namespaces"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.namespaces">192. Vault Enterprise Namespace Support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vault Enterprise allows using namespaces to isolate multiple Vaults on a single Vault server.
Configuring a namespace by setting
<code>spring.cloud.vault.namespace=…</code> enables the namespace header
<code>X-Vault-Namespace</code> on every outgoing HTTP request when using the Vault
<code>RestTemplate</code> or <code>WebClient</code>.</p>
</div>
<div class="paragraph">
<p>Please note that this feature is not supported by Vault Community edition and has no effect on Vault operations.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    namespace: my-namespace</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/enterprise/namespaces/index.html">Vault Enterprise: Namespaces</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vault.config.ssl"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.ssl"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault.config.ssl">193. Vault Client SSL configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>SSL can be configured declaratively by setting various properties.
You can set either <code>javax.net.ssl.trustStore</code> to configure JVM-wide SSL settings or <code>spring.cloud.vault.ssl.trust-store</code>
to set SSL settings only for Spring Cloud Vault Config.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    ssl:
        trust-store: classpath:keystore.jks
        trust-store-password: changeit</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>trust-store</code> sets the resource for the trust-store.
SSL-secured Vault communication will validate the Vault SSL certificate with the specified trust-store.</p>
</li>
<li>
<p><code>trust-store-password</code> sets the trust-store password</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please note that configuring <code>spring.cloud.vault.ssl.*</code> can be only applied when either Apache Http Components or the OkHttp client is on your class-path.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vault-lease-renewal"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault-lease-renewal"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#vault-lease-renewal">194. Lease lifecycle management (renewal and revocation)</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>With every secret, Vault creates a lease:
metadata containing information such as a time duration, renewability, and more.</p>
</div>
<div class="paragraph">
<p>Vault promises that the data will be valid for the given duration, or Time To Live (TTL).
Once the lease is expired, Vault can revoke the data, and the consumer of the secret can no longer be certain that it is valid.</p>
</div>
<div class="paragraph">
<p>Spring Cloud Vault maintains a lease lifecycle beyond the creation of login tokens and secrets.
That said, login tokens and secrets associated with a lease are scheduled for renewal just before the lease expires until terminal expiry.
Application shutdown revokes obtained login tokens and renewable leases.</p>
</div>
<div class="paragraph">
<p>Secret service and database backends (such as MongoDB or MySQL) usually generate a renewable lease so generated credentials will be disabled on application shutdown.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Static tokens are not renewed or revoked.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Lease renewal and revocation is enabled by default and can be disabled by setting <code>spring.cloud.vault.config.lifecycle.enabled</code>
to <code>false</code>.
This is not recommended as leases can expire and Spring Cloud Vault cannot longer access Vault or services using generated credentials and valid credentials remain active after application shutdown.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring.cloud.vault:
    config.lifecycle:
        enabled: true
        min-renewal: 10s
        expiry-threshold: 1m
        lease-endpoints: Legacy</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> controls whether leases associated with secrets are considered to be renewed and expired secrets are rotated.
Enabled by default.</p>
</li>
<li>
<p><code>min-renewal</code> sets the duration that is at least required before renewing a lease.
This setting prevents renewals from happening too often.</p>
</li>
<li>
<p><code>expiry-threshold</code> sets the expiry threshold.
A lease is renewed the configured period of time before it expires.</p>
</li>
<li>
<p><code>lease-endpoints</code> sets the endpoints for renew and revoke.
Legacy for vault versions before 0.8 and SysLeases for later.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also: <a href="https://www.vaultproject.io/docs/concepts/lease.html">Vault Documentation: Lease, Renew, and Revoke</a></p>
</div>
</div>
</div>
<h1 id="spring-cloud-zookeeper" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper">Spring Cloud Zookeeper</a></h1>
<div class="openblock partintro">
<div class="content">
This project provides Zookeeper integrations for Spring Boot applications through
autoconfiguration and binding to the Spring Environment and other Spring programming model
idioms. With a few annotations, you can quickly enable and configure the common patterns
inside your application and build large distributed systems with Zookeeper based
components. The provided patterns include Service Discovery and Configuration. Integration
with Spring Cloud Netflix provides Intelligent Routing (Zuul), Client Side Load Balancing
(Ribbon), and Circuit Breaker (Hystrix).
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-zookeeper-install"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-install"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-install">195. Install Zookeeper</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>See the <a href="https://zookeeper.apache.org/doc/current/zookeeperStarted.html">installation
documentation</a> for instructions on how to install Zookeeper.</p>
</div>
<div class="paragraph">
<p>Spring Cloud Zookeeper uses Apache Curator behind the scenes.
While Zookeeper 3.5.x is still considered "beta" by the Zookeeper development team,
the reality is that it is used in production by many users.
However, Zookeeper 3.4.x is also used in production.
Prior to Apache Curator 4.0, both versions of Zookeeper were supported via two versions of Apache Curator.
Starting with Curator 4.0 both versions of Zookeeper are supported via the same Curator libraries.</p>
</div>
<div class="paragraph">
<p>In case you are integrating with version 3.4 you need to change the Zookeeper dependency
that comes shipped with <code>curator</code>, and thus <code>spring-cloud-zookeeper</code>.
To do so simply exclude that dependency and add the 3.4.x version like shown below.</p>
</div>
<div class="listingblock">
<div class="title">maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-zookeeper-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.zookeeper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>zookeeper<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.zookeeper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>zookeeper<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-log4j12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile(<span class="hljs-string">'org.springframework.cloud:spring-cloud-starter-zookeeper-all'</span>) {
  exclude <span class="hljs-string">group:</span> <span class="hljs-string">'org.apache.zookeeper'</span>, <span class="hljs-string">module:</span> <span class="hljs-string">'zookeeper'</span>
}
compile(<span class="hljs-string">'org.apache.zookeeper:zookeeper:3.4.12'</span>) {
  exclude <span class="hljs-string">group:</span> <span class="hljs-string">'org.slf4j'</span>, <span class="hljs-string">module:</span> <span class="hljs-string">'slf4j-log4j12'</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-zookeeper-discovery"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-discovery"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-discovery">196. Service Discovery with Zookeeper</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Service Discovery is one of the key tenets of a microservice based architecture. Trying to
hand-configure each client or some form of convention can be difficult to do and can be
brittle. <a href="https://curator.apache.org/">Curator</a>(A Java library for Zookeeper) provides Service
Discovery through a <a href="https://curator.apache.org/curator-x-discovery/">Service Discovery
Extension</a>. Spring Cloud Zookeeper uses this extension for service registration and
discovery.</p>
</div>
<div class="sect2">
<h3 id="activating"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#activating"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#activating">196.1. Activating</a></h3>
<div class="paragraph">
<p>Including a dependency on
<code>org.springframework.cloud:spring-cloud-starter-zookeeper-discovery</code> enables
autoconfiguration that sets up Spring Cloud Zookeeper Discovery.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For web functionality, you still need to include
<code>org.springframework.boot:spring-boot-starter-web</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
When working with version 3.4 of Zookeeper you need to change
the way you include the dependency as described <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-install">here</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="registering-with-zookeeper"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-with-zookeeper"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-with-zookeeper">196.2. Registering with Zookeeper</a></h3>
<div class="paragraph">
<p>When a client registers with Zookeeper, it provides metadata (such as host and port, ID,
and name) about itself.</p>
</div>
<div class="paragraph">
<p>The following example shows a Zookeeper client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{

    <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">home</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello world"</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        <span class="hljs-keyword">new</span> SpringApplicationBuilder(Application.class).web(<span class="hljs-keyword">true</span>).run(args);
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The preceding example is a normal Spring Boot application.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If Zookeeper is located somewhere other than <code>localhost:2181</code>, the configuration must
provide the location of the server, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">spring:
  cloud:
    zookeeper:
      connect-string: localhost:2181</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
If you use <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-config">Spring Cloud Zookeeper Config</a>, the
values shown in the preceding example need to be in <code>bootstrap.yml</code> instead of
<code>application.yml</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The default service name, instance ID, and port (taken from the <code>Environment</code>) are
<code>${spring.application.name}</code>, the Spring Context ID, and <code>${server.port}</code>, respectively.</p>
</div>
<div class="paragraph">
<p>Having <code>spring-cloud-starter-zookeeper-discovery</code> on the classpath makes the app into both
a Zookeeper “service” (that is, it registers itself) and a “client” (that is, it can
query Zookeeper to locate other services).</p>
</div>
<div class="paragraph">
<p>If you would like to disable the Zookeeper Discovery Client, you can set
<code>spring.cloud.zookeeper.discovery.enabled</code> to <code>false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-discoveryclient-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-the-discoveryclient-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#using-the-discoveryclient-2">196.3. Using the DiscoveryClient</a></h3>
<div class="paragraph">
<p>Spring Cloud has support for
<a href="https://github.com/spring-cloud/spring-cloud-netflix/blob/master/docs/src/main/asciidoc/spring-cloud-netflix.adoc#spring-cloud-feign">Feign</a>
(a REST client builder),
<a href="https://github.com/spring-cloud/spring-cloud-netflix/blob/master/docs/src/main/ascii">Spring
<code>RestTemplate</code></a> and
<a href="https://cloud.spring.io/spring-cloud-commons/reference/html/#loadbalanced-webclient">Spring WebFlux</a>, using logical service names instead of physical URLs.</p>
</div>
<div class="paragraph">
<p>You can also use the <code>org.springframework.cloud.client.discovery.DiscoveryClient</code>, which
provides a simple API for discovery clients that is not specific to Netflix, as shown in
the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> DiscoveryClient discoveryClient;

<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">serviceUrl</span><span class="hljs-params">()</span> </span>{
    List&lt;ServiceInstance&gt; list = discoveryClient.getInstances(<span class="hljs-string">"STORES"</span>);
    <span class="hljs-keyword">if</span> (list != <span class="hljs-keyword">null</span> &amp;&amp; list.size() &gt; <span class="hljs-number">0</span> ) {
        <span class="hljs-keyword">return</span> list.get(<span class="hljs-number">0</span>).getUri().toString();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-zookeeper-netflix"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-netflix"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-netflix">197. Using Spring Cloud Zookeeper with Spring Cloud Netflix Components</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Netflix supplies useful tools that work regardless of which <code>DiscoveryClient</code>
implementation you use. Feign, Turbine, Ribbon, and Zuul all work with Spring Cloud
Zookeeper.</p>
</div>
<div class="sect2">
<h3 id="ribbon-with-zookeeper"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ribbon-with-zookeeper"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#ribbon-with-zookeeper">197.1. Ribbon with Zookeeper</a></h3>
<div class="paragraph">
<p>Spring Cloud Zookeeper provides an implementation of Ribbon’s <code>ServerList</code>. When you use
the <code>spring-cloud-starter-zookeeper-discovery</code>, Ribbon is autoconfigured to use the
<code>ZookeeperServerList</code> by default.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-zookeeper-service-registry"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-service-registry"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-service-registry">198. Spring Cloud Zookeeper and Service Registry</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Zookeeper implements the <code>ServiceRegistry</code> interface, letting developers
register arbitrary services in a programmatic way.</p>
</div>
<div class="paragraph">
<p>The <code>ServiceInstanceRegistration</code> class offers a <code>builder()</code> method to create a
<code>Registration</code> object that can be used by the <code>ServiceRegistry</code>, as shown in the following
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> ZookeeperServiceRegistry serviceRegistry;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerThings</span><span class="hljs-params">()</span> </span>{
    ZookeeperRegistration registration = ServiceInstanceRegistration.builder()
            .defaultUriSpec()
            .address(<span class="hljs-string">"anyUrl"</span>)
            .port(<span class="hljs-number">10</span>)
            .name(<span class="hljs-string">"/a/b/c/d/anotherservice"</span>)
            .build();
    <span class="hljs-keyword">this</span>.serviceRegistry.register(registration);
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="instance-status"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#instance-status"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#instance-status">198.1. Instance Status</a></h3>
<div class="paragraph">
<p>Netflix Eureka supports having instances that are <code>OUT_OF_SERVICE</code> registered with the
server. These instances are not returned as active service instances. This is useful for
behaviors such as blue/green deployments. (Note that the Curator Service Discovery recipe
does not support this behavior.) Taking advantage of the flexible payload has let Spring
Cloud Zookeeper implement <code>OUT_OF_SERVICE</code> by updating some specific metadata and then
filtering on that metadata in the Ribbon <code>ZookeeperServerList</code>. The <code>ZookeeperServerList</code>
filters out all non-null instance statuses that do not equal <code>UP</code>. If the instance status
field is empty, it is considered to be <code>UP</code> for backwards compatibility. To change the
status of an instance, make a <code>POST</code> with <code>OUT_OF_SERVICE</code> to the <code>ServiceRegistry</code>
instance status actuator endpoint, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs bash" data-lang="sh">$ http POST http://localhost:8081/service-registry status=OUT_OF_SERVICE</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The preceding example uses the <code>http</code> command from <a href="https://httpie.org/" class="bare">httpie.org</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-zookeeper-dependencies"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies">199. Zookeeper Dependencies</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following topics cover how to work with Spring Cloud Zookeeper dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-using">Using the Zookeeper Dependencies</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-activating">Activating Zookeeper Dependencies</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-setting-up">Setting up Zookeeper Dependencies</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-configuring">Configuring Spring Cloud Zookeeper Dependencies</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="spring-cloud-zookeeper-dependencies-using"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-using"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-using">199.1. Using the Zookeeper Dependencies</a></h3>
<div class="paragraph">
<p>Spring Cloud Zookeeper gives you a possibility to provide dependencies of your application
as properties. As dependencies, you can understand other applications that are registered
in Zookeeper and which you would like to call through
<a href="https://github.com/spring-cloud/spring-cloud-netflix/blob/master/docs/src/main/asciidoc/spring-cloud-netflix.adoc#spring-cloud-feign">Feign</a>
(a REST client builder),
<a href="https://github.com/spring-cloud/spring-cloud-netflix/blob/master/docs/src/main/ascii">Spring
<code>RestTemplate</code></a> and
<a href="https://cloud.spring.io/spring-cloud-commons/reference/html/#loadbalanced-webclient">Spring WebFlux</a>.</p>
</div>
<div class="paragraph">
<p>You can also use the Zookeeper Dependency Watchers functionality to control and monitor
the state of your dependencies.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-zookeeper-dependencies-activating"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-activating"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-activating">199.2. Activating Zookeeper Dependencies</a></h3>
<div class="paragraph">
<p>Including a dependency on
<code>org.springframework.cloud:spring-cloud-starter-zookeeper-discovery</code> enables
autoconfiguration that sets up Spring Cloud Zookeeper Dependencies. Even if you provide
the dependencies in your properties, you can turn off the dependencies. To do so, set the
<code>spring.cloud.zookeeper.dependency.enabled</code> property to false (it defaults to <code>true</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-zookeeper-dependencies-setting-up"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-setting-up"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-setting-up">199.3. Setting up Zookeeper Dependencies</a></h3>
<div class="paragraph">
<p>Consider the following example of dependency representation:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">spring.application.name: yourServiceName
spring.cloud.zookeeper:
  dependencies:
    newsletter:
      path: /path/where/newsletter/has/registered/in/zookeeper
      loadBalancerType: ROUND_ROBIN
      contentTypeTemplate: application/vnd.newsletter.$version+json
      version: v1
      headers:
        header1:
            - value1
        header2:
            - value2
      required: false
      stubs: org.springframework:foo:stubs
    mailing:
      path: /path/where/mailing/has/registered/in/zookeeper
      loadBalancerType: ROUND_ROBIN
      contentTypeTemplate: application/vnd.mailing.$version+json
      version: v1
      required: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next few sections go through each part of the dependency one by one. The root property
name is <code>spring.cloud.zookeeper.dependencies</code>.</p>
</div>
<div class="sect3">
<h4 id="spring-cloud-zookeeper-dependencies-setting-up-aliases"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-setting-up-aliases"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-setting-up-aliases">199.3.1. Aliases</a></h4>
<div class="paragraph">
<p>Below the root property you have to represent each dependency as an alias. This is due to
the constraints of Ribbon, which requires that the application ID be placed in the URL.
Consequently, you cannot pass any complex path, suchas <code>/myApp/myRoute/name</code>). The alias
is the name you use instead of the <code>serviceId</code> for <code>DiscoveryClient</code>, <code>Feign</code>, or
<code>RestTemplate</code>.</p>
</div>
<div class="paragraph">
<p>In the previous examples, the aliases are <code>newsletter</code> and <code>mailing</code>. The following
example shows Feign usage with a <code>newsletter</code> alias:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@FeignClient</span>(<span class="hljs-string">"newsletter"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NewsletterService</span> </span>{
        <span class="hljs-meta">@RequestMapping</span>(method = RequestMethod.GET, value = <span class="hljs-string">"/newsletter"</span>)
        <span class="hljs-function">String <span class="hljs-title">getNewsletters</span><span class="hljs-params">()</span></span>;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="path"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#path"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#path">199.3.2. Path</a></h4>
<div class="paragraph">
<p>The path is represented by the <code>path</code> YAML property and is the path under which the
dependency is registered under Zookeeper. As described in the
<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-setting-up-aliases">previous section</a>, Ribbon
operates on URLs. As a result, this path is not compliant with its requirement.
That is why Spring Cloud Zookeeper maps the alias to the proper path.</p>
</div>
</div>
<div class="sect3">
<h4 id="load-balancer-type"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#load-balancer-type"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#load-balancer-type">199.3.3. Load Balancer Type</a></h4>
<div class="paragraph">
<p>The load balancer type is represented by <code>loadBalancerType</code> YAML property.</p>
</div>
<div class="paragraph">
<p>If you know what kind of load-balancing strategy has to be applied when calling this
particular dependency, you can provide it in the YAML file, and it is automatically
applied. You can choose one of the following load balancing strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>STICKY: Once chosen, the instance is always called.</p>
</li>
<li>
<p>RANDOM: Picks an instance randomly.</p>
</li>
<li>
<p>ROUND_ROBIN: Iterates over instances over and over again.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="content-type-template-and-version"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#content-type-template-and-version"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#content-type-template-and-version">199.3.4. <code>Content-Type</code> Template and Version</a></h4>
<div class="paragraph">
<p>The <code>Content-Type</code> template and version are represented by the <code>contentTypeTemplate</code> and
<code>version</code> YAML properties.</p>
</div>
<div class="paragraph">
<p>If you version your API in the <code>Content-Type</code> header, you do not want to add this header
to each of your requests. Also, if you want to call a new version of the API, you do not
want to roam around your code to bump up the API version. That is why you can provide a
<code>contentTypeTemplate</code> with a special <code>$version</code> placeholder. That placeholder will be filled by the value of the
<code>version</code> YAML property. Consider the following example of a <code>contentTypeTemplate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>application/vnd.newsletter.$version+json</pre>
</div>
</div>
<div class="paragraph">
<p>Further consider the following <code>version</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>v1</pre>
</div>
</div>
<div class="paragraph">
<p>The combination of <code>contentTypeTemplate</code> and version results in the creation of a
<code>Content-Type</code> header for each request, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>application/vnd.newsletter.v1+json</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="default-headers"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#default-headers"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#default-headers">199.3.5. Default Headers</a></h4>
<div class="paragraph">
<p>Default headers are represented by the <code>headers</code> map in YAML.</p>
</div>
<div class="paragraph">
<p>Sometimes, each call to a dependency requires setting up of some default headers. To not
do that in code, you can set them up in the YAML file, as shown in the following example
<code>headers</code> section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">headers:
    Accept:
        - text/html
        - application/xhtml+xml
    Cache-Control:
        - no-cache</code></pre>
</div>
</div>
<div class="paragraph">
<p>That <code>headers</code> section results in adding the <code>Accept</code> and <code>Cache-Control</code> headers with
appropriate list of values in your HTTP request.</p>
</div>
</div>
<div class="sect3">
<h4 id="required-dependencies"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#required-dependencies"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#required-dependencies">199.3.6. Required Dependencies</a></h4>
<div class="paragraph">
<p>Required dependencies are represented by <code>required</code> property in YAML.</p>
</div>
<div class="paragraph">
<p>If one of your dependencies is required to be up when your application boots, you can set
the <code>required: true</code> property in the YAML file.</p>
</div>
<div class="paragraph">
<p>If your application cannot localize the required dependency during boot time, it throws an
exception, and the Spring Context fails to set up. In other words, your application cannot
start if the required dependency is not registered in Zookeeper.</p>
</div>
<div class="paragraph">
<p>You can read more about Spring Cloud Zookeeper Presence Checker
<a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependency-watcher-presence-checker">later in this document</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="stubs"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stubs"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#stubs">199.3.7. Stubs</a></h4>
<div class="paragraph">
<p>You can provide a colon-separated path to the JAR containing stubs of the dependency, as
shown in the following example:</p>
</div>
<div class="paragraph">
<p><code>stubs: org.springframework:myApp:stubs</code></p>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.springframework</code> is the <code>groupId</code>.</p>
</li>
<li>
<p><code>myApp</code> is the <code>artifactId</code>.</p>
</li>
<li>
<p><code>stubs</code> is the classifier. (Note that <code>stubs</code> is the default value.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because <code>stubs</code> is the default classifier, the preceding example is equal to the following
example:</p>
</div>
<div class="paragraph">
<p><code>stubs: org.springframework:myApp</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-zookeeper-dependencies-configuring"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-configuring"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependencies-configuring">199.4. Configuring Spring Cloud Zookeeper Dependencies</a></h3>
<div class="paragraph">
<p>You can set the following properties to enable or disable parts of Zookeeper Dependencies
functionalities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spring.cloud.zookeeper.dependencies</code>: If you do not set this property, you cannot use
Zookeeper Dependencies.</p>
</li>
<li>
<p><code>spring.cloud.zookeeper.dependency.ribbon.enabled</code> (enabled by default): Ribbon requires
either explicit global configuration or a particular one for a dependency. By turning on
this property, runtime load balancing strategy resolution is possible, and you can use the
<code>loadBalancerType</code> section of the Zookeeper Dependencies. The configuration that needs
this property has an implementation of <code>LoadBalancerClient</code> that delegates to the
<code>ILoadBalancer</code> presented in the next bullet.</p>
</li>
<li>
<p><code>spring.cloud.zookeeper.dependency.ribbon.loadbalancer</code> (enabled by default): Thanks to
this property, the custom <code>ILoadBalancer</code> knows that the part of the URI passed to Ribbon
might actually be the alias that has to be resolved to a proper path in Zookeeper. Without
this property, you cannot register applications under nested paths.</p>
</li>
<li>
<p><code>spring.cloud.zookeeper.dependency.headers.enabled</code> (enabled by default): This property
registers a <code>RibbonClient</code> that automatically appends appropriate headers and content
types with their versions, as presented in the Dependency configuration. Without this
setting, those two parameters do not work.</p>
</li>
<li>
<p><code>spring.cloud.zookeeper.dependency.resttemplate.enabled</code> (enabled by default): When
enabled, this property modifies the request headers of a <code>@LoadBalanced</code>-annotated
<code>RestTemplate</code> such that it passes headers and content type with the version set in
dependency configuration. Without this setting, those two parameters do not work.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-zookeeper-dependency-watcher"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependency-watcher"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependency-watcher">200. Spring Cloud Zookeeper Dependency Watcher</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Dependency Watcher mechanism lets you register listeners to your dependencies. The
functionality is, in fact, an implementation of the <code>Observator</code> pattern. When a
dependency changes, its state (to either UP or DOWN), some custom logic can be applied.</p>
</div>
<div class="sect2">
<h3 id="activating-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#activating-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#activating-2">200.1. Activating</a></h3>
<div class="paragraph">
<p>Spring Cloud Zookeeper Dependencies functionality needs to be enabled for you to use the
Dependency Watcher mechanism.</p>
</div>
</div>
<div class="sect2">
<h3 id="registering-a-listener"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-a-listener"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#registering-a-listener">200.2. Registering a Listener</a></h3>
<div class="paragraph">
<p>To register a listener, you must implement an interface called
<code>org.springframework.cloud.zookeeper.discovery.watcher.DependencyWatcherListener</code> and
register it as a bean. The interface gives you one method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">stateChanged</span><span class="hljs-params">(String dependencyName, DependencyState newState)</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to register a listener for a particular dependency, the <code>dependencyName</code> would
be the discriminator for your concrete implementation. <code>newState</code> provides you with
information about whether your dependency has changed to <code>CONNECTED</code> or <code>DISCONNECTED</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-zookeeper-dependency-watcher-presence-checker"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependency-watcher-presence-checker"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-dependency-watcher-presence-checker">200.3. Using the Presence Checker</a></h3>
<div class="paragraph">
<p>Bound with the Dependency Watcher is the functionality called Presence Checker. It lets
you provide custom behavior when your application boots, to react according to the state
of your dependencies.</p>
</div>
<div class="paragraph">
<p>The default implementation of the abstract
<code>org.springframework.cloud.zookeeper.discovery.watcher.presence.DependencyPresenceOnStartupVerifier</code>
class is the
<code>org.springframework.cloud.zookeeper.discovery.watcher.presence.DefaultDependencyPresenceOnStartupVerifier</code>,
which works in the following way.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the dependency is marked us <code>required</code> and is not in Zookeeper, when your application
boots, it throws an exception and shuts down.</p>
</li>
<li>
<p>If the dependency is not <code>required</code>, the
<code>org.springframework.cloud.zookeeper.discovery.watcher.presence.LogMissingDependencyChecker</code>
logs that the dependency is missing at the <code>WARN</code> level.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Because the <code>DefaultDependencyPresenceOnStartupVerifier</code> is registered only when there is
no bean of type <code>DependencyPresenceOnStartupVerifier</code>, this functionality can be
overridden.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-zookeeper-config"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-config"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-config">201. Distributed Configuration with Zookeeper</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zookeeper provides a
<a href="https://zookeeper.apache.org/doc/current/zookeeperOver.html#sc_dataModelNameSpace">hierarchical namespace</a>
that lets clients store arbitrary data, such as configuration data. Spring Cloud Zookeeper
Config is an alternative to the
<a href="https://github.com/spring-cloud/spring-cloud-config">Config Server and Client</a>.
Configuration is loaded into the Spring Environment during the special “bootstrap”
phase. Configuration is stored in the <code>/config</code> namespace by default. Multiple
<code>PropertySource</code> instances are created, based on the application’s name and the active
profiles, to mimic the Spring Cloud Config order of resolving properties. For example, an
application with a name of <code>testApp</code> and with the <code>dev</code> profile has the following property
sources created for it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>config/testApp,dev</code></p>
</li>
<li>
<p><code>config/testApp</code></p>
</li>
<li>
<p><code>config/application,dev</code></p>
</li>
<li>
<p><code>config/application</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The most specific property source is at the top, with the least specific at the bottom.
Properties in the <code>config/application</code> namespace apply to all applications that use
zookeeper for configuration. Properties in the <code>config/testApp</code> namespace are available
only to the instances of the service named <code>testApp</code>.</p>
</div>
<div class="paragraph">
<p>Configuration is currently read on startup of the application. Sending a HTTP <code>POST</code>
request to <code>/refresh</code> causes the configuration to be reloaded. Watching the configuration
namespace (which Zookeeper supports) is not currently implemented.</p>
</div>
<div class="sect2">
<h3 id="activating-3"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#activating-3"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#activating-3">201.1. Activating</a></h3>
<div class="paragraph">
<p>Including a dependency on
<code>org.springframework.cloud:spring-cloud-starter-zookeeper-config</code> enables
autoconfiguration that sets up Spring Cloud Zookeeper Config.</p>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
When working with version 3.4 of Zookeeper you need to change
the way you include the dependency as described <a href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#spring-cloud-zookeeper-install">here</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="customizing-2"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-2"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#customizing-2">201.2. Customizing</a></h3>
<div class="paragraph">
<p>Zookeeper Config may be customized by setting the following properties:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">spring:
  cloud:
    zookeeper:
      config:
        enabled: true
        root: configuration
        defaultContext: apps
        profileSeparator: '::'</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code>: Setting this value to <code>false</code> disables Zookeeper Config.</p>
</li>
<li>
<p><code>root</code>: Sets the base namespace for configuration values.</p>
</li>
<li>
<p><code>defaultContext</code>: Sets the name used by all applications.</p>
</li>
<li>
<p><code>profileSeparator</code>: Sets the value of the separator used to separate the profile name in
property sources with profiles.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="access-control-lists-acls"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#access-control-lists-acls"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#access-control-lists-acls">201.3. Access Control Lists (ACLs)</a></h3>
<div class="paragraph">
<p>You can add authentication information for Zookeeper ACLs by calling the <code>addAuthInfo</code>
method of a <code>CuratorFramework</code> bean. One way to accomplish this is to provide your own
<code>CuratorFramework</code> bean, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@BoostrapConfiguration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomCuratorFrameworkConfig</span> </span>{

  <span class="hljs-meta">@Bean</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> CuratorFramework <span class="hljs-title">curatorFramework</span><span class="hljs-params">()</span> </span>{
    CuratorFramework curator = <span class="hljs-keyword">new</span> CuratorFramework();
    curator.addAuthInfo(<span class="hljs-string">"digest"</span>, <span class="hljs-string">"user:password"</span>.getBytes());
    <span class="hljs-keyword">return</span> curator;
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Consult
<a href="https://github.com/spring-cloud/spring-cloud-zookeeper/blob/master/spring-cloud-zookeeper-core/src/main/java/org/springframework/cloud/zookeeper/ZookeeperAutoConfiguration.java">the ZookeeperAutoConfiguration class</a>
to see how the <code>CuratorFramework</code> bean’s default configuration.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can add your credentials from a class that depends on the existing
<code>CuratorFramework</code> bean, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-meta">@BoostrapConfiguration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DefaultCuratorFrameworkConfig</span> </span>{

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ZookeeperConfig</span><span class="hljs-params">(CuratorFramework curator)</span> </span>{
    curator.addAuthInfo(<span class="hljs-string">"digest"</span>, <span class="hljs-string">"user:password"</span>.getBytes());
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The creation of this bean must occur during the boostrapping phase. You can register
configuration classes to run during this phase by annotating them with
<code>@BootstrapConfiguration</code> and including them in a comma-separated list that you set as the
value of the <code>org.springframework.cloud.bootstrap.BootstrapConfiguration</code> property in the
<code>resources/META-INF/spring.factories</code> file, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">resources/META-INF/spring.factories</div>
<div class="content">
<pre>org.springframework.cloud.bootstrap.BootstrapConfiguration=\
my.project.CustomCuratorFrameworkConfig,\
my.project.DefaultCuratorFrameworkConfig</pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="appendix-compendium-of-configuration-properties" class="sect0"><a class="anchor" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#appendix-compendium-of-configuration-properties"></a><a class="link" href="https://docs.spring.io/spring-cloud/docs/Hoxton.SR10/reference/htmlsingle/#appendix-compendium-of-configuration-properties">Appendix: Compendium of Configuration Properties</a></h1>
<div class="openblock partintro">
<div class="content">
<table class="tableblock frame-topbot grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aws.paramstore.default-context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aws.paramstore.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is AWS Parameter Store support enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aws.paramstore.fail-fast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Throw exceptions during config lookup if true, otherwise, log warnings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aws.paramstore.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alternative to spring.application.name to use in looking up values in AWS Parameter Store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aws.paramstore.prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefix indicating first level for every property. Value must start with a forward slash followed by a valid path segment or be empty. Defaults to "/config".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aws.paramstore.profile-separator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aws.paramstore.region</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If region value is not null or empty it will be used in creation of AWSSimpleSystemsManagement.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aws.secretsmanager.default-context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aws.secretsmanager.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is AWS Secrets Manager support enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aws.secretsmanager.fail-fast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Throw exceptions during config lookup if true, otherwise, log warnings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aws.secretsmanager.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alternative to spring.application.name to use in looking up values in AWS Secrets Manager.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aws.secretsmanager.prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/secret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefix indicating first level for every property. Value must start with a forward slash followed by a valid path segment or be empty. Defaults to "/config".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aws.secretsmanager.profile-separator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aws.secretsmanager.region</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If region value is not null or empty it will be used in creation of AWSSecretsManager.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.credentials.access-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The access key to be used with a static provider.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.credentials.instance-profile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures an instance profile credentials provider with no further configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.credentials.profile-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The AWS profile name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.credentials.profile-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The AWS profile path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.credentials.secret-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The secret key to be used with a static provider.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.credentials.use-default-aws-credentials-chain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the DefaultAWSCredentials Chain instead of configuring a custom credentials chain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.loader.core-pool-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The core pool size of the Task Executor used for parallel S3 interaction. @see org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor#setCorePoolSize(int)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.loader.max-pool-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum pool size of the Task Executor used for parallel S3 interaction. @see org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor#setMaxPoolSize(int)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.loader.queue-capacity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum queue capacity for backed up S3 requests. @see org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor#setQueueCapacity(int)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.region.auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables automatic region detection based on the EC2 meta data service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.region.static</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.region.use-default-aws-region-chain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether default AWS SDK region provider chain should be used when auto is set to true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.stack.auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the automatic stack name detection for the application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.stack.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the manually configured stack name that will be used to retrieve the resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eureka.client.eureka-connection-idle-timeout-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates how much time (in seconds) that the HTTP connections to eureka server can stay idle before it can be closed. In the AWS environment, it is recommended that the values is 30 seconds or less, since the firewall cleans up the connection information after a few mins leaving the connection hanging in limbo.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eureka.client.eureka-server-connect-timeout-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates how long to wait (in seconds) before a connection to eureka server needs to timeout. Note that the connections in the client are pooled by org.apache.http.client.HttpClient and this setting affects the actual connection creation and also the wait time to get the connection from the pool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eureka.client.eureka-server-d-n-s-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets the DNS name to be queried to get the list of eureka servers.This information is not required if the contract returns the service urls by implementing serviceUrls. The DNS mechanism is used when useDnsForFetchingServiceUrls is set to true and the eureka client expects the DNS to configured a certain way so that it can fetch changing eureka servers dynamically. The changes are effective at runtime.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eureka.client.eureka-server-port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets the port to be used to construct the service url to contact eureka server when the list of eureka servers come from the DNS.This information is not required if the contract returns the service urls eurekaServerServiceUrls(String). The DNS mechanism is used when useDnsForFetchingServiceUrls is set to true and the eureka client expects the DNS to configured a certain way so that it can fetch changing eureka servers dynamically. The changes are effective at runtime.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eureka.client.eureka-server-read-timeout-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates how long to wait (in seconds) before a read from eureka server needs to timeout.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eureka.client.eureka-server-total-connections</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>200</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets the total number of connections that is allowed from eureka client to all eureka servers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eureka.client.eureka-server-total-connections-per-host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>50</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets the total number of connections that is allowed from eureka client to a eureka server host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eureka.client.eureka-server-u-r-l-context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets the URL context to be used to construct the service url to contact eureka server when the list of eureka servers come from the DNS. This information is not required if the contract returns the service urls from eurekaServerServiceUrls. The DNS mechanism is used when useDnsForFetchingServiceUrls is set to true and the eureka client expects the DNS to configured a certain way so that it can fetch changing eureka servers dynamically. The changes are effective at runtime.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eureka.client.eureka-service-url-poll-interval-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates how often(in seconds) to poll for changes to eureka server information. Eureka servers could be added or removed and this setting controls how soon the eureka clients should know about it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eureka.client.prefer-same-zone-eureka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether or not this instance should try to use the eureka server in the same zone for latency and/or other reason. Ideally eureka clients are configured to talk to servers in the same zone The changes are effective at runtime at the next registry fetch cycle as specified by registryFetchIntervalSeconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eureka.client.register-with-eureka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether or not this instance should register its information with eureka server for discovery by others. In some cases, you do not want your instances to be discovered whereas you just want do discover other instances.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eureka.server.peer-eureka-nodes-update-interval-ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eureka.server.peer-eureka-status-refresh-time-interval-ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.autoconfiguration.jackson.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, PageJacksonModule and SortJacksonModule bean will be provided for Jackson page decoding.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.circuitbreaker.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, an OpenFeign client will be wrapped with a Spring Cloud CircuitBreaker circuit breaker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.client.config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.client.decode-slash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feign clients do not encode slash `/` characters by default. To change this behavior, set the `decodeSlash` to `false`.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.client.default-config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.client.default-to-properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.compression.request.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the request sent by Feign to be compressed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.compression.request.mime-types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[text/xml, application/xml, application/json]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of supported mime types.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.compression.request.min-request-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2048</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minimum threshold content size.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.compression.response.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the response from Feign to be compressed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.compression.response.useGzipDecoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the default gzip decoder to be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.httpclient.connection-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2000</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.httpclient.connection-timer-repeat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3000</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.httpclient.disable-ssl-validation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.httpclient.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the use of the Apache HTTP Client by Feign.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.httpclient.follow-redirects</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.httpclient.max-connections</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>200</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.httpclient.max-connections-per-route</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>50</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.httpclient.time-to-live</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>900</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.httpclient.time-to-live-unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.hystrix.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, an OpenFeign client will be wrapped with a Hystrix circuit breaker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feign.okhttp.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the use of the OK HTTP Client by Feign.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">management.endpoint.hystrix.config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hystrix settings. These are traditionally set using servlet parameters. Refer to the documentation of Hystrix for more details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">management.endpoint.hystrix.stream.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable the hystrix.stream endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">management.metrics.binders.hystrix.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables creation of OK Http Client factory beans.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ribbon.eureka.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the use of Eureka with Ribbon.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.bus.ack.destination-service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service that wants to listen to acks. By default null (meaning all services).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.bus.ack.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to switch off acks (default on).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.bus.destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>springCloudBus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of Spring Cloud Stream destination for messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.bus.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to indicate that the bus is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.bus.env.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to switch off environment change events (default on).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.bus.id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier for this application instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.bus.refresh.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to switch off refresh events (default on).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.bus.trace.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to switch on tracing of acks (default off).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.circuitbreaker.hystrix.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables auto-configuration of the Hystrix Spring Cloud CircuitBreaker API implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cloudfoundry.discovery.default-server-port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>80</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port to use when no port is defined by ribbon.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cloudfoundry.discovery.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to indicate that discovery is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cloudfoundry.discovery.heartbeat-frequency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Frequency in milliseconds of poll for heart beat. The client will poll on this frequency and broadcast a list of service ids.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cloudfoundry.discovery.internal-domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apps.internal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default internal domain when configured to use Native DNS service discovery.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cloudfoundry.discovery.order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Order of the discovery client used by `CompositeDiscoveryClient` for sorting available clients.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cloudfoundry.discovery.use-container-ip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to resolve hostname when BOSH DNS is used. In order to use this feature, spring.cloud.cloudfoundry.discovery.use-dns must be true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cloudfoundry.discovery.use-dns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to use BOSH DNS for the discovery. In order to use this feature, your Cloud Foundry installation must support Service Discovery.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cloudfoundry.org</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization name to initially target.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cloudfoundry.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for user to authenticate and obtain token.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cloudfoundry.skip-ssl-validation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cloudfoundry.space</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Space name to initially target.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cloudfoundry.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL of Cloud Foundry API (Cloud Controller).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cloudfoundry.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username to authenticate (usually an email address).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.compatibility-verifier.compatible-boot-versions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default accepted versions for the Spring Boot dependency. You can set {@code x} for the patch version if you don't want to specify a concrete value. Example: {@code 3.4.x}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.compatibility-verifier.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables creation of Spring Cloud compatibility verification.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.allow-override</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to indicate that {@link #isOverrideSystemProperties() systemPropertiesOverride} can be used. Set to false to prevent users from changing the default accidentally. Default true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.allow-override</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to indicate that {@link #isOverrideSystemProperties() systemPropertiesOverride} can be used. Set to false to prevent users from changing the default accidentally. Default true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.discovery.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to indicate that config server discovery is enabled (config server URL will be looked up via discovery).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.discovery.service-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>configserver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service id to locate config server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to say that remote configuration is enabled. Default true;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.fail-fast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to indicate that failure to connect to the server is fatal (default false).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional headers used to create the client request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The label name to use to pull remote configuration properties. The default is set on the server (generally "master" for a git based server).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.media-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Accept header media type to send to config server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of application used to fetch remote properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.override-none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to indicate that when {@link #setAllowOverride(boolean) allowOverride} is true, external properties should take lowest priority and should not override any existing property sources (including local config files). Default false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.override-none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to indicate that when {@link #setAllowOverride(boolean) allowOverride} is true, external properties should take lowest priority and should not override any existing property sources (including local config files). Default false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.override-system-properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to indicate that the external properties should override system properties. Default true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.override-system-properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to indicate that the external properties should override system properties. Default true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password to use (HTTP Basic) when contacting the remote server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.profile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default profile to use when fetching remote configuration (comma-separated). Default is "default".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.request-connect-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeout on waiting to connect to the Config Server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.request-read-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeout on waiting to read data from the Config Server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.retry.initial-interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial retry interval in milliseconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.retry.max-attempts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of attempts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.retry.max-interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum interval for backoff.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.retry.multiplier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiplier for next interval.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.send-state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to indicate whether to send state. Default true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.tls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security Token passed thru to underlying environment repository.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[<a href="http://localhost:8888/" class="bare">localhost:8888</a>]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URI of the remote server (default <a href="http://localhost:8888/" class="bare">localhost:8888</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.config.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username to use (HTTP Basic) when contacting the remote server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.config.acl-token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.config.data-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>data</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If format is Format.PROPERTIES or Format.YAML then the following field is used as key to look up consul for configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.config.default-context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.config.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.config.fail-fast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Throw exceptions during config lookup if true, otherwise, log warnings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.config.format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.config.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alternative to spring.application.name to use in looking up values in consul KV.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.config.prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>config</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.config.profile-separator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>,</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.config.watch.delay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the fixed delay for the watch in millis. Defaults to 1000.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.config.watch.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the watch is enabled. Defaults to true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.config.watch.wait-time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>55</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of seconds to wait (or block) for watch query, defaults to 55. Needs to be less than default ConsulClient (defaults to 60). To increase ConsulClient timeout create a ConsulClient bean with a custom ConsulRawClient with a custom HttpClient.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.acl-token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.catalog-services-watch-delay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The delay between calls to watch consul catalog in millis, default is 1000.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.catalog-services-watch-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of seconds to block while watching consul catalog, default is 2.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.consistency-mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consistency mode for health service request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.datacenters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map of serviceId's -&gt; datacenter to query for in server list. This allows looking up services in another datacenters.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.default-query-tag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tag to query for in service list if one is not listed in serverListQueryTags.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.default-zone-metadata-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zone</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service instance zone comes from metadata. This allows changing the metadata tag name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.deregister</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable automatic de-registration of service in consul.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.enable-tag-override</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable tag override for the registered service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is service discovery enabled?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.fail-fast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Throw exceptions during service registration if true, otherwise, log warnings (defaults to true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.health-check-critical-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout to deregister services critical for longer than timeout (e.g. 30m). Requires consul version 7.x or higher.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.health-check-headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Headers to be applied to the Health Check calls.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.health-check-interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How often to perform the health check (e.g. 10s), defaults to 10s.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.health-check-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/actuator/health</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alternate server path to invoke for health checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.health-check-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout for health check (e.g. 10s).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.health-check-tls-skip-verify</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skips certificate verification during service checks if true, otherwise runs certificate verification.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.health-check-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom health check url to override default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.heartbeat.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.heartbeat.interval-ratio</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.heartbeat.ttl-unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>s</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.heartbeat.ttl-value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.hostname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hostname to use when accessing server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.include-hostname-in-instance-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether hostname is included into the default instance id when registering service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.instance-group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service instance group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.instance-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique service instance id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.instance-zone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service instance zone.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.ip-address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address to use when accessing service (must also set preferIpAddress to use).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.lifecycle.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.management-enable-tag-override</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable tag override for the registered management service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.management-metadata</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata to use when registering management service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.management-port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port to register the management service under (defaults to management port).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.management-suffix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>management</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suffix to use when registering management service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.management-tags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tags to use when registering management service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.metadata</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata to use when registering service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Order of the discovery client used by `CompositeDiscoveryClient` for sorting available clients.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port to register the service under (defaults to listening port).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.prefer-agent-address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source of how we will determine the address to use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.prefer-ip-address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use ip address rather than hostname during registration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.query-passing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add the 'passing` parameter to /v1/health/service/serviceName. This pushes health check passing to the server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.register</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Register as a service in consul.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.register-health-check</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Register health check in consul. Useful during development of a service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to register an http or https service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.server-list-query-tags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map of serviceId's -&gt; tag to query for in server list. This allows filtering services by a single tag.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.service-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.tags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tags to use when registering service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.discovery.tags-as-metadata</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use tags as metadata, defaults to true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is spring cloud consul enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localhost</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consul agent hostname. Defaults to 'localhost'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8500</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consul agent port. Defaults to '8500'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.retry.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If consul retry is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.retry.initial-interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial retry interval in milliseconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.retry.max-attempts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of attempts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.retry.max-interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum interval for backoff.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.retry.multiplier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiplier for next interval.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consul agent scheme (HTTP/HTTPS). If there is no scheme in address - client will use HTTP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.service-registry.auto-registration.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables Consul Service Registry Auto-registration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.service-registry.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables Consul Service Registry functionality.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.tls.certificate-password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password to open the certificate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.tls.certificate-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File path to the certificate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.tls.key-store-instance-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of key framework to use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.tls.key-store-password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password to an external keystore.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.consul.tls.key-store-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to an external keystore.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.discovery.client.composite-indicator.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables discovery client composite health indicator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.discovery.client.health-indicator.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.discovery.client.health-indicator.include-description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.discovery.client.simple.instances</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.discovery.client.simple.order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.discovery.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables discovery client health indicators.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.features.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the features endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.default-filters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of filter definitions that are applied to every route.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.discovery.locator.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag that enables DiscoveryClient gateway integration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.discovery.locator.filters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.discovery.locator.include-expression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SpEL expression that will evaluate whether to include a service in gateway integration or not, defaults to: true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.discovery.locator.lower-case-service-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Option to lower case serviceId in predicates and filters, defaults to false. Useful with eureka when it automatically uppercases serviceId. so MYSERIVCE, would match /myservice/**</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.discovery.locator.predicates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.discovery.locator.route-id-prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The prefix for the routeId, defaults to discoveryClient.getClass().getSimpleName() + "_". Service Id will be appended to create the routeId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.discovery.locator.url-expression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'lb://'+serviceId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SpEL expression that create the uri for each route, defaults to: 'lb://'+serviceId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables gateway functionality.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.fail-on-route-definition-error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Option to fail on route definition errors, defaults to true. Otherwise, a warning is logged.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.add-request-header.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the add-request-header filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.add-request-parameter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the add-request-parameter filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.add-response-header.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the add-response-header filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.circuit-breaker.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the circuit-breaker filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.dedupe-response-header.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the dedupe-response-header filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.fallback-headers.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the fallback-headers filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.hystrix.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the hystrix filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.map-request-header.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the map-request-header filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.modify-request-body.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the modify-request-body filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.modify-response-body.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the modify-response-body filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.prefix-path.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the prefix-path filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.preserve-host-header.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the preserve-host-header filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.redirect-to.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the redirect-to filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.remove-hop-by-hop.headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.remove-hop-by-hop.order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.remove-request-header.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the remove-request-header filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.remove-request-parameter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the remove-request-parameter filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.remove-response-header.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the remove-response-header filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.request-header-size.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the request-header-size filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.request-header-to-request-uri.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the request-header-to-request-uri filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.request-rate-limiter.deny-empty-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Switch to deny requests if the Key Resolver returns an empty key, defaults to true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.request-rate-limiter.empty-key-status-code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpStatus to return when denyEmptyKey is true, defaults to FORBIDDEN.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.request-rate-limiter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the request-rate-limiter filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.request-size.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the request-size filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.retry.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the retry filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.rewrite-location-response-header.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the rewrite-location-response-header filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.rewrite-location.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the rewrite-location filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.rewrite-path.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the rewrite-path filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.rewrite-response-header.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the rewrite-response-header filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.save-session.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the save-session filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.secure-headers.content-security-policy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-src 'self' https:; font-src 'self' https: data:; img-src 'self' https: data:; object-src 'none'; script-src https:; style-src 'self' https: 'unsafe-inline'</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.secure-headers.content-type-options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nosniff</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.secure-headers.disable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.secure-headers.download-options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>noopen</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.secure-headers.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the secure-headers filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.secure-headers.frame-options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DENY</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.secure-headers.permitted-cross-domain-policies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.secure-headers.referrer-policy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-referrer</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.secure-headers.strict-transport-security</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-age=631138519</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.secure-headers.xss-protection-header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1 ; mode=block</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.set-path.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the set-path filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.set-request-header.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the set-request-header filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.set-request-host-header.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the set-request-host-header filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.set-response-header.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the set-response-header filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.set-status.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the set-status filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.filter.strip-prefix.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the strip-prefix filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.forwarded.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the ForwardedHeadersFilter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.global-filter.adapt-cached-body.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the adapt-cached-body global filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.global-filter.forward-path.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the forward-path global filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.global-filter.forward-routing.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the forward-routing global filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.global-filter.load-balancer-client.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the load-balancer-client global filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.global-filter.netty-routing.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the netty-routing global filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.global-filter.netty-write-response.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the netty-write-response global filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.global-filter.reactive-load-balancer.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the reactive-loadbalancer global filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.global-filter.remove-cached-body.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the remove-cached-body global filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.global-filter.route-to-request-url.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the route-to-request-url global filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.global-filter.websocket-routing.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the websocket-routing global filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.globalcors.add-to-simple-url-handler-mapping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If global CORS config should be added to the URL handler.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.globalcors.cors-configurations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.connect-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The connect timeout in millis, the default is 45s.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.max-header-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The max response header size.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.max-initial-line-length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The max initial line length.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.pool.acquire-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only for type FIXED, the maximum time in millis to wait for aquiring.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.pool.max-connections</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only for type FIXED, the maximum number of connections before starting pending acquisition on existing ones.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.pool.max-idle-time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in millis after which the channel will be closed. If NULL, there is no max idle time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.pool.max-life-time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration after which the channel will be closed. If NULL, there is no max life time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.pool.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>proxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The channel pool map name, defaults to proxy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.pool.type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of pool for HttpClient to use, defaults to ELASTIC.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.proxy.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hostname for proxy configuration of Netty HttpClient.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.proxy.non-proxy-hosts-pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regular expression (Java) for a configured list of hosts. that should be reached directly, bypassing the proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.proxy.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for proxy configuration of Netty HttpClient.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.proxy.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port for proxy configuration of Netty HttpClient.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.proxy.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username for proxy configuration of Netty HttpClient.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.response-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The response timeout.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.ssl.close-notify-flush-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3000ms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL close_notify flush timeout. Default to 3000 ms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.ssl.close-notify-flush-timeout-millis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.ssl.close-notify-read-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL close_notify read timeout. Default to 0 ms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.ssl.close-notify-read-timeout-millis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.ssl.default-configuration-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default ssl configuration type. Defaults to TCP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.ssl.handshake-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000ms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL handshake timeout. Default to 10000 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.ssl.handshake-timeout-millis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.ssl.key-password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key password, default is same as keyStorePassword.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.ssl.key-store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keystore path for Netty HttpClient.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.ssl.key-store-password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keystore password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.ssl.key-store-provider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keystore provider for Netty HttpClient, optional field.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.ssl.key-store-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JKS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keystore type for Netty HttpClient, default is JKS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.ssl.trusted-x509-certificates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trusted certificates for verifying the remote endpoint's certificate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.ssl.use-insecure-trust-manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installs the netty InsecureTrustManagerFactory. This is insecure and not suitable for production.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.websocket.max-frame-payload-length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max frame payload length.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.websocket.proxy-ping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proxy ping frames to downstream services, defaults to true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpclient.wiretap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables wiretap debugging for Netty HttpClient.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.httpserver.wiretap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables wiretap debugging for Netty HttpServer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.loadbalancer.use404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.metrics.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the collection of metrics data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.metrics.prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gateway</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The prefix of all metrics emitted by gateway.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.metrics.tags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tags map that added to metrics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.predicate.after.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the after predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.predicate.before.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the before predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.predicate.between.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the between predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.predicate.cloud-foundry-route-service.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the cloud-foundry-route-service predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.predicate.cookie.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the cookie predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.predicate.header.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the header predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.predicate.host.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the host predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.predicate.method.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the method predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.predicate.path.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the path predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.predicate.query.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the query predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.predicate.read-body.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the read-body predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.predicate.remote-addr.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the remote-addr predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.predicate.weight.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the weight predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.redis-rate-limiter.burst-capacity-header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X-RateLimit-Burst-Capacity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the header that returns the burst capacity configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.redis-rate-limiter.config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.redis-rate-limiter.include-headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not to include headers containing rate limiter information, defaults to true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.redis-rate-limiter.remaining-header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X-RateLimit-Remaining</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the header that returns number of remaining requests during the current second.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.redis-rate-limiter.replenish-rate-header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X-RateLimit-Replenish-Rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the header that returns the replenish rate configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.redis-rate-limiter.requested-tokens-header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X-RateLimit-Requested-Tokens</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the header that returns the requested tokens configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.routes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of Routes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.set-status.original-status-header-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the header which contains http code of the proxied request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.streaming-media-types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.x-forwarded.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the XForwardedHeadersFilter is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.x-forwarded.for-append</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If appending X-Forwarded-For as a list is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.x-forwarded.for-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If X-Forwarded-For is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.x-forwarded.host-append</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If appending X-Forwarded-Host as a list is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.x-forwarded.host-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If X-Forwarded-Host is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.x-forwarded.order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The order of the XForwardedHeadersFilter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.x-forwarded.port-append</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If appending X-Forwarded-Port as a list is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.x-forwarded.port-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If X-Forwarded-Port is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.x-forwarded.prefix-append</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If appending X-Forwarded-Prefix as a list is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.x-forwarded.prefix-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If X-Forwarded-Prefix is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.x-forwarded.proto-append</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If appending X-Forwarded-Proto as a list is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gateway.x-forwarded.proto-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If X-Forwarded-Proto is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.bigquery.credentials.encoded-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.bigquery.credentials.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.bigquery.credentials.scopes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.bigquery.dataset-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the BigQuery dataset to use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.bigquery.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Google Cloud BigQuery components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.bigquery.project-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the GCP project ID specified in the Core module to use for BigQuery.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.config.credentials.encoded-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.config.credentials.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.config.credentials.scopes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.config.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Google Cloud Runtime components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.config.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.config.profile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-delimited string of profiles under which the app is running. Gets its default value from the {@code spring.profiles.active} property, falling back on the {@code spring.profiles.default} property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.config.project-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the GCP project ID specified in the Core module.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.config.timeout-millis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>60000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout for Google Runtime Configuration API calls.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.core.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Google Cloud Core components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.credentials.encoded-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.credentials.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.credentials.scopes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.datastore.credentials.encoded-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.datastore.credentials.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.datastore.credentials.scopes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.datastore.emulator-host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@deprecated use &lt;code&gt;spring.cloud.gcp.datastore.host&lt;/code&gt; instead. @see #host</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.datastore.emulator.consistency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consistency to use creating the Datastore server instance. Default: {@code 0.9}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.datastore.emulator.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled the Datastore client will connect to an local datastore emulator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.datastore.emulator.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8081</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is the datastore emulator port. Default: {@code 8081}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.datastore.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Google Cloud Datastore components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.datastore.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host and port of a Datastore emulator as the following example: localhost:8081.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.datastore.namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.datastore.project-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.firestore.credentials.encoded-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.firestore.credentials.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.firestore.credentials.scopes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.firestore.emulator.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables autoconfiguration to use the Firestore emulator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.firestore.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Google Cloud Firestore components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.firestore.host-port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firestore.googleapis.com:443</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host and port of the Firestore emulator service; can be overridden to specify an emulator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.firestore.project-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.logging.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Google Cloud Stackdriver logging for Spring MVC.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.metrics.credentials.encoded-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.metrics.credentials.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.metrics.credentials.scopes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.metrics.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Google Cloud Monitoring for Micrometer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.metrics.project-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the GCP project ID specified in the Core module.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.project-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP project ID where services are running.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.credentials.encoded-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.credentials.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.credentials.scopes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.emulator-host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host and port of the local running emulator. If provided, this will setup the client to connect against a running pub/sub emulator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Google Cloud Pub/Sub components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.keep-alive-interval-minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How often to ping the server to keep the channel alive.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.project-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the GCP project ID specified in the Core module.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.batching.delay-threshold-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The delay threshold to use for batching. After this amount of time has elapsed (counting from the first element added), the elements will be wrapped up in a batch and sent.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.batching.element-count-threshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The element count threshold to use for batching.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.batching.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables batching if true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.batching.flow-control.limit-exceeded-behavior</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The behavior when the specified limits are exceeded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.batching.flow-control.max-outstanding-element-count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of outstanding elements to keep in memory before enforcing flow control.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.batching.flow-control.max-outstanding-request-bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of outstanding bytes to keep in memory before enforcing flow control.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.batching.request-byte-threshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The request byte threshold to use for batching.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.executor-threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of threads used by every publisher.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.retry.initial-retry-delay-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">InitialRetryDelay controls the delay before the first retry. Subsequent retries will use this value adjusted according to the RetryDelayMultiplier.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.retry.initial-rpc-timeout-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">InitialRpcTimeout controls the timeout for the initial RPC. Subsequent calls will use this value adjusted according to the RpcTimeoutMultiplier.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.retry.jittered</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jitter determines if the delay time should be randomized.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.retry.max-attempts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MaxAttempts defines the maximum number of attempts to perform. If this value is greater than 0, and the number of attempts reaches this limit, the logic will give up retrying even if the total retry time is still lower than TotalTimeout.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.retry.max-retry-delay-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MaxRetryDelay puts a limit on the value of the retry delay, so that the RetryDelayMultiplier can't increase the retry delay higher than this amount.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.retry.max-rpc-timeout-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MaxRpcTimeout puts a limit on the value of the RPC timeout, so that the RpcTimeoutMultiplier can't increase the RPC timeout higher than this amount.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.retry.retry-delay-multiplier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RetryDelayMultiplier controls the change in retry delay. The retry delay of the previous call is multiplied by the RetryDelayMultiplier to calculate the retry delay for the next call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.retry.rpc-timeout-multiplier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RpcTimeoutMultiplier controls the change in RPC timeout. The timeout of the previous call is multiplied by the RpcTimeoutMultiplier to calculate the timeout for the next call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.publisher.retry.total-timeout-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TotalTimeout has ultimate control over how long the logic should keep trying the remote call until it gives up completely. The higher the total timeout, the more retries can be attempted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.reactive.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Google Cloud Pub/Sub Reactive components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.executor-threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of threads used by every subscriber.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.flow-control.limit-exceeded-behavior</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The behavior when the specified limits are exceeded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.flow-control.max-outstanding-element-count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of outstanding elements to keep in memory before enforcing flow control.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.flow-control.max-outstanding-request-bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of outstanding bytes to keep in memory before enforcing flow control.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.max-ack-extension-period</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The optional max ack extension period in seconds for the subscriber factory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.max-acknowledgement-threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of threads used for batch acknowledgement.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.parallel-pull-count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The optional parallel pull count setting for the subscriber factory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.pull-endpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The optional pull endpoint setting for the subscriber factory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.retry.initial-retry-delay-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">InitialRetryDelay controls the delay before the first retry. Subsequent retries will use this value adjusted according to the RetryDelayMultiplier.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.retry.initial-rpc-timeout-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">InitialRpcTimeout controls the timeout for the initial RPC. Subsequent calls will use this value adjusted according to the RpcTimeoutMultiplier.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.retry.jittered</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jitter determines if the delay time should be randomized.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.retry.max-attempts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MaxAttempts defines the maximum number of attempts to perform. If this value is greater than 0, and the number of attempts reaches this limit, the logic will give up retrying even if the total retry time is still lower than TotalTimeout.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.retry.max-retry-delay-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MaxRetryDelay puts a limit on the value of the retry delay, so that the RetryDelayMultiplier can't increase the retry delay higher than this amount.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.retry.max-rpc-timeout-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MaxRpcTimeout puts a limit on the value of the RPC timeout, so that the RpcTimeoutMultiplier can't increase the RPC timeout higher than this amount.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.retry.retry-delay-multiplier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RetryDelayMultiplier controls the change in retry delay. The retry delay of the previous call is multiplied by the RetryDelayMultiplier to calculate the retry delay for the next call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.retry.rpc-timeout-multiplier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RpcTimeoutMultiplier controls the change in RPC timeout. The timeout of the previous call is multiplied by the RpcTimeoutMultiplier to calculate the timeout for the next call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.pubsub.subscriber.retry.total-timeout-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TotalTimeout has ultimate control over how long the logic should keep trying the remote call until it gives up completely. The higher the total timeout, the more retries can be attempted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.secretmanager.credentials.encoded-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.secretmanager.credentials.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.secretmanager.credentials.scopes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.secretmanager.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure GCP Secret Manager support components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.secretmanager.project-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the GCP Project ID specified in the Core module.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.security.firebase.project-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the GCP project ID specified in the Core module.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.security.firebase.public-keys-endpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="https://www.googleapis.com/robot/v1/metadata/x509/securetoken@system.gserviceaccount.com" class="bare">www.googleapis.com/robot/v1/metadata/x509/securetoken@system.gserviceaccount.com</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link to Google's public endpoint containing Firebase public keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.security.iap.algorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ES256</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encryption algorithm used to sign the JWK token.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.security.iap.audience</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Non-dynamic audience string to validate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.security.iap.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Google Cloud IAP identity extraction components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.security.iap.header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x-goog-iap-jwt-assertion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Header from which to extract the JWK key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.security.iap.issuer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="https://cloud.google.com/iap" class="bare">cloud.google.com/iap</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWK issuer to verify.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.security.iap.registry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="https://www.gstatic.com/iap/verify/public_key-jwk" class="bare">www.gstatic.com/iap/verify/public_key-jwk</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link to JWK public key registry.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.create-interleaved-table-ddl-on-delete-cascade</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.credentials.encoded-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.credentials.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.credentials.scopes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.database</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.emulator-host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localhost:9010</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.emulator.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables auto-configuration to use the Spanner emulator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Google Cloud Spanner components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.fail-if-pool-exhausted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.instance-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.keep-alive-interval-minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.max-idle-sessions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.max-sessions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.min-sessions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.num-rpc-channels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.prefetch-chunks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.project-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.spanner.write-sessions-fraction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.sql.credentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the GCP OAuth2 credentials specified in the Core module.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.sql.database-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the database in the Cloud SQL instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.sql.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Google Cloud SQL support components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.sql.instance-connection-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud SQL instance connection name. [GCP_PROJECT_ID]:[INSTANCE_REGION]:[INSTANCE_NAME].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.sql.ip-types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma delimited list of preferred IP types for connecting to the Cloud SQL instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.storage.auto-create-files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.storage.credentials.encoded-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.storage.credentials.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.storage.credentials.scopes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.storage.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Google Cloud Storage components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.storage.project-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.trace.authority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP/2 authority the channel claims to be connecting to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.trace.compression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compression to use for the call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.trace.credentials.encoded-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.trace.credentials.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.trace.credentials.scopes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.trace.deadline-ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Call deadline.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.trace.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Google Cloud Stackdriver tracing components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.trace.max-inbound-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum size for an inbound message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.trace.max-outbound-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum size for an outbound message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.trace.message-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout in seconds before pending spans will be sent in batches to GCP Stackdriver Trace.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.trace.num-executor-threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of threads to be used by the Trace executor.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.trace.project-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the GCP project ID specified in the Core module.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.trace.wait-for-ready</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Waits for the channel to be ready in case of a transient failure. Defaults to failing fast in that case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.vision.credentials.encoded-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.vision.credentials.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.vision.credentials.scopes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.vision.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-configure Google Cloud Vision components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.vision.executor-threads-count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of threads used to poll for the completion of Document OCR operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.gcp.vision.json-output-batch-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of document pages to include in each JSON output file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.httpclientfactories.apache.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables creation of Apache Http Client factory beans.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.httpclientfactories.ok.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables creation of OK Http Client factory beans.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.hypermedia.refresh.fixed-delay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5000</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.hypermedia.refresh.initial-delay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.inetutils.default-hostname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localhost</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default hostname. Used in case of errors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.inetutils.default-ip-address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>127.0.0.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default IP address. Used in case of errors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.inetutils.ignored-interfaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of Java regular expressions for network interfaces that will be ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.inetutils.preferred-networks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of Java regular expressions for network addresses that will be preferred.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.inetutils.timeout-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout, in seconds, for calculating hostname.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.inetutils.use-only-site-local-interfaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to use only interfaces with site local addresses. See {@link InetAddress#isSiteLocalAddress()} for more details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.api-version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.apiVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>v1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes API Version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.ca-cert-data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.ca-cert-file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.caCertData</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes API CACertData</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.caCertFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes API CACertFile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.client-cert-data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.client-cert-file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.client-key-algo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.client-key-data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.client-key-file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.client-key-passphrase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.clientCertData</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes API ClientCertData</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.clientCertFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes API ClientCertFile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.clientKeyAlgo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RSA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes API ClientKeyAlgo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.clientKeyData</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes API ClientKeyData</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.clientKeyFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes API ClientKeyFile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.clientKeyPassphrase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>changeit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes API ClientKeyPassphrase</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.connection-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.connectionTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection timeout</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.http-proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.https-proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.logging-interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.loggingInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logging interval</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.master-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.masterUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="https://kubernetes.default.svc/" class="bare">kubernetes.default.svc</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes API Master Node URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes Namespace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.no-proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes API Password</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.proxy-password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.proxy-username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.request-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.requestTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request timeout</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.rolling-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.rollingTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>900s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rolling timeout</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.trust-certs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.trustCerts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes API Trust Certificates</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes API Username</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.watch-reconnect-interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.watch-reconnect-limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.watchReconnectInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reconnect Interval</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.client.watchReconnectLimit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reconnect Interval limit retries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.config.enable-api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.config.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable the ConfigMap property source locator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.config.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.config.namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.config.paths</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.config.sources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.discovery.all-namespaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If discovering all namespaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.discovery.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If Kubernetes Discovery is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.discovery.filter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SpEL expression to filter services AFTER they have been retrieved from the Kubernetes API server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.discovery.known-secure-ports</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the port numbers that are considered secure and use HTTPS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.discovery.metadata.add-annotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When set, the Kubernetes annotations of the services will be included as metadata of the returned ServiceInstance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.discovery.metadata.add-labels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When set, the Kubernetes labels of the services will be included as metadata of the returned ServiceInstance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.discovery.metadata.add-ports</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When set, any named Kubernetes service ports will be included as metadata of the returned ServiceInstance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.discovery.metadata.annotations-prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When addAnnotations is set, then this will be used as a prefix to the key names in the metadata map.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.discovery.metadata.labels-prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When addLabels is set, then this will be used as a prefix to the key names in the metadata map.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.discovery.metadata.ports-prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port.</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When addPorts is set, then this will be used as a prefix to the key names in the metadata map.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.discovery.order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.discovery.primary-port-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set then the port with a given name is used as primary when multiple ports are defined for a service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.discovery.service-labels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set, then only the services matching these labels will be fetched from the Kubernetes API server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.discovery.service-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unknown</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The service name of the local instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable Kubernetes integration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.loadbalancer.cluster-domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cluster.local</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cluster domain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.loadbalancer.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load balancer enabled,default true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.loadbalancer.mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{@link KubernetesLoadBalancerMode} setting load balancer server list with ip of pod or service name. default value is POD.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.loadbalancer.port-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">service port name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.reload.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the Kubernetes configuration reload on change.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.reload.max-wait-for-restart</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If Restart or Shutdown strategies are used, Spring Cloud Kubernetes waits a random amount of time before restarting. This is done in order to avoid having all instances of the same application restart at the same time. This property configures the maximum of amount of wait time from the moment the signal is received that a restart is needed until the moment the restart is actually triggered</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.reload.mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the detection mode for Kubernetes configuration reload.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.reload.monitoring-config-maps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables monitoring on config maps to detect changes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.reload.monitoring-secrets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables monitoring on secrets to detect changes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.reload.period</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15000ms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the polling period to use when the detection mode is POLLING.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.reload.strategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the reload strategy for Kubernetes configuration reload on change.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.ribbon.cluster-domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cluster.local</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cluster domain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.ribbon.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ribbon enabled,default true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.ribbon.mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{@link KubernetesRibbonMode} setting ribbon server list with ip of pod or service name. default value is POD.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.secrets.enable-api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.secrets.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable the Secrets property source locator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.secrets.labels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.secrets.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.secrets.namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.secrets.paths</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.kubernetes.secrets.sources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.cache.caffeine.spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The spec to use to create caches. See CaffeineSpec for more details on the spec format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.cache.capacity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>256</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial cache capacity expressed as int.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.cache.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables Spring Cloud LoadBalancer caching mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.cache.ttl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>35s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time To Live - time counted from writing of the record, after which cache entries are expired, expressed as a {@link Duration}. The property {@link String} has to be in keeping with the appropriate syntax as specified in Spring Boot &lt;code&gt;StringToDurationConverter&lt;/code&gt;. @see &lt;a href= "<a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/convert/StringToDurationConverter.java%22%3EStringToDurationConverter.java%3C/a%3E" class="bare">github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/convert/StringToDurationConverter.java"&gt;StringToDurationConverter.java&lt;/a&gt;</a>;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.eureka.approximate-zone-from-hostname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to determine whether we should try to get the `zone` value from host name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.health-check.initial-delay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial delay value for the HealthCheck scheduler.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.health-check.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>25s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval for rerunning the HealthCheck scheduler.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.health-check.path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.health-check.refetch-instances</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the instances should be refetched by the &lt;code&gt;HealthCheckServiceInstanceListSupplier&lt;/code&gt;. This can be used if the instances can be updated and the underlying delegate does not provide an ongoing flux.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.health-check.refetch-instances-interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>25s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval for refetching available service instances.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.health-check.repeat-health-check</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether health checks should keep repeating. It might be useful to set it to &lt;code&gt;false&lt;/code&gt; if periodically refetching the instances, as every refetch will also trigger a healthcheck.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.retry.backoff.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether Reactor Retry backoffs should be applied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.retry.backoff.jitter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to set {@link RetryBackoffSpec#jitter}.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.retry.backoff.max-backoff</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to set {@link RetryBackoffSpec#maxBackoff}.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.retry.backoff.min-backoff</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5ms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to set {@link RetryBackoffSpec#minBackoff}.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.retry.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.retry.max-retries-on-next-service-instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of retries to be executed on the next &lt;code&gt;ServiceInstance&lt;/code&gt;. A &lt;code&gt;ServiceInstance&lt;/code&gt; is chosen before each retry call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.retry.max-retries-on-same-service-instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of retries to be executed on the same &lt;code&gt;ServiceInstance&lt;/code&gt;.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.retry.retry-on-all-operations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates retries should be attempted on operations other than {@link HttpMethod#GET}.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.retry.retryable-status-codes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A {@link Set} of status codes that should trigger a retry.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.ribbon.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Causes `RibbonLoadBalancerClient` to be used by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.ribbon.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Causes `RibbonLoadBalancerClient` to be used by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.service-discovery.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String representation of Duration of the timeout for calls to service discovery.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.loadbalancer.zone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Cloud LoadBalancer zone.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.refresh.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables autoconfiguration for the refresh scope and associated features.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.refresh.extra-refreshable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional class names for beans to post process into refresh scope.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.refresh.never-refreshable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of class names for beans to never be refreshed or rebound.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.service-registry.auto-registration.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether service auto-registration is enabled. Defaults to true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.service-registry.auto-registration.fail-fast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether startup fails if there is no AutoServiceRegistration. Defaults to false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.service-registry.auto-registration.register-management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to register the management as a service. Defaults to true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.util.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables creation of Spring Cloud utility beans.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.app-id.app-id-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>app-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mount path of the AppId authentication backend.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.app-id.network-interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network interface hint for the "MAC_ADDRESS" UserId mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.app-id.user-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MAC_ADDRESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UserId mechanism. Can be either "MAC_ADDRESS", "IP_ADDRESS", a string or a class name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.app-role.app-role-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>approle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mount path of the AppRole authentication backend.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.app-role.role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the role, optional, used for pull-mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.app-role.role-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The RoleId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.app-role.secret-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The SecretId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.application-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application name for AppId authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.aws-ec2.aws-ec2-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws-ec2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mount path of the AWS-EC2 authentication backend.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.aws-ec2.identity-document</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://169.254.169.254/latest/dynamic/instance-identity/pkcs7" class="bare">169.254.169.254/latest/dynamic/instance-identity/pkcs7</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL of the AWS-EC2 PKCS7 identity document.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.aws-ec2.nonce</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nonce used for AWS-EC2 authentication. An empty nonce defaults to nonce generation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.aws-ec2.role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the role, optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.aws-iam.aws-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mount path of the AWS authentication backend.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.aws-iam.endpoint-uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STS server URI. @since 2.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.aws-iam.role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the role, optional. Defaults to the friendly IAM name if not set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.aws-iam.server-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the server used to set {@code X-Vault-AWS-IAM-Server-ID} header in the headers of login requests.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.azure-msi.azure-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>azure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mount path of the Azure MSI authentication backend.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.azure-msi.role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the role.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.config.lifecycle.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable lifecycle management.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.config.lifecycle.expiry-threshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The expiry threshold. {@link Lease} is renewed the given {@link Duration} before it expires. @since 2.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.config.lifecycle.lease-endpoints</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the {@link LeaseEndpoints} to delegate renewal/revocation calls to. {@link LeaseEndpoints} encapsulates differences between Vault versions that affect the location of renewal/revocation endpoints. Can be {@link LeaseEndpoints#SysLeases} for version 0.8 or above of Vault or {@link LeaseEndpoints#Legacy} for older versions (the default). @since 2.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.config.lifecycle.min-renewal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time period that is at least required before renewing a lease. @since 2.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.config.order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to set a {@link org.springframework.core.env.PropertySource} priority. This is useful to use Vault as an override on other property sources. @see org.springframework.core.PriorityOrdered</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.connection-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection timeout.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.discovery.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to indicate that Vault server discovery is enabled (vault server URL will be looked up via discovery).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.discovery.service-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vault</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service id to locate Vault.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable Vault config server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.fail-fast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fail fast if data cannot be obtained from Vault.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.gcp-gce.gcp-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gcp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mount path of the Kubernetes authentication backend.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.gcp-gce.role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the role against which the login is being attempted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.gcp-gce.service-account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional service account id. Using the default id if left unconfigured.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.gcp-iam.credentials.encoded-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The base64 encoded contents of an OAuth2 account private key in JSON format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.gcp-iam.credentials.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of the OAuth2 credentials private key. &lt;p&gt; Since this is a Resource, the private key can be in a multitude of locations, such as a local file system, classpath, URL, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.gcp-iam.gcp-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gcp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mount path of the Kubernetes authentication backend.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.gcp-iam.jwt-validity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validity of the JWT token.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.gcp-iam.project-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the GCP project Id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.gcp-iam.role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the role against which the login is being attempted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.gcp-iam.service-account-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the GCP service account Id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.generic.application-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application name to be used for the context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.generic.backend</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the default backend.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.generic.default-context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the default context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.generic.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable the generic backend.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.generic.profile-separator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profile-separator to combine application name and profile.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localhost</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vault server host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.kubernetes.kubernetes-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubernetes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mount path of the Kubernetes authentication backend.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.kubernetes.role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the role against which the login is being attempted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.kubernetes.service-account-token-file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/run/secrets/kubernetes.io/serviceaccount/token</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the service account token file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.kv.application-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application name to be used for the context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.kv.backend</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the default backend.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.kv.backend-version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key-Value backend version. Currently supported versions are: &lt;ul&gt; &lt;li&gt;Version 1 (unversioned key-value backend).&lt;/li&gt; &lt;li&gt;Version 2 (versioned key-value backend).&lt;/li&gt; &lt;/ul&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.kv.default-context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the default context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.kv.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable the kev-value backend.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.kv.profile-separator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profile-separator to combine application name and profile.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vault namespace (requires Vault Enterprise).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.pcf.instance-certificate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the instance certificate (PEM). Defaults to {@code CF_INSTANCE_CERT} env variable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.pcf.instance-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the instance key (PEM). Defaults to {@code CF_INSTANCE_KEY} env variable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.pcf.pcf-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pcf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mount path of the Kubernetes authentication backend.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.pcf.role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the role against which the login is being attempted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8200</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vault server port.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.read-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read timeout.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>https</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol scheme. Can be either "http" or "https".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.ssl.cert-auth-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mount path of the TLS cert authentication backend.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.ssl.key-store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust store that holds certificates and private keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.ssl.key-store-password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password used to access the key store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.ssl.trust-store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trust store that holds SSL certificates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.ssl.trust-store-password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password used to access the trust store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Static vault token. Required if {@link #authentication} is {@code TOKEN}.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.vault.uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vault URI. Can be set with scheme, host and port.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.base-sleep-time-ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>50</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial amount of time to wait between retries.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.block-until-connected-unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unit of time related to blocking on connection to Zookeeper.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.block-until-connected-wait</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wait time to block on connection to Zookeeper.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.connect-string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localhost:2181</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection string to the Zookeeper cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.connection-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The configured connection timeout in milliseconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.default-health-endpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default health endpoint that will be checked to verify that a dependency is alive.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mapping of alias to ZookeeperDependency. From Ribbon perspective the alias is actually serviceID since Ribbon can't accept nested structures in serviceID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.dependency-configurations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.dependency-names</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.discovery.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.discovery.initial-status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The initial status of this instance (defaults to {@link StatusConstants#STATUS_UP}).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.discovery.instance-host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Predefined host with which a service can register itself in Zookeeper. Corresponds to the {code address} from the URI spec.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.discovery.instance-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Id used to register with zookeeper. Defaults to a random UUID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.discovery.instance-port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port to register the service under (defaults to listening port).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.discovery.instance-ssl-port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ssl port of the registered service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.discovery.metadata</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets the metadata name/value pairs associated with this instance. This information is sent to zookeeper and can be used by other instances.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.discovery.order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Order of the discovery client used by `CompositeDiscoveryClient` for sorting available clients.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.discovery.register</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Register as a service in zookeeper.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.discovery.root</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/services</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root Zookeeper folder in which all instances are registered.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.discovery.uri-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{scheme}://{address}:{port}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URI specification to resolve during service registration in Zookeeper.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is Zookeeper enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.max-retries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max number of times to retry.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.max-sleep-ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>500</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max time in ms to sleep on each retry.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common prefix that will be applied to all Zookeeper dependencies' paths.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.session-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The configured/negotiated session timeout in milliseconds. Please refer to &lt;a href='<a href="https://cwiki.apache.org/confluence/display/CURATOR/TN14&#39;%3ECurator&#39;s" class="bare">cwiki.apache.org/confluence/display/CURATOR/TN14'&gt;Curator's</a> Tech Note 14&lt;/a&gt; to understand how Curator implements connection sessions. @see &lt;a href='<a href="https://cwiki.apache.org/confluence/display/CURATOR/TN14&#39;%3ECurator&#39;s" class="bare">cwiki.apache.org/confluence/display/CURATOR/TN14'&gt;Curator's</a> Tech Note 14&lt;/a&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.annotation.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.async.configurer.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable default AsyncConfigurer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.async.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable instrumenting async related components so that the tracing information is passed between threads.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.async.ignored-beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of {@link java.util.concurrent.Executor} bean names that should be ignored and not wrapped in a trace representation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.baggage-keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of baggage key names that should be propagated out of process. These keys will be prefixed with `baggage` before the actual key. This property is set in order to be backward compatible with previous Sleuth versions. @see brave.propagation.ExtraFieldPropagation.FactoryBuilder#addPrefixedFields(String, java.util.Collection)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.baggage.correlation-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a {@link CorrelationScopeDecorator} to put baggage values into the correlation context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.baggage.correlation-fields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of {@link BaggageField#name() fields} to add to correlation (MDC) context. @see CorrelationScopeConfig.SingleCorrelationField#create(BaggageField)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.baggage.local-fields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as {@link #remoteFields} except that this field is not propagated to remote services. @see BaggagePropagationConfig.SingleBaggageField#local(BaggageField)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.baggage.remote-fields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields that are referenced the same in-process as it is on the wire. For example, the field "x-vcap-request-id" would be set as-is including the prefix. @see BaggagePropagationConfig.SingleBaggageField#remote(BaggageField) @see BaggagePropagationConfig.SingleBaggageField.Builder#addKeyName(String)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.baggage.tag-fields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of {@link BaggageField#name() fields} to tag into the span. @see Tags#BAGGAGE_FIELD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.circuitbreaker.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable Spring Cloud CircuitBreaker instrumentation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.feign.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable span information propagation when using Feign.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.feign.processor.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable post processor that wraps Feign Context in its tracing representations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.grpc.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable span information propagation when using GRPC.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.http.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.http.legacy.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the legacy Sleuth setup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.hystrix.strategy.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable custom HystrixConcurrencyStrategy that wraps all Callable instances into their Sleuth representative - the TraceCallable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.hystrix.strategy.passthrough</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When enabled the tracing information is passed to the Hystrix execution threads but spans are not created for each execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.integration.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable Spring Integration sleuth instrumentation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.integration.patterns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[!hystrixStreamOutput*, <strong>, !channel</strong>]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An array of patterns against which channel names will be matched. @see org.springframework.integration.config.GlobalChannelInterceptor#patterns() Defaults to any channel name not matching the Hystrix Stream and functional Stream channel names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.integration.websockets.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable tracing for WebSockets.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.keys.http.headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional headers that should be added as tags if they exist. If the header value is multi-valued, the tag value will be a comma-separated, single-quoted list.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.keys.http.prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http.</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefix for header names if they are added as tags.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.local-keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as {@link #propagationKeys} except that this field is not propagated to remote services. @see brave.propagation.ExtraFieldPropagation.FactoryBuilder#addRedactedField(String) @deprecated use {@code spring.sleuth.baggage.local-fields} property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.log.slf4j.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable a {@link Slf4jScopeDecorator} that prints tracing information in the logs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.log.slf4j.whitelisted-mdc-keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of keys to be put from baggage to MDC. @deprecated use spring.sleuth.baggage.correlation-fields property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.messaging.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should messaging be turned on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.messaging.jms.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable tracing of JMS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.messaging.jms.remote-service-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jms</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.messaging.kafka.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable tracing of Kafka.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.messaging.kafka.mapper.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable DefaultKafkaHeaderMapper tracing for Kafka.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.messaging.kafka.remote-service-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.messaging.rabbit.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable tracing of RabbitMQ.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.messaging.rabbit.remote-service-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rabbitmq</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.opentracing.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.propagation-keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields that are referenced the same in-process as it is on the wire. For example, the name "x-vcap-request-id" would be set as-is including the prefix. &lt;p&gt; Note: {@code fieldName} will be implicitly lower-cased. @see brave.propagation.ExtraFieldPropagation.FactoryBuilder#addField(String) @deprecated use {@code spring.sleuth.baggage.remote-fields} property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.propagation.tag.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables a {@link TagPropagationFinishedSpanHandler} that adds extra propagated fields to span tags.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.propagation.tag.whitelisted-keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of keys to be put from extra propagation fields to span tags.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.reactor.decorate-on-each</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When true decorates on each operator, will be less performing, but logging will always contain the tracing entries in each operator. When false decorates on last operator, will be more performing, but logging might not always contain the tracing entries.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.reactor.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When true enables instrumentation for reactor.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.redis.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable span information propagation when using Redis.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.redis.remote-service-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>redis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service name for the remote Redis endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.rpc.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable tracing of RPC.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.rxjava.schedulers.hook.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable support for RxJava via RxJavaSchedulersHook.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.rxjava.schedulers.ignoredthreads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[HystrixMetricPoller, ^RxComputation.*$]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thread names for which spans will not be sampled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.sampler.probability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Probability of requests that should be sampled. E.g. 1.0 - 100% requests should be sampled. The precision is whole-numbers only (i.e. there's no support for 0.1% of the traces).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.sampler.rate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A rate per second can be a nice choice for low-traffic endpoints as it allows you surge protection. For example, you may never expect the endpoint to get more than 50 requests per second. If there was a sudden surge of traffic, to 5000 requests per second, you would still end up with 50 traces per second. Conversely, if you had a percentage, like 10%, the same surge would end up with 500 traces per second, possibly overloading your storage. Amazon X-Ray includes a rate-limited sampler (named Reservoir) for this purpose. Brave has taken the same approach via the {@link brave.sampler.RateLimitingSampler}.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.scheduled.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable tracing for {@link org.springframework.scheduling.annotation.Scheduled}.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.scheduled.skip-pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.springframework.cloud.netflix.hystrix.stream.HystrixStreamTask</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pattern for the fully qualified name of a class that should be skipped.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.supports-join</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True means the tracing system supports sharing a span ID between a client and server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.trace-id128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When true, generate 128-bit trace IDs instead of 64-bit ones.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.web.additional-skip-pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional pattern for URLs that should be skipped in tracing. This will be appended to the {@link SleuthWebProperties#skipPattern}.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.web.client.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable interceptor injecting into {@link org.springframework.web.client.RestTemplate}.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.web.client.skip-pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pattern for URLs that should be skipped in client side tracing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.web.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When true enables instrumentation for web applications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.web.exception-logging-filter-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to toggle the presence of a filter that logs thrown exceptions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.web.exception-throwing-filter-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to toggle the presence of a filter that logs thrown exceptions. @deprecated use {@link #exceptionLoggingFilterEnabled}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.web.filter-order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Order in which the tracing filters should be registered. Defaults to {@link TraceHttpAutoConfiguration#TRACING_FILTER_ORDER}.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.web.ignore-auto-configured-skip-patterns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, auto-configured skip patterns will be ignored. @see TraceWebAutoConfiguration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.web.skip-pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.sleuth.zuul.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable span information propagation when using Zuul.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.zipkin.activemq.message-max-bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>100000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of bytes for a given message with spans sent to Zipkin over ActiveMQ.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.zipkin.activemq.queue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zipkin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the ActiveMQ queue where spans should be sent to Zipkin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.zipkin.base-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://localhost:9411/" class="bare">localhost:9411/</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL of the zipkin query server instance. You can also provide the service id of the Zipkin server if Zipkin's registered in service discovery (e.g. <a href="https://zipkinserver/" class="bare">zipkinserver/</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.zipkin.compression.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.zipkin.discovery-client-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to {@code false}, will treat the {@link ZipkinProperties#baseUrl} as a URL always.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.zipkin.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables sending spans to Zipkin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.zipkin.encoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encoding type of spans sent to Zipkin. Set to {@link SpanBytesEncoder#JSON_V1} if your server is not recent.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.zipkin.kafka.topic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zipkin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Kafka topic where spans should be sent to Zipkin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.zipkin.locator.discovery.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabling of locating the host name via service discovery.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.zipkin.message-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout in seconds before pending spans will be sent in batches to Zipkin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.zipkin.rabbitmq.addresses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Addresses of the RabbitMQ brokers used to send spans to Zipkin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.zipkin.rabbitmq.queue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zipkin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the RabbitMQ queue where spans should be sent to Zipkin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.zipkin.sender.type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Means of sending spans to Zipkin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.zipkin.service.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the service, from which the Span was sent via HTTP, that should appear in Zipkin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.amqp.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable support for Stub Runner and AMQP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.amqp.mockCOnnection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable support for Stub Runner and AMQP mocked connection factory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.classifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>stubs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The classifier to use by default in ivy co-ordinates for a stub.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.cloud.consul.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable stubs registration in Consul.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.cloud.delegate.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable DiscoveryClient's Stub Runner implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.cloud.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable Spring Cloud support for Stub Runner.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.cloud.eureka.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable stubs registration in Eureka.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.cloud.loadbalancer.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable Stub Runner's Spring Cloud Load Balancer integration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.cloud.stubbed.discovery.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether Service Discovery should be stubbed for Stub Runner. If set to false, stubs will get registered in real service discovery.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.cloud.zookeeper.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable stubs registration in Zookeeper.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.consumer-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can override the default {@code spring.application.name} of this field by setting a value to this parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.delete-stubs-after-test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to {@code false} will NOT delete stubs from a temporary folder after running tests.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.fail-on-no-stubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When enabled, this flag will tell stub runner to throw an exception when no stubs / contracts were found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.generate-stubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When enabled, this flag will tell stub runner to not load the generated stubs, but convert the found contracts at runtime to a stub format and run those stubs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.http-server-stub-configurer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration for an HTTP server stub.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.ids</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ids of the stubs to run in "ivy" notation ([groupId]:artifactId:[version]:[classifier][:port]). {@code groupId}, {@code classifier}, {@code version} and {@code port} can be optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.ids-to-service-ids</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mapping of Ivy notation based ids to serviceIds inside your application. Example "a:b" -&gt; "myService" "artifactId" -&gt; "myOtherService"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.integration.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable Stub Runner integration with Spring Integration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.jms.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable Stub Runner integration with Spring JMS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.kafka.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable Stub Runner integration with Spring Kafka.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.kafka.initializer.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to allow Stub Runner to take care of polling for messages instead of the KafkaStubMessages component. The latter should be used only on the producer side.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.mappings-output-folder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dumps the mappings of each HTTP server to the selected folder.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.max-port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max value of a port for the automatically started WireMock server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.min-port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Min value of a port for the automatically started WireMock server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Repository password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map of properties that can be passed to custom {@link org.springframework.cloud.contract.stubrunner.StubDownloaderBuilder}.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.proxy-host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Repository proxy host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.proxy-port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Repository proxy port.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.stream.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable Stub Runner integration with Spring Cloud Stream.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.stubs-mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pick where the stubs should come from.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.stubs-per-consumer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should only stubs for this particular consumer get registered in HTTP server stub.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Repository username.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wiremock.placeholders.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to indicate that http URLs in generated wiremock stubs should be filtered to add or resolve a placeholder for a dynamic port.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wiremock.reset-mappings-after-each-test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wiremock.rest-template-ssl-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wiremock.server.files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[]</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wiremock.server.https-port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wiremock.server.https-port-dynamic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wiremock.server.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8080</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wiremock.server.port-dynamic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wiremock.server.stubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[]</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zuul.ribbon-isolation-strategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zuul.ribbon.eager-load.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables eager loading of Ribbon clients on startup.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<link rel="stylesheet" href="./Spring Cloud_files/github.min.css">
<script src="./Spring Cloud_files/highlight.min.js.下载"></script>
<script>hljs.initHighlighting()</script>
<script>if(window.parent==window){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-2728886-23','auto',{'siteSpeedSampleRate':100});ga('send','pageview');}</script>
</body></html>